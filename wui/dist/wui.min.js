/*!
 *  WUI 简介 
 *  
 *  v0.0.1_beta date: 2018-05-14
 *  Now Version: v0.2.0_beta date: 2019-05-20
 *  
 *  WUI 是 Web User Interface 的简称
 *  -----------------------------------------------------------
 *  WUI Team
 *  部门: 广州擎云创新研发中心
 *  -----------------------------------------------------------
 *  WUI 反馈邮箱: chenzx@cloudmtr.com
 *
 *  Copyright (c) 2016-2019
 */
var libs=window.jQuery||window.$||$,FRAME_NAME="wui",wui=function(e,t,i){var r="v0.2.0 内测版",n="20190610001",o=t.WUI_CONFIG||{},a=t.WUI_PARAMS||{},s=t.WUI_LANGUAGE||{},l="/",d=document.location.protocol+"//"+document.location.host+l,u=document.getElementsByTagName("script"),h=u[u.length-1],c=document.querySelector?h.src:h.getAttribute("src",4),f=c.lastIndexOf(l),p=c.substring(0,f)+l,m=function(e,t,i){if(i=i||{},t.attr("ui-type")){var r=t.attr("ui-type");if(widgetId=t.attr("id")||t.attr("name"),"file"!==r&&"img"!==r||(widgetId=t.parent().attr("_fileId")),wui&&wui[r]){var n=wui[r](widgetId).get("value");if(v.isArray(n)&&n.length>0)return!0;if("string"==typeof n&&""!==n)return!0}switch(e.hide(),r){case"file":v.tips(e[0].innerHTML,t.parent(),i);break;case"date":v.tips(e[0].innerHTML,t,i);break;case"img":v.tips(e[0].innerHTML,t.parent(),i);break;case"opinionBox":v.tips(e[0].innerHTML,t.next().children("textarea"),i);break;default:v.tips(e[0].innerHTML,t.parent(),i)}}else v.tips(e[0].innerHTML,t,i)},g=function(e,t,i){if(t.attr("ui-type")){var r=t.attr("ui-type");switch(r){case"file":e.insertAfter(t);break;case"date":e.insertAfter(t);break;case"img":e.insertAfter(t);break;case"opinionBox":break;default:e.insertAfter(t.parent())}}else if(t.is("select"))e.insertAfter(t);else if("checkbox"===t.prop("type"))if(t.parents(".wui-valid-tip")&&t.parents(".wui-valid-tip").length>0){var n=t.parents(".wui-valid-tip"),o=n.attr("wui-valid-tip");n[o](e)}else e.insertAfter(t);else if("radio"===t.prop("type"))if(t.parents(".wui-valid-tip")&&t.parents(".wui-valid-tip").length>0){var n=t.parents(".wui-valid-tip"),o=n.attr("wui-valid-tip");n[o](e)}else e.insertAfter(t);else e.insertAfter(t)},v={isDebug:!0,context:l,fileContext:"",contextPath:d,FRAME_PATH:p,commonPageBasePath:d+"common-pages/",uploadFlashUrl:p+"/plugins/swfupload/Flash/swfupload.swf",logUtilConfig:{isLog:!0,isLogMethodCalled:!0,isLogParamValue:!0,isLogMessage:!0,isLogError:!0,isLogWarn:!0,debugLog:{className:FRAME_NAME,methodName:"",isDebug:!0},debugConfig:{isLogMethodCalled:!1,isLogParamValue:!1,isLogMessage:!1,isLogError:!0,isLogWarn:!0}},CONSTANTS:{EMPTYFUNC:i,KEYS:{CLEAR:"12",ENTER:"13",NEXT:"34",END:"35",HOME:"36",LEFT:"37",UP:"38",RIGHT:"39",DOWN:"40",OTHER:"44",DELETE:"46",BACKSPACE:"8"},ISCODEURLVALUE:i,WUI_PROJECT_PATH:p,DATAATTRIBUTEFIELD:"wui",DATAINITWIDGETFIELD:"init-wui",SKINNAMEFIELD:"wuiSkinName",URLVALUEEXTSTRING:"####",OMODALWINDOW:["top","parent","self"]},validateUtilConfig:{errorTipStyles:{tips:m,label:g},errorTipStyle:"tips",isAddRequiredStar:!0,labelErrorClass:"valid-emement-error",elementErrorClass:"validate-error",elementSuccessClass:"",starDirection:"left"},validateAttributeField:"validate",serviceInterface:{orgServiceAPI:"",subOrgServiceAPI:"",userServiceAPI:"",chooseUserServiceAPI:"",gridFileUploadServiceAPI:"",gridImportServiceAPI:"",opinionBoxSource:null},skinConfig:{skinFileName:"style.css",skinId:"wuiSkin",isAddSkin:!1,isInitSkin:!0},isInitPage:!1,modalWindow:"top",pageHeight:"570px",pageWidth:"1300px",selectBoxSetting:{isTriggerSelectEvent:!0},gridSetting:{defaultColConfig:{key:!1,label:"",name:"",align:"",hidden:!1,hidedlg:!1,frozen:!1,fixed:!0,drap:!1,sortable:!1,editable:!1,formatter:"",wstype:"",search:!1,stype:"text",searchoptions:{searchhidden:!0},formatDate:"yyyy-mm-dd",searchDefVal:"",searchSort:8,searchrules:{}}},dictCodeSetting:{items:null,name:"id",text:"name"},commonOpinions:["同意。","不同意。","阅。","照拟。","传阅"],commonOpinionsSetting:{},isAddRandomCode:!0,extVariables:{}},b={isIE:function(){var e=navigator.userAgent,t=/(msie\s|trident.*rv:)([\w.]+)/,i=e.toLowerCase(),r=t.exec(i);return null!=r},isChrome:function(){var e=navigator.userAgent,t=/(chrome)\/([\w.]+)/,i=e.toLowerCase(),r=t.exec(i);return null!=r},isMozila:function(){var e=navigator.userAgent,t=/(firefox)\/([\w.]+)/,i=e.toLowerCase(),r=t.exec(i);return null!=r},isOpera:function(){var e=navigator.userAgent,t=/(opera).+version\/([\w.]+)/,i=e.toLowerCase(),r=t.exec(i);return null!=r},isSafari:function(){var e=navigator.userAgent,t=/version\/([\w.]+).*(safari)/,i=e.toLowerCase(),r=t.exec(i);return null!=r},isIE7:!!navigator.userAgent.match(/MSIE 7.0/),isIE8:!!navigator.userAgent.match(/MSIE 8.0/),isIE9:!!navigator.userAgent.match(/MSIE 9.0/),isIE10:!!navigator.userAgent.match(/MSIE 10.0/)};return e.extend(!0,v.CONSTANTS,b),v.CONSTANTS.isIE7||v.CONSTANTS.isIE8||v.CONSTANTS.isIE9?v.CONSTANTS.ISSUPPORTH5=!1:v.CONSTANTS.ISSUPPORTH5=!0,v.CONSTANTS.FILE_STATUS={},v.CONSTANTS.ISSUPPORTH5&&t.Dropzone?(v.CONSTANTS.FILE_STATUS.QUEUED=Dropzone.QUEUED,v.CONSTANTS.FILE_STATUS.PROCESSING=Dropzone.PROCESSING,v.CONSTANTS.FILE_STATUS.CANCELED=Dropzone.CANCELED,v.CONSTANTS.FILE_STATUS.ERROR=Dropzone.ERROR,v.CONSTANTS.FILE_STATUS.SUCCESS=Dropzone.SUCCESS):!v.CONSTANTS.ISSUPPORTH5&&t.SWFUpload&&(v.CONSTANTS.FILE_STATUS.QUEUED=SWFUpload.FILE_STATUS.QUEUED,v.CONSTANTS.FILE_STATUS.PROCESSING=SWFUpload.FILE_STATUS.IN_PROGRESS,v.CONSTANTS.FILE_STATUS.CANCELED=SWFUpload.FILE_STATUS.CANCELLED,v.CONSTANTS.FILE_STATUS.ERROR=SWFUpload.FILE_STATUS.ERROR,v.CONSTANTS.FILE_STATUS.SUCCESS=SWFUpload.FILE_STATUS.COMPLETE),v.layerSetting={title:"信息",url:d,skin:"",width:"800px",height:"460px",offset:"auto",icon:i,shade:.3,closeBtn:1,time:0,maxWidth:360,maxHeight:"auto",zIndex:"19950105",tips:2,isShadeClose:!1,isMaxmin:!1,isFixed:!0,isResize:!0,isShowMultipleTips:!0,isScrollbar:!1,isFull:!1,onResizing:v.CONSTANTS.EMPTYFUNC,onPoped:v.CONSTANTS.EMPTYFUNC,onSure:v.CONSTANTS.EMPTYFUNC,onCancel:v.CONSTANTS.EMPTYFUNC,onClosed:v.CONSTANTS.EMPTYFUNC,onFull:v.CONSTANTS.EMPTYFUNC,onMin:v.CONSTANTS.EMPTYFUNC,onRestore:v.CONSTANTS.EMPTYFUNC},e.extend(!0,v,a),e.each(o,function(e,t){"isLog"===e||"isLogMethodCalled"===e||"isLogParamValue"===e||"isLogMessage"===e||"isLogError"===e||"isLogWarn"===e?v.logUtilConfig[e]=t:"isAddRequiredStar"===e||"starDirection"===e?v.validateUtilConfig[e]=t:"orgServiceAPI"===e||"subOrgServiceAPI"===e||"userServiceAPI"===e||"chooseUserServiceAPI"===e||"gridFileUploadServiceAPI"===e||"gridImportServiceAPI"===e||"opinionBoxSource"===e?v.serviceInterface[e]=t:v[e]=t}),v.language={date:{days:["星期日","星期一","星期二","星期三","星期四","星期五","星期六","星期日"],daysShort:["周日","周一","周二","周三","周四","周五","周六","周日"],daysMin:["日","一","二","三","四","五","六","日"],months:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],monthsShort:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],today:"今日",clear:"清空",suffix:[],meridiem:["上午","下午"],clearBtn:"<i class='fa fa-remove'></i>"},chooseBox:{editBtn:"<i class='fa fa-edit'></i>",clearBtn:"<i class='fa fa-trash'></i>"},file:{dictDefaultMessage:"",dictFallbackMessage:"您的浏览器不支持拖放文件上传.",dictFallbackText:"",dictFileTooBig:"文件 ({{filesize}}MB)字节过大。允许上传的最大文件大小: {{maxFilesize}}MB.",dictInvalidFileType:"此类型文件不被支持上传",dictResponseError:"服务器返回状态代码为 {{statusCode}}",dictUploadCanceled:"文件上传被取消",dictCancelUploadConfirmation:"您确定取消上传吗?",dictRemoveFile:'<i title="取消上传" class="fa fa-trash"></i>',dictUploadFile:'<i title="上传" class="fa fa-cloud-upload"></i>',dictDownloadFile:'<i title="下载" class="fa fa-cloud-download"></i>',dictCancelUpload:'<i title="删除" class="fa fa-close"></i>',dictMaxFilesExceeded:"您上传文件数量达到上限。"},img:{dictCancelUpload:'<i class="fa fa-close"></i>',dictEditFile:'<i class="fa fa-edit"></i>',dictRemoveFile:'<i class="fa fa-trash"></i>'},grid:{searchBar:{searchBtn:'<i class="fa fa-search"></i>',resetBtn:'<i class="fa fa-refresh"></i>',showMoreBtn:'<i class="fa fa-chevron-down"></i>',hideMoreBtn:'<i class="fa fa-chevron-up"></i>'},toolBar:{resetBtn:'<i class="fa fa-refresh"></i> 重置',showFilterBtn:'<i class="fa fa-filter"></i> 显示数据过滤',highSearchBtn:'<i class="fa fa-search"></i> 高级搜索',exportBtn:'<i class="fa fa-sign-out"></i> 导出',importBtn:'<i class="fa fa-sign-in"></i> 导入',screenBtn:'<i class="fa fa-filter"></i> 筛选',filterShowString:"显示",filterHideString:"隐藏"},importPageTitle:"列表数据导入",treeIcon:{plus:"fa fa-angle-right wui-fa-middle",minus:"fa fa-angle-down wui-fa-middle",leaf:"wui-text-primary"},defaultText:{emptyrowstext:"<div>** 暂无数据 **</div>",recordtext:"{0} - {1}　共 {2} 条",emptyrecords:"",loadtext:"<img src='"+v.FRAME_PATH+"themes/images/loading-1.gif' title='加载中...' />",savetext:"保存中...",pgtext:" {0} 共 {1} 页",pgfirst:"首页",pglast:"尾页",pgnext:"下一页",pgprev:"上一页",pgrecs:"页码记录",showhide:"列表折叠或展开",overPageNumberText:"当前列表最多只有 {0} 页",pagerCaption:"Grid::页码设置",pageText:"页码:",recordPage:"每页记录",nomorerecs:"没有更多的记录了...",scrollPullup:"上拉加载更多...",scrollPulldown:"下拉刷新...",scrollRefresh:"释放刷新..."},singleColHead:"选择"},selectBox:{noneSelected:"没有选中任何项",noneResults:"匹配不到'{0}'",deselectAll:"全不选",selectAll:"全选",doneButton:"关闭",liveSearchPlaceholder:"查找选项"},selectComboBox:{noneSelected:"没有选中任何项"},tagBox:{placeholder:"",noneItem:"没有标签"},tagComboBox:{noneItem:""},tagsinput:{noneItem:""},tree:{virtualRootTitle:"虚拟根节点"},ueditor:{initialContent:"",wordOverFlowMsg:'<span style="color:red;">你输入的字符个数已经超出最大允许值,服务器可能会拒绝保存！</span>'}},e.extend(!0,v.language,s),v.version=r,v.versionDate=n,v.stopPropagation=function(e){v.logUtilConfig.debugLog.methodName="stopPropagation",v.logMethodCalled(v.logUtilConfig.debugLog),e=e||t.event,e.stopPropagation()},v.preventDefault=function(e){v.logUtilConfig.debugLog.methodName="preventDefault",v.logMethodCalled(v.logUtilConfig.debugLog),e.preventDefault()},v.addEventListener=function(e,t,i,r){v.logUtilConfig.debugLog.methodName="addEventListener",v.logMethodCalled(v.logUtilConfig.debugLog),e.addEventListener?e.addEventListener(t,i,r):e.attachEvent?e.attachEvent("on"+t,i):e["on"+t]=i},v.removeEventListener=function(e,t,i,r){v.logUtilConfig.debugLog.methodName="removeEventListener",v.logMethodCalled(v.logUtilConfig.debugLog),e.addEventListener?e.removeEventListener(t,i,r):e.attachEvent?e.detachEvent("on"+t,i):e["on"+t]=null},v.ready=function(e){v.logUtilConfig.debugLog.methodName="ready",v.logMethodCalled(v.logUtilConfig.debugLog)},v}(libs,window);!function(e,t,i){return e.scroll=function(r,n){e.logUtilConfig.debugLog.methodName="scroll",e.logMethodCalled(e.logUtilConfig.debugLog);var o;if(!r)return e.logError("$element 参数不能为空",FRAME_NAME+".scroll",!0),!1;o=e.isJQuery(r)?r:t(r),n=n||{};var a=n.size||"8px",s=n.color||"#ccc",l=n.autohidemode!==i?n.autohidemode:"cursor",d=n.cursoropacitymax||1,u=n.cursoropacitymin||0,h=n.oneaxismousemode!=i?n.oneaxismousemode:"auto",c={cursorborder:"",cursorwidth:a,cursorcolor:s,autohidemode:l,cursoropacitymax:d,cursoropacitymin:u,oneaxismousemode:h,cursorborderradius:"5px",horizrailenabled:!0,enablekeyboard:!0},f=[];return o.each(function(){var i=t(this).niceScroll(c);t(this).children().length>0?t(this).children().each(function(r,n){e.onresize(t(n),function(e,t){i.resize()})}):e.onresize(t(this),function(e,t){i.resize()}),f.push(i)}),1==f.length?f[0]:f},e.onresize=function(i,r){e.logUtilConfig.debugLog.methodName="onresize",e.logMethodCalled(e.logUtilConfig.debugLog),"function"==typeof i?(r=i,i=t(window)):"string"==typeof i?i=t(i):"undefined"==typeof i&&(e.logMessage("传入空参数","wui.onresize",!0),i=t(window));var n=i.width(),o=i.height();i.on("resize",function(){n==i.width()&&o==i.height()||(n=i.width(),o=i.height(),r&&"function"==typeof r&&r(n,o))})},e.setFullScreenHeight=function(i,r,n){if(e.logUtilConfig.debugLog.methodName="setFullScreenHeight",e.logMethodCalled(e.logUtilConfig.debugLog),!i)return e.logError("必须传入要计算全屏的DOM节点",FRAME_NAME+".setFullScreenHeight",!0),!1;var o=null;if(e.isJQuery(i)&&i.exist())o=i;else{if(!t(i).exist())return e.logError("页面中不存在此节点",FRAME_NAME+".setFullScreenHeight",!0),!1;o=t(i)}var a=e.getViewSize(),s=t(window).scrollLeft(),l=t(window).scrollTop(),d=o.offset(),u=a.width-(d.left-s),h=a.height-(d.top-l);return r?(r=t.extend(!0,{},{left:0,right:0,top:0,bottom:0},r),(r.top||r.bottom)&&(h=h-parseInt(r.top)-parseInt(r.bottom),o.height(h)),(r.left||r.right)&&(u=u-parseInt(r.left)-parseInt(r.right),o.width(u))):(o.height(h),o.width(u)),n&&e.scroll(o,{height:h}),{width:u,height:h}},e.getFullScreenSize=function(i){if(e.logUtilConfig.debugLog.methodName="getFullScreenSize",e.logMethodCalled(e.logUtilConfig.debugLog),!i)return e.logError("必须传入要计算全屏的DOM节点",FRAME_NAME+".getFullScreenSize",!0),!1;var r=null;if(e.isJQuery(i)&&i.exist())r=i;else{if(!t(i).exist())return e.logError("页面中不存在此节点",FRAME_NAME+".getFullScreenSize",!0),!1;r=t(i)}var n=e.getViewSize(),o=t(window).scrollLeft(),a=t(window).scrollTop(),s=r.offset(),l=n.width-(s.left-o),d=n.height-(s.top-a);return{width:l,height:d}},e.getViewSize=function(){e.logUtilConfig.debugLog.methodName="getViewSize",e.logMethodCalled(e.logUtilConfig.debugLog);var t,i;return window.innerHeight?(t=window.innerWidth,i=window.innerHeight):document.documentElement&&document.documentElement.clientHeight?(t=document.documentElement.clientWidth,i=document.documentElement.clientHeight):document.body&&(t=document.body.clientWidth,i=document.body.clientHeight),{width:t,height:i}},e.getBrowserVersion=function(){e.logUtilConfig.debugLog.methodName="getBrowserVersion",e.logMethodCalled(e.logUtilConfig.debugLog);var t=navigator.userAgent,i=/(msie\s|trident.*rv:)([\w.]+)/,r=/(firefox)\/([\w.]+)/,n=/(opera).+version\/([\w.]+)/,o=/(chrome)\/([\w.]+)/,a=/version\/([\w.]+).*(safari)/,s=t.toLowerCase(),l=i.exec(s);if(null!=l)return{browser:"IE",version:l[2]||"0"};var l=r.exec(s);if(null!=l)return{browser:l[1]||"",version:l[2]||"0"};var l=n.exec(s);if(null!=l)return{browser:l[1]||"",version:l[2]||"0"};var l=o.exec(s);if(null!=l)return{browser:l[1]||"",version:l[2]||"0"};var l=a.exec(s);return null!=l?{browser:l[2]||"",version:l[1]||"0"}:null!=l?{browser:"",version:"0"}:void 0},e.guid=function(){function t(){return(65536*(1+Math.random())|0).toString(16).substring(1)}return e.logUtilConfig.debugLog.methodName="guid",e.logMethodCalled(e.logUtilConfig.debugLog),t()+t()+"-"+t()+"-"+t()+"-"+t()+"-"+t()+t()+t()},e.getTimeFormat=function(t,i){e.logUtilConfig.debugLog.methodName="getTimeFormat",e.logMethodCalled(e.logUtilConfig.debugLog);var r=0;try{if(!t)return e.logError("要转化的日期参数不能为空",FRAME_NAME+".getTimeFormat",!0),!1;if("object"==typeof t)r=t.getTime();else{if("number"!=typeof t)return e.logError("要转化的日期参数不是时间戳:"+t,FRAME_NAME+".getTimeFormat",!0),!1;r=t}}catch(n){return e.logError(n,FRAME_NAME+".getTimeFormat",!0),!1}10==r.toString().length&&(r=1e3*r),i=i||"yyyy-mm-dd";var o=new Date(r),a=i,s=["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],l=["Jan.","Feb.","Mar.","Apr.","May","Jun.","Jul.","Aug.","Sep.","Oct.","Nov.","Dec."],d=["日","一","二","三","四","五","六"],u=["Sun.","Mon.","Tues.","Wed.","Thur.","Fri.","Sat."];a=a.replace(/yyyy|YYYY/,o.getFullYear()),a=a.replace(/yy|YY/,o.getYear()%100>9?(o.getYear()%100).toString():"0"+o.getYear()%100),a=a.replace(/MM/,s[o.getMonth()]),a=a.replace(/M/g,l[o.getMonth()]),a=a.replace(/mm/,o.getMonth()+1>9?(o.getMonth()+1).toString():"0"+(o.getMonth()+1)),a=a.replace(/m/g,o.getMonth()+1),a=a.replace(/w/g,d[o.getDay()]),a=a.replace(/W/g,u[o.getDay()]),a=a.replace(/dd|DD/,o.getDate()>9?o.getDate().toString():"0"+o.getDate()),a=a.replace(/d|D/g,o.getDate()),a=a.replace(/hh/,o.getHours()>9?o.getHours().toString():"0"+o.getHours()),a=a.replace(/h/g,o.getHours());var h=o.getHours()>12?o.getHours()-12:o.getHours();return a=a.replace(/HH/,h>9?h.toString():"0"+h),a=a.replace(/H/g,h),a=a.replace(/p/,o.getHours()>12?"p.m.":"a.m."),a=a.replace(/P/g,o.getHours()>12?"P.M.":"A.M."),a=a.replace(/ii/,o.getMinutes()>9?o.getMinutes().toString():"0"+o.getMinutes()),a=a.replace(/i/g,o.getMinutes()),a=a.replace(/ss|SS/,o.getSeconds()>9?o.getSeconds().toString():"0"+o.getSeconds()),a=a.replace(/s|S/g,o.getSeconds())},e.getDate=function(t,i){t=t?Number(t):0,i=i||"yyyy-mm-dd hh:ii:ss";var r=new Date,n=r.getTime(),o=new Date;return o.setTime(n+24*t*60*60*1e3),e.getTimeFormat(Date.parse(o),i)},e}(wui||{},libs),function(e,t,i){return e.createElement=function(e){var t=document.createElement("div");return t.innerHTML=e,t.childNodes[0]},e.getChooseBoxNode=function(){e.logUtilConfig.debugLog.methodName="getChooseBoxNode",e.logMethodCalled(e.logUtilConfig.debugLog);var t=e.getChooseBoxNodes(),i={node:[]};return t.length>0&&(i=t[t.length-1]),i.node},e.emptyChooseBoxNode=function(){e.logUtilConfig.debugLog.methodName="emptyChooseBoxNode",e.logMethodCalled(e.logUtilConfig.debugLog);var t=e.getChooseBoxNodes();return t.length>0&&(t[t.length-1].node=[]),!0},e.removeChooseBoxNode=function(){e.logUtilConfig.debugLog.methodName="removeChooseBoxNode",e.logMethodCalled(e.logUtilConfig.debugLog);var t=e.getChooseBoxNodes().pop();return t.node},e.addChooseBoxNode=function(t){e.logUtilConfig.debugLog.methodName="addChooseBoxNode",e.logMethodCalled(e.logUtilConfig.debugLog);var i={};i.node=t,e.getChooseBoxNodes().push(i)},e.getChooseBoxNodes=function(t){e.logUtilConfig.debugLog.methodName="getChooseBoxNodes",e.logMethodCalled(e.logUtilConfig.debugLog);var i=e.CONSTANTS.OMODALWINDOW.indexOf(e.modalWindow),r=window.top;if(i>-1){var n=e.CONSTANTS.OMODALWINDOW[i];r=window[n]}else"function"==typeof e.modalWindow&&(r=e.modalWindow.call(this,window));return r.chooseBoxNodes&&0!=r.chooseBoxNodes.length||(r.chooseBoxNodes=[]),e.logParamValue({paramName:"chooseBoxNodes",paramValue:r.chooseBoxNodes,methodName:"getChooseBoxNodes",className:FRAME_NAME,isDebug:!0}),r.chooseBoxNodes},e.parseInt=function(e,t){return e=parseInt(e,10),isNaN(e)?t||0:e},e.formatDate=function(t,i){if(!t)return!1;try{var r=/date/i;if(i=i||"yyyy-mm-dd","number"==typeof t)return e.getTimeFormat(t,i);if("object"==typeof t){var n=t.getTime();return e.getTimeFormat(n,i)}if("string"==typeof t){if(t.search(r)>-1){var n=t.slice(6,19);return e.getTimeFormat(parseInt(n),i)}var n=new Date(Date.parse(t.replace(/-/g,"/"))).getTime();return!isNaN(n)&&e.getTimeFormat(n,i)}return e.logWarn("date参数不符合格式要求","wui.formatDate",!0),!1}catch(o){return e.logError(o,FRAME_NAME+".formatDate",!0),!1}},e.formatOtherParam=function(t){return t?"object"==typeof t?t:"string"==typeof t?(t=e.parseToObj(t),t?t:{}):{}:{}},e.formatParamToBool=function(e){return!!e&&("number"==typeof e?!!e:"string"!=typeof e||"false"!=e&&"0"!=e&&""!=e)},e.formatParamToNumberBool=function(e){return e?"number"==typeof e?1:"string"==typeof e&&("false"==e||"0"==e||""==e)?0:1:0},e.formatMaxNumber=function(t){return t==i&&(t=!1),"string"==typeof t&&(t="false"!=t&&parseInt(t)),"number"==typeof t&&(isNaN(t)?t=!1:t<=0&&(e.logMessage("maxNumber参数必须为正整数或false","wui.formatMaxNumber",!0),t=!1)),t},e.formatMaxChars=function(t){return t==i&&(t=0),"string"==typeof t&&(t="false"==t?0:parseInt(t)),"number"==typeof t&&(isNaN(t)?t=0:t<=0&&(e.logMessage("maxChars参数必须为正整数或false","wui.formatMaxChars",!0),t=0)),t},e.init=function(i){e.logUtilConfig.debugLog.methodName="init",e.logMethodCalled(e.logUtilConfig.debugLog),e.isJson(i)||(i={});var r={};return t("[data-"+e.CONSTANTS.DATAINITWIDGETFIELD+"]").each(function(n,o){var a=t(o).attr("data-"+e.CONSTANTS.DATAINITWIDGETFIELD),s=t(o).attr("id");if(a&&s)if(e[a]){var l={};e.isUndefined(i[s])||(l=i[s]),r[s]=e[a](s,l)}else e.logWarn(a+" 组件初始化失败,错误信息:WUI查无此组件!",FRAME_NAME+".init",!0)}),r},e.getAttributeParams=function(t,i,r){i=i||{},r=r||e.CONSTANTS.DATAATTRIBUTEFIELD;var n=t.data(),o={};for(var a in n)if(0==a.toLowerCase().indexOf(r)){var s=a.toLowerCase().substring(r.length,a.length);if(e.isArray(i)){for(var l=0;l<i.length;l++)if(i[l].toLowerCase()==s){s=i[l];break}o[s]=n[a]}else if(e.isJson(i)){for(var d in i)if(d.toLowerCase()==s){s=d;break}var u=n[a];switch(typeof i[s]){case"boolean":u=e["boolean"](n[a]);break;case"number":u=e.number(n[a]);break;case"object":u=e.parseToObj(n[a])}o[s]=u}}return o},e.checkIsLoadPlugins=function(i){e.logUtilConfig.debugLog.methodName="checkIsLoadPlugins",e.logMethodCalled(e.logUtilConfig.debugLog);var r=!0;if(i){t("<div></div>").appendTo("body");switch(i){case"date":try{t.fn.datetimepicker||(e.logWarn("没有加载 date 所需第三方插件:datetimepicker",FRAME_NAME+".checkIsLoadPlugins",!0),r=!1)}catch(n){e.logWarn("没有加载 date 所需第三方插件",FRAME_NAME+".checkIsLoadPlugins",!0),r=!1}finally{break}case"file":try{"undefined"==typeof Dropzone&&(e.logWarn("没有加载 file 所需第三方插件:Dropzone",FRAME_NAME+".checkIsLoadPlugins",!0),r=!1),"undefined"==typeof SWFUpload&&(e.logWarn("没有加载 file 所需第三方插件:SWFUpload,在IE8下不被支持哟",FRAME_NAME+".checkIsLoadPlugins",!0),r=!1)}catch(n){e.logWarn("没有加载 file 所需第三方插件:Dropzone、SWFUpload",FRAME_NAME+".checkIsLoadPlugins",!0),r=!1}finally{break}case"tree":try{t.ui?t.ui.fancytree||(e.logWarn("没有加载 tree 所需第三方插件:fancytree",FRAME_NAME+".checkIsLoadPlugins",!0),r=!1):(e.logWarn("没有加载 tree 所需第三方插件:jquery-ui",FRAME_NAME+".checkIsLoadPlugins",!0),r=!1)}catch(n){e.logWarn("没有加载 tree 所需第三方插件:jquery-ui、fancytree",FRAME_NAME+".checkIsLoadPlugins",!0),r=!1}finally{break}case"grid":try{t.fn.jqGrid||(e.logWarn("没有加载 grid 所需第三方插件:jqGrid",FRAME_NAME+".checkIsLoadPlugins",!0),r=!1)}catch(n){e.logWarn("没有加载 grid 所需第三方插件",FRAME_NAME+".checkIsLoadPlugins",!0),r=!1}finally{break}case"img":try{"undefined"==typeof Dropzone&&(e.logWarn("没有加载 img 所需第三方插件:Dropzone",FRAME_NAME+".checkIsLoadPlugins",!0),r=!1),"undefined"==typeof SWFUpload&&(e.logWarn("没有加载 img 所需第三方插件:SWFUpload,在IE8下不被支持哟",FRAME_NAME+".checkIsLoadPlugins",!0),r=!1)}catch(n){e.logWarn("没有加载 img 所需第三方插件:Dropzone、SWFUpload",FRAME_NAME+".checkIsLoadPlugins",!0),r=!1}finally{break}}}return r},e.addToolBar=function(i,r,n){e.logUtilConfig.debugLog.methodName="addToolBar",e.logMethodCalled(e.logUtilConfig.debugLog),n=n||"after";var o=t('<span class="input-group-btn" wui-attr="toolBar" ui-control="toolBar"></span>');if(i instanceof jQuery)i[n](o);else{if("string"!=typeof i)return;t("#"+i)[n](o)}return t.each(r,function(e,i){var r=i.cssClass||"wui-btn-white",n=i.type||"button",a=t('<button class="wui-btn '+r+'" wui-toolBar-action="'+i.action+'" ui-toolBar-action="'+i.action+'" type="'+n+'" title="'+i.title+'">'+i.html+"</button>");o.append(a)}),!0},e.mask=function(i,r){e.logUtilConfig.debugLog.methodName="mask",e.logMethodCalled(e.logUtilConfig.debugLog),i=i||!1,r=parseInt(r)||1;var n='<div class="ui-mask"></div>';i?t(".ui-mask").length>0?t(".ui-mask").show():t("body").append(n):t(".ui-mask").hide(),r&&t(".ui-mask").attr("opacity",r)},e.deleteDataByIds=function(t,i,r){if(t){r=r||"您确定要删除选择数据吗？";var n={title:"删除确认"},o=function(e){i(t),wui.closeIndex(e)};wui.confirm(r,n,o)}else e.warnNotice("请至少选择一条数据")},e.textarea=function(i,r,n,o){var a;if(!i)return!1;a=e.isJQuery(i)?i:t(i),r=r||0,o=o||"none";var s=function(e,t){if(e.currentStyle){var i=e.currentStyle[t];if("height"===t&&1!==i.search(/px/i)){var r=e.getBoundingClientRect();return r.bottom-r.top-parseFloat(s(e,"paddingTop"))-parseFloat(s(e,"paddingBottom"))+"px"}return i}return window.getComputedStyle(e,null)[t]},l=function(t,i){var o,a,l=0,d=t.style;t._length!==t.value.length&&(t._length=t.value.length,e.CONSTANTS.isMozila||e.CONSTANTS.isOpera||(l=parseInt(s(t,"paddingTop"))+parseInt(s(t,"paddingBottom"))),o=document.body.scrollTop||document.documentElement.scrollTop,t.style.height=i+"px",t.scrollHeight>i&&(n&&t.scrollHeight>n?(a=n-l,d.overflowY="auto"):(a=t.scrollHeight-l,d.overflowY="hidden"),d.height=a+r+"px",o+=parseInt(d.height)-t.currHeight,document.body.scrollTop=o,document.documentElement.scrollTop=o,t.currHeight=parseInt(d.height)))};a.each(function(){var e=this;t(e).attr("data-auto-height","true"),e.style.resize=o;var i=parseFloat(s(e,"height"));t(e).on("propertychange input focus change",function(){l(this,i)}),l(e,i)})},e.input=function(i,r,n){var o;if(!i)return!1;o=e.isJQuery(i)?i:t(i),r=r||80;var a=function(e,i,r){var n=t(e).css("font-size"),o=t(e).css("font-family"),a=t(e).val(),s=parseInt(t(e).css("borderLeftWidth"))+parseInt(t(e).css("borderRightWidth")),l=parseInt(t(e).css("paddingLeft"))+parseInt(t(e).css("paddingRight"));r=r||t(e).parent().width();var d=a.width(n+" "+o),u=d+s+l;u<i?u=i:u>r&&(u=r),t(e).css("width",u+"px")};o.each(function(){var e=this;t(e).on("propertychange input focus",function(){a(this,r,n)}),a(e,r,n)})},e.getTextField=function(e){var t=[];if(e){var i=/\{\{(.+?)\}\}/g,r=e.match(i);if(r)for(var n=r.length,o=0;o<n;o++){var a={},s=/^\{\{(.+?)\}\}$/.exec(r[o]);s.length>1&&(a.match=s[0],a.value=s[1],t.push(a))}else for(var s=e.split(","),n=s.length,o=0;o<n;o++){var a={};a.match=s[o],a.value=s[o],t.push(a)}}return t},e}(wui||{},libs),function(ui,$,undefined){return ui.number=function(e){ui.isUndefined(e)&&(e=NaN);try{return Number(e)}catch(t){return NaN}},ui["boolean"]=function(e){return!!e&&("number"==typeof e?!!e:"string"!=typeof e||"false"!=e&&"0"!=e&&""!=e)},ui.isFunction=function(e){return ui.logUtilConfig.debugLog.methodName="isFunction",ui.logMethodCalled(ui.logUtilConfig.debugLog),!ui.isUndefined(e)&&"function"==typeof e},ui.isObject=function(e){return ui.logUtilConfig.debugLog.methodName="isObject",ui.logMethodCalled(ui.logUtilConfig.debugLog),!ui.isUndefined(e)&&"object"==typeof e},ui.isString=function(e){return ui.logUtilConfig.debugLog.methodName="isString",ui.logMethodCalled(ui.logUtilConfig.debugLog),!ui.isUndefined(e)&&"string"==typeof e},ui.isNaN=function(e){ui.logUtilConfig.debugLog.methodName="isNaN",ui.logMethodCalled(ui.logUtilConfig.debugLog);var t=Number.isNaN||window.isNaN;return!ui.isUndefined(e)&&t(e)},ui.isNumber=function(e){return ui.logUtilConfig.debugLog.methodName="isNumber",ui.logMethodCalled(ui.logUtilConfig.debugLog),!ui.isUndefined(e)&&("number"==typeof e&&!ui.isNaN(e))},ui.isBoolean=function(e){return ui.logUtilConfig.debugLog.methodName="isBoolean",ui.logMethodCalled(ui.logUtilConfig.debugLog),!ui.isUndefined(e)&&"boolean"==typeof e},ui.isUndefined=function(e){ui.logUtilConfig.debugLog.methodName="isUndefined",ui.logMethodCalled(ui.logUtilConfig.debugLog);try{return e===undefined}catch(t){return!0}},ui.isEmptyType=function(e){return ui.logUtilConfig.debugLog.methodName="isEmptyType",ui.logMethodCalled(ui.logUtilConfig.debugLog),e!==!1&&(ui.isArray(e)?0==e.length:ui.isJson(e)?0==ui.getLength(e):0!==e&&!e)},ui.isEmptyObject=function(e){return ui.logUtilConfig.debugLog.methodName="isEmptyObject",ui.logMethodCalled(ui.logUtilConfig.debugLog),!!ui.isObject(e)&&(!(!ui.isArray(e)||0!=e.length)||!(!ui.isJson(e)||0!=ui.getLength(e)))},ui.deepCopy=function(e){if(ui.logUtilConfig.debugLog.methodName="deepCopy",ui.logMethodCalled(ui.logUtilConfig.debugLog),"object"!=typeof e)return ui.logMessage("传入参数不是 Object 类型,不支持此方法","wui.deepCopy",!0),!1;var t=$.extend(!0,{},e);return t},ui.parseToObj=function(objStr){ui.logUtilConfig.debugLog.methodName="parseToObj",ui.logMethodCalled(ui.logUtilConfig.debugLog);var returnValue=null;if(!objStr)return ui.logMessage("传入的字符串为空","wui.parseToObj",!0),!1;if("string"!=typeof objStr||""==objStr)return"object"==typeof objStr?objStr:(ui.logWarn("字符串转化为对象出错,错误信息为:传入参数不符合字符串对象语法","wui.parseToObj",!0),!1);try{returnValue=eval("("+objStr+")"),"object"!=typeof returnValue&&(ui.logWarn("字符串转化为对象出错,错误信息为:"+objStr+"转化结果是 "+typeof returnValue+" 类型","wui.parseToObj",!0),returnValue=!1)}catch(e){console.info("eval"),console.info(objStr),ui.logWarn("字符串转化为对象出错,错误信息为："+e,"wui.parseToObj",!0),returnValue=!1}finally{return returnValue}},ui.isEqualObject=function(e,t){return ui.logUtilConfig.debugLog.methodName="isEqualObject",ui.logMethodCalled(ui.logUtilConfig.debugLog),!(!ui.isObject(e)||!ui.isObject(t))&&(ui.isJson(e)===ui.isJson(t)&&(ui.isArray(e)===ui.isArray(t)&&(ui.getLength(e)==ui.getLength(t)&&ui.compareObj(e,t,!0))))},ui.isDom=function(e){try{var t="object"==typeof HTMLElement?e instanceof HTMLElement:e&&"object"==typeof e&&1===e.nodeType&&"string"==typeof e.nodeName;return t}catch(i){return ui.logWarn(i,FRAME_NAME+".isDom",!0),!1}},ui.isJQuery=function(e){ui.logUtilConfig.debugLog.methodName="isJQuery",ui.logMethodCalled(ui.logUtilConfig.debugLog);try{var t=e instanceof jQuery&&e.length>0;return t}catch(i){return ui.logWarn(i,FRAME_NAME+".isJQuery",!0),!1}},ui.getJqueryObject=function(e){if(!e)return!1;try{return ui.isDom(e)?$(e):ui.isJQuery(e)?e:ui.isJQuery($(e))?$(e):!!ui.isJQuery($("#"+e))&&$("#"+e)}catch(t){return ui.logWarn(JSON.stringify(t),FRAME_NAME+".getJqueryObject",!0),!1}},ui._hasOwnProperty=function(e,t){return t in e},ui.isJson=function(e){return ui.logUtilConfig.debugLog.methodName="isJson",ui.logMethodCalled(ui.logUtilConfig.debugLog),e&&"object"==typeof e&&"[object object]"==Object.prototype.toString.call(e).toLowerCase()&&!e.length},ui.isArray=function(e){return ui.logUtilConfig.debugLog.methodName="isArray",ui.logMethodCalled(ui.logUtilConfig.debugLog),"object"==typeof e&&"[object Array]"===Object.prototype.toString.call(e)},ui.getLength=function(e){var t=0;for(var i in e)t++;return t},ui.compareObj=function(e,t,i){for(var r in e){if(!i)break;if(!t.hasOwnProperty(r)){i=!1;break}if(ui.isArray(e[r])){if(!ui.isArray(t[r])){i=!1;break}var n=e[r],o=t[r];if(n.length!=o.length){i=!1;break}for(var a in n){if(!i)break;i=ui.compareObj(n[a],o[a],i)}}else if(t[r]!=e[r]){i=!1;break}}return i},ui}(wui||{},libs),function(e,t,i){return e.openWindow=function(i){var r={pageUrl:"",pageParams:{},pageName:"",pageSetting:""};i=t.extend(!0,{},r,i);var n=e.buildUrl(i.pageUrl,i.pageParams);window.WUI_WINDOW_FLAG=e.guid(),window.open(n,i.pageName,i.pageSetting)},e.closeWindow=function(i){var r={onBeforeClose:e.CONSTANTS.EMPTYFUNC,isRefresh:!0};i=t.extend(!0,{},r,i);try{if(i.onBeforeClose&&"function"==typeof i.onBeforeClose&&i.onBeforeClose(window.opener),i.isRefresh){var n=window.WUI_WINDOW_FLAG;window.opener&&!window.opener.closed&&(window.opener.WUI_WINDOW_FLAG!==n?window.opener.location=window.opener.location:window.opener.parent.location=window.opener.parent.location)}window.open("","_self"),window.close()}catch(o){e.logWarn(o,"wui.closeWindow",!0),window.open("","_self"),window.close()}},e.backhome=function(t){e.logUtilConfig.debugLog.methodName="backhome",e.logMethodCalled(e.logUtilConfig.debugLog),t?window.top.location.href=t:window.top.location.href=e.contextPath},e.encodeURI=function(e){return encodeURIComponent(e)},e.decodeURI=function(e){return decodeURIComponent(e)},e.encodeURLParamValue=function(t,i){e.logUtilConfig.debugLog.methodName="encodeURLParamValue",e.logMethodCalled(e.logUtilConfig.debugLog);var r=t,n=e.CONSTANTS.URLVALUEEXTSTRING;if(i)switch(typeof t){case"string":r=t;break;case"number":r=typeof t+n+t;break;case"boolean":r=typeof t+n+t;break;case"object":r=typeof t+n+JSON.stringify(t);break;case"undefined":r=typeof t+n+t;break;default:r=typeof t+n+t}return e.encodeURI(r)},e.isDecodeUrlValue=function(t,i){var r=!1,n=e.CONSTANTS.URLVALUEEXTSTRING;if(e.isUndefined(i))if(e.isUndefined(e.CONSTANTS.ISCODEURLVALUE)){var o=new RegExp("^(number"+n+"|object"+n+"|string"+n+"|boolean"+n+"|undefined"+n+")","m");r=o.test(t)}else r=e.CONSTANTS.ISCODEURLVALUE;else r=i;return r},e.decodeURLParamValue=function(t,r){e.logUtilConfig.debugLog.methodName="decodeURLParamValue",e.logMethodCalled(e.logUtilConfig.debugLog);var n,o,a=e.decodeURI(t),s=e.CONSTANTS.URLVALUEEXTSTRING;if(r=e.isDecodeUrlValue(a,r)){var l=a.split(s);if(l&&l.length>1)switch(n=l[0],o=l[1],n){case"string":a=o;break;case"number":a=e.number(o);break;case"boolean":a=e["boolean"](o);break;case"object":a=e.parseToObj(o);break;case"undefined":a=i}}return a},e.buildUrl=function(i,r,n,o){e.logUtilConfig.debugLog.methodName="buildUrl",e.logMethodCalled(e.logUtilConfig.debugLog);var a="&";r=r||{},n=n||!0,e.isUndefined(o)&&(o=e.CONSTANTS.ISCODEURLVALUE);var s={};s.url=i;var l=JSON.stringify(r);l.length>50?s.paramObject="参数字符太长不显示":s.paramObject=r,s.addRandomCode=n,e.logParamValue({paramName:"params",paramValue:s,methodName:"buildUrl",className:FRAME_NAME,isDebug:!0}),n&&(r.randomCode=(new Date).valueOf());var d="",u=e.getQueryString(i);i.indexOf("?")>-1&&(i=i.substring(0,i.indexOf("?"))),r=t.extend(!0,{},u,r);for(var h in r){var c=r[h];d.length>0&&(d+=a),d+=h+"="+e.encodeURLParamValue(c,o)}return d.length>0&&(i=i.indexOf("?")>=0?i+a+d:i+"?"+d),"/"==i.charAt(0)&&i.substr(0,e.context.length)!=e.context&&(i=e.context+i),i},e.getQueryString=function(t,i){e.logUtilConfig.debugLog.methodName="getQueryString",e.logMethodCalled(e.logUtilConfig.debugLog);var r;if(t&&"string"==typeof t){if(!(t.indexOf("?")>-1))return{};r=t.substring(t.indexOf("?")+1);
}else{if(""==window.location.search)return{};r=window.location.search.substring(1)}for(var n=r.split("&"),o={},a=0;a<n.length;a++){var s=n[a].split("=");o[s[0]]=e.decodeURLParamValue(s[1],i)}return o},e.getQueryStringByName=function(t,i){e.logUtilConfig.debugLog.methodName="getQueryStringByName",e.logMethodCalled(e.logUtilConfig.debugLog);var r=location.search.match(new RegExp("[?&]"+t+"=([^&]+)","i"));return null==r||r.length<1?"":e.decodeURLParamValue(r[1],i)},e}(wui||{},libs),function(e,t,i){return e.ajax=function(r){e.logUtilConfig.debugLog.methodName="ajax",e.logMethodCalled(e.logUtilConfig.debugLog);var n,o,a,s,l,d,u,h,c,f,p=Array.prototype.slice.call(arguments,1);if("string"==typeof r?(n=r,o=p[0],a=p[1],s=p[2],l=p[3],d=p[4],u=p[5],contentType=p[6],c=p[7],f=p[8],h=p[9]):r&&"object"==typeof r&&(n=r.url,o=r.data,a=r.onSuccess||r.successCallback,s=r.onError||r.errorCallback,l=r.async,d=r.dataType,u=r.method,contentType=r.contentType,c=r.onBeforeSend,f=r.onComplete,h=r.isAddRandomCode),!n)return e.logError("请求服务地址不能为空",FRAME_NAME+".ajax",!0),!1;l==i&&(l=!0),d=d||"json",u=u||"post",contentType=contentType||"application/json","get"==u.toLowerCase()?e.isUndefined(h)&&e.isAddRandomCode&&(n=e.buildUrl(n)):h&&(n=e.buildUrl(n));var m={};m.url=n,o&&JSON.stringify(o).length<100?m.data=o:m.data="传递参数过多不显示",m.async=l,m.dataType=d,m.method=u,e.logParamValue({paramName:"params",paramValue:m,methodName:"ajax",className:FRAME_NAME,isDebug:!0}),t.ajax({type:u,url:n,async:l,data:o,dataType:d,contentType:contentType,processData:!0,beforeSend:function(e){c&&"function"==typeof c&&c(e)},success:function(e,t,i){a&&"function"==typeof a?a(e,t,i):wui.logMessage(e,"wui.ajax",!0)},complete:function(e,t){f&&"function"==typeof f&&f(e,t)},error:function(t,i,r){s&&"function"==typeof s?s(t,i,r):"object"==typeof t&&e.errorNotice(JSON.stringify(t))}})},e.getAjax=function(i){e.logUtilConfig.debugLog.methodName="getAjax",e.logMethodCalled(e.logUtilConfig.debugLog);var r=Array.prototype.slice.call(arguments,1),n={};return"string"==typeof i?(n.url=i,n.data=r[0],n.onSuccess=r[1],n.onError=r[2],n.async=r[3],n.dataType=r[4],n.contentType=r[5],n.onBeforeSend=r[6],n.onComplete=r[7],n.isAddRandomCode=r[8]):i&&"object"==typeof i&&(n=t.extend(!0,{},n,i)),n.url?(n.method="get",void e.ajax(n)):(e.logError("请求服务地址不能为空",FRAME_NAME+".getAjax",!0),!1)},e.patchAjax=function(i){e.logUtilConfig.debugLog.methodName="patchAjax",e.logMethodCalled(e.logUtilConfig.debugLog);var r=Array.prototype.slice.call(arguments,1),n={};return"string"==typeof i?(n.url=i,n.data=r[0],n.onSuccess=r[1],n.onError=r[2],n.async=r[3],n.dataType=r[4],n.contentType=r[5],n.onBeforeSend=r[6],n.onComplete=r[7],n.isAddRandomCode=r[8]):i&&"object"==typeof i&&(n=t.extend(!0,{},n,i)),n.url?(n.method="patch",void e.ajax(n)):(e.logError("请求服务地址不能为空",FRAME_NAME+".patchAjax",!0),!1)},e.deleteAjax=function(i){e.logUtilConfig.debugLog.methodName="deleteAjax",e.logMethodCalled(e.logUtilConfig.debugLog);var r=Array.prototype.slice.call(arguments,1),n={};return"string"==typeof i?(n.url=i,n.data=r[0],n.onSuccess=r[1],n.onError=r[2],n.async=r[3],n.dataType=r[4],n.contentType=r[5],n.onBeforeSend=r[6],n.onComplete=r[7],n.isAddRandomCode=r[8]):i&&"object"==typeof i&&(n=t.extend(!0,{},n,i)),n.url?(n.method="delete",void e.ajax(n)):(e.logError("请求服务地址不能为空",FRAME_NAME+".deleteAjax",!0),!1)},e.submitByForm=function(i){e.logUtilConfig.debugLog.methodName="submitByForm",e.logMethodCalled(e.logUtilConfig.debugLog);var r,n,o,a,s;if(!i||"object"!=typeof i)return!1;if(r=i.url,n=i.data,o=i.onSuccess,a=i.onError,s=i.method,s=s||"post",n=n||{},!r)return void e.logError("url不能为空",FRAME_NAME+".submitByForm",!0);if(!e.isJson(n))return void e.logError("传递的data参数只能为json",FRAME_NAME+".submitByForm",!0);var l=t("<form></form>").attr("action",r).attr("method",s);for(var d in n)l.append(t("<input></input>").attr({type:"hidden",name:d}).val(n[d]));l.appendTo("body").submit().remove()},e}(wui||{},libs),function(e,t,i){return e.setCookie=function(t,r,n){e.logUtilConfig.debugLog.methodName="setCookie",e.logMethodCalled(e.logUtilConfig.debugLog);var o=n==i?7:parseInt(n),a=new Date;a.setTime(a.getTime()+24*o*3600*1e3),document.cookie=t+"="+escape(r)+";expires="+a.toGMTString()},e.deleteCookie=function(t){e.logUtilConfig.debugLog.methodName="deleteCookie",e.logMethodCalled(e.logUtilConfig.debugLog);var i=new Date;i.setTime(i.getTime()-1e4),document.cookie=t+"="+escape("")+"; expires ="+i.toGMTString()},e.getCookie=function(t){e.logUtilConfig.debugLog.methodName="getCookie",e.logMethodCalled(e.logUtilConfig.debugLog);for(var i=document.cookie,r=i.split(";"),n=0,o=r.length;n<o;n++){var a=r[n].split("=");if(a[0]==t)return unescape(a[1])}return!1},e.getLocalStorage=function(t){return e.logUtilConfig.debugLog.methodName="getLocalStorage",e.logMethodCalled(e.logUtilConfig.debugLog),"undefined"!=typeof Storage?localStorage.getItem(t):(e.logWarn("对不起，您的浏览器不支持 web 存储。","wui.getLocalStorage",!0),!1)},e.setLocalStorage=function(t,i){return e.logUtilConfig.debugLog.methodName="setLocalStorage",e.logMethodCalled(e.logUtilConfig.debugLog),"undefined"!=typeof Storage?(localStorage.setItem(t,i),!0):(e.logWarn("对不起，您的浏览器不支持 web 存储。","wui.setLocalStorage",!0),!1)},e.deleteLocalStorage=function(t){return e.logUtilConfig.debugLog.methodName="deleteLocalStorage",e.logMethodCalled(e.logUtilConfig.debugLog),"undefined"!=typeof Storage?(e.isUndefined(t)?localStorage.clear():localStorage.removeItem(t),!0):(e.logWarn("对不起，您的浏览器不支持 web 存储。","wui.deleteLocalStorage",!0),!1)},e}(wui||{},libs),function(e,t,i){return e.setTimeout=function(e,t){return t=t||1e3,setTimeout(e,t)},e.clearTimeout=function(e){return clearTimeout(e)},e.setInterval=function(e,t){return t=t||1e3,setInterval(e,t)},e.clearInterval=function(e){return clearInterval(e)},e}(wui||{},libs),function(e,t,i){return e.setSkins=function(t,i,r,n){if(e.isUndefined(i)&&(i=e.skinConfig.isAddSkin),n=n||window,"complete"==n.document.readyState){var o=n.document.getElementsByTagName("iframe");if(o&&o.length>0)for(var a=0;a<o.length;a++)e.setSkins(t,i,r,o[a].contentWindow);n.wui&&n.wui.setSkin(t,i,r)}else e.setTimeout(function(){e.setSkins(t,i,r,n)},300)},e.setSkin=function(t,i,r){e.logUtilConfig.debugLog.methodName="setSkin",e.logMethodCalled(e.logUtilConfig.debugLog),e.logMessage("设置皮肤："+t,"wui.setSkin",!0),e.isUndefined(i)&&(i=e.skinConfig.isAddSkin),t||(t=e.getLocalStorage(e.CONSTANTS.SKINNAMEFIELD),t||(t="default"));var n=e.getSkinElement(!!i&&t);if(n)if("string"==typeof n)e.setLocalStorage(e.CONSTANTS.SKINNAMEFIELD,t);else{var o=n.attr("href"),a=o.match(/themes\/(\S*)\//)[1],s=o.substr(0,o.indexOf("themes"))+"themes/";a!==t&&(n.attr("href",s+t+"/"+e.skinConfig.skinFileName),e.setLocalStorage(e.CONSTANTS.SKINNAMEFIELD,t))}return r&&"function"==typeof r&&r(n),!!n},e.removeSkin=function(t){e.logUtilConfig.debugLog.methodName="removeSkin",e.logMethodCalled(e.logUtilConfig.debugLog);var i=e.getSkinElement();return e.deleteLocalStorage(e.CONSTANTS.SKINNAMEFIELD),t&&"function"==typeof t&&t(i),!!i},e.getSkin=function(){e.logUtilConfig.debugLog.methodName="getSkin",e.logMethodCalled(e.logUtilConfig.debugLog),e.getLocalStorage(e.CONSTANTS.SKINNAMEFIELD)},e.getSkinElement=function(i){if(e.logUtilConfig.debugLog.methodName="getSkinFile",e.logMethodCalled(e.logUtilConfig.debugLog),!t("#"+e.skinConfig.skinId).exist()){if(e.logMessage("当前页面不存在 ID 为"+e.skinConfig.skinId+" 的DOM节点","wui.getSkinFile",!0),i){var r=e.CONSTANTS.WUI_PROJECT_PATH+"themes/"+i+"/"+e.skinConfig.skinFileName;e.logMessage("框架新皮肤路径："+r,!0);var n=t('<link href="'+r+'" rel="stylesheet" type="text/css" id="'+e.skinConfig.skinId+'" charset="utf-8" />');return t(t("head")[0]).append(n),i}return!1}return"link"===document.getElementById(e.skinConfig.skinId).tagName.toLowerCase()?t("#"+e.skinConfig.skinId):(e.logMessage("当前页面 ID 为"+e.skinConfig.skinId+" 的DOM节点不是link标签","wui.getSkinFile",!0),!1)},e}(wui||{},libs),function(e,t,i){return e.initPage=function(r,n){e.logUtilConfig.debugLog.methodName="initPage",e.logMethodCalled(e.logUtilConfig.debugLog),e.extVariables.components={};var o,a=null;t("[data-init-page]").length>0?(a=t("[data-init-page]"),o="undefined"==typeof a.attr("data-init-page")?e.isInitPage:a.data("init-page")):(a=t("body"),o=e.isInitPage),e.isUndefined(r)?r=o:e.isJson(r)&&(n=r,r=o),e.logParamValue({paramName:"isInitPage",paramValue:r,methodName:"initPage",className:FRAME_NAME,isDebug:!0}),a.data("data-init-page",r);var s="[type='button'],[type='submit'],[type='reset']",l=function(){"rtl"===t("body").css("direction")&&(e.isRTL=!0),e.CONSTANTS.isIE10&&t("html").addClass("ie10"),(e.CONSTANTS.isIE10||e.CONSTANTS.isIE9||e.CONSTANTS.isIE8)&&t("html").addClass("ie"),"undefined"==typeof a.attr("data-init-skin")&&a.data("init-skin",r),"undefined"==typeof a.attr("data-add-skin")&&a.data("add-skin",e.skinConfig.isAddSkin),"undefined"==typeof a.attr("data-init-element")&&a.data("init-element",r),"undefined"==typeof a.attr("data-init-components")&&a.data("init-components",r),"undefined"==typeof a.attr("data-init-validate")&&a.data("init-validate",r),"undefined"==typeof a.attr("data-init-scroll")&&a.data("init-scroll",r)},d=function(){return a.data("initScroll")!==!1&&"false"!==a.data("initScroll")&&void e.scroll(a)},u=function(){t("input:not("+s+")").each(function(e,r){t(r).hasClass("wui-input")||t(r).attr("data-init-wui")||t(r).addClass("wui-input"),t(r).attr("data-init-wui")||t(r).attr("id")&&t(r).attr("name")==i&&t(r).attr("name",t(r).attr("id"))}),t("select").each(function(e,r){t(r).hasClass("wui-select")||t(r).addClass("wui-select"),t(r).attr("data-init-wui")||t(r).attr("id")&&t(r).attr("name")==i&&t(r).attr("name",t(r).attr("id"))}),t("textarea").each(function(e,r){t(r).hasClass("wui-textarea")||t(r).addClass("wui-textarea"),t(r).attr("data-init-wui")||t(r).attr("id")&&t(r).attr("name")==i&&t(r).attr("name",t(r).attr("id"))})},h=function(){a.find(s).each(function(e,i){t(i).hasClass("wui-btn")||t(i).addClass("wui-btn")})},c=function(r){return a.data("initComponents")!==!1&&"false"!==a.data("initComponents")&&(e.isJson(r)||(r={}),void a.find("[data-"+e.CONSTANTS.DATAINITWIDGETFIELD+"]").each(function(n,o){var a=t(o).attr("data-"+e.CONSTANTS.DATAINITWIDGETFIELD),s=t(o).attr("id");if(a&&s)if(e[a]){var l={};r[s]!=i&&(l=r[s]),e.extVariables.components[s]=e[a](s,l)}else e.logWarn(a+" 组件初始化失败,错误信息:WUI查无此组件!",FRAME_NAME+".initPage",!0)}))},f=function(){return a.data("initElement")!==!1&&"false"!==a.data("initElement")&&(u(),void h())},p=function(){return a.data("initValidate")!==!1&&"false"!==a.data("initValidate")&&void a.find("form").each(function(i,r){if(t(r).find("["+e.validateAttributeField+"]").length>0){var n=t(r).attr("id")||t(r).attr("name");n?e.extVariables.components[n]=wui.validate(r):e.extVariables.components["formValidate"+i]=wui.validate(r)}})},m=function(){if(a.data("initSkin")===!1||"false"===a.data("initSkin"))return!1;var t=a.data("addSkin");e.setSkins(null,t)},g=function(e){l(),m(),f(),c(e),d(),p()};return g(n),e.extVariables.components},e.initDesign=function(i){e.logParamValue({paramName:"setting",paramValue:i,methodName:"initDesign",className:FRAME_NAME,isDebug:!0});var r=function(){var e="[type='button'],[type='submit'],[type='reset'],button,a";t(e).find(function(){t(this).attr("color")&&t(this).addClass(t(this).attr("color")),t(this).attr("size")&&t(this).addClass(t(this).attr("size")),t(this).attr("radius")&&t(this).addClass(t(this).attr("radius")),t(this).attr("icon")&&t(this).prepend('<i class="fa fa-'+t(this).attr("icon")+'"></i>'),t(this).attr("text")&&t(this).append(t(this).attr("text"))})},n=function(e){r()};n(i)},e}(wui||{},libs),jQuery(document).ready(function(){if(window.wui){var e=wui.getBrowserVersion();wui.logMessage("当前浏览器版本："+e.browser+" "+e.version,"wui.ready",!0),wui.logMessage("当前WUI框架版本: "+wui.version+", 发布日期为: "+wui.versionDate,"wui.ready",!0),$("textarea[data-auto-height]").each(function(){wui.textarea(this)}),wui.isInitDesign&&wui.initDesign(),wui.isInitPage?wui.initPage():$("[data-init-page]").length>0?wui.initPage():wui.skinConfig.isInitSkin&&wui.setSkins()}}),function(e,t,i){return e.getForm=function(i,r,n,o,a){e.logUtilConfig.debugLog.methodName="getForm",e.logMethodCalled(e.logUtilConfig.debugLog);var s=t("body");i&&(s=e.isJQuery(i)?i:t(i)),r===!0?(a=!0,r="",n=n||"value",o=o||"html"):n===!0?(a=!0,r=r||"",n="value",o=o||"html"):o===!0?(a=!0,r=r||"",n=n||"value",o="html"):(r=r||"",n=n||"value",o=o||"html");var l="[type='button'],[type='submit'],[type='reset'],[wui-widget-hidden]",d={};return s.find("input:not("+l+"),select,textarea,[ui-type]:not("+l+")").not(r).each(function(i,r){var s=t(r).attr("name")||t(r).attr("id");if(!s)return!0;if(t(r).attr("ui-type")){var l=t(r).attr("id"),u=t(r).attr("ui-type");if(!l)return e.logWarn(u+"组件没有id属性值",FRAME_NAME+".getForm",!0),!0;switch("file"!==u&&"img"!==u||(l=t(r).parent().attr("_fileId")),u){case"ueditor":var h=wui[u](l);d[s]=h.get(o);break;case"":e.logWarn(u+"组件不支持通过表单取值",FRAME_NAME+".getForm",!0);break;default:var h=wui[u](l),c=h.get(n);null!==c&&(!a||"value"!=n&&"text"!=n?d[s]=c:d[s]=e.isArray(c)?c.join(","):c)}}else{var f=t(r)[0].tagName,p=t(r).attr("type"),m=[];e.isEmptyType(d[s])||(m=d[s].split(",")),"INPUT"==f?"radio"==p?t(r).prop("checked")&&""!=t(r).val()&&m.push(t(r).val()):"checkbox"==p?t(r).prop("checked")&&""!=t(r).val()&&m.push(t(r).val()):""!=t(r).val()&&m.push(t(r).val()):"SELECT"!=f&&"TEXTAREA"!=f||""!=t(r).val()&&m.push(t(r).val()),d[s]=m.join(",")}}),d},e.fillForm=function(i,r,n,o){e.logUtilConfig.debugLog.methodName="fillForm",e.logMethodCalled(e.logUtilConfig.debugLog);var a=t("body");o&&(a=e.isJQuery(o)?o:t(o));var s,l,d,u,h,c=i||{};for(x in c)s=x,l=c[x],h=[],a.find("[name='"+s+"'],[name='"+s+"[]'], [id='"+s+"'],[id='"+s+"[]']").each(function(i,o){var a=!1,s=!0;if(r&&"function"==typeof r&&(s=r.call(this,this,l)),s===!1)return!0;if(t(this).attr("ui-type")){var c=t(o).attr("ui-type"),f=t(o).attr("id")?t(o).attr("id"):t(o).attr("name");if(!e[c])return e.logWarn(c+"组件不存在","wui.fillForm",!0),!0;var p=e[c](f);if(!p)return e.logWarn(c+"组件未初始化","wui.fillForm",!0),!0;if(e.isUndefined(l))p.empty&&(p.empty(),a=!0);else if(p.set)p.set(l),a=!0;else{if(!p.select)return e.logWarn(c+"组件无 set()/select() 方法","wui.fillForm",!0),!0;p.select(l),a=!0}}else if(d=t(this)[0].tagName,u=t(this).attr("type"),"boolean"==typeof l&&(l=l.toString()),"INPUT"==d)if("radio"==u)t(this).prop("checked",t(this).val()==l),a=!0;else if("checkbox"==u){"string"==typeof l?h=l.split(","):"number"==typeof l?h.push(l):e.isJson(l)&&h.push(l);for(var m=0;m<h.length;m++)t(this).val()==h[m]?t(this).prop("checked",!0):t(this).prop("checked",!1);a=!0}else t(this).val(l),a=!0;else"SELECT"==d?(t(this).val(l),a=!0):"TEXTAREA"==d&&(t(this).val(l),e.isUndefined(t(this).attr("data-auto-height"))||t(this).change(),a=!0);n&&"function"==typeof n&&n.call(this,this,a,l)});return!0},e.emptyForm=function(i,r,n){e.logUtilConfig.debugLog.methodName="emptyForm",e.logMethodCalled(e.logUtilConfig.debugLog);var o=t("body");i&&(o=e.isJQuery(i)?i:t(i)),r=r||"",e.isUndefined(n)&&(n=!0);var a,s,l="[type='button'],[type='submit'],[type='reset'],[wui-widget-hidden]",d={};return o.find("input:not("+l+"),select,textarea,[ui-type]").not(r).each(function(i,r){var o=t(r).attr("name")||t(r).attr("id");if(t(r).attr("ui-type")){var l=t(r).attr("id"),u=t(r).attr("ui-type");if(!l)return e.logWarn(u+"组件没有id属性值",FRAME_NAME+".getForm",!0),!0;"file"!==u&&"img"!==u||(l=t(r).parent().attr("_fileId"));var h=wui[u](l);switch(u){case"":e.logWarn(u+"组件不支持通过表单清空",FRAME_NAME+".emptyForm",!0);break;default:d[o]=h.empty(n)}}else a=t(r)[0].tagName,s=t(r).attr("type"),"INPUT"==a?"radio"==s?t(r).prop("checked",!1):"checkbox"==s?t(r).prop("checked",!1):t(r).val(""):"SELECT"==a?t(r).val(""):"TEXTAREA"==a&&t(r).val("")}),!0},e.readonly=function(i,r,n){e.logUtilConfig.debugLog.methodName="readonly",e.logMethodCalled(e.logUtilConfig.debugLog);var o=t("body");i&&(o=t(i)),r=r||"";var a=["input","select","textarea"];return o.find("*").not(r).each(function(i,r){var n=t(r)[0].tagName.toLowerCase();if(t(r).attr("ui-type")){var o=t(r).attr("ui-type"),s=t(r).attr("id");"file"!==o&&"img"!==o||(s=t(r).parent().attr("_fileId"));var l=e[o](s);if(!l)return e.logWarn(o+"组件未初始化","wui.readonly",!0),!0;if(!l.readonly)return e.logWarn(o+"组件无此方法","wui.readonly",!0),!0;l.readonly()}else if(a.indexOf(n)>-1)if("select"===n)t(r).attr("disabled",!0).addClass("wui-readonly");else{var d=t(this).attr("type");"radio"==d?t(r).attr("disabled",!0).addClass("wui-readonly"):"checkbox"==d?t(r).attr("disabled",!0).addClass("wui-readonly"):t(r).attr("readonly",!0)}}),n&&"function"==typeof n&&n(i),!0},e.readwrite=function(i,r,n){e.logUtilConfig.debugLog.methodName="readwrite",e.logMethodCalled(e.logUtilConfig.debugLog);var o=t("body");i&&(o=t(i)),r=r||"";var a=["input","select","textarea"];return o.find("*").not(r).each(function(i,r){var n=t(r)[0].tagName.toLowerCase();if(t(r).attr("ui-type")){var o=t(r).attr("ui-type"),s=t(r).attr("id");"file"!==o&&"img"!==o||(s=t(r).parent().attr("_fileId"));var l=e[o](s);if(!l)return e.logWarn(o+"组件未初始化","wui.readwrite",!0),!0;if(!l.readwrite)return e.logWarn(o+"组件无此方法","wui.readwrite",!0),!0;l.readwrite()}else if(a.indexOf(n)>-1)if("select"===n)t(r).removeAttr("disabled").removeClass("wui-readonly");else{var d=t(this).attr("type");"radio"==d?t(r).removeAttr("disabled").removeClass("wui-readonly"):"checkbox"==d?t(r).removeAttr("disabled").removeClass("wui-readonly"):t(r).removeAttr("readonly")}}),n&&"function"==typeof n&&n(i),!0},e.disabled=function(i,r,n){e.logUtilConfig.debugLog.methodName="disabled",e.logMethodCalled(e.logUtilConfig.debugLog);var o=t("body");i&&(o=t(i)),r=r||"";var a=["input","select","button","a","textarea"];return o.find("*").not(r).each(function(i,r){var n=t(r)[0].tagName.toLowerCase();if(t(r).attr("ui-type")){var o=t(r).attr("ui-type"),s=t(r).attr("id");"file"!==o&&"img"!==o||(s=t(r).parent().attr("_fileId"));var l=e[o](s);if(!l)return e.logWarn(o+"组件未初始化","wui.disabled",!0),!0;if(!l.disabled)return e.logWarn(o+"组件无此方法","wui.disabled",!0),!0;l.disabled()}else a.indexOf(n)>-1&&(t(r).attr("disabled",!0),t(r).addClass("cursor-default"))}),n&&"function"==typeof n&&n(i),!0},e.enabled=function(i,r,n){e.logUtilConfig.debugLog.methodName="enabled",e.logMethodCalled(e.logUtilConfig.debugLog);var o=t("body");i&&(o=t(i)),r=r||"";var a=["input","select","button","a","textarea"];return o.find("*").not(r).each(function(i,r){var n=t(r)[0].tagName.toLowerCase();if(t(r).attr("ui-type")){var o=t(r).attr("ui-type"),s=t(r).attr("id");"file"!==o&&"img"!==o||(s=t(r).parent().attr("_fileId"));var l=e[o](s);if(!l)return e.logWarn(o+"组件未初始化","wui.enabled",!0),!0;if(!l.enabled)return e.logWarn(o+"组件无此方法","wui.enabled",!0),!0;l.enabled()}else a.indexOf(n)>-1&&(t(r).removeAttr("disabled"),t(r).removeClass("cursor-default"))}),n&&"function"==typeof n&&n(i),!0},e}(wui||{},libs),function(e,t,i){return e.logMethodCalled=function(i){var r=Array.prototype.slice.call(arguments,1),n={methodName:"",className:"",id:"",isDebug:!1};if("string"==typeof i?(n.methodName=i,n.className=r[0],n.id=r[1],n.isDebug=r[2]):"object"==typeof i&&(n=t.extend(!0,{},n,i)),!e.logUtilConfig.isLogMethodCalled)return!1;n.className?n.methodName="【函数】"+n.className+"."+n.methodName+" 被调用; ":n.methodName="【函数】"+n.methodName+" 被调用; ",n.id?n.id="【触发对象】"+n.id:n.id="";var o=n.methodName+n.id;if(n.isDebug){if(!e.isDebug||!e.logUtilConfig.debugConfig.isLogMethodCalled)return!1;"Netscape"===navigator.appName?console.log("%c"+o,"color: #52C079"):console.log(o)}else{if(!e.logUtilConfig.isLog)return!1;"Netscape"===navigator.appName?console.log("%c"+o,"color: #52C079"):console.log(o)}return!0},e.logParamValue=function(i){var r=Array.prototype.slice.call(arguments,1),n={paramName:null,paramValue:"",methodName:null,className:"",isDebug:!1};if("string"==typeof i?(n.paramName=i,n.paramValue=r[0],n.methodName=r[1],n.className=r[2],n.isDebug=r[3]):"object"==typeof i&&(n=t.extend(!0,{},n,i)),!e.logUtilConfig.isLogParamValue)return!1;n.className&&(n.methodName=n.className+"."+n.methodName),n.methodName?n.methodName="【函数】"+n.methodName+"中":n.methodName="",n.paramName?n.paramName="【参数】"+n.paramName+"值为:\n":n.paramName="",n.isDebug=n.isDebug||!1;var o=n.paramValue;if(n.isDebug){if(!e.isDebug||!e.logUtilConfig.debugConfig.isLogParamValue)return!1;"Netscape"===navigator.appName?console.info("%c"+n.methodName+n.paramName,"color:#4B83FA",o):console.info(n.methodName+n.paramName,o)}else{if(!e.logUtilConfig.isLog)return!1;"Netscape"===navigator.appName?console.info("%c"+n.methodName+n.paramName,"color:#4B83FA",o):console.info(n.methodName+n.paramName,o)}return!0},e.logMessage=function(t,i,r){var n={message:"",methodName:"",isDebug:!1};if(t&&(n.message=t),i&&(n.methodName="【函数】"+i+" 输出"),n.isDebug=r||!1,!e.logUtilConfig.isLogMessage)return!1;if(n.isDebug){if(!e.isDebug||!e.logUtilConfig.debugConfig.isLogMessage)return!1;console.info("【消息】:"+n.methodName+"\n",n.message)}else{if(!e.logUtilConfig.isLog)return!1;console.info("【消息】:"+n.methodName+"\n",n.message)}return!0},e.logWarn=function(t,i,r){var n={message:t,methodName:"",isDebug:!1};if(i&&(n.methodName=i),n.isDebug=r||!1,!e.logUtilConfig.isLogWarn)return!1;if(n.isDebug){if(!e.isDebug||!e.logUtilConfig.debugConfig.isLogWarn)return!1;console.warn("【警告】"+n.methodName+":"+n.message)}else{if(!e.logUtilConfig.isLog)return!1;console.warn("【警告】"+n.methodName+":"+n.message)}return!0},e.logError=function(t,i,r){var n={error:t,methodName:"",isDebug:!1};if(i&&(n.methodName=i),n.isDebug=r||!1,!e.logUtilConfig.isLogError)return!1;if(n.isDebug){if(!e.isDebug||!e.logUtilConfig.debugConfig.isLogError)return!1;console.error("【异常】"+n.methodName+":"+n.error)}else{if(!e.logUtilConfig.isLog)return!1;console.error("【异常】"+n.methodName+":"+n.error)}return!0},e}(wui||{},libs),function(e,t,i){return e.openModalDialog=function(i){e.logUtilConfig.debugLog.methodName="openModalDialog",e.logMethodCalled(e.logUtilConfig.debugLog);var r,n={};if("string"==typeof i){var o=Array.prototype.slice.call(arguments,1);n.content=e._getDefault("http://platform.depts.bingosoft.net/wui/",i),n.successCallback=o[0],n.width=e._getDefault("800px",o[1]),n.height=e._getDefault("460px",o[2]),n.title=e._getDefault("",o[3]),n.isFull=e._getDefault(!1,o[4]),n.full=o[5],n.maxmin=e._getDefault(!1,o[6]),n.closedCallback=o[7],n.cancelCallback=o[8],n.offset=e._getDefault("auto",o[9]),n.shadeClose=e._getDefault(!1,o[10]),n.area=[n.width,n.height],r=t.extend(!0,{},n)}else i&&"object"==typeof i&&(n.content=e._getDefault("http://platform.depts.bingosoft.net/wui/",i.url,i.content),n.successCallback=i.successCallback,n.width=e._getDefault("800px",i.width),n.height=e._getDefault("460px",i.height),n.title=e._getDefault("",i.title),n.isFull=e._getDefault(!1,i.isFull),n.full=e._getDefault(e.CONSTANTS.EMPTYFUNC,i.onFull,i.full),n.maxmin=e._getDefault(!1,i.isMaxmin,i.maxmin),n.closedCallback=i.closedCallback,n.cancelCallback=i.cancelCallback,n.offset=e._getDefault("auto",i.offset),n.shadeClose=e._getDefault(!1,i.isShadeClose,i.shadeClose),n.area=[n.width,n.height],r=t.extend(!0,{},n,i));r.end||(r.end=function(){e.getModalDialogs().pop();e.CONSTANTS.isIE&&t("[data-hide-opend-modal-ie]").each(function(e,i){t(i).removeClass("hide-opend-modal")}),n.closedCallback&&"function"==typeof n.closedCallback&&n.closedCallback()}),r.cancel||(r.cancel=function(e,t){var i=!0;if(n.cancelCallback&&"function"==typeof n.cancelCallback&&(i=n.cancelCallback(e,t)),i===!1)return!1}),r.type=2,e.CONSTANTS.isIE&&t("[data-hide-opend-modal-ie]").each(function(e,i){t(i).addClass("hide-opend-modal")}),e.logParamValue({paramName:"params",paramValue:r,methodName:"openModalDialog",className:FRAME_NAME,isDebug:!0});var a=e.CONSTANTS.OMODALWINDOW.indexOf(e.modalWindow);if(a>-1)for(var s,l=a;l<e.CONSTANTS.OMODALWINDOW.length;l++){var d=e.CONSTANTS.OMODALWINDOW[l],u=window[d];if(u.layui){u.layui.use("layer",function(){return layer=u.layui.layer,s=layer.open(r),e.addModalDialog(s,r.successCallback),r.isFull&&layer.full(s),s});break}if(u.layer)return s=u.layer.open(r),e.addModalDialog(s,r.successCallback),r.isFull&&u.layer.full(s),s}else{var s;if("function"==typeof e.modalWindow){var u=e.modalWindow.call(this,window);if(u.layui)u.layui.use("layer",function(){return layer=u.layui.layer,s=layer.open(r),e.addModalDialog(s,r.successCallback),r.isFull&&layer.full(s),s});else if(u.layer)return s=u.layer.open(r),e.addModalDialog(s,r.successCallback),r.isFull&&u.layer.full(s),s}}},e.addModalDialog=function(t,i){e.logUtilConfig.debugLog.methodName="addModalDialog",e.logMethodCalled(e.logUtilConfig.debugLog);var r={};r.modalDialogIndex=t,r.successCallback=function(e){i&&"function"==typeof i&&i(e)},e.getModalDialogs().push(r)},e.closeModalDialog=function(t){e.logUtilConfig.debugLog.methodName="closeModalDialog",e.logMethodCalled(e.logUtilConfig.debugLog),e.logParamValue({paramName:"res",paramValue:t,methodName:"closeModalDialog",className:FRAME_NAME,isDebug:!0});var i=e.getModalDialogs(),r={};i&&i.length>0&&(r=i[i.length-1]),r&&(r.successCallback(t),e.dialogOff(r.modalDialogIndex))},e.cancelModalDialog=function(){e.logUtilConfig.debugLog.methodName="cancelModalDialog",e.logMethodCalled(e.logUtilConfig.debugLog);var t,i=e.getModalDialogs();i.length>0&&(t=i[i.length-1]),t&&e.dialogOff(t.modalDialogIndex)},e.getWindowModal=function(){e.logUtilConfig.debugLog.methodName="getWindowModal",e.logMethodCalled(e.logUtilConfig.debugLog);var t=e.CONSTANTS.OMODALWINDOW.indexOf(e.modalWindow),i=window.top;if(t>-1){var r=e.CONSTANTS.OMODALWINDOW[t];i=window[r]}else"function"==typeof e.modalWindow&&(i=e.modalWindow.call(this,window));return i},e.getModalDialogs=function(){e.logUtilConfig.debugLog.methodName="getModalDialogs",e.logMethodCalled(e.logUtilConfig.debugLog);var t=e.getWindowModal();return!t||t.modalDialogs&&0!=t.modalDialogs.length||(t.modalDialogs=[]),e.logParamValue({paramName:"modalDialogs",paramValue:t.modalDialogs,methodName:"getModalDialogs",className:FRAME_NAME,isDebug:!0}),t.modalDialogs},e.dialogOff=function(t){e.logUtilConfig.debugLog.methodName="dialogOff",e.logMethodCalled(e.logUtilConfig.debugLog);var i=parent.layer.getFrameIndex(window.name);t=i;var r=e.CONSTANTS.OMODALWINDOW.indexOf(e.modalWindow);if(r>-1)for(var n=r;n<e.CONSTANTS.OMODALWINDOW.length;n++){var o=e.CONSTANTS.OMODALWINDOW[n],a=window.parent;if("top"==o?a=window.top:"parent"==o&&(a=window[o].parent?window[o].parent:window.top),a.layui)a.layui.use("layer",function(){var e=a.layui.layer;return e.close(t),!0});else if(a.layer)return a.layer.close(t),!0}else if("function"==typeof e.modalWindow){var a=e.modalWindow.call(this,window);if(a.layui)a.layui.use("layer",function(){var e=a.layui.layer;return e.close(t),!0});else if(a.layer)return a.layer.close(t),!0}},e.deleteDialog=function(){e.logUtilConfig.debugLog.methodName="deleteDialog",e.logMethodCalled(e.logUtilConfig.debugLog),layer.closeAll("dialog")},e.closeDialog=function(){e.logUtilConfig.debugLog.methodName="closeDialog",e.logMethodCalled(e.logUtilConfig.debugLog);var t=layer.getFrameIndex(window.name);layer.close(t)},e}(wui||{},libs),function(e,t,i){return e.setLayerSetting=function(i){i=i||{},t.extend(!0,e.layerSetting,i)},e._getDefault=function(e,r){for(var n=Array.prototype.slice.call(arguments,1),o=e,a=0;a<n.length;a++){var s=n[a];if(s!==i){o="object"==typeof e&&"object"==typeof s?t.extend(!0,{},e,s):s;break}}return o},e.openHtml=function(i){e.logUtilConfig.debugLog.methodName="openHtml",e.logMethodCalled(e.logUtilConfig.debugLog);var r,n=Array.prototype.slice.call(arguments,1),o='<div style="padding:20px;">无内容</div>',a=e.layerSetting,s={};"string"==typeof i?(s.title=e._getDefault(a.title,i),s.content=e._getDefault(o,n[0]),s.width=e._getDefault(a.width,n[1]),s.height=e._getDefault(a.height,n[2]),s.shadeClose=e._getDefault(a.isShadeClose,n[3]),s.isFull=e._getDefault(a.isFull,n[4]),s.maxmin=e._getDefault(a.isMaxmin,n[5]),s.offset=e._getDefault(a.offset,n[6]),s.success=e._getDefault(a.onPoped,n[7]),s.end=e._getDefault(a.onClosed,n[8]),s.scrollbar=e._getDefault(a.isScrollbar,n[9]),s.zIndex=e._getDefault(a.zIndex,n[10]),s.area=[s.width,s.height],s.time=0,s.skin="",r=t.extend(!0,{},s)):i&&"object"==typeof i?(s.title=e._getDefault(a.title,i.title),s.content=e._getDefault(o,i.content),s.width=e._getDefault(a.width,i.width),s.height=e._getDefault(a.height,i.height),s.shadeClose=e._getDefault(a.isShadeClose,i.isShadeClose,i.shadeClose),s.isFull=e._getDefault(a.isFull,i.isFull),s.maxmin=e._getDefault(a.isMaxmin,i.isMaxmin,i.maxmin),s.offset=e._getDefault(a.offset,i.offset),s.success=e._getDefault(a.onPoped,i.onPoped,i.success),s.end=e._getDefault(a.onClosed,i.onClosed,i.end),s.scrollbar=e._getDefault(a.isScrollbar,i.isScrollbar,i.scrollbar),s.zIndex=e._getDefault(a.zIndex,i.zIndex),s.area=[s.width,s.height],s.time=0,s.skin="",r=t.extend(!0,{},s,i)):(s={title:a.title,skin:"",type:1,area:[a.width,a.height],time:0,shadeClose:a.isShadeClose,offset:a.offset,maxmin:a.isMaxmin,content:'<div style="padding:20px;">无内容</div>',zIndex:a.zIndex,scrollbar:a.isScrollbar},r=t.extend(!0,{},s)),r.type=1,e.logParamValue({paramName:"params",paramValue:r,methodName:"openHtml",className:FRAME_NAME,isDebug:!0});var l=layer.open(r);return r.isFull&&(r.maxmin=!1,l=layer.full(l)),l},e.openIframe=function(i){e.logUtilConfig.debugLog.methodName="openIframe",e.logMethodCalled(e.logUtilConfig.debugLog);var r,n=Array.prototype.slice.call(arguments,1),o={},a=e.layerSetting;"string"==typeof i?(o.content=e._getDefault(a.url,i),o.width=e._getDefault(a.width,n[0]),o.height=e._getDefault(a.height,n[1]),o.title=e._getDefault(a.title,n[2]),o.maxmin=e._getDefault(a.isMaxmin,n[3]),o.shadeClose=e._getDefault(a.isShadeClose,n[4]),o.isFull=e._getDefault(a.isFull,n[5]),o.offset=e._getDefault(a.offset,n[6]),o.success=e._getDefault(a.onPoped,n[7]),o.end=e._getDefault(a.onClosed,n[8]),o.scrollbar=e._getDefault(a.isScrollbar,n[9]),o.zIndex=e._getDefault(a.zIndex,n[10]),o.area=[o.width,o.height],r=t.extend(!0,{},o)):i&&"object"==typeof i?(o.content=e._getDefault(a.url,i.url),o.width=e._getDefault(a.width,i.width),o.height=e._getDefault(a.height,i.height),o.title=e._getDefault(a.title,i.title),o.maxmin=e._getDefault(a.isMaxmin,i.isMaxmin,i.maxmin),o.shadeClose=e._getDefault(a.isShadeClose,i.isShadeClose,i.shadeClose),o.isFull=e._getDefault(a.isFull,i.isFull),o.offset=e._getDefault(a.offset,i.offset),o.success=e._getDefault(a.onPoped,i.onPoped,i.success),o.end=e._getDefault(a.onClosed,i.onClosed,i.end),o.scrollbar=e._getDefault(a.isScrollbar,i.isScrollbar,i.scrollbar),o.zIndex=e._getDefault(a.zIndex,i.zIndex),o.area=[o.width,o.height],r=t.extend(!0,{},o,i)):(o={type:2,area:[a.width,a.height],shadeClose:a.isShadeClose,content:a.url,title:a.title,maxmin:a.isMaxmin,zIndex:a.zIndex,scrollbar:a.isScrollbar,offset:a.offset},r=t.extend(!0,{},o)),r.type=2,e.logParamValue({paramName:"params",paramValue:r,methodName:"openIframe",className:FRAME_NAME,isDebug:!0});var s=layer.open(r);return r.isFull&&(r.maxmin=!1,s=layer.full(s)),s},e.load=function(i,r){e.logUtilConfig.debugLog.methodName="load",e.logMethodCalled(e.logUtilConfig.debugLog);var n,o=e.layerSetting,a={},s=1;return e.isJson(i)?r=i:s="number"==typeof i?i:1,r&&"object"==typeof r?(a.skin=e._getDefault(o.skin,r.skin),a.time=e._getDefault(o.time,r.time),a.shadeClose=e._getDefault(o.isShadeClose,r.isShadeClose,r.shadeClose),a.offset=e._getDefault(o.offset,r.offset),a.success=e._getDefault(o.onPoped,r.onPoped,r.success),a.end=e._getDefault(o.onClosed,r.onClosed,r.end),n=t.extend(!0,{},a,r)):(a={skin:o.skin,time:o.time,shadeClose:o.isShadeClose,offset:o.offset},n=t.extend(!0,{},a)),e.logParamValue({paramName:"params",paramValue:n,methodName:"load",className:FRAME_NAME,isDebug:!0}),layer.load(s,n)},e.tips=function(i,r,n){e.logUtilConfig.debugLog.methodName="tips",e.logMethodCalled(e.logUtilConfig.debugLog);var o,a=e.layerSetting,s={};return n&&"object"==typeof n?(s.skin=e._getDefault("layui-layer-success",n.skin),s.time=e._getDefault(a.time,n.time),s.tips=e._getDefault(a.tips,n.tips),
s.shadeClose=e._getDefault(a.isShadeClose,n.isShadeClose,n.shadeClose),s.tipsMore=e._getDefault(a.isShowMultipleTips,n.isShowMultipleTips,n.tipsMore),s.success=e._getDefault(a.onPoped,n.onPoped,n.success),s.end=e._getDefault(a.onClosed,n.onClosed,n.end),o=t.extend(!0,{},s,n)):(s={skin:"layui-layer-success",tipsMore:a.isShowMultipleTips,time:a.time,tips:a.tips,offset:a.offset,shadeClose:a.isShadeClose},o=t.extend(!0,{},s)),e.logParamValue({paramName:"params",paramValue:o,methodName:"tips",className:FRAME_NAME,isDebug:!0}),layer.tips(i,r,o)},e.message=function(i,r,n){e.logUtilConfig.debugLog.methodName="message",e.logMethodCalled(e.logUtilConfig.debugLog);var o,a=e.layerSetting,s={};return r&&"object"==typeof r?(s.skin=e._getDefault(a.skin,r.skin),s.time=e._getDefault(0,r.time),s.icon=e._getDefault(a.icon,r.icon),s.success=e._getDefault(a.onPoped,r.onPoped,r.success),s.end=e._getDefault(a.onClosed,r.onClosed,r.end),o=t.extend(!0,{},s,r)):(s={skin:a.skin,time:0,offset:a.offset,icon:a.icon},o=t.extend(!0,{},s)),e.logParamValue({paramName:"params",paramValue:o,methodName:"message",className:FRAME_NAME,isDebug:!0}),layer.msg(i,o,n)},e.alert=function(i,r,n){e.logUtilConfig.debugLog.methodName="alert",e.logMethodCalled(e.logUtilConfig.debugLog);var o,a=e.layerSetting,s={};return r&&"object"==typeof r?(s.skin=e._getDefault(a.skin,r.skin),s.time=e._getDefault(a.time,r.time),s.offset=e._getDefault(a.offset,r.offset),s.shadeClose=e._getDefault(a.isShadeClose,r.isShadeClose,r.shadeClose),s.title=e._getDefault(a.title,r.title),s.success=e._getDefault(a.onPoped,r.onPoped,r.success),s.end=e._getDefault(a.onClosed,r.onClosed,r.end),o=t.extend(!0,{},s,r)):(s={skin:a.skin,time:a.time,title:a.title,offset:a.offset,shadeClose:a.isShadeClose},o=t.extend(!0,{},s)),e.logParamValue({paramName:"params",paramValue:o,methodName:"alert",className:FRAME_NAME,isDebug:!0}),layer.alert(i,o,n)},e.confirm=function(i,r,n,o){e.logUtilConfig.debugLog.methodName="confirm",e.logMethodCalled(e.logUtilConfig.debugLog);var a,s=e.layerSetting,l={};return r&&"object"==typeof r?(l.skin=e._getDefault(s.skin,r.skin),l.time=e._getDefault(s.time,r.time),l.btn=e._getDefault(s.btn,r.btn),l.offset=e._getDefault(s.offset,r.offset),l.shadeClose=e._getDefault(s.isShadeClose,r.isShadeClose,r.shadeClose),l.title=e._getDefault(s.title,r.title),l.success=e._getDefault(s.onPoped,r.onPoped,r.success),l.end=e._getDefault(s.onClosed,r.onClosed,r.end),a=t.extend(!0,{},l,r)):(l={skin:s.skin,title:s.title,time:s.time,offset:s.offset,shadeClose:s.isShadeClose,btn:s.btn},a=t.extend(!0,{},l)),e.logParamValue({paramName:"params",paramValue:a,methodName:"confirm",className:FRAME_NAME,isDebug:!0}),layer.confirm(i,a,n,o)},e.prompt=function(i,r){e.logUtilConfig.debugLog.methodName="prompt",e.logMethodCalled(e.logUtilConfig.debugLog);var n,o=e.layerSetting,a={};return i&&"object"==typeof i&&(a.skin=e._getDefault(o.skin,i.skin),a.time=e._getDefault(o.time,i.time),a.btn=e._getDefault(o.btn,i.btn),a.offset=e._getDefault(o.offset,i.offset),a.shadeClose=e._getDefault(o.isShadeClose,i.isShadeClose,i.shadeClose),a.title=e._getDefault(o.title,i.title),a.success=e._getDefault(o.onPoped,i.onPoped,i.success),a.end=e._getDefault(o.onClosed,i.onClosed,i.end),a.area=[a.width,a.height],n=t.extend(!0,{},a,i)),e.logParamValue({paramName:"params",paramValue:n,methodName:"prompt",className:FRAME_NAME,isDebug:!0}),layer.prompt(i,r)},e.setTopLayer=function(e){layer.setTop(e)},e.closeIndex=function(t){e.logUtilConfig.debugLog.methodName="closeIndex",e.logMethodCalled(e.logUtilConfig.debugLog),t==i&&(t=layer.index),layer.close(t)},e.closeAll=function(t){return e.logUtilConfig.debugLog.methodName="closeAll",e.logMethodCalled(e.logUtilConfig.debugLog),t=t||"",layer.closeAll(t)},e}(wui||{},libs),function(e,t,i){return e.getToastrDefaults=function(){return{closeButton:!0,debug:!1,progressBar:!0,positionClass:"toast-top-right",onclick:e.CONSTANTS.EMPTYFUNC,showDuration:400,hideDuration:1e3,timeOut:5e3,extendedTimeOut:1e3,showEasing:"swing",hideEasing:"linear",showMethod:"fadeIn",hideMethod:"fadeOut",target:"body",tapToDismiss:!1}},e.successNotice=function(t,i,r){e.notice(t,i,r,"success")},e.warnNotice=function(t,i,r){e.notice(t,i,r,"warning")},e.errorNotice=function(t,i,r){e.notice(t,i,r,"error")},e.notice=function(i,r,n,o){e.logUtilConfig.debugLog.methodName="notice",e.logMethodCalled(e.logUtilConfig.debugLog),n=n||{};var a=t.extend(!0,{},e.getToastrDefaults(),n);toastr.options=a,o=o||"info",toastr[o](i,r)},e}(wui||{},libs),function(e,t,i){return e.tabs=function(r,n){function o(e,t){this.init()}function a(i,n){var o=t.data(document.getElementById(r),S);if(!o)return void e.logError("wui.tabs 未初始化或已被销毁",FRAME_NAME+"."+N,!0);var a=Array.prototype.slice.call(arguments,1);return"function"==typeof o[i]?o[i].apply(o,a):void e.logWarn("wui.tabs 中不存在 "+i+"() 方法",FRAME_NAME+"."+N,!0)}function s(e,i){var n=t.data(document.getElementById(r),S);return a("on",e,i),n}function l(e,i){var n=t.data(document.getElementById(r),S);return a("off",e,i),n}function d(e){return a("add",e)}function u(e,t){return a("remove",e,t)}function h(e,t){return a("index",e,t)}function c(e){return a("option",e)}function f(e){return a("hide",e)}function p(e){return a("show",e)}function m(){return a("disabled")}function g(){return a("enabled")}function v(e){return a("empty",e)}function b(e){return a("refresh",e)}function y(){return a("destroy")}function x(i){return t.data(document.getElementById(r),S)?i&&e.isJson(i)?a("option",i):void 0:void t("#"+r)[w](i)}var w="uiTabs",S="plugin_"+w,N="tabs",C=["beforeShow","iframeLoaded","shown","beforeAdd","added","beforeRemove","removed"];if(e.logMethodCalled({className:FRAME_NAME,methodName:N,isDebug:!0,id:r}),!t("#"+r).exist())return e.logError("当前页面不存在 ID 为"+r+" 的DOM节点",FRAME_NAME+"."+N,!0),!1;var E={direction:"top",navStyle:"nav-tabs",tabStyle:"tab-overflow",isShowTabDrop:!0,height:0,isFullScreen:!1,offset:{left:0,right:0,top:0,bottom:0},offsetV:0,navWidth:null,navMargin:30,index:0,isDynamicLoading:!0,isEnableRemove:!1,isShowTitle:!1,tabPages:[],isAccordion:!1,onBeforeShow:e.CONSTANTS.EMPTYFUNC,onShown:e.CONSTANTS.EMPTYFUNC,onBeforeHide:e.CONSTANTS.EMPTYFUNC,onHidden:e.CONSTANTS.EMPTYFUNC},_={text:'更多 <i class="icon-align-justify"></i>',deleteIcon:"fa fa-times-circle tab-close"},T=function(){var e,i=[],r=!1,n=function(t){clearTimeout(e),e=setTimeout(o,100)},o=function(){for(var e=0,t=i.length;e<t;e++)i[e].apply()};return{register:function(e){i.push(e),r===!1&&(t(window).bind("resize",n),r=!0)},unregister:function(e){for(var t=0,r=i.length;t<r;t++)if(i[t]==e){delete i[t];break}}}}();return o.prototype={constructor:o,init:function(){this.pluginName=N,this.element=r,this.$element=t("#"+r),this.defaults=_,this._option=n,this.hasDom=!1,this.initDom=this.$element.prop("outerHTML");var i=e.getAttributeParams(this.$element,E);this._opt=t.extend(!0,{},E,n,i),this.liNavTmpl='<li role="presentation" wui-attr="nav"><a href="javascript:void(0);" aria-controls="" role="tab" data-toggle="tab"></a></li>',this.tabContentTmpl='<div role="tabpanel" class="tab-pane fade" id=""></div>',this.deleteTpml='<i class="'+_.deleteIcon+'"></i>',this.iframeTmpl='<iframe id="" name="" allowtransparency="true" width="100%" height="100%" src="" scrolling="yes" frameborder="0"></iframe>',this.$Maxcontainer=this.$element,this.$navBox=null,this.$tabsPageBox=null,this.$dropdownBox=null,this.navBoxItemList=[],this.listeners=[],this.handlers={},this._formatParams(),this.dom=this._buildContainer()},_buildContainer:function(){var e=this,i=this._opt;this.$element;this.$element.hasClass("wui-tabs")||this.$element.addClass("wui-tabs"),this._createContainer(),this.$navBox.hide(),this.$dropdownBox=t('<li class="dropdown hide pull-right tabdrop"><a class="dropdown-toggle" data-toggle="dropdown" href="#">'+e.defaults.text+' <b class="caret"></b></a><ul class="dropdown-menu"></ul></li>'),this.$navBox.children(".tabdrop").length>0?this.$dropdownBox=this.$navBox.children(".tabdrop"):(this.$dropdownBox.prependTo(this.$navBox),this.$navBox.parent().is(".tabs-below")&&this.$dropdownBox.addClass("dropup"),T.register(t.proxy(this.layout,this))),this.navBoxItemList=this._getList(),this._setEnableRemove(i.isEnableRemove),this._setTabdrop(i.isShowTabDrop),t.each(this.navBoxItemList,function(){if(t(this).children("a").on("show.bs.tab",function(t){return e._show(t)}).on("hide.bs.tab",function(t){return e._hide(t)}).on("shown.bs.tab",function(t){return e._shown(t)}).on("hidden.bs.tab",function(t){return e._hidden(t)}).on("click",function(e){return e.preventDefault(),!t(this).attr("disabled")&&void t(this).tab("show")}),e._opt.isEnableRemove){var i=t(e.deleteTpml);t(this).children("a").addClass("is-close").append(i),i.on("click",function(i){i.preventDefault(),e._remove(t(this))})}});for(var r=i.tabPages,n=r.length,o=0;o<n;o++){var a=r[o];this._add(a)}return null!=this._opt.index?this.index(this._opt.index):this.index(0),this._setHeight(),this._bindEvent(),null!=i.index&&this.index(i.index),this.hasDom=!0,this.$Maxcontainer.prop("outerHTML")},_setTabdrop:function(e){if(e=e||!1);else{var t=this.$dropdownBox.children(".dropdown-menu").children("li");t.appendTo(this.$navBox),this.$dropdownBox.addClass("hide").find("ul").empty()}},_formatParams:function(){this._opt},_bindEvent:function(){var e=this;this.hasDom||t.each(this.navBoxItemList,function(i,r){var n=t(r);n.children("a").on("show.bs.tab",function(t){return e._show(t)}).on("hide.bs.tab",function(t){return e._hide(t)}).on("shown.bs.tab",function(t){return e._shown(t)}).on("hidden.bs.tab",function(t){return e._hidden(t)})})},_show:function(e){var t=this._opt;return t.onBeforeShow&&"function"==typeof t.onBeforeShow&&t.onBeforeShow(e),!(this.listeners.indexOf("show")>-1&&!this.emit({type:"show",target:e.target}))&&this},_hide:function(e){var t=this._opt;return t.onBeforeHide&&"function"==typeof t.onBeforeHide&&t.onBeforeHide(e),!(this.listeners.indexOf("hide")>-1&&!this.emit({type:"hide",target:e.target}))&&this},_shown:function(e){var t=this._opt;return t.onShown&&"function"==typeof t.onShown&&t.onShown(e),!(this.listeners.indexOf("shown")>-1&&!this.emit({type:"shown",target:e.target}))&&this},_hidden:function(e){var t=this._opt;return t.onHidden&&"function"==typeof t.onHidden&&t.onHidden(e),!(this.listeners.indexOf("hidden")>-1&&!this.emit({type:"hidden",target:e.target}))&&this},_getList:function(){var e=[];return this.$navBox.find(">li").not(".tabdrop").each(function(){e.push(this)}),this.$dropdownBox.find("li").each(function(){e.push(this)}),e},layout:function(){var e=[],i=null;this._opt.isShowTabDrop&&(this.$dropdownBox.addClass("hide"),this.$navBox.append(this.$dropdownBox.find("li")).find(">li").not(".tabdrop").each(function(){this.offsetTop>0?e.push(this):i=this}),e.length>0&&(this.$dropdownBox.removeClass("hide"),e.unshift(i),e=t(e),this.$dropdownBox.find("ul").empty().append(e),1==this.$dropdownBox.find(".active").length?this.$dropdownBox.addClass("active"):this.$dropdownBox.removeClass("active")),this._setHeight())},_createContainer:function(){var e=this._opt;switch(e.direction){case"top":0==this.$element.find('[wui-tabs-part="nav"]').length?(this.$navBox=t('<ul class="nav '+e.navStyle+'" wui-tabs-part="nav"></ul>'),this.$element.prepend(this.$navBox)):this.$navBox=this.$element.find('[wui-tabs-part="nav"]'),0==this.$element.find('[wui-tabs-part="tabContent"]').length?(this.$tabsPageBox=t('<div class="tab-content '+e.tabStyle+'" wui-tabs-part="tabContent"></div>'),this.$element.append(this.$tabsPageBox)):this.$tabsPageBox=this.$element.find('[wui-tabs-part="tabContent"]');break;case"bottom":case"below":0==this.$element.find('[wui-tabs-part="tabContent"]').length?(this.$tabsPageBox=t('<div class="tab-content '+e.tabStyle+'" wui-tabs-part="tabContent"></div>'),this.$element.prepend(this.$tabsPageBox)):this.$tabsPageBox=this.$element.find('[wui-tabs-part="tabContent"]'),0==this.$element.find('[wui-tabs-part="nav"]').length?(this.$navBox=t('<ul class="nav '+e.navStyle+'" wui-tabs-part="nav"></ul>'),this.$element.append(this.$navBox)):this.$navBox=this.$element.find('[wui-tabs-part="nav"]');break;case"right":this.$element.hasClass("tabs-horizontal")||this.$element.addClass("tabs-horizontal"),this._opt.isShowTabDrop=!1,0==this.$element.find('[wui-tabs-part="tabContent"]').length?(this.$tabsPageBox=t('<div class="tab-content" wui-tabs-part="tabContent"></div>'),this.$element.append(this.$tabsPageBox)):this.$tabsPageBox=this.$element.find('[wui-tabs-part="tabContent"]'),0==this.$element.find('[wui-tabs-part="nav"]').length?(this.$navBox=t('<ul class="nav nav-right" wui-tabs-part="nav"></ul>'),this.$element.prepend(this.$navBox)):(this.$navBox=this.$element.find('[wui-tabs-part="nav"]'),this.$navBox.hasClass("nav-right")||this.$navBox.addClass("nav-right"));break;case"left":this.$element.hasClass("tabs-horizontal")||this.$element.addClass("tabs-horizontal"),this._opt.isShowTabDrop=!1,0==this.$element.find('[wui-tabs-part="nav"]').length?(this.$navBox=t('<ul class="nav nav-left" wui-tabs-part="nav"></ul>'),this.$element.prepend(this.$navBox)):(this.$navBox=this.$element.find('[wui-tabs-part="nav"]'),this.$navBox.hasClass("nav-left")||this.$navBox.addClass("nav-left")),0==this.$element.find('[wui-tabs-part="tabContent"]').length?(this.$tabsPageBox=t('<div class="tab-content" wui-tabs-part="tabContent"></div>'),this.$element.append(this.$tabsPageBox)):this.$tabsPageBox=this.$element.find('[wui-tabs-part="tabContent"]');break;default:0==this.$element.find('[wui-tabs-part="nav"]').length?(this.$navBox=t('<ul class="nav '+e.navStyle+'" wui-tabs-part="nav"></ul>'),this.$element.prepend(this.$navBox)):this.$navBox=this.$element.find('[wui-tabs-part="nav"]'),0==this.$element.find('[wui-tabs-part="tabContent"]').length?(this.$tabsPageBox=t('<div class="tab-content '+e.tabStyle+'" wui-tabs-part="tabContent"></div>'),this.$element.append(this.$tabsPageBox)):this.$tabsPageBox=this.$element.find('[wui-tabs-part="tabContent"]')}return this},_setHeight:function(){var i=this,r=this._opt,n=0;this._opt.isShowTitle?this.$navBox.show():(this.$navBox.show(),t.each(this.navBoxItemList,function(e,i){t(i).is(":visible")&&n++}),1==n&&this.$navBox.hide());var o=i.$element.height(),a=(i.$element.width(),i.$navBox.height()),s=this._opt.offset,l=this._opt.offsetV;if(l=s.top||s.bottom?parseFloat(s.top)+parseFloat(s.bottom):parseFloat(l),this.$navBox.is(":visible")||(a=0),r.isFullScreen){var d=wui.getFullScreenSize("#"+this.element);o=d.height-l,i.$element.height(o)}else r.height&&parseInt(r.height)>0&&(o=r.height);var u=0,h=0;if("left"==r.direction){u=o+"px",h="auto",r.navWidth&&this.$navBox.width(r.navWidth);var c=this.$navBox.width();this.$tabsPageBox.css({"margin-left":c+r.navMargin+"px"}),i.$navBox.css({height:u}),e.scroll(this.$navBox)}else if("right"==r.direction){u=o+"px",h="auto",r.navWidth&&this.$navBox.width(r.navWidth);var c=this.$navBox.width();this.$tabsPageBox.css({"margin-right":c+r.navMargin+"px"}),i.$navBox.css({height:u}),e.scroll(this.$navBox)}else u=parseInt(o)-parseInt(a)-5+"px",h="100%";i.$tabsPageBox.css({height:u,width:h}),i.$tabsPageBox.children(".tab-pane").css({height:u,width:"100%","padding-top":"2px","padding-bottom":"5px","padding-left":"5px","padding-right":"5px"})},_add:function(r){if("object"!=typeof r)return void e.logError("只能添加传递的对象参数",FRAME_NAME+"."+N,!0);if("string"!=typeof r.content||""==r.content)return void e.logError("添加的选项卡内容只能是表示HTML模板id或者是iframe的src的字符串",FRAME_NAME+"."+N,!0);if(!(this.listeners.indexOf("beforeAdd")>-1)||this.emit({type:"beforeAdd",target:this.$element})){var n=this,o=r.id?r.id:e.guid(),a=o+"_tab",s=!1,l=-1;if(t.each(this.navBoxItemList,function(e,i){if(t(this).attr("_tabId")==a)return l=e,s=!0,!1}),s)return this.index(l),e.logMessage("添加选项页id重复:"+a),!1;var d=t(this.liNavTmpl);d.attr("_tabId",a),d.children("a").attr({href:"#"+a,"aria-controls":a}).html(r.title);var u=t(this.tabContentTmpl);u.attr("id",a),this._opt.isShowTabDrop?this.$dropdownBox.find("ul").append(d):this.$navBox.append(d),this.$tabsPageBox.append(u);var h=null;if(r.dataType=r.dataType?r.dataType:"iframe","iframe"==r.dataType){r.otherParam&&r.otherParam!==i&&""!==r.otherParam&&null!==r.otherParam||(r.otherParam={}),h=t(this.iframeTmpl);var c=o+"_iframe";h.attr({id:c,name:c}),d.children("a").on("show.bs.tab",function(i){if("true"==t(this).attr("isInit"));else{var o=r.content,a=r.otherParam;if(n.listeners.indexOf("beforeShow")>-1){var s=n.emit({type:"beforeShow",target:i.target,relatedtarget:i.relatedtarget,otherParam:a});if(!s)return s!==!1&&void 0;s.otherParam&&"object"==typeof s.otherParam&&(a=s.otherParam)}var l=e.buildUrl(o,a);h.attr("src",l),u.html(h),h.off("load").on("load",function(e){n.listeners.indexOf("iframeLoaded")>-1&&!n.emit({type:"iframeLoaded",target:e.target,relatedtarget:e.relatedtarget,iframeId:c,src:l})})}n._opt.isDynamicLoading||t(this).attr("isInit","true")})}else if("html"==r.dataType&&""!=r.content)if(this._opt.isDynamicLoading)d.children("a").on("show.bs.tab",function(){var e=r.content;if(n.listeners.indexOf("beforeShow")>-1){var t=n.emit({type:"beforeShow",target:h[0],content:e});if(!t)return t!==!1&&void 0;"string"==typeof t.content&&(e=t.content)}u.html(e)});else{var f=r.content;if(n.listeners.indexOf("beforeShow")>-1){var p=n.emit({type:"beforeShow",target:h[0],content:f});if(!p)return;"string"==typeof p.content&&(f=p.content)}u.html(f)}if(d.children("a").on("show.bs.tab",function(e){return n._show(e)}).on("hide.bs.tab",function(e){return n._hide(e)}).on("shown.bs.tab",function(e){return n._shown(e)}).on("hidden.bs.tab",function(e){return n._hidden(e)}).on("click",function(e){return e.preventDefault(),!t(this).attr("disabled")&&void t(this).tab("show")}),this._opt.isEnableRemove){var m=t(this.deleteTpml);d.children("a").addClass("is-close").append(m),m.on("click",function(e){e.preventDefault(),n._remove(d)})}if(r.hidden&&d.hide(),this.navBoxItemList.push(d[0]),this._opt.isShowTabDrop?this.layout():this._setHeight(),!(this.listeners.indexOf("added")>-1)||this.emit({type:"added",target:d}))return this}},add:function(e){var t=this._add(e);return t&&(e.open?this.index(this.navBoxItemList.length):this.index()<0&&this.index(0)),this},_remove:function(e){var i=t(e).children("a"),r=-1;t(i.attr("href"))&&t(i.attr("href")).length>0&&t(i.attr("href")).remove(),t(e).hasClass("active")&&(r=t(e).index()),t(e).remove(),this.navBoxItemList=this._getList(),r>-1&&this.index(r),this._opt.isShowTabDrop?this.layout():this._setHeight()},hide:function(i){var r=this;e.isArray(i)?t.each(i,function(e,i){r.navBoxItemList[e]&&t(r.navBoxItemList[e]).hide()}):e.isNumber(i)?r.navBoxItemList[i]&&t(r.navBoxItemList[i]).hide():"all"==i&&t.each(r.navBoxItemList,function(e,i){t(i).hide()}),this._opt.isShowTabDrop?this.layout():this._setHeight()},show:function(i,r){var n=this;e.isArray(i)?t.each(i,function(e,i){n.navBoxItemList[e]&&t(n.navBoxItemList[e]).show()}):e.isNumber(i)?n.navBoxItemList[i]&&t(n.navBoxItemList[i]).show():"all"==i&&t.each(n.navBoxItemList,function(e,i){t(i).show()}),this._opt.isShowTabDrop?this.layout():this._setHeight()},disabled:function(){for(var e=this.navBoxItemList,i=e.length,r=0;r<i;r++){var n=e[r];t(n).children("a").children("i").remove()}},enabled:function(){for(var e=this,i=this.navBoxItemList,r=i.length,n=0;n<r;n++){var o=i[n],a=t(this.deleteTpml);t(o).children("a").append(a),a.on("click",function(i){i.preventDefault(),e._remove(t(o))})}},option:function(t){var r=this._opt;if(!t)return r;if("object"==typeof t)this.dom=this._resetOption(t);else if("string"==typeof t)return"getDefOpt"===t?E:r[t]==i?e.logWarn("查找的属性值不存在",FRAME_NAME+"."+N,!0):r[t]},_resetOption:function(t){var r=this,n=this._opt;if(t.isShowTabDrop!=i&&n.isShowTabDrop!=t.isShowTabDrop&&(this._opt.isShowTabDrop=t.isShowTabDrop,this._setTabdrop(t.isShowTabDrop)),t.height!=i&&n.height!=parseInt(t.height)){var o=t.height;0==o?o=0:"number"!=typeof o&&(o=parseInt(o)),o<0&&(e.logWarn("height参数必须为非负整数",FRAME_NAME+"."+N,!0),o=0),this._opt.height=o,r._setHeight()}if(t.index!=i&&n.index!=parseInt(t.index)){var a=t.height;0==a?a=0:"number"!=typeof a&&(a=parseInt(a)),a<0&&(e.logWarn("index参数必须为非负整数",FRAME_NAME+"."+N,!0),a=0),this._opt.index=a,this.index(a)}if(t.isEnableRemove!=i&&n.isEnableRemove!=t.isEnableRemove&&(this._opt.isEnableRemove=t.isEnableRemove,this._setEnableRemove(t.isEnableRemove)),t.isShowTitle!=i&&n.isShowTitle!=t.isShowTitle&&(this._opt.isShowTitle=t.isShowTitle,r._setHeight()),t.tabPages!==i){this._opt.tabPages=t.tabPages,this.empty();for(var s=t.tabPages,l=s.length,d=0;d<l;d++){var u=s[d];this._add(u)}null!=this._opt.index&&this.index(this._opt.index)}},_setEnableRemove:function(e){var i=this;e?t.each(this.navBoxItemList,function(e,r){var n=t(r);if(0==n.find("i").length){var o=t(i.deleteTpml);n.children("a").append(o),o.on("click",function(e){e.preventDefault(),i._remove(n[0])})}}):t.each(this.navBoxItemList,function(e,i){var r=t(i);r.find("i").remove()})},index:function(i,r){if("string"==typeof i||"number"==typeof i){var n=this.navBoxItemList.length;if(0==n)return void e.logMessage("当前没有可打开的选项卡页",FRAME_NAME+"."+N,!0);i=parseInt(i),i<0?i=0:i>=n&&(i=n-1);var o=t(this.navBoxItemList).eq(i);o.hasClass("active")||o.children("a").tab("show");var a=o.children("a").attr("href"),s=null;return s=t(a).children("iframe").length>0?t(a).children("iframe")[0]:t(a).get(0),r&&"function"==typeof r&&r(i,o[0],s),i}if(i&&"function"==typeof i){var l=0,d=null;t(this.navBoxItemList).each(function(e,i){if(t(i).hasClass("active"))return d=i,l=e,!1});var a=t(d).children("a").attr("href"),s=null;return s=t(a).children("iframe").length>0?t(a).children("iframe")[0]:t(a).get(0),i(l,d,s),l}var l=-1,d=null;t(this.navBoxItemList).each(function(e,i){if(t(i).hasClass("active"))return d=i,l=e,!1});var a=t(d).children("a").attr("href"),s=null;return s=t(a).children("iframe").length>0?t(a).children("iframe")[0]:t(a).get(0),r&&"function"==typeof r&&r(l,d,s),l},remove:function(i,r){if(!(this.listeners.indexOf("beforeRemove")>-1)||this.emit({type:"beforeRemove",target:this.$element})){var n=this.navBoxItemList.length;if(0==n)return void e.logError("当前没有可删除的选项卡页",FRAME_NAME+"."+N,!0);i=parseInt(i),i<0?i=0:i>=n&&(i=n-1);var o=t(this.navBoxItemList).eq(i),a=t(o.children("a").attr("href"));if(o.hasClass("active")?(t(this.navBoxItemList).eq(i).remove(),this.navBoxItemList.splice(i,1),this.index(i)):(t(this.navBoxItemList).eq(i).remove(),this.navBoxItemList.splice(i,1)),a.remove(),this._opt.isShowTabDrop?this.layout():this._setHeight(),!(this.listeners.indexOf("removed")>-1)||this.emit({type:"removed",target:this.$element}))return r&&"function"==typeof r&&r(),this}},empty:function(i){if(0==this.navBoxItemList.length)return void e.logMessage("当前没有可删除的选项卡页","wui.tabs",!0);for(var r=this.navBoxItemList.length,n=[],o=0;o<r;o++){var a=this.navBoxItemList[o];if("nav"===t(a).attr("wui-attr")){var s=t(a).children("a");t(s.attr("href"))&&t(s.attr("href")).length>0&&t(s.attr("href")).remove(),t(a).remove()}else n.push(a)}return this.navBoxItemList=n,this._setHeight(),i&&"function"==typeof i&&i(),this},destroy:function(){if(!(this.listeners.indexOf("destroy")>-1)||this.emit({type:"destroy",target:this.dom}))return this.$element.replaceWith(this.initDom),this.$element.removeData(S),this},refresh:function(i){var r=this,n={},o=0,a=null;t(this.navBoxItemList).each(function(e,i){if(t(i).hasClass("active"))return a=i,o=e,!1});var s=t(a).children("a").attr("href"),l=t(s).children("iframe"),d=l.attr("src");if(r.listeners.indexOf("beforeShow")>-1){var u=r.emit({type:"beforeShow",target:$temp[0],otherParam:n});if(!u)return u!==!1&&void 0;u.otherParam&&"object"==typeof u.otherParam&&(n=u.otherParam)}var h={};if(i&&("function"==typeof i?i(h):"object"==typeof i&&(h=i)),"object"==typeof h&&!e.isArray(h))for(var c in h)n[c]=h[c];e.buildUrl(d,n);return l.attr("src",d),this},on:function(e,t){return C.indexOf(e)>-1&&("undefined"==typeof this.handlers[e]&&(this.handlers[e]=[],this.listeners.push(e)),this.handlers[e].push(t)),this},off:function(e,t){var r,n,o,a,s;if(C.indexOf(e)>-1&&this.handlers[e]instanceof Array){for(a=this.handlers[e],o=this.listeners,r=0,s=o.length;r<s&&o[r]!==e;r++);if(t===i)this.listeners.splice(r,1),delete this.handlers[e];else{for(n=0,s=a.length;n<s&&a[n]!==t;n++);n<s&&(this.handlers[e].splice(n,1),0==this.handlers[e].length&&this.listeners.splice(r,1))}}return this},emit:function(e){if(e.target||(e.target=this),this.handlers[e.type]instanceof Array)for(var t=this.handlers[e.type],i=0,r=t.length;i<r;i++)return t[i](e);return!1}},t.fn[w]=function(e){return this.each(function(){t.data(document.getElementById(r),S)||t.data(document.getElementById(r),S,new o(this,e))})},x(n),{init:x,on:s,off:l,add:d,remove:u,index:h,option:c,hide:f,show:p,enabled:g,disabled:m,empty:v,refresh:b,destroy:y}},e}(wui||{},libs),function(e,t,i){return e.validate=function(r,n){function o(e,t){this.init()}function a(i,n){var o=t.data(r,f);if(!o)return void e.logError("wui.validate 未初始化或已被销毁",FRAME_NAME+"."+p,!0);var a=Array.prototype.slice.call(arguments,1);return"function"==typeof o[i]?o[i].apply(o,a):void e.logWarn("wui.validate 中不存在 "+i+"() 方法",FRAME_NAME+"."+p,!0)}function s(e){return a("resetForm",e)}function l(){return a("valid")}function d(e,t,i,r){return a("rules",e,t,i,r)}function u(e){return a("validElement",e)}function h(e){t(r)[c](e)}var c="formValidate",f="plugin_"+c,p="validate";if(e.logMethodCalled({className:FRAME_NAME,methodName:p,isDebug:!0,id:r}),r){if(!t(r).exist())return e.logWarn("当前页面不存在"+r+" 表单",FRAME_NAME+"."+p,!0),!1;r=t(r).eq(0)}else e.logWarn("form 没传递",FRAME_NAME+"."+p,!0),r=t("form").eq(0);var m={ignore:":hidden:not([ui-type],select)",errorTipStyle:e.validateUtilConfig.errorTipStyle,errorTipSetting:{isShadeClose:!0,time:2e3,skin:"layui-layer-warning"},errorElement:"em",labelErrorClass:e.validateUtilConfig.labelErrorClass,validClass:"valid",elementErrorClass:e.validateUtilConfig.elementErrorClass,elementSuccessClass:e.validateUtilConfig.elementSuccessClass,isAddRequiredStar:e.validateUtilConfig.isAddRequiredStar,textTdClassName:"validate-title",starDirection:e.validateUtilConfig.starDirection,rules:{},messages:{},onkeyup:!1,errorPlacement:e.CONSTANTS.EMPTYFUNC,highlight:e.CONSTANTS.EMPTYFUNC,unhighlight:e.CONSTANTS.EMPTYFUNC,submitHandler:e.CONSTANTS.EMPTYFUNC},g={messages:{required:"这是必填字段",widgetRequired:"此组件值不能为空",remote:"请修正此字段",email:"请输入有效的电子邮件地址",url:"请输入有效的网址",date:"请输入有效的日期",dateISO:"请输入有效的日期 (yyyy-mm-dd)",number:"请输入合法的数字(包括负数,小数)",digits:"只能输入非负数",creditcard:"请输入有效的信用卡号码",equalTo:"你的输入不相同",extension:"请输入有效的后缀",maxlength:t.validator.format("最多可以输入 {0} 个字符"),minlength:t.validator.format("最少要输入 {0} 个字符"),rangelength:t.validator.format("请输入长度在 {0} 到 {1} 之间的字符串"),range:t.validator.format("请输入范围在 {0} 到 {1} 之间的数值"),max:t.validator.format("请输入不大于 {0} 的数值"),min:t.validator.format("请输入不小于 {0} 的数值")},ruleAttribute:"id",dataAttribute:e.validateAttributeField||"validate",messageAttribute:"message",messageSplitString:"###"};return o.prototype={constructor:o,init:function(){this.pluginName=p,this.form=r,this.$form=t(r),this.defaults=g,this._option=n,this.requiredHtml='<i class="red-star">*</i> ',this.hasDom=!1;var i=e.getAttributeParams(this.$form,m);this._opt=t.extend(!0,{},m,n,i),this._validate=null,this._formatParams(),this.dom=this._initDom()},_formatParams:function(){var t=this._opt;t.errorTipStyle&&e.validateUtilConfig.errorTipStyles[t.errorTipStyle]!=i?t.errorPlacement=e.validateUtilConfig.errorTipStyles[t.errorTipStyle]:t.errorPlacement=e.validateUtilConfig.errorTipStyles.tips},_getOptions:function(){var e=this,i=e._opt,r=(this.$form,{rules:i.rules,messages:i.messages,ignore:i.ignore,errorClass:i.labelErrorClass,validClass:i.validClass,onfocusin:i.onfocusin,onfocusout:i.onfocusout,onkeyup:i.onkeyup,onclick:i.onclick,onsubmit:i.onsubmit,errorElement:i.errorElement,focusInvalid:i.focusInvalid,focusCleanup:i.focusCleanup,errorPlacement:function(e,t){i.errorPlacement(e,t,i.errorTipSetting)},highlight:function(e,r,n){var o=i.elementErrorClass,a=i.elementSuccessClass;if(t(e).attr("ui-type")){var s=t(e).attr("ui-type");switch(s){case"file":t(e).parent().removeClass(a).addClass(o);break;case"date":t(e).removeClass(a).addClass(o);break;case"img":t(e).parent().removeClass(a).addClass(o);break;case"opinionBox":t(e).next().children("textarea").removeClass(a).addClass(o);break;default:t(e).parent().removeClass(a).addClass(o)}}else if(i.highlight&&"function"==typeof i.highlight)i.highlight(e,r,n);else if(t(e).is("select"))t(e).removeClass(a).addClass(o);else if("checkbox"===t(e).prop("type"))if(t(e).parents(".wui-valid-tip")&&t(e).parents(".wui-valid-tip").length>0){var l=t(e).parents(".wui-valid-tip");l.removeClass(a).addClass(o)}else t(e).parent().removeClass(a).addClass(o);else if("radio"===t(e).prop("type"))if(t(e).parents(".wui-valid-tip")&&t(e).parents(".wui-valid-tip").length>0){var l=t(e).parents(".wui-valid-tip");l.removeClass(a).addClass(o)}else t(e).parent().removeClass(a).addClass(o);else t(e).removeClass(a).addClass(o)},unhighlight:function(e,r,n){var o=i.elementErrorClass,a=i.elementSuccessClass;if(t(e).attr("ui-type")){var s=t(e).attr("ui-type");switch(s){case"file":t(e).parent().removeClass(o).addClass(a);break;case"date":t(e).removeClass(o).addClass(a);break;case"img":t(e).parent().removeClass(o).addClass(a);break;case"opinionBox":t(e).next().children("textarea").removeClass(o).addClass(a);break;default:t(e).parent().removeClass(o).addClass(a)}}else if(i.unhighlight&&"function"==typeof i.unhighlight)i.unhighlight(e,r,n);else if(t(e).is("select"))t(e).removeClass(o).addClass(a);else if("checkbox"===t(e).prop("type"))if(t(e).parents(".wui-valid-tip")&&t(e).parents(".wui-valid-tip").length>0){var l=t(e).parents(".wui-valid-tip");l.removeClass(o).addClass(a)}else t(e).parent().removeClass(o).addClass(a);else if("radio"===t(e).prop("type"))if(t(e).parents(".wui-valid-tip")&&t(e).parents(".wui-valid-tip").length>0){var l=t(e).parents(".wui-valid-tip");l.removeClass(o).addClass(a)}else t(e).parent().removeClass(o).addClass(a);else t(e).removeClass(o).addClass(a)}});return r},_initDom:function(){var i=this,r=(i._opt,this.$form);i._addWidgetValidateMethod(),this._bindNameAttribute(),t.extend(t.validator.messages,i.defaults.messages),i._validateRuleSettings(),this._validate&&r.destroy();var n=i._getOptions();return e.logParamValue({paramName:"options",paramValue:n,methodName:"_initValidate",className:"wui.validate",isDebug:!0}),this._validate=r.validate(n),this.hasDom=!0,r.parent().prop("outerHTML")},_addWidgetValidateMethod:function(){var i=this;t.validator.addMethod("widgetRequired",function(i,r){var n=t(r).attr("ui-type"),o=r.id||r.name;if("file"!==n&&"img"!==n||(o=t(r).parent().attr("_fileId")),e&&e[n]){var a=e[n](o).get("value");return!(!a||0==a.length)}return!1},i.defaults.messages.widgetRequired)},_bindNameAttribute:function(){var e=this,i=e._opt,r=this.$form,n=e.defaults.dataAttribute;r.find("["+n+"]").each(function(e,i){t(i).attr("name")||t(i).attr("name",t(i).attr("id"))}),"id"==e.defaults.ruleAttribute&&t.each(i.rules,function(e,i){t("#"+e).attr("name",e)})},_normalizeAttributeRule:function(e,t,r){var n=/[^\[]*\[(.*)\][^\]]*/;if(/min|max/.test(e)&&(null===t||/number|range|text/.test(t)))r=Number(r),isNaN(r)&&(r=i);else if(/range/.test(e)){var o=r.replace(n,"$1");o&&(r=o.split(","))}return r||0===r?r=r:t===e&&"range"!==t&&(r=!0),r},_validateRuleSettings:function(){var r=this,n=this._opt,o=this.$form,a=r.defaults.dataAttribute,s=r.defaults.messageAttribute,l=r.defaults.messageSplitString,d=o.find("["+a+"]"),u={},h={},c=this.requiredHtml;d.each(function(o,d){var f,p,m,g,v,b,y=d.name,x=(d.id,{}),w={};return"submit"==d.type||"button"==d.type||"reset"==d.type||(f=d.getAttribute(a),p=d.getAttribute(s),p==i&&(p=""),!f||(m=f.match(/\[[^\]]+(\]\]|\])/g),m&&t.each(m,function(e,t){var i=this.replace(",","###");f=f.replace(this,i)}),g=f.split(","),v=p.split(l),t.each(g,function(i,o){b=o.replace("###",",");var a=b.split(":");if(e.isUndefined(t(d).attr("wui-attr-isaddrequiredstar"))&&("required"==a[0]||"widgetRequired"==a[0])){
if(n.isAddRequiredStar){var s=t(d).closest("td")?t(d).closest("td").prev("td"):null;s&&s.text()&&0==s.children(".red-star").length&&("left"==n.starDirection?s.prepend(c):s.append(c))}t(d).attr("wui-attr-isaddrequiredstar",n.isAddRequiredStar)}if(!t(d).attr("ui-type")||"required"!=a[0]&&"widgetRequired"!=a[0]){if(1==a.length)"float"==a[0]||"double"==a[0]?x[a[0]]=2:x[a[0]]=!0;else{var l=r._normalizeAttributeRule(a[0],d.type,a[1]);x[a[0]]=l}v[i]&&(w[a[0]]=v[i])}else x.widgetRequired=!0,v[i]&&(w.widgetRequired=v[i])}),u[y]=x,h[y]=w,!0))});var f=r._opt.rules,p=r._opt.messages;r._opt.rules=t.extend(!0,{},u,f),r._opt.messages=t.extend(!0,{},h,p)},rules:function(i,r,n,o){var a,s=this._opt,l=this.requiredHtml;if(t(i).attr("name")||t(i).attr("name",t(i).attr("id")),e.isUndefined(o)&&(o=s.isAddRequiredStar),this._validate.resetForm(),"add"==r){if(e.isJson(n)&&(n.hasOwnProperty("required")||n.hasOwnProperty("widgetRequired"))&&o){var d=t(i).closest("td")?t(i).closest("td").prev("td"):null;d&&d.text()&&0==d.children(".red-star").length&&("left"==s.starDirection?d.prepend(l):d.append(l))}}else if(!n||n.indexOf("required")>-1||n.indexOf("widgetRequired")>-1){var d=t(i).closest("td")?t(i).closest("td").prev("td"):null;d&&d.text()&&d.children(".red-star").length>0&&d.children(".red-star").remove()}return a=t(i).rules(r,n)},option:function(t){var i=this._opt;if(!t)return i;if("object"==typeof t)this._resetOption(t);else if("string"==typeof t)return"getDefOpt"===t?m:i[t]?i[t]:e.logWarn("查找的属性值不存在",FRAME_NAME+"."+p,!0)},_resetOption:function(e){this._opt;this._validate.resetForm(),this._initDom()},resetForm:function(){this._validate.resetForm()},destroy:function(e){return this.$form.removeData(f),this},valid:function(){return this.$form.valid()},validElement:function(e){return this._validate.element(e)}},t.fn[c]=function(e){return this.each(function(){t.data(r,f)?(t.data(r,f)._validate.resetForm(),t.data(r,f,new o(this,e))):t.data(r,f,new o(this,e))})},h(n),{init:h,valid:l,validElement:u,rules:d,resetForm:s}},e.validElement=function(r,n){if(e.logUtilConfig.debugLog.methodName="validElement",e.logMethodCalled(e.logUtilConfig.debugLog),r!==i&&(n===i&&(n=r.parents("form").get(0)),n!==i)){var o=t.data(n,"validator");return o?(o.element(r),o):void 0}},e.addValidateMethod=function(r,n,o){if(e.logUtilConfig.debugLog.methodName="addValidateMethod",e.logMethodCalled(e.logUtilConfig.debugLog),t.validator&&"function"==typeof t.validator&&"function"==typeof t.validator.addMethod){if(r!=i&&"function"==typeof n){return t.validator.addMethod(r,n,o),!0}}else e.logWarn("无法添加自定义校验方法,原因是:没引入校验的第三方插件","wui.addValidateMethod",!0);return!1},e.setValidateDefault=function(r){if(e.logUtilConfig.debugLog.methodName="setValidateDefault",e.logMethodCalled(e.logUtilConfig.debugLog),t.validator&&"function"==typeof t.validator&&"function"==typeof t.validator.addMethod){if(r!=i&&"object"==typeof r)return t.validator.setDefaults(r),!0}else e.logWarn("无法设置默认的校验参数,原因是:没引入校验的第三方插件","wui.setValidateDefault",!0);return!1},e.addValidateErrorTipStyle=function(t,i){if(e.logUtilConfig.debugLog.methodName="addValidateErrorTipStyle",e.logMethodCalled(e.logUtilConfig.debugLog),t&&i&&"function"==typeof i)try{return e.validateUtilConfig.errorTipStyles[t]=i,!0}catch(r){e.logWarn("无法添加校验出错节点全局提示样式","wui.addValidateErrorTipStyle",!0)}else e.logWarn("无法添加校验出错节点全局提示样式,原因是:传递参数不符合规则","wui.addValidateErrorTipStyle",!0);return!1},e}(wui||{},libs),function(e,t,i){function r(i,r,n,o){if(this.opt=r,this.component=n,this.active=!1,this.textFields=e.getTextField(r.text),this.data=i,"object"==typeof i&&(this.item=i,this.enable=e.isUndefined(this.item.isEnableRemove)?o:this.item.isEnableRemove),"string"==typeof i){this.enable=o,this.item={},this.item[r.name]=i;for(var a=0;a<this.textFields.length;a++){var s=this.textFields[a];this.item[s.value]=i}this.item.isEnableRemove=this.enable}this.enable=e.isUndefined(this.enable)?n.isClosable:this.enable,this.key="string"==typeof i?i:i[r.name],this.tagTmp='<span class="tag label"><span wui-attr="title"></span><span data-role="remove"></span></span>',this.node=t(this.tagTmp),this.renderNode(),this.component.itemsName.push(this.key)}r.prototype={constructor:r,renderNode:function(){var e=this;this.data;this.renderTitle(this.item),this.addClass(this.opt.tagClass),this.component.$input?this.component.$input.before(this.node):this.component.$viewBox.append(this.node),this.nodeRenderStatus(),this.node.on("click",function(e){e.stopPropagation()}),this.node.children('[data-role="remove"]').on("click",function(t){t.stopPropagation(),e.component.removeNode(e.data)})},nodeRenderStatus:function(){this.setEnable(this.enable),this.component.trigger("nodeRender",this)},addClass:function(e){this.node.addClass(e)},removeClass:function(e){this.node.removeClass(e)},remove:function(){var e=this.node.index();this.node.remove(),this.component.nodes.splice(e,1),this.component.itemsName.splice(e,1)},renderTitle:function(i){var r=this,n=this.opt.text,o=n;if(e.isUndefined(i)&&(i=this.item),this.textFields.length>0)for(var a=0;a<this.textFields.length;a++){var s=this.textFields[a];e.isUndefined(i[s.value])&&(i[s.value]=""),o=o.replace(s.match,i[s.value])}else o="string"==typeof i?i:JSON.stringify(i);return this.title=r.normChars(o),this.node.find('[wui-attr="title"]').each(function(e){t(this).html(r.title)}),r.title},normChars:function(e){var t=this,i=this.opt.maxChars;return i>0&&e.length>i&&(e=e.substr(0,i)+t.opt.ellipsis),e},setEnable:function(e){this.enable=e!==!1,this.enable&&this.component.enable?this.node.children('[data-role="remove"]').removeClass("hide"):this.node.children('[data-role="remove"]').addClass("hide")},isEnable:function(){return this.enable},enter:function(){this.node.children('[data-role="remove"]').trigger("click")},focus:function(){this.node.focus()},blur:function(){this.node.blur()},setActive:function(e){e?this.addClass("selected"):this.removeClass("selected"),this.active=!!e},isActive:function(){return this.active}};var n=function(){return this||(0,eval)("this")}();"undefined"!=typeof module&&module.exports?module.exports=r:"function"==typeof define&&define.amd?define(function(){return r}):!("TagNode"in n)&&(n.TagNode=r)}(wui||{},libs),function(e,t,i){function r(i,r,n,o){if(this.opt=t.extend(!0,{},this.getInitOpt(),r),this.component=n,this.key=i[this.opt.name],this.textFields=e.getTextField(this.opt.text),this.title=i[this.opt.text],this.enable=!i[this.opt.jsonReader.disabled],delete i[this.opt.jsonReader.disabled],this.group=!!i[this.opt.jsonReader.children],this.selected=!!i[this.opt.jsonReader.selected],delete i[this.opt.jsonReader.selected],this.hidden=!!i[this.opt.jsonReader.hidden],delete i[this.opt.jsonReader.hidden],this.data=i,"object"==typeof i&&(this.item=i),"string"==typeof i){this.item={},this.item[r.name]=i;for(var a=0;a<this.textFields.length;a++){var s=this.textFields[a];this.item[s.value]=i}}this.renderTitle(this.item),this.childrens=[],this.parent=o,this.optionTmp='<li tabindex=0 data-original-index="'+this.component.pickerNodes.length+'"><a><span class="text"><i class="'+this.opt.classList.option+'"></i> '+this.title+'</span><span class="'+this.opt.classList.checked+' check-mark"></span></a></li>',this.optgroupTmp='<li class="dropdown-header" tabindex=0 data-optgroup-index="'+this.component.pickerNodes.length+'"><span class="text"><i class="'+this.opt.classList.group+'"></i> '+this.title+'</span><span class="'+this.opt.classList.checked+' check-mark"></li>',this.dividerTmp='<li class="divider" data-divider-index="{0}"></li>',this.node=null,this.renderNode()}r.prototype={constructor:r,getInitOpt:function(){return{text:"name",name:"id",jsonReader:{children:"children",disabled:"disabled",selected:"selected",hidden:"hidden"},classList:{selected:"selected",hidden:"hide",disabled:"disabled",active:"active",checked:"fa fa-check",group:"fa fa-group  wui-fa-middle",option:""},rules:{hidden:null,disabled:null,selected:null},isSelectGroup:!1,maxNumber:!1}},renderNode:function(){var i=this;this.data;this.group?(this.node=t(this.optgroupTmp),this.$divider1=t(this.dividerTmp),this.component.addPickerItem(this.$divider1),this.component.addPickerItem(this.node)):(this.node=t(this.optionTmp),this.parent&&this.node.children("a").addClass("opt"),this.component.addPickerItem(this.node)),this.node.children("a").attr("title",this.title),this.node.on("click","a, span",function(e){e.stopPropagation(),i.click()}),this.node.focus(function(){i.addClass(i.opt.classList.active)}).blur(function(){i.removeClass(i.opt.classList.active)}).hover(function(){i.focus()},function(){i.blur()}),this.node.keydown(function(e){}).keyup(function(t){t.stopPropagation();var r=window.event?t.keyCode:t.which;if(r==e.CONSTANTS.KEYS.ENTER||r==e.CONSTANTS.KEYS.OTHER)i.enter(this);else if(r==e.CONSTANTS.KEYS.DOWN)for(var n=i.getNextSibling(),o=0;o<n.length;o++){var a=n[o];if(!a.isHidden()&&a.isEnable()){i.blur(),a.focus();break}}else if(r==e.CONSTANTS.KEYS.UP)for(var s=i.getPrevSibling(),o=s.length-1;o>=0;o--){var a=s[o];if(!a.isHidden()&&a.isEnable()){i.blur(),a.focus();break}}}),this.nodeRenderStatus(this.opt.rules)},renderTitle:function(t){var i=this,r=this.opt.text,n=r;if(this.textFields.length>0)for(var o=0;o<this.textFields.length;o++){var a=this.textFields[o];e.isUndefined(t[a.value])&&(t[a.value]=""),n=n.replace(a.match,t[a.value])}else n="string"==typeof t?t:JSON.stringify(t);return this.title=n,i.title},click:function(){this.setSelected(!this.isSelected())},enter:function(){this.setSelected(!this.isSelected())},focus:function(){this.node.focus()},blur:function(){this.node.blur()},hover:function(){this.node.hover()},getPrevSibling:function(){var e=this.component.pickerNodes.indexOf(this),t=this.component.pickerNodes.slice(0,e);return t},getNextSibling:function(){var e=this.component.pickerNodes.indexOf(this),t=this.component.pickerNodes.slice(e+1,this.component.pickerNodes.length);return t},setNodeSelected:function(i,r,n){var o=!0;if(i!=this.isSelected()&&this.isEnable()&&(!i||!this.isHidden())&&(r=e.isUndefined(r)?this.opt.isSelectGroup:r,n=!!e.isUndefined(n)||n,!this.isGroup()||r)){if(n){var a=!0;if(a=i?this.component.trigger("beforeItemSelect",{srcElement:this.node.get(0),item:this.data,node:this}):this.component.trigger("beforeItemUnselect",{srcElement:this.node.get(0),item:this.data,node:this}),a===!1)return!1}this.isGroup()?(i&&"number"==typeof this.opt.maxNumber&&this.getEnableChildrens(!1).length>this.opt.maxNumber-this.component.getComponentNodes().length&&(o=!1),this.isEnable()&&o&&(this.component.isFilter||(this.selected=!!i,this.selected?this.addClass("selected"):this.removeClass("selected")),t.each(this.childrens,function(e,t){t.setNodeSelected(i,r,n)}))):(this.selected=!!i,this.selected?(this.addClass(this.opt.classList.selected),this.component.addComponentNodes(this,n)):(this.removeClass(this.opt.classList.selected),this.component.removeComponentNodes(this,n)),!this.selected&&this.parent&&this.parent.setNodeSelected(!1,!1)),1==this.opt.maxNumber&&this.component.closePicker()}},getEnableChildrens:function(i){var r=[];return t.each(this.childrens,function(t,n){n.isEnable()&&!n.isHidden()&&(e.isUndefined(i)?r.push(n):n.isSelected()===i&&r.push(n))}),r},addClass:function(e){this.node.addClass(e)},removeClass:function(e){this.node.removeClass(e)},setSelected:function(e){if(1===this.opt.maxNumber&&this.component.getComponentNodes().length>0&&e)for(;this.component.getComponentNodes().length>0;){var t=this.component.popNodes();t.setNodeSelected(!1,i,!1)}if(e){var r=this.component.isMaxNumber(this.data);if(r)return!1}this.setNodeSelected(e),this.component.renderResult()},isSelected:function(){return this.selected},setEnable:function(e){this.enable=!!e,this.enable?this.removeClass(this.opt.classList.disabled):this.addClass(this.opt.classList.disabled)},isEnable:function(){return this.enable},setNodeHidden:function(e,i){this.hidden=!!e,this.hidden?this.addClass(this.opt.classList.hidden):this.removeClass(this.opt.classList.hidden),this.isGroup()&&i&&t.each(this.childrens,function(t,r){r.setNodeHidden(e,i)})},setHidden:function(e){this.setNodeHidden(e)},isHidden:function(){return this.hidden},isGroup:function(){return this.group},nodeRenderStatus:function(e){this.node.hasClass(this.opt.classList.disabled)===this.isEnable()&&this.setEnable(this.isEnable()),this.node.hasClass(this.opt.classList.hidden)!==this.isHidden()&&this.setNodeHidden(this.isHidden()),this.node.hasClass(this.opt.classList.selected)!==this.isSelected()&&(this.selected=!this.isSelected(),this.setSelected(!this.selected)),this.component.trigger("nodeRender",this)}};var n=function(){return this||(0,eval)("this")}();"undefined"!=typeof module&&module.exports?module.exports=r:"function"==typeof define&&define.amd?define(function(){return r}):!("SelectNode"in n)&&(n.SelectNode=r)}(wui||{},libs),function(e,t,i){return e.date=function(r,n){function o(e,t){this.init(t)}function a(i,n){var o=t.data(document.getElementById(r),N);if(!o)return void e.logError("wui.date 未初始化或已被销毁",FRAME_NAME+"."+C,!0);var a=Array.prototype.slice.call(arguments,1);return"function"==typeof o[i]?o[i].apply(o,a):void e.logWarn("wui.date "+i+"() 方法",FRAME_NAME+"."+C,!0)}function s(e,i){var n=t.data(document.getElementById(r),N);return a("on",e,i),n}function l(e,i){var n=t.data(document.getElementById(r),N);return a("off",e,i),n}function d(){return a("get")}function u(e,t){return a("set",e,t)}function h(){return a("hide")}function c(){return a("show")}function f(){return a("disabled")}function p(){return a("enabled")}function m(){return a("readonly")}function g(){return a("readwrite")}function v(e){return a("option",e)}function b(){return a("empty")}function y(){return a("destroy")}function x(){return a("component")}function w(i){return t.data(document.getElementById(r),N)?i&&e.isJson(i)?a("option",i):void 0:void t("#"+r)[S](i)}var S="uiDate",N="plugin_"+S,C="date";if(e.logMethodCalled({className:FRAME_NAME,methodName:C,isDebug:!0,id:r}),!e.checkIsLoadPlugins(C))return!1;if(!t("#"+r).exist())return e.logError("【"+C+"】当前页面不存在 ID 为"+r+" 的DOM节点",FRAME_NAME+"."+C,!0),!1;var E=[],_=["show","hide","changeValue","changeDate","changeYear","changeMonth","outOfRange"],T={value:"",isFreeInput:!1,isShowBtnGroup:!1,format:"yyyy-mm-dd",pickerPosition:"auto-right",isShowClearBtn:!0,isShowTodayBtn:!0,isHighlightToday:!1,weekStart:0,minuteStep:5,startDate:"",endDate:"",startView:-1,defaultText:{emptyText:e.language.date.clearBtn}},A={language:"zh-CN",isForceParseValue:!0,minView:0,maxView:4,isAutoclose:!0,startView:2};return o.prototype={constructor:o,init:function(i){this.pluginName=C,this.hasDom=!1,this.element=r,this.$element=t("#"+this.element),this.defaults=A,this._option=i,this.initDom=t("#"+r).prop("outerHTML");var n=e.getAttributeParams(this.$element,T);this._opt=t.extend(!0,{},T,i,n),this.listeners=[],this.handlers={},this._formatParams(),this.dom=this._initDom()},_initLanguage:function(){t.fn.datetimepicker.dates["zh-CN"]=e.language.date},_formatParams:function(){var t=this._opt,i=this.$element,r="";t.value?r=e.formatDate(t.value,t.format):i.val()&&(r=e.formatDate(i.val(),t.format)),r?t.value=r:t.value="",i.val(t.value),"linked"!==t.isShowTodayBtn&&(t.isShowTodayBtn=e.formatParamToBool(t.isShowTodayBtn)),t.startDate&&(t.startDate=e.formatDate(t.startDate,t.format)),t.endDate&&(t.endDate=e.formatDate(t.endDate,t.format))},_initDom:function(){var i=this,r=this._opt,n=this.$element;n.attr("type","text"),this._checkView(),n.hasClass("date-range-input")||n.addClass("wui-input"),n.attr("name")||n.attr("name",this.element),this.name=n.attr("name"),r.isFreeInput||n.attr("readonly","readonly"),this.$container=this.$element;var o=n.nextAll('[ui-control="toolBar"]');if(r.isShowBtnGroup&&0==o.length){if(!n.parent().hasClass("input-group")){var a='<div class="input-group"></div>';n.wrap(a)}this.$container=n.parent("input-group");var s=[{html:r.defaultText.emptyText,action:"empty",title:"清空"}];e.addToolBar(i.element,s,"after"),n.nextAll('[ui-control="toolBar"]').each(function(e,r){t(r).find("[ui-toolbar-action]").each(function(e,r){var n=t(r).attr("ui-toolbar-action");"edit"==n?t(r).on("click",function(){i.show()}):"empty"==n&&t(r).on("click",function(){i.empty()})})})}i._initLanguage();var l={autoclose:this.defaults.isAutoclose,format:r.format,formatType:r.formatType,pickerPosition:r.pickerPosition,todayBtn:r.isShowTodayBtn,clearBtn:r.isShowClearBtn,todayHighlight:r.isHighlightToday,weekStart:r.weekStart,minView:this.defaults.minView,maxView:this.defaults.maxView,startView:this.defaults.startView,minuteStep:r.minuteStep,startDate:r.startDate,endDate:r.endDate,forceParse:this.defaults.isForceParseValue,language:this.defaults.language,hoursDisabled:r.hoursDisabled};return e.logParamValue({paramName:"dateParam",paramValue:l,methodName:"date",className:FRAME_NAME,isDebug:!0}),this._date=n.datetimepicker(l),i.$element.on("changeValue",function(r){var n=i.$element.get(0);n.form&&t.data(n.form,"validator")&&!e.isEmptyType(i.$element.rules())&&e.validElement(i.$element)}),i.$element.attr("ui-type",i.pluginName),this.hasDom=!0,this.$container.prop("outerHTML")},_checkView:function(){var e=this._opt.format.toLowerCase(),t=0,i=4,r=2;e.indexOf("y")>-1?i=4:e.indexOf("m")>-1?i=3:e.indexOf("d")>-1?i=2:e.indexOf("h")>-1?i=1:e.indexOf("i")>-1&&(i=0),e.indexOf("i")>-1||e.indexOf("s")>-1?t=0:e.indexOf("h")>-1?t=1:e.indexOf("d")>-1?t=2:e.indexOf("m")>-1?t=3:e.indexOf("y")>-1&&(t=4),this._opt.startView==-1?e.indexOf("d")==-1&&(e.indexOf("m")>-1?r=3:e.indexOf("h")>-1?r=1:e.indexOf("i")>-1||e.indexOf("s")>-1?r=0:e.indexOf("y")>-1&&(r=4)):r=this._opt.startView,this.defaults.maxView=i,this.defaults.minView=t,this.defaults.startView=r},option:function(t){var r=this._opt;if(!t)return r;if("object"==typeof t)this._resetOption(t);else if("string"==typeof t)return"getDefOpt"===t?T:r[t]==i?e.logWarn("查找的属性值不存在",FRAME_NAME+"."+C,!0):r[t]},_resetOption:function(r){var n=this,o=this._opt,a=this.$element,s=!1;if(r.isFreeInput!=i&&r.isFreeInput!=o.isFreeInput&&(r.isFreeInput?(this._opt.isFreeInput=r.isFreeInput,a.removeAttr("readonly")):(this._opt.isFreeInput=!1,a.attr("readonly","readonly"))),r.defaultText!=i&&r.defaultText.emptyText!=o.defaultText.emptyText&&(t.extend(!0,this._opt.defaultText,r.defaultText),o.isShowBtnGroup&&a.nextAll('[ui-control="toolBar"]').find('[ui-toolbar-action="empty"]').html(this._opt.defaultText.emptyText)),r.isShowBtnGroup!=i&&r.isShowBtnGroup!=o.isShowBtnGroup)if(r.isShowBtnGroup){if(this._opt.isShowBtnGroup=!0,!a.parent().hasClass("input-group")){var l='<div class="input-group"></div>';a.wrap(l)}this.$container=a.parent("input-group");var d=[{html:this._opt.defaultText.emptyText,action:"empty",title:"清空"}];e.addToolBar(this.element,d,"after"),a.nextAll('[ui-control="toolBar"]').each(function(e,i){t(i).find("[ui-toolbar-action]").each(function(e,i){var r=t(i).attr("ui-toolbar-action");"edit"==r?t(i).on("click",function(){n.show()}):"empty"==r&&t(i).on("click",function(){n.empty()})})})}else{this._opt.isShowBtnGroup=!1;var u=a.nextAll('[ui-control="toolBar"]');u.length>0&&(a.unwrap(),u.remove()),this.$container=this.$element}if(r.format&&r.format!=o.format&&(this._opt.format=r.format,this._checkView(),s=!0),r.pickerPosition&&r.pickerPosition!=o.pickerPosition&&(this._opt.pickerPosition=r.pickerPosition,s=!0),r.isShowTodayBtn!=i&&r.isShowTodayBtn!=o.isShowTodayBtn&&(r.isShowTodayBtn?this._opt.isShowTodayBtn=r.isShowTodayBtn:this._opt.isShowTodayBtn=!1,s=!0),r.isShowClearBtn!=i&&r.isShowClearBtn!=o.isShowClearBtn&&(r.isShowClearBtn?this._opt.isShowClearBtn=r.isShowClearBtn:this._opt.isShowClearBtn=!1,s=!0),r.isHighlightToday!=i&&r.isHighlightToday!=o.isHighlightToday&&(r.isHighlightToday?this._opt.isHighlightToday=r.isHighlightToday:this._opt.isHighlightToday=!1,s=!0),r.weekStart!=i&&r.weekStart!=o.weekStart&&(this._opt.weekStart=typeof r.weekStart,s=!0),r.minuteStep!=i&&r.minuteStep!=o.minuteStep&&(this._opt.minuteStep=parseInt(r.minuteStep),s=!0),r.startDate!=i&&r.startDate!=o.startDate&&(this._opt.startDate=e.formatDate(r.startDate,this._opt.format),s=!0),r.endDate!=i&&r.endDate!=o.endDate&&(this._opt.endDate=e.formatDate(r.endDate,this._opt.format),s=!0),s){a.datetimepicker("remove");var h={autoclose:this.defaults.isAutoclose,format:o.format,pickerPosition:o.pickerPosition,todayBtn:o.isShowTodayBtn,clearBtn:o.isShowClearBtn,todayHighlight:o.isHighlightToday,weekStart:o.weekStart,minView:this.defaults.minView,maxView:this.defaults.maxView,startView:this.defaults.startView,minuteStep:o.minuteStep,startDate:o.startDate,endDate:o.endDate,forceParse:this.defaults.isForceParseValue,language:this.defaults.language};a.datetimepicker(h)}},hide:function(){return this.$element.datetimepicker("hide"),this},show:function(){return this.$element.datetimepicker("show"),this},disabled:function(){this.$element.attr("disabled","disabled")},enabled:function(){this.$element.removeAttr("disabled")},readonly:function(){this.$element.attr("disabled","disabled"),this.$element.addClass("wui-readonly")},readwrite:function(){this.$element.removeAttr("disabled"),this.$element.removeClass("wui-readonly")},set:function(t,i){var r=this._opt;if(e.isUndefined(t))return e.logMessage("没有传入组件值","wui.date",!0),!1;if("string"==typeof t){var n;return n=i?e.formatDate(t,i):e.formatDate(t,r.format),n?(this.$element.val(n),this.$element.datetimepicker("update"),this.$element.change(),this.$element.trigger({type:"changeValue"}),!0):(this.$element.val(""),this.$element.datetimepicker("update"),this.$element.change(),this.$element.trigger({type:"changeValue"}),!1)}return!1},get:function(){return this.$element.val()},empty:function(){var e=this;if(!(this.listeners.indexOf("empty")>-1)||this.emit({type:"empty",target:this.dom}))return this.$element.val(""),this.$element.datetimepicker("update"),this.$element.change(),e.$element.trigger({type:"changeValue"}),this},destroy:function(){var e=this.$element;if(e.datetimepicker("remove"),e.removeAttr("ui-type"),e.removeData(N),this.$container.replaceWith(this.initDom),!(this.listeners.indexOf("destroy")>-1)||this.emit({type:"destroy",target:this.dom}))return this},on:function(e,t){return E.indexOf(e)>-1?("undefined"==typeof this.handlers[e]&&(this.handlers[e]=[],this.listeners.push(e)),this.handlers[e].push(t)):_.indexOf(e)>-1&&this._date.on(e,t),this},off:function(e,t){var r,n,o,a,s;if(E.indexOf(e)>-1){if(this.handlers[e]instanceof Array){for(a=this.handlers[e],o=this.listeners,r=0,s=o.length;r<s&&o[r]!==e;r++);if(t===i)this.listeners.splice(r,1),delete this.handlers[e];else{for(n=0,s=a.length;n<s&&a[n]!==t;n++);n<s&&(this.handlers[e].splice(n,1),0==this.handlers[e].length&&this.listeners.splice(r,1))}}}else _.indexOf(e)>-1&&this._date.off(e,t);return this},emit:function(e){if(e.target||(this.$Maxcontainer?e.target=this.$Maxcontainer:e.target=this),this.handlers[e.type]instanceof Array)for(var t=this.handlers[e.type],i=0,r=t.length;i<r;i++)return t[i](e),!0;return!1},component:function(){return this}},t.fn[S]=function(e,i,n){return this.each(function(){t.data(document.getElementById(r),N)||t.data(document.getElementById(r),N,new o(this,e))})},w(n),{init:w,on:s,off:l,get:d,set:u,hide:h,show:c,enabled:p,disabled:f,readwrite:g,readonly:m,option:v,empty:b,component:x,destroy:y}},e}(wui||{},libs),function(e,t,i){return e.selectBox=function(r,n){function o(e,i){var n=this.initComponentAttributes(r,i);t.extend(!0,this,n),this.renderComponent()}function a(i,n){var o=t.data(document.getElementById(r),E);if(!o)return void e.logError("wui.selectBox 未初始化或已被销毁",FRAME_NAME+"."+_,!0);var a=Array.prototype.slice.call(arguments,1);return"function"==typeof o[i]?o[i].apply(o,a):void e.logWarn("组件中不存在 "+i+"() 方法",FRAME_NAME+"."+_,!0)}function s(e,i){t.data(document.getElementById(r),E);return a("on",e,i),this}function l(e,i){t.data(document.getElementById(r),E);return a("off",e,i),this}function d(e,t){return a("set",e,t)}function u(e){return a("get",e)}function h(e){return a("select",e)}function c(e){return a("unselect",e)}function f(){return a("selectAll")}function p(){return a("unselectAll")}function m(){return a("disabled")}function g(){return a("enabled")}function v(e){return a("reload",e)}function b(){return a("refresh")}function y(e){return a("option",e)}function x(e){return a("empty",e)}function w(){return a("destroy")}function S(){return a("component")}function N(i){return t.data(document.getElementById(r),E)?i&&e.isJson(i)?a("option",i):void 0:void t("#"+r)[C](i)}var C="uiSelectBox",E="plugin_"+C,_="selectBox";return e.logMethodCalled({className:FRAME_NAME,methodName:_,isDebug:!0,id:r}),!!e.checkIsLoadPlugins(_)&&(t("#"+r).exist()?(o.prototype={constructor:o,initComponentAttributes:function(i,r){var n={loadUrl:"",method:"get",otherParam:"",async:!1,loadData:null,source:e.EMPTYFUNC,value:"",text:"name",name:"id",direction:"auto",isShowCloseBtn:!1,multipleSeparator:",",isEnabledLiveSearch:!0,isShowActionsBox:!0,maxNumber:!1,maxHeight:0,offset:{top:0,bottom:20,left:0,right:0},width:"",menuWidth:"",defaultText:{noneSelectedText:t("#"+i).attr("placeholder")?t("#"+i).attr("placeholder"):"没有选中任何项",noneResultsText:"匹配不到'{0}'",deselectAllText:"全不选",selectAllText:"全选",doneButtonText:"关闭",liveSearchPlaceholder:"查找选项",noneOptionText:"没有可选的选项",queryErrorText:'<span class="wui-text-danger">Sorry,尽力了,但数据还是加载失败..</span>'},jsonReader:{root:null,isSuccess:"isSuccess",message:"message",children:"children",disabled:"disabled",selected:"selected",hidden:"hidden"},isSelectGroup:!1,classList:{selected:"selected",hidden:"hide",disabled:"disabled",active:"active",checked:"fa fa-check",group:"fa fa-group  wui-fa-middle",option:""},lazy:!1,lazySetting:{number:20},onLoadComplete:e.CONSTANTS.EMPTYFUNC},o=e.getAttributeParams(t("#"+i),n),a=t.extend(!0,{},n,r,o),s={pluginName:_,id:i,name:"",element:document.getElementById(i),$element:t("#"+i),defaults:n,initDom:t("#"+i).prop("outerHTML"),dom:"",status:"init",isFilter:!1,enable:!0,expanded:!1,pickerNodes:[],activeNodes:[],handlers:{},data:null,itemsArray:[],itemsName:[],itemsText:[],opt:a,searchBoxTmp:'<div class="ws-searchbox"><input type="text" class="wui-input" wui-widget-hidden="true" autocomplete="off" placeholder="'+a.defaultText.liveSearchPlaceholder+'"></div>',actionsBoxTmp:'<div class="ws-actionsbox"><div class="btn-group btn-group-sm btn-block"><button type="button" class="actions-btn ws-select-all btn btn-default">'+a.defaultText.selectAllText+'</button><button type="button" class="actions-btn ws-deselect-all btn btn-default">'+a.defaultText.deselectAllText+"</button></div></div>",closeButtonTmp:'<div class="ws-donebutton"><div class="btn-group btn-block"><button type="button" class="btn btn-sm btn-default">'+a.defaultText.doneButtonText+"</button></div></div>",tipTmp:'<li class="no-result-text"><a>{0}</a></li>',$container:null,$viewBox:null,$buttonBox:null,$resultBox:null,$dropdownBox:null,$selectContentBox:null,ext:{}};return s},renderComponent:function(){var e=this,i=this.opt;if(this.status="loading",this.$element.attr("name")||this.$element.attr("name",e.id),this.name=this.$element.attr("name"),!this.$element.parent().hasClass("wui-selectBox")){var r='<div class="wui-selectBox"></div>';this.$element.wrap(r)}this.$container=this.$element.parent(),this.$viewBox=t('<div wui-combobox="dropdown" class="btn-group wui-select-box show-tick input-layout" style="width: 100%;"></div>'),this.$buttonBox=t('<button type="button" class="wui-btn dropdown-toggle btn-default" data-toggle="dropdown" aria-expanded="true"></button>').appendTo(this.$viewBox),this.$resultBox=t('<span class="filter-option pull-left">'+i.defaultText.noneSelectedText+"</span>").appendTo(this.$buttonBox),this.$caret=t('<span class="ws-caret"> <span class="caret"></span> <span class="sr-only">Toggle Dropdown</span> </span>').appendTo(this.$buttonBox),this.$dropdownBox=t('<div class="dropdown-menu open"></div>').appendTo(this.$viewBox),this.$selectContentBox=t('<ul wui-data="menu" class="dropdown-menu focus inner" role="menu" style="overflow-y: auto;"></ul>'),this.$element.after(this.$viewBox),this.$element.hide(),i.width&&this.$container.width(i.width),this.opt.isEnabledLiveSearch&&this.renderSearchBox(),this.opt.isShowActionsBox&&this.renderSelectButton(),this.renderDropdownBox(),this.load(),this.$element.attr("ui-type",this.pluginName),this.dom=this.$container.prop("outerHTML"),this.width(),this.$viewBox.on({"hide.bs.dropdown":function(e){},"hidden.bs.dropdown":function(e){},"show.bs.dropdown":function(t){e.direction(),e.trigger("show",t)},"shown.bs.dropdown":function(t){e.height(),e.trigger("shown",t)}}),this.trigger("init",{type:"init"})},addComponentNodes:function(e,t){this.activeNodes.push(e),t&&(this.trigger("itemSelected",{srcElement:e.node.get(0),item:e.data,node:e}),this.trigger("change",{srcElement:e.node.get(0),item:e.data,node:e,selected:e.selected}))},removeComponentNodes:function(e,t){var i=this.activeNodes.indexOf(e);i>-1&&this.activeNodes.splice(i,1),t&&(this.trigger("itemUnselected",{srcElement:e.node.get(0),item:e.data,node:e}),this.trigger("change",{srcElement:e.node.get(0),item:e.data,node:e,selected:e.selected}))},getComponentNodes:function(){return this.activeNodes},popNodes:function(){return this.activeNodes.pop()},addPickerItem:function(e){this.$selectContentBox.append(e)},isMaxNumber:function(e){var t={"-1":"最多可选择"+this.opt.maxNumber+"个标签"};if(0!=this.opt.maxNumber&&this.opt.maxNumber>1&&this.activeNodes.length>=this.opt.maxNumber)return this.trigger("itemSelectError",{type:"itemSelectError",item:e,code:-1,message:t[-1]}),!0},direction:function(){if("auto"==this.opt.direction){var t=e.getViewSize(),i=this.$container.offset();t.height/2>i.top?this.$viewBox.removeClass("dropup").addClass("dropdown"):this.$viewBox.addClass("dropup").removeClass("dropdown")}else"dropup"==this.opt.direction?this.$viewBox.addClass("dropup"):this.$viewBox.addClass("dropdown")},scroll:function(){e.scroll(this.$selectContentBox)},width:function(){this.opt.width&&this.$container.width(this.opt.width),this.opt.menuWidth&&this.$selectContentBox.width(this.opt.menuWidth)},height:function(){var i=e.getViewSize(),r=null,n=0;if(this.$viewBox.hasClass("dropup")){r=this.$buttonBox.offset(),this.$dropdownBox.children().filter(".ws-searchbox, .ws-actionsbox, .ws-donebutton").each(function(e,i){n+=t(i).outerHeight(!0)});var o=this.opt.maxHeight?this.opt.maxHeight:r.top-n-this.opt.offset.top-this.opt.offset.bottom;this.$selectContentBox.height()>o&&this.$selectContentBox.css({"max-height":o+"px"})}else{r=this.$selectContentBox.offset(),this.$dropdownBox.children().filter(".ws-donebutton").each(function(e,i){n+=t(i).outerHeight(!0)});var o=this.opt.maxHeight?this.opt.maxHeight:i.height-r.top-n-this.opt.offset.top-this.opt.offset.bottom;this.$selectContentBox.height()>o&&this.$selectContentBox.css({"max-height":o+"px"})}this.scroll()},renderSearchBox:function(){var i=this,r=t(this.searchBoxTmp).appendTo(this.$dropdownBox);r.children("input").on("input propertychange",function(e){var r=t(this).val();i.filter(r)}),r.children("input").keypress(function(t){var i=window.event?t.keyCode:t.which;i!=e.CONSTANTS.KEYS.ENTER&&i!=e.CONSTANTS.KEYS.OTHER||(e.stopPropagation(t),e.preventDefault(t))}).keyup(function(r){var n=window.event?r.keyCode:r.which;n==e.CONSTANTS.KEYS.ENTER||n==e.CONSTANTS.KEYS.OTHER?t.each(i.pickerNodes,function(e,t){if(!t.isHidden()&&t.isEnable())return t.focus(),t.click(),!1}):n==e.CONSTANTS.KEYS.DOWN&&t.each(i.pickerNodes,function(e,t){if(!t.isHidden()&&t.isEnable())return t.focus(),!1})})},removeSearchBox:function(){this.$dropdownBox.children(".ws-searchbox").length>0&&this.$dropdownBox.children(".ws-searchbox").remove()},renderSelectButton:function(){if(this.opt.maxNumber!==!1)return this.opt.isShowActionsBox=!1,void e.logMessage("限制节点个数时无法使用开启全选功能","wui.selectBox",!0);var i=this,r=t(this.actionsBoxTmp).appendTo(this.$dropdownBox);r.find(".ws-select-all").each(function(){t(this).off("click").on("click",function(e){e.stopPropagation(),i.selectAll()})}),r.find(".ws-deselect-all").each(function(){
t(this).off("click").on("click",function(e){e.stopPropagation(),i.unselectAll()})})},removeSelectButton:function(){this.$dropdownBox.children(".ws-actionsbox").length>0&&this.$dropdownBox.children(".ws-actionsbox").remove()},renderCloseButton:function(){var e=this,i=t(this.closeButtonTmp).appendTo(this.$dropdownBox);i.find("button").on("click",function(t){e.closePicker()})},openPicker:function(){this.$viewBox.addClass("open")},closePicker:function(){this.$viewBox.removeClass("open")},removeCloseButton:function(){this.$dropdownBox.children(".ws-donebutton").length>0&&this.$dropdownBox.children(".ws-donebutton").remove()},renderDropdownBox:function(){0==this.$dropdownBox.children('[wui-data="menu"]').length?this.$dropdownBox.append(this.$selectContentBox):this.$selectContentBox=this.$dropdownBox.children('[wui-data="menu"]'),this.$selectContentBox.empty(),this.opt.isShowCloseBtn&&this.renderCloseButton()},createNode:function(e,t){var i={text:this.opt.text,name:this.opt.name,jsonReader:{children:this.opt.jsonReader.children,disabled:this.opt.jsonReader.disabled,selected:this.opt.jsonReader.selected,hidden:this.opt.jsonReader.hidden},classList:{selected:this.opt.classList.selected,hidden:this.opt.classList.hidden,disabled:this.opt.classList.disabled,active:this.opt.classList.active,checked:this.opt.classList.checked,group:this.opt.classList.group,option:this.opt.classList.option},isSelectGroup:this.opt.isSelectGroup,maxNumber:this.opt.maxNumber};return new SelectNode(e,i,this,t)},filter:function(e){var i=[];if(this.removeNoneOptionTip(),e?this.isFilter=!0:this.isFilter=!1,t.each(this.pickerNodes,function(t,r){r.title.indexOf(e)>-1?(r.setNodeHidden(!1,!0),i.push(r),!r.isGroup()&&r.parent&&(r.parent.setNodeHidden(!1),i.push(r.parent),r.isSelected()||r.parent.setNodeSelected(!1,!1,!1))):r.setNodeHidden(!0,!0)}),0==i.length){var r=this.opt.defaultText.noneResultsText.replace("{0}",e);this.renderNoneOptionTip(r,"append")}},renderNodes:function(e){var i=this,r=[];this.data=e,t.each(e,function(e,n){var o=i.createNode(n,null);i.pickerNodes.push(o),o.isHidden()||r.push(o),n[i.opt.jsonReader.children]&&t.each(n[i.opt.jsonReader.children],function(e,t){var n=i.createNode(t,o);o.childrens.push(n),i.pickerNodes.push(n),n.isHidden()||r.push(n)})}),this.getShowNodes().length>0&&this.removeNoneOptionTip(),this.trigger("loadComplete",e)},renderResult:function(){var i=[];t.each(this.activeNodes,function(e,t){i.push(t.title)});var r=this.opt.defaultText.noneSelectedText;i.length>0&&(r=i.join(this.opt.multipleSeparator)),this.$resultBox.text(r),this.$resultBox.attr("title",r);var n=this.get("value");e.isArray(n)?this.$element.val(n.join(",")):this.$element.val(n);var o=this.$element.get(0);o.form&&t.data(o.form,"validator")&&!e.isEmptyType(this.$element.rules())&&e.validElement(this.$element)},disabled:function(){this.$buttonBox.attr("disabled","disabled"),this.enable=!1},enabled:function(){this.$buttonBox.removeAttr("disabled"),this.enable=!0},renderNoneOptionTip:function(e,t){e=e||this.opt.defaultText.noneOptionText,t=t||"html";var i=this.tipTmp.replace("{0}",e);this.$selectContentBox[t](i)},removeNoneOptionTip:function(){this.$selectContentBox.children(".no-result-text")&&this.$selectContentBox.children(".no-result-text").remove()},querySuccess:function(i,r,n){var o,a,s=this,l=this.opt,d=this.trigger("success",i,r,n),u={"-1":"数据请求失败",0:l.jsonReader.isSuccess+"字段返回false",1:"服务器返回数据不包含参数"+l.jsonReader.root};if(d!==!1){if(l.jsonReader.root)if(e.isUndefined(i[l.jsonReader.root]))this.status="error",o="1";else{var h=i[l.jsonReader.root];l.jsonReader.isSuccess&&!e.isUndefined(i[l.jsonReader.isSuccess])?i[l.jsonReader.isSuccess]?(a=t.extend(!0,[],h,s.getItemsFromSelect()),this.status="loaded"):(this.status="error",o="0"):(a=t.extend(!0,[],h,s.getItemsFromSelect()),this.status="loaded")}else a=t.extend(!0,[],i,s.getItemsFromSelect()),this.status="loaded";"error"==this.status?(this.removeSelectButton(),this.removeSearchBox(),this.renderNoneOptionTip(this.opt.defaultText.queryErrorText),this.trigger("loadError",o,u[o],i,r,n)):"loaded"==this.status&&(this.trigger("loadSuccess",i,r,n),s.renderNodes(a))}},queryError:function(e,t,i){this.status="error";var r={"-1":"数据请求失败",0:this.opt.jsonReader.isSuccess+"字段返回false",1:"服务器返回数据不包含参数"+this.opt.jsonReader.root};this.removeSelectButton(),this.removeSearchBox(),this.renderNoneOptionTip(this.opt.defaultText.queryErrorText),this.trigger("loadError","-1",r[-1],e,t,i)},getItemFromOption:function(e){var i=this,r=this.opt.name,n=this.opt.text,o=this.opt.jsonReader.children,a=this.opt.jsonReader.selected,s=this.opt.jsonReader.disabled,l=this.opt.jsonReader.hidden,d={};if("option"==e.tagName.toLowerCase()){var u=t(e).text(),h=t(e).val();d[r]=h,d[n]=u,e.hasAttribute("disabled")&&(d[s]=!0),e.hasAttribute("selected")&&(d[a]=!0),e.hasAttribute("hidden")&&(d[l]=!0)}else if("optgroup"==e.tagName.toLowerCase()){var u=t(e).attr("label"),h=t(e).attr("value");d[r]=h,d[n]=u,e.hasAttribute("disabled")&&(d[s]=!0),e.hasAttribute("selected")&&(d[a]=!0),e.hasAttribute("hidden")&&(d[l]=!0),d[o]=[],t(e).children().each(function(e,t){var r=i.getItemFromOption(t);r.length>0&&d[o].push(r)})}return d},getItemsFromSelect:function(){var e=this,t=[];return this.$element.is("select")&&this.$element.children().each(function(i,r){var n=e.getItemFromOption(r);t.push(n)}),t},getEnableSelectNodes:function(i){var r=[];return t.each(this.pickerNodes,function(t,n){n.isEnable()&&!n.isHidden()&&(e.isUndefined(i)?r.push(n):n.isSelected()===i&&r.push(n))}),r},getShowNodes:function(i){var r=[];return t.each(this.pickerNodes,function(t,n){n.isHidden()||(e.isUndefined(i)?r.push(n):n.isSelected()===i&&r.push(n))}),r},getEnableNodes:function(i){var r=[];return t.each(this.pickerNodes,function(t,n){n.isEnable()&&(e.isUndefined(i)?r.push(n):n.isSelected()===i&&r.push(n))}),r},load:function(){var i=this,r=this.opt;if(this.opt.source)"function"==typeof this.opt.source&&this.opt.source.apply(this);else if(this.opt.loadData&&(e.isArray(this.opt.loadData)?(t.extend(!0,i.opt.loadData,i.getItemsFromSelect()),i.renderNodes(i.opt.loadData)):e.logWarn("传入的下拉数据格式不是数组",FRAME_NAME+".selectBox().load",!0)),""!=r.loadUrl){var n={url:this.opt.loadUrl,data:this.opt.otherParam,method:this.opt.method,onSuccess:function(e,t,r){i.querySuccess(e,t,r)},onError:function(e,t,r){i.queryError(e,t,r)},async:this.opt.async,dataType:"json"};e.ajax(n)}},reload:function(e){this.pickerNodes=[],this.activeNodes=[],this.$selectContentBox.empty(),this.renderResult(),e?this.renderNodes(e):this.load()},select:function(i){var r=this,n=this.opt.name,o={"-1":"最多可选择"+this.opt.maxNumber+"个标签",2:"选项中不存在 "+n+" 字段值为{0}的数据",3:"节点已经被选中",4:"{0} 中不存在"+n+"属性",6:"添加的节点不能为空类型"};if(e.isEmptyType(i))return this.trigger("itemSelectError",{type:"itemSelectError",item:i,code:6,message:o[6]}),!1;if(e.isArray(i))return t.each(i,function(a,s){var l=s;if(0!=r.opt.maxNumber&&r.opt.maxNumber>1&&r.activeNodes.length>=r.opt.maxNumber)return r.trigger("itemSelectError",{type:"itemSelectError",item:s,code:-1,message:o[-1]}),!1;if(e.isJson(s)&&(l=s[n]),e.isEmptyType(l))return r.trigger("itemSelectError",{type:"itemSelectError",item:s,code:4,message:o[4].replace("{0}",JSON.stringify(s))}),!0;var d=!1;t.each(r.pickerNodes,function(e,t){if(t.key==l)return t.isSelected()?r.trigger("itemSelectError",{type:"itemSelectError",item:i,code:3,message:o[3]}):t.setSelected(!0),d=!0,!1}),d||r.trigger("itemSelectError",{type:"itemSelectError",item:s,code:2,message:o[2].replace("{0}",l)})}),!0;if(e.isJson(i)){var a=i[n];if(0!=r.opt.maxNumber&&r.opt.maxNumber>1&&r.activeNodes.length>=r.opt.maxNumber)return r.trigger("itemSelectError",{type:"itemSelectError",item:i,code:-1,message:o[-1]}),!1;e.isEmptyType(a)&&r.trigger("itemSelectError",{type:"itemSelectError",item:i,code:4,message:o[4].replace("{0}",JSON.stringify(i))});var s=!1;return t.each(r.pickerNodes,function(e,t){if(t.key==a)return t.isSelected()?r.trigger("itemSelectError",{type:"itemSelectError",item:i,code:3,message:o[3]}):t.setSelected(!0),s=!0,!1}),!!s||(r.trigger("itemSelectError",{type:"itemSelectError",item:i,code:2,message:o[2].replace("{0}",a)}),!1)}if(e.isString(i))return t.each(i.split(","),function(e,n){if(0!=r.opt.maxNumber&&r.opt.maxNumber>1&&r.activeNodes.length>=r.opt.maxNumber)return r.trigger("itemSelectError",{type:"itemSelectError",item:i,code:-1,message:o[-1]}),!1;var a=!1;t.each(r.pickerNodes,function(e,t){if(t.key==n)return t.isSelected()?r.trigger("itemSelectError",{type:"itemSelectError",item:i,code:3,message:o[3]}):t.setSelected(!0),a=!0,!1}),a||r.trigger("itemSelectError",{type:"itemSelectError",item:i,code:2,message:o[2].replace("{0}",n)})}),!0;if(e.isNumber(i)){var a=i;if(0!=r.opt.maxNumber&&r.opt.maxNumber>1&&r.activeNodes.length>=r.opt.maxNumber)return r.trigger("itemSelectError",{type:"itemSelectError",item:i,code:-1,message:o[-1]}),!1;var s=!1;return t.each(r.pickerNodes,function(e,t){if(t.key==a)return t.isSelected()?r.trigger("itemSelectError",{type:"itemSelectError",item:i,code:3,message:o[3]}):t.setSelected(!0),s=!0,!1}),!!s||(r.trigger("itemSelectError",{type:"itemSelectError",item:i,code:2,message:o[2].replace("{0}",a)}),!1)}return!1},unselect:function(i){var r=this,n=this.opt.name,o={0:"移除的数据不能为空",1:"取消数据类型不是string或JSON",2:"选项中不存在 "+n+" 字段值为{0}的数据",3:"节点未被选中",4:"{0} 中不存在"+n+"属性",6:"去选选择的数据不能为空类型"};if(e.isEmptyType(i))return this.trigger("itemUnselectError",{type:"itemUnselectError",item:i,code:6,message:o[6]}),!1;if(e.isArray(i))return t.each(i,function(a,s){var l=s;if(e.isJson(s)&&(l=s[n]),e.isEmptyType(l))return r.trigger("itemUnselectError",{type:"itemUnselectError",item:s,code:4,message:o[4].replace("{0}",JSON.stringify(s))}),!0;var d=!1;t.each(r.pickerNodes,function(e,t){if(t.key==l)return t.isSelected()?t.setSelected(!1):r.trigger("itemUnselectError",{type:"itemUnselectError",item:i,code:3,message:o[3]}),d=!0,!1}),d||r.trigger("itemUnselectError",{type:"itemUnselectError",item:s,code:2,message:o[2].replace("{0}",l)})}),!0;if(e.isJson(i)){var a=i[n];e.isEmptyType(a)&&r.trigger("itemUnselectError",{type:"itemUnselectError",item:i,code:4,message:o[4].replace("{0}",JSON.stringify(i))});var s=!1;return t.each(r.pickerNodes,function(e,t){if(t.key==a)return t.isSelected()?t.setSelected(!1):r.trigger("itemUnselectError",{type:"itemUnselectError",item:i,code:3,message:o[3]}),s=!0,!1}),!!s||(r.trigger("itemUnselectError",{type:"itemUnselectError",item:i,code:2,message:o[2].replace("{0}",a)}),!1)}if(e.isString(i))return t.each(i.split(","),function(e,n){var a=!1;t.each(r.pickerNodes,function(e,t){if(t.key==n)return t.isSelected()?t.setSelected(!1):r.trigger("itemUnselectError",{type:"itemUnselectError",item:i,code:3,message:o[3]}),a=!0,!1}),a||r.trigger("itemUnselectError",{type:"itemUnselectError",item:i,code:2,message:o[2].replace("{0}",n)})}),!0;if(e.isNumber(i)){var a=i,s=!1;return t.each(r.pickerNodes,function(e,t){if(t.key==a)return t.isSelected()?t.setSelected(!1):r.trigger("itemUnselectError",{type:"itemUnselectError",item:i,code:3,message:o[3]}),s=!0,!1}),!!s||(r.trigger("itemUnselectError",{type:"itemUnselectError",item:i,code:2,message:o[2].replace("{0}",a)}),!1)}return!1},selectAll:function(e){t.each(this.pickerNodes,function(t,i){i.isEnable()&&!i.isHidden()&&i.setNodeSelected(!0,!1,e)}),this.renderResult(),this.trigger("selectAll")},unselectAll:function(e){t.each(this.pickerNodes,function(t,i){i.isEnable()&&!i.isHidden()&&i.setNodeSelected(!1,!1,e)}),this.renderResult(),this.trigger("unselectAll")},set:function(e){for(;this.activeNodes.length>0;){var t=this.activeNodes.pop();t.setNodeSelected(!1,!1,!1)}this.select(e)},option:function(t){if(e.isUndefined(t))return this.opt;if("object"==typeof t)this.reoption(t);else if("string"==typeof t)return"getDefOpt"===t?this.defaults:this.opt[t]},reoption:function(r){var n=this.opt,o=!1;if(r.direction!=i&&n.direction!=r.direction&&(this.opt.direction=r.direction,this.direction()),r.text!=i&&n.text!=r.text&&(o=!0,this.opt.text=r.text),r.name!=i&&n.name!=r.name&&(o=!0,this.opt.name=r.name),r.loadUrl!=i&&n.loadUrl!=r.loadUrl&&(this.opt.loadUrl=r.loadUrl,o=!0),r.otherParam!==i&&n.otherParam!==r.otherParam&&(this.opt.otherParam=r.otherParam,o=!0),r.jsonReader!=i&&n.jsonReader!=r.jsonReader&&e.isJson(r.jsonReader)&&(t.extend(!0,this.opt.jsonReader,r.jsonReader),o=!0),r.loadData&&n.loadData!=r.loadData&&(this.opt.loadData=r.loadData,o=!0),o&&this.reload(),r.maxNumber!=i&&n.maxNumber!=parseInt(r.maxNumber)){var a=e.formatMaxNumber(r.maxNumber);if(this.opt.maxNumber=a,a!==!1){for(;this.activeNodes.length>a;){var s=this.component.activeNodes.pop();s.setNodeSelected(!1,i,!1)}this.renderResult(),r.isShowActionsBox=!1}}r.multipleSeparator&&n.multipleSeparator!=r.multipleSeparator&&(this.opt.multipleSeparator=r.multipleSeparator,this.renderResult()),r.isShowActionsBox!=i&&n.isShowActionsBox!=r.isShowActionsBox&&(n.maxNumber!==!1&&(r.isShowActionsBox=!1,e.logMessage("限制节点个数时无法使用开启全选功能","wui.selectBox",!0)),this.opt.isShowActionsBox=r.isShowActionsBox,r.isShowActionsBox?this.renderSelectButton():this.removeSelectButton()),r.isEnabledLiveSearch!=i&&n.isEnabledLiveSearch!=r.isEnabledLiveSearch&&(this.opt.isEnabledLiveSearch=r.isEnabledLiveSearch,r.isEnabledLiveSearch?this.renderSearchBox():this.removeSearchBox()),r.isShowCloseBtn!=i&&n.isShowCloseBtn!=r.isShowCloseBtn&&(this.opt.isShowCloseBtn=r.isShowCloseBtn,r.isShowCloseBtn?this.renderCloseButton():this.removeCloseButton())},empty:function(e){var t=this;for(e=e||!1;this.activeNodes.length>0;){var i=this.activeNodes.pop();i.setNodeSelected(!1,!1,e)}this.renderResult(),this.trigger("empty",{type:"empty",component:t})},refresh:function(){},destroy:function(){this.$element.removeData(E),this.$element.removeAttr("ui-type"),this.$container.replaceWith(this.initDom),this.status="destroy"},get:function(e){var i=this.opt.name,r=this.opt.text,n=[];return e=e||"json",t.each(this.activeNodes,function(o,a){var s;if("json"==e){var l={};l[i]=a.key,l[r]=a.title,s=t.extend(!0,{},a.data,l)}else s="text"==e?a.title:"value"==e?a.key:a;n.push(s)}),1==this.opt.maxNumber?n[0]:n},trigger:function(i,r){var n,o,a=Array.prototype.slice.call(arguments,1),s=i.substring(0,1).toUpperCase()+i.substring(1);if(this.opt[i]&&"function"==typeof this.opt[i]&&(n=this.opt[i].apply(this,a),!e.isUndefined(n)))return n;if(this.opt["on"+s]&&"function"==typeof this.opt["on"+s]&&(o=this.opt["on"+s].apply(this,a),!e.isUndefined(o)))return o;if(this.handlers[i]instanceof Array){var l={type:i,target:this,srcElement:this.element};t.extend(!0,l,r);for(var d=this.handlers[i],u=0,h=d.length;u<h;u++){var c=d[u](l);if(!e.isUndefined(c))return c}}},component:function(){return this},on:function(e,t){return"undefined"==typeof this.handlers[e]&&(this.handlers[e]=[]),this.handlers[e].push(t),this},off:function(e,t){if(e&&this.handlers[e]instanceof Array){var i=this.handlers[e];if(t&&i.indexOf(t)>-1){var r=i.indexOf(t);this.handlers[e].splice(r,1)}}return this}},t.fn[C]=function(e,i,n){return this.each(function(){t.data(document.getElementById(r),E)||t.data(document.getElementById(r),E,new o(this,e))})},N(n),{init:N,on:s,off:l,set:d,get:u,select:h,unselect:c,selectAll:f,unselectAll:p,enabled:g,disabled:m,option:y,reload:v,refresh:b,empty:x,component:S,destroy:w}):(e.logError("【"+_+"】当前页面不存在 ID 为"+r+" 的DOM节点",FRAME_NAME+"."+_,!0),!1))},e}(wui||{},libs),function(e,t,i){return e.tagsinput=function(r,n){function o(i,n){var o=e.load(),a=this.initComponentAttributes(r,n);t.extend(!0,this,a),this.formatParams(),this.renderComponent(),e.closeIndex(o)}function a(i,n){var o=t.data(document.getElementById(r),C);if(!o)return void e.logError("组件未初始化或已被销毁",FRAME_NAME+"."+E,!0);var a=Array.prototype.slice.call(arguments,1);return"function"==typeof o[i]?o[i].apply(o,a):void e.logWarn("组件中不存在 "+i+"() 方法",FRAME_NAME+"."+E,!0)}function s(e,i){var n=t.data(document.getElementById(r),C);return a("on",e,i),n}function l(e,i){var n=t.data(document.getElementById(r),C);return a("off",e,i),n}function d(){return a("getMaxNumber")}function u(e){return a("get",e)}function h(e,t,i){return a("set",e,t,i)}function c(e,t,i){return a("add",e,t,i)}function f(e,t){return a("remove",e,t)}function p(e){return a("option",e)}function m(e){return a("disabled",e)}function g(){return a("enabled")}function v(){return a("readonly")}function b(){return a("readwrite")}function y(e){return a("empty",e)}function x(){return a("destroy")}function w(){return a("component")}function S(i){return t.data(document.getElementById(r),C)?i&&e.isJson(i)?a("option",i):void 0:void t("#"+r)[N](i)}var N="uiTagsinput",C="plugin_"+N,E="tagsinput";return e.logMethodCalled({className:FRAME_NAME,methodName:E,isDebug:!0,id:r}),!!e.checkIsLoadPlugins(E)&&(t("#"+r).exist()?(o.prototype={constructor:o,initComponentAttributes:function(i,r){var n={value:[],isFreeInput:!0,width:"",initHeight:"",maxHeight:"",name:"id",text:"name",maxNumber:!1,isAddRemoveLink:!0,isAllowDuplicates:!1,tagClass:"label wui-bg-primary",maxChars:0,ellipsis:"...",isShowAnimate:!0,placeholderText:"",noneItemText:e.language.tagsinput.noneItem,onInput:e.CONSTANTS.EMPTYFUNC,onEnter:!0},o=e.getAttributeParams(t("#"+i),n),a=t.extend(!0,{},n,r,o),s={pluginName:E,id:i,name:"",element:document.getElementById(i),$element:t("#"+i),defaults:n,initDom:t("#"+i).prop("outerHTML"),dom:"",status:"init",enable:!0,isClosable:a.isAddRemoveLink,nodes:[],handlers:{},itemsName:[],opt:a,viewBoxTmp:'<div class="tag-container wui-input" wui-attr="view"></div>',inputBoxTmp:'<input type="text" wui-widget-hidden="true" wui-attr="input"/>',tipTmp:'<span class="placeholder">{0}</span>',$container:null,$viewBox:null,$input:null,ext:{}};return s},resize:function(){this.width(this.opt.width),this.height(this.opt.initHeight,this.opt.maxHeight)},width:function(e){e&&this.$container.width(e)},height:function(t,i){t&&this.$viewBox.css({height:t}),i&&this.$viewBox.css({maxHeight:i}),e.scroll(this.$viewBox)},formatParams:function(){this.opt.maxNumber=e.formatMaxNumber(this.opt.maxNumber),this.opt.maxChars=e.formatMaxChars(this.opt.maxChars)},renderComponent:function(){var i=this;this.opt;if(this.status="loading",this.$element.attr("name")||this.$element.attr("name",i.id),this.name=this.$element.attr("name"),!this.$element.parent().hasClass("wui-tagsinput")){var r='<div class="wui-tagsinput"></div>';this.$element.wrap(r)}this.$container=this.$element.parent(),this.$container.attr("wui-attr","container"),this.$viewBox=t(this.viewBoxTmp),this.$element.after(this.$viewBox),this.$element.hide(),this.renderInputBox(),this.resize(),e.isEmptyType(this.opt.value)||this.addNodes(this.opt.value),this.$element.attr("ui-type",this.pluginName),this.dom=this.$container.prop("outerHTML"),this.trigger("init",{type:"init"})},updatedNodes:function(){this.$element.val(this.itemsName.join(","));var i=this.$element.get(0);i.form&&t.data(i.form,"validator")&&!e.isEmptyType(this.$element.rules())&&e.validElement(this.$element)},createNode:function(t,i){return new TagNode(t,this.opt,this,i,e)},addNode:function(t,i,r){var n=this,o=this.opt.name,a={"-1":"最多可选择"+this.opt.maxNumber+"个标签",0:"添加的数据不能为空",1:"name属性值没设置,无法添加object类型数据",2:"标签数据"+o+"属性值重复",3:"{0} 中不存在"+o+"属性",5:"只能添加类型为object、string的数据"},s=t;if(e.isUndefined(i)&&(i=!0),"number"==typeof n.opt.maxNumber&&n.opt.maxNumber>0&&n.nodes.length>=n.opt.maxNumber)return n.trigger("itemAddError",{type:"itemAddError",item:t,code:-1,message:a[-1]}),!1;if(e.isJson(t)&&(s=t[o]),e.isEmptyType(s))return n.trigger("itemAddError",{type:"itemAddError",item:t,code:3,message:a[3].replace("{0}",JSON.stringify(t))}),!0;if(!n.opt.isAllowDuplicates&&n.itemsName.indexOf(s)>-1)return n.opt.isShowAnimate&&this.$viewBox.children("span").eq(n.itemsName.indexOf(s)).hide().fadeIn(),n.trigger("itemAddError",{type:"itemAddError",item:t,code:2,message:a[2]}),!0;if(i){var l=n.trigger("beforeItemAdd",{type:"beforeItemAdd",item:t,items:n.get("json"),nodes:n.nodes});if(l===!1)return}var d=n.createNode(t,r);return n.nodes.push(d),n.updatedNodes(),i&&n.trigger("itemAdded",{type:"itemAdded",item:t,items:n.get("json"),nodes:n.nodes,node:d}),!0},addNodes:function(i,r,n){var o=this,a=this.opt.name,s={"-1":"最多可选择"+this.opt.maxNumber+"个标签",0:"添加的数据不能为空",1:"name属性值没设置,无法添加object类型数据",2:"标签数据"+a+"属性值重复",3:"{0} 中不存在"+a+"属性",5:"只能添加类型为object、string的数据"};return e.isEmptyType(i)?(this.trigger("itemAddError",{type:"itemAddError",item:i,code:0,message:s[0]}),!1):e.isArray(i)?(t.each(i,function(e,t){return o.addNode(t,r,n)}),!0):e.isJson(i)?o.addNode(i,r,n):e.isString(i)?(t.each(i.split(","),function(e,t){return o.addNode(t,r,n)}),!0):(this.trigger("itemAddError",{type:"itemAddError",item:i,code:5,message:s[5]}),!1)},removeNode:function(i,r){var n=this,o=this.opt.name,a={0:"移除的数据不能为空",1:o+"属性值没设置,无法移除object类型数据",2:"组件中不存在{0}节点",3:"{0} 中不存在"+o+"属性",5:"只能根据类型为object、string的数据来移除节点",6:"移除的节点不能为空"},s=i;if(e.isUndefined(r)&&(r=!0),e.isEmptyType(i))return n.trigger("itemRemoveError",{type:"itemRemoveError",item:i,code:0,message:a[0]}),!0;if(e.isJson(i)){if(e.isUndefined(i[this.opt.name]))return n.trigger("itemRemoveError",{type:"itemRemoveError",item:i,code:1,message:a[1]}),!0;s=i[o]}if(e.isEmptyType(s))return n.trigger("itemRemoveError",{type:"itemRemoveError",item:i,code:3,message:a[3].replace("{0}",JSON.stringify(i))}),!0;if("string"!=typeof s)return n.trigger("itemRemoveError",{type:"itemRemoveError",item:i,code:5,message:a[5]}),!0;if(!(n.itemsName.indexOf(s)>-1))return n.trigger("itemRemoveError",{type:"itemRemoveError",item:i,code:2,message:a[2].replace("{0}",JSON.stringify(i))}),!0;var l=null;if(this.opt.isAllowDuplicates)t.each(n.nodes,function(e,t){t.data==i&&(l=t)});else{var d=n.itemsName.indexOf(s);l=n.nodes[d]}if(l){if(r){var u=n.trigger("beforeItemRemove",{type:"beforeItemRemove",item:i,items:n.get("json"),nodes:n.nodes,node:l});if(u===!1)return}l.remove(),n.updatedNodes(),r&&n.trigger("itemRemoved",{type:"itemRemoved",item:i,items:this.get("json"),nodes:n.nodes,node:l})}return!0},removeNodes:function(i,r){var n=this,o=this.opt.name,a={0:"移除的数据不能为空",1:o+"属性值没设置,无法移除object类型数据",2:"传入数据{0}不存在",5:"只能根据类型为object、string的数据来移除节点",6:"移除的节点不能为空"};return e.isEmptyType(i)?(this.trigger("itemRemoveError",{type:"itemRemoveError",item:i,code:6,message:a[6]}),!1):e.isArray(i)?(t.each(i,function(e,t){return n.removeNode(t,r)}),!0):e.isJson(i)?n.removeNode(i,r):e.isString(i)?(t.each(i.split(","),function(e,t){return n.removeNode(t,r)}),!0):(this.trigger("itemRemoveError",{type:"itemRemoveError",item:i,code:5,message:a[5]}),!1)},renderInputBox:function(){var i=this,r=this.opt;this.opt.isFreeInput&&!this.$input?(this.$input=t(this.inputBoxTmp).appendTo(this.$viewBox),e.input(this.$input,40),this.$input.on("click",function(t){e.stopPropagation(t)}).keypress(function(t){var i=window.event?t.keyCode:t.which;i!=e.CONSTANTS.KEYS.ENTER&&i!=e.CONSTANTS.KEYS.OTHER||(e.stopPropagation(t),e.preventDefault(t))}).keyup(function(n){var o=t(this).val(),a=window.event?n.keyCode:n.which;if(a==e.CONSTANTS.KEYS.ENTER||a==e.CONSTANTS.KEYS.OTHER)r.onEnter===!0?(i.addNode(o),t(this).val("")):r.onEnter&&"function"==typeof r.onEnter&&r.onEnter(this,n,o);else if((a==e.CONSTANTS.KEYS.DELETE||a==e.CONSTANTS.KEYS.BACKSPACE||a==e.CONSTANTS.KEYS.CLEAR)&&""==o)for(var s=i.nodes.length-1;s>=0;s--){var l=i.nodes[s];if(l.isEnable()){l.isActive()?l.remove():l.setActive(!0);break}}}),this.$input.on("input propertychange",function(n){e.stopPropagation(n);var o=t(this).val(),a=!1;if(r.onInput&&"function"==typeof r.onInput&&(a=r.onInput(this,n)),a!==!1&&""!=o){var s=i.nodes.length>0?i.nodes[i.nodes.length-1]:null;s&&(s.isActive()||s.setActive(!1))}}),i.$viewBox.off("click").on("click",function(){i.$input.focus()})):!this.opt.isFreeInput&&this.$input&&(this.$input.remove(),this.$input=null)},setEnable:function(e,i){var r=this;this.enable=e,t.each(r.nodes,function(t,r){return!i&&r.item.isEnableRemove===!1||void r.setEnable(e)})},set:function(e,t,i){this.nodes.length>0&&this.empty(),this.addNodes(e,t,i)},get:function(e){if(e=e||"json","value"==e.toLowerCase())return this.itemsName;if("json"==e.toLowerCase()){var i=[];return t.each(this.nodes,function(e,t){i.push(t.item)}),i}if("text"==e.toLowerCase()){var r=[];return t.each(this.nodes,function(e,t){r.push(t.title)}),r}if("data"==e.toLowerCase()){var r=[];return t.each(this.nodes,function(e,t){i.push(t.data)}),r}return this.nodes},add:function(e,t,i){this.addNodes(e,t,i)},remove:function(e,t){this.removeNodes(e,t)},disabled:function(e){this.setEnable(!1,e),this.$input?this.$input.attr("disabled",!0):null,this.$viewBox.addClass("disabled")},enabled:function(e){this.setEnable(!0,e),this.$input?this.$input.removeAttr("disabled"):null,this.$viewBox.removeClass("disabled")},readonly:function(e){this.setEnable(!1,e),this.$input?this.$input.attr("readonly",!0):null,this.$viewBox.addClass("readonly")},readwrite:function(e){this.setEnable(!0,e),this.$input?this.$input.removeAttr("readonly"):null,this.$viewBox.removeClass("readonly")},_refresh:function(r){var n=this,o=!1,a=!1,s=!1;if(r.isAllowDuplicates!=i&&this.opt.isAllowDuplicates!=r.isAllowDuplicates&&(this.opt.isAllowDuplicates=r.isAllowDuplicates,r.isAllowDuplicates||(a=!0)),r.width!=i&&this.opt.width!=r.width&&(this.opt.width=r.width,this.width(this.opt.width)),r.initHeight!=i&&this.opt.initHeight!=r.initHeight&&(this.opt.initHeight=r.initHeight,o=!0),r.maxHeight!=i&&this.opt.maxHeight!=r.maxHeight&&(this.opt.maxHeight=r.maxHeight,o=!0),o&&this.height(this.opt.initHeight,this.opt.maxHeight),r.isAddRemoveLink!=i&&this.opt.isAddRemoveLink!=r.isAddRemoveLink&&(this.opt.isAddRemoveLink=r.isAddRemoveLink,this.setEnable(this.opt.isAddRemoveLink)),r.isShowAnimate!=i&&this.opt.isShowAnimate!=r.isShowAnimate&&(this.opt.isShowAnimate=r.isShowAnimate),r.text!=i&&this.opt.text!=r.text&&(a=!0,this.opt.text=r.text),r.name!=i&&this.opt.name!=r.name&&(a=!0,this.opt.name=r.name),a&&this.empty(),r.tagClass!=i&&this.opt.tagClass!=r.tagClass&&(""!=this.opt.tagClass&&t.each(n.nodes,function(e,t){t.node.removeClass(n.opt.tagClass).addClass(r.tagClass)}),this.opt.tagClass=r.tagClass),r.maxNumber!=i&&this.opt.maxNumber!==e.formatMaxNumber(r.maxNumber)){var l=e.formatMaxNumber(r.maxNumber);if(this.opt.maxNumber=l,l)for(;n.nodes.length>l;){var d=n.nodes[n.nodes.length-1];d.remove()}}if(r.ellipsis!=i&&this.opt.ellipsis!=r.ellipsis&&(this.opt.ellipsis=r.ellipsis,s=!0),r.maxChars!=i&&this.opt.maxChars!=e.formatMaxChars(r.maxChars)){var u=e.formatMaxChars(r.maxChars);this.opt.maxChars=u,s=!0}return!a&&s&&t.each(n.nodes,function(e,t){t.renderTitle()}),r.isFreeInput!=i&&this.opt.isFreeInput!=r.isFreeInput&&(this.opt.isFreeInput=r.isFreeInput,n.renderInputBox()),!0},option:function(e){var t=this;if(!e)return this.opt;if("object"==typeof e)this._refresh(e);else if("string"==typeof e)return"getDefOpt"===e?t.defaults:t.opt[e]},empty:function(e){var t=this;if(e===i&&(e=!0),e)for(;t.nodes.length>0;){var r=t.nodes[0],n=r.data;r.remove(),t.trigger("itemRemoved",{type:"itemRemoved",item:n,items:t.get("json"),nodes:t.nodes})}else for(;t.nodes.length>0;){var r=t.nodes[0];r.remove()}t.trigger("empty",{type:"empty",component:t})},destroy:function(){return this.$element.removeData(C),this.$element.removeAttr("ui-type"),this.$container.replaceWith(this.initDom),this.status="destroy",this},trigger:function(i,r){var n=Array.prototype.slice.call(arguments,1),o=i.substring(0,1).toUpperCase()+i.substring(1);if(this.opt[i]&&"function"==typeof this.opt[i])return this.opt[i].apply(this,n);if(this.opt["on"+o]&&"function"==typeof this.opt["on"+o])return this.opt["on"+o].apply(this,n);if(this.handlers[i]instanceof Array){var a={type:i,target:this,srcElement:this.element};t.extend(!0,a,r);for(var s=this.handlers[i],l=0,d=s.length;l<d;l++){var u=s[l](a);if(!e.isUndefined(u))return u}}},component:function(){return this},on:function(e,t){return"undefined"==typeof this.handlers[e]&&(this.handlers[e]=[]),this.handlers[e].push(t),this},off:function(e,t){if(e&&this.handlers[e]instanceof Array){var i=this.handlers[e];if(t&&i.indexOf(t)>-1){var r=i.indexOf(t);this.handlers[e].splice(r,1)}}return this}},t.fn[N]=function(e){return this.each(function(){t.data(document.getElementById(r),C)||t.data(document.getElementById(r),C,new o(this,e))})},S(n),{init:S,on:s,off:l,getMaxNumber:d,get:u,set:h,add:c,remove:f,disabled:m,enabled:g,readonly:v,readwrite:b,empty:y,option:p,component:w,destroy:x}):(e.logError("【"+E+"】当前页面不存在 ID 为"+r+" 的DOM节点",FRAME_NAME+"."+E,!0),!1))},e}(wui||{},libs),function(e,t,i){return e.chooseBox=function(r,n){function o(t){for(var i={},r=0;r<t.length;r++){var n=t[r];for(var o in n)i[o]?i[o]=i[o]+","+n[o]:i[o]=n[o]}e.fillForm(i)}function a(t){if(t){e.logParamValue({paramName:"params",paramValue:t,methodName:"_close",className:FRAME_NAME+"."+E,isDebug:!0});var i=x(),r=t.data;if(h(r),i.isVoluation){var n=c("json");o(n)}}}function s(i,n){var o=e.load(),a=this.initComponentAttributes(r,n);t.extend(!0,this,a),this.formatParams(),this.renderComponent(),this.status="loaded",e.closeIndex(o)}function l(i,n){var o=t.data(document.getElementById(r),_);if(!o)return void e.logError("组件未初始化或已被销毁",FRAME_NAME+"."+T,!0);var a=Array.prototype.slice.call(arguments,1);return"function"==typeof o[i]?o[i].apply(o,a):void e.logWarn("组件中不存在 "+i+"() 方法",FRAME_NAME+"."+T,!0)}function d(e,t){return l("on",e,t),this}function u(e,t){return l("off",e,t),this}function h(e,t){return l("set",e,t)}function c(e){return l("get",e)}function f(e){return l("add",e)}function p(e){return l("remove",e)}function m(e){return e=e||{},l("open",e)}function g(){return l("disabled")}function v(){return l("enabled")}function b(){return l("readonly")}function y(){return l("readwrite")}function x(e){return l("option",e)}function w(e){return l("empty",e)}function S(){return l("destroy")}function N(){return l("component")}function C(i){return t.data(document.getElementById(r),_)?i&&e.isJson(i)?l("option",i):void 0:void t("#"+r)[E](i)}var E="uiChooseBox",_="plugin_"+E,T="chooseBox";return e.logMethodCalled({className:FRAME_NAME,methodName:T,isDebug:!0,id:r}),!!e.checkIsLoadPlugins(T)&&(t("#"+r).exist()?(s.prototype={constructor:s,initComponentAttributes:function(i,r){var n={popPageUrl:e.commonPageBasePath+"wui.choosebox.popup.html",value:[],width:"",initHeight:"",maxHeight:"",isShowBtnGroup:!0,otherParam:{},isClickTriggerPopup:!0,isVoluation:!1,isShowInputBar:!0,isOpenWithNodes:!1,isDisableRemove:!1,pageHeight:e.pageHeight,pageWidth:e.pageWidth,isFull:!1,pageTitle:"弹出层页面:【 "+i+" 】",treeTitle:"",treeUrl:"",lazyField:"parentDeptId",isEnabledSearch:!0,tabTitle:"",tabUrl:"",gridTitle:"",gridUrl:"",isFilterable:!1,filterUrl:null,filterData:null,filterPickerWidth:"",filterPickerMaxHeight:"auto",filterSourceReader:{root:null,children:"children"},filterField:"key",filterDirection:"auto",filterMaxHeight:0,filterMenuWidth:"auto",filterClassList:{selected:"",hidden:"hide",disabled:"disabled",active:"active",checked:"fa fa-check",group:"fa fa-group  wui-fa-middle",option:""},name:"id",text:"name",maxNumber:!1,isFreeInput:!1,isAddRemoveLink:!0,isAllowDuplicates:!1,tagClass:"wui-bg-primary",maxChars:0,ellipsis:"...",onBeforeOpenPopup:e.CONSTANTS.EMPTYFUNC,onClosedLayer:e.CONSTANTS.EMPTYFUNC,onSuccessCallback:e.CONSTANTS.EMPTYFUNC,onCancelCallback:e.CONSTANTS.EMPTYFUNC,onEmpty:e.CONSTANTS.EMPTYFUNC,onEmptyBtn:e.CONSTANTS.EMPTYFUNC,onInput:!0,onEnter:!0,isRewrite:!1,defaultText:{editBtn:e.language.chooseBox.editBtn,clearBtn:e.language.chooseBox.clearBtn},treeExtSetting:null,tabsExtSetting:null,gridExtSetting:null,tagsExtSetting:null,modalExtSetting:null},o=e.getAttributeParams(t("#"+i),n),a=t.extend(!0,{},n,r,o),s={pluginName:T,id:i,name:"",element:document.getElementById(i),$element:t("#"+i),defaults:n,initDom:t("#"+i).prop("outerHTML"),dom:"",status:"init",isRendPickerNode:!1,enable:!0,isClosable:a.isAddRemoveLink,nodes:[],handlers:{},itemsName:[],opt:a,viewConTmp:'<div class="tag-container btn-group wui-select-box dropdown"><div wui-attr="view" class="wui-view-tags"></div></div>',inputBoxTmp:'<input type="text" wui-widget-hidden="true" wui-attr-clear-node="true" wui-attr="input"/>',
tipTmp:'<span class="placeholder">{0}</span>',pickerTmp:'<ul wui-attr="menu" class="dropdown-menu focus inner" role="menu" style="overflow-y: auto;"></ul>',$container:null,$viewBox:null,$viewCon:null,$input:null,$dropdownBox:null,$selectContentBox:null,pickerNodes:[],data:[],ext:{}};return s},resize:function(){this.width(this.opt.width),this.height(this.opt.initHeight,this.opt.maxHeight)},width:function(e){this.$container.width(e)},height:function(t,i){t&&this.$viewBox.css({height:t}),i&&this.$viewBox.css({maxHeight:i}),e.scroll(this.$viewBox)},formatParams:function(){this.opt.maxNumber=e.formatMaxNumber(this.opt.maxNumber),this.opt.maxChars=e.formatMaxChars(this.opt.maxChars)},renderComponent:function(){var i=this;this.opt;if(this.status="loading",this.$element.attr("name")||this.$element.attr("name",i.id),this.name=this.$element.attr("name"),!this.$element.parent().hasClass("wui-tagsinput")){var r='<div class="wui-tagsinput"></div>';this.$element.wrap(r)}this.$container=this.$element.parent(),this.$container.attr("wui-attr","container"),this.$viewCon=t(this.viewConTmp),this.$viewBox=this.$viewCon.find('[wui-attr="view"]'),this.$element.after(this.$viewCon),this.$element.hide(),this.renderInputBox(),this.renderToolbar(this.opt.isShowBtnGroup),this.renderPicker(this.opt.isShowBtnGroup),this.opt.isClickTriggerPopup&&this.$viewBox.on("click",function(){i.open()}),this.opt.isShowInputBar||this.$viewCon.hide(),this.resize(),e.isEmptyType(this.opt.value)||this.addNodes(this.opt.value),this.$element.attr("ui-type",this.pluginName),this.dom=this.$container.prop("outerHTML"),this.trigger("init",{type:"init"})},addComponentNodes:function(e,t){this.addNode(e.data,t),this.$input.val(""),this.closePicker()},removeComponentNodes:function(e,t){},getComponentNodes:function(){return this.nodes},popNodes:function(){return this.nodes.pop()},isMaxNumber:function(e){var t={"-1":"最多可选择"+this.opt.maxNumber+"个标签"};if(0!=this.opt.maxNumber&&this.opt.maxNumber>1&&this.nodes.length>=this.opt.maxNumber)return this.trigger("itemSelectError",{type:"itemSelectError",item:e,code:-1,message:t[-1]}),!0},renderResult:function(){this.focus(),this.updatedNodes()},addPickerItem:function(e){this.$selectContentBox.append(e)},updatedNodes:function(){this.$element.val(this.itemsName.join(","));var i=this.$element.get(0);i.form&&t.data(i.form,"validator")&&!e.isEmptyType(this.$element.rules())&&e.validElement(this.$element)},createNode:function(t,i){return new TagNode(t,this.opt,this,i,e)},addNode:function(t,i,r){var n=this,o=this.opt.name,a={"-1":"最多可选择"+this.opt.maxNumber+"个标签",0:"添加的数据不能为空",1:"name属性值没设置,无法添加object类型数据",2:"标签数据"+o+"属性值重复",3:"{0} 中不存在"+o+"属性",5:"只能添加类型为object、string的数据"},s=t;if(e.isUndefined(i)&&(i=!0),"number"==typeof n.opt.maxNumber&&n.opt.maxNumber>0&&n.nodes.length>=n.opt.maxNumber)return n.trigger("itemAddError",{type:"itemAddError",item:t,code:-1,message:a[-1]}),!1;if(e.isJson(t)&&(s=t[o]),e.isEmptyType(s))return n.trigger("itemAddError",{type:"itemAddError",item:t,code:3,message:a[3].replace("{0}",JSON.stringify(t))}),!0;if(!n.opt.isAllowDuplicates&&n.itemsName.indexOf(s)>-1)return n.opt.isShowAnimate&&this.$viewBox.children("span").eq(n.itemsName.indexOf(s)).hide().fadeIn(),n.trigger("itemAddError",{type:"itemAddError",item:t,code:2,message:a[2]}),!0;if(i){var l=n.trigger("beforeItemAdd",{type:"beforeItemAdd",item:t,items:n.get("json"),nodes:n.nodes});if(l===!1)return}var d=n.createNode(t,r);return n.nodes.push(d),n.updatedNodes(),i&&n.trigger("itemAdded",{type:"itemAdded",item:t,items:n.get("json"),node:d}),!0},addNodes:function(i,r,n){var o=this,a=this.opt.name,s={"-1":"最多可选择"+this.opt.maxNumber+"个标签",0:"添加的数据不能为空",1:"name属性值没设置,无法添加object类型数据",2:"标签数据"+a+"属性值重复",3:"{0} 中不存在"+a+"属性",5:"只能添加类型为object、string的数据"};return e.isEmptyType(i)?(this.trigger("itemAddError",{type:"itemAddError",item:i,code:0,message:s[0]}),!1):e.isArray(i)?(t.each(i,function(e,t){return o.addNode(t,r,n)}),!0):e.isJson(i)?o.addNode(i,r,n):e.isString(i)?(t.each(i.split(","),function(e,t){return o.addNode(t,r,n)}),!0):(this.trigger("itemAddError",{type:"itemAddError",item:i,code:5,message:s[5]}),!1)},removeNode:function(t){var i=this,r=this.opt.name,n={0:"移除的数据不能为空",1:r+"属性值没设置,无法移除object类型数据",2:"{0} 中不存在"+r+"属性",3:"组件中不存在{0}节点",5:"只能根据类型为object、string的数据来移除节点",6:"移除的节点不能为空"},o=t;if(e.isEmptyType(t))return i.trigger("itemRemoveError",{type:"itemRemoveError",item:t,code:0,message:n[0]}),!0;if(e.isJson(t)){if(!this.opt.name)return i.trigger("itemRemoveError",{type:"itemRemoveError",item:t,code:1,message:n[1]}),!0;o=t[r]}if(e.isEmptyType(o))return i.trigger("itemRemoveError",{type:"itemRemoveError",item:t,code:2,message:n[2].replace("{0}",JSON.stringify(t))}),!0;if("string"!=typeof o)return i.trigger("itemRemoveError",{type:"itemRemoveError",item:t,code:5,message:n[5]}),!0;if(!(i.itemsName.indexOf(o)>-1))return i.trigger("itemRemoveError",{type:"itemRemoveError",item:t,code:3,message:n[3].replace("{0}",JSON.stringify(t))}),!0;var a=i.itemsName.indexOf(o),s=i.nodes[a],l=i.trigger("beforeItemRemove",{type:"beforeItemRemove",item:t,items:i.get("json"),nodes:i.nodes,node:s});return l!==!1?(s.remove(),i.updatedNodes(),i.trigger("itemRemoved",{type:"itemRemoved",item:t,items:this.get("json"),nodes:i.nodes}),!0):void 0},removeNodes:function(i){var r=this,n=this.opt.name,o={0:"移除的数据不能为空",1:n+"属性值没设置,无法移除object类型数据",2:"传入数据{0}不存在",5:"只能根据类型为object、string的数据来移除节点",6:"移除的节点不能为空"};return e.isEmptyType(i)?(this.trigger("itemRemoveError",{type:"itemRemoveError",item:i,code:6,message:o[6]}),!1):e.isArray(i)?(t.each(i,function(e,t){return r.removeNode(t)}),!0):e.isJson(i)?r.removeNode(i):e.isString(i)?(t.each(i.split(","),function(e,t){return r.removeNode(t)}),!0):(this.trigger("itemRemoveError",{type:"itemRemoveError",item:i,code:5,message:o[5]}),!1)},renderInputBox:function(){var i=this,r=this.opt;!this.opt.isFreeInput&&!this.opt.isFilterable||this.$input?this.$input&&(this.$input.remove(),this.$input=null):(this.$input=t(this.inputBoxTmp).appendTo(this.$viewBox),e.input(this.$input,40),this.$input.on("click",function(t){e.stopPropagation(t)}).keypress(function(t){var i=window.event?t.keyCode:t.which;i!=e.CONSTANTS.KEYS.ENTER&&i!=e.CONSTANTS.KEYS.OTHER||(e.stopPropagation(t),e.preventDefault(t))}).keyup(function(n){var o=t(this).val(),a=window.event?n.keyCode:n.which;a==e.CONSTANTS.KEYS.ENTER||a==e.CONSTANTS.KEYS.OTHER?r.onEnter===!0?(r.isFreeInput?i.addNode(o):r.isFilterable&&i.addNode(o),t(this).val("")):r.onEnter&&"function"==typeof r.onEnter&&r.onEnter(this,n,o):a==e.CONSTANTS.KEYS.DELETE||a==e.CONSTANTS.KEYS.BACKSPACE||a==e.CONSTANTS.KEYS.CLEAR?i.keyDelete(o):a==e.CONSTANTS.KEYS.DOWN?i.keyDown():a==e.CONSTANTS.KEYS.UP?i.keyUp():a==e.CONSTANTS.KEYS.END?i.keyEnd():a==e.CONSTANTS.KEYS.LEFT?i.keyLeft():a==e.CONSTANTS.KEYS.RIGHT&&i.keyRight()}),this.$input.on("input propertychange",function(n){e.stopPropagation(n);var o=t(this).val(),a=!0;if(r.onInput&&"function"==typeof r.onInput&&(a=r.onInput(this,n)),a!==!1)if(i.$input.attr("wui-attr-clear-node","false"),""!=o){var s=i.findLastEnableNode();s&&s.isActive()&&s.setActive(!1),r.isFilterable&&i.loadPickerNodes(o)}else r.isFilterable&&i.closePicker()}),i.opt.isClickTriggerPopup||i.$viewBox.off("click").on("click",function(){i.$input.focus()}))},keyLeft:function(){var e=this,t=e.findLastEnableNode();t&&!t.isActive()&&t.setActive(!0)},keyRight:function(){},keyDown:function(){var e=this;t.each(e.pickerNodes,function(e,t){if(!t.isHidden())return t.focus(),!1})},keyUp:function(){for(var e=this,t=e.pickerNodes.length-1;t>=0;t--){var i=e.pickerNodes[t];if(!i.isHidden()){i.focus();break}}},keyEnd:function(){for(var e=this,t=e.pickerNodes.length-1;t>=0;t--){var i=e.pickerNodes[t];if(!i.isHidden()){i.focus();break}}},keyDelete:function(e){var t=this,i=this.opt;if(""==e){var r=t.findLastEnableNode();r&&("true"==t.$input.attr("wui-attr-clear-node")?r.isActive()?r.remove():r.setActive(!0):t.$input.attr("wui-attr-clear-node","true")),i.isFilterable&&t.closePicker()}else t.$input.attr("wui-attr-clear-node","false"),i.isFilterable&&t.loadPickerNodes(e)},findLastEnableNode:function(){for(var e=this,t=null,i=e.nodes.length-1;i>=0;i--){var r=e.nodes[i];if(r.isEnable()){t=r;break}}return t},focus:function(){this.$input&&this.$input.focus()},blur:function(){this.$input&&this.$input.blur()},renderToolbar:function(i){var r=this,n=this.opt;if(i){if(this.$element.parent().hasClass("wui-tagsinput"))this.$element.parent().hasClass("input-group")||this.$element.parent().addClass("input-group");else{var o='<div class="wui-tagsinput input-group"></div>';this.$element.wrap(o)}var a=[{html:n.defaultText.editBtn,action:"edit",title:"弹出窗口"},{html:n.defaultText.clearBtn,action:"empty",title:"清空"}];e.addToolBar(this.$viewCon,a,"after"),this.$container.find("[wui-toolBar-action]").each(function(e,i){var n=t(i).attr("wui-toolBar-action");"edit"==n?t(i).off("click").on("click",function(){r.open()}):"empty"==n&&t(i).off("click").on("click",function(){r.empty("btn")})})}else this.$container.find("[wui-toolBar-action]").remove(),this.$container.removeClass("input-group")},openPicker:function(){this.$viewCon.addClass("open"),this.direction(),this.viewWidth(),this.viewHeight(),this.keyDown()},closePicker:function(){return!!this.opt.isFilterable&&(this.$viewCon.removeClass("open"),void(this.opt.filterUrl&&this.emptyPicker()))},emptyPicker:function(){this.data=[],this.pickerNodes=[],this.$selectContentBox.empty()},createSelectNode:function(e,t){var i={text:this.opt.text,name:this.opt.name,jsonReader:{children:this.opt.filterSourceReader.children},classList:{selected:this.opt.filterClassList.selected,active:this.opt.filterClassList.active,checked:this.opt.filterClassList.checked,group:this.opt.filterClassList.group,option:this.opt.filterClassList.option},isSelectGroup:!1,maxNumber:this.opt.maxNumber};return new SelectNode(e,i,this,t)},renderPickerNodes:function(e){var i=this,r=[];this.data=e,t.each(e,function(e,n){var o=i.createSelectNode(n,null);i.pickerNodes.push(o),o.isHidden()||r.push(o),n[i.opt.filterSourceReader.children]&&t.each(n[i.opt.filterSourceReader.children],function(e,t){var n=i.createSelectNode(t,o);o.childrens.push(n),i.pickerNodes.push(n),n.isHidden()||r.push(n)})}),this.openPicker(),this.trigger("loadComplete",e)},loadPickerNodes:function(t){var i=this,r=this.opt,n={},o=this.opt.filterSourceReader.root;return n[r.filterField]=t,!!this.opt.isFilterable&&void(this.opt.filterUrl?e.ajax({url:r.filterUrl,data:JSON.stringify(n),onSuccess:function(t){if(o){var r=t[o];e.isArray(r)&&r.length>0&&i.renderPickerNodes(r)}else i.renderPickerNodes(t)},onError:function(t){e.logError(t)},async:!0,dataType:"json",method:"get"}):!this.isRendPickerNode&&this.opt.filterData?(i.renderPickerNodes(this.opt.filterData),this.filterPicker(t),this.isRendPickerNode=!0):this.isRendPickerNode&&(this.filterPicker(t),this.openPicker()))},filterPicker:function(e){var i=this;t.each(this.pickerNodes,function(t,r){r.title.indexOf(e)>-1?i.itemsName.indexOf(r.key)>-1?i.opt.isAllowDuplicates?r.setHidden(!1):r.setHidden(!0):r.setHidden(!1):r.setHidden(!0)})},renderPicker:function(){this.$dropdownBox=t('<div class="dropdown-menu wui-open"></div>').appendTo(this.$viewCon),this.$selectContentBox=t(this.pickerTmp).appendTo(this.$dropdownBox)},direction:function(){if("auto"==this.opt.filterDirection){var t=e.getViewSize(),i=this.$container.offset();t.height/2>i.top?this.$viewCon.removeClass("dropup").addClass("dropdown"):this.$viewCon.addClass("dropup").removeClass("dropdown")}else"dropup"==this.opt.filterDirection?this.$viewCon.addClass("dropup"):this.$viewCon.addClass("dropdown")},scroll:function(){e.scroll(this.$selectContentBox)},viewWidth:function(){"auto"==this.opt.filterMenuWidth?this.$selectContentBox.width(this.$container.width()):this.$selectContentBox.width(this.opt.filterMenuWidth)},viewHeight:function(){var t=e.getViewSize(),i=null;if(this.$viewCon.hasClass("dropup")){i=this.$container.offset();var r=this.opt.filterMaxHeight?this.opt.filterMaxHeight:i.top-20;this.$selectContentBox.height()>r&&this.$selectContentBox.css({"max-height":r+"px"})}else{i=this.$selectContentBox.offset();var r=this.opt.filterMaxHeight?this.opt.filterMaxHeight:t.height-i.top-20;this.$selectContentBox.height()>r&&this.$selectContentBox.css({"max-height":r+"px"})}this.scroll()},setEnable:function(e,i){var r=this;this.enable=e,t.each(r.nodes,function(t,r){return!i&&r.item.isEnableRemove===!1||void r.setEnable(e)})},set:function(e,t){this.nodes.length>0&&this.empty(t),this.addNodes(e)},get:function(e){if(e=e||"json","value"==e.toLowerCase())return this.itemsName;if("json"==e.toLowerCase()){var i=[];return t.each(this.nodes,function(e,t){i.push(t.item)}),i}if("text"==e.toLowerCase()){var r=[];return t.each(this.nodes,function(e,t){r.push(t.title)}),r}if("data"==e.toLowerCase()){var i=[];return t.each(this.nodes,function(e,t){i.push(t.data)}),i}return this.nodes},add:function(e,t,i){this.addNodes(e,t,i)},remove:function(e){this.removeNodes(e)},disabled:function(e){var t=this;t.setEnable(!1,e),t.$input?t.$input.attr("disabled",!0):null,t.$viewBox.off("click").addClass("disabled"),t.$container.find("[wui-toolBar-action]").attr("disabled","disabled")},enabled:function(e){var t=this;t.setEnable(!0,e),t.$input?t.$input.removeAttr("disabled"):null,t.$viewBox.removeClass("disabled"),t.opt.isClickTriggerPopup&&t.$viewBox.off("click").on("click",function(){t.open()}),t.$container.find("[wui-toolBar-action]").removeAttr("disabled")},readonly:function(e){var t=this;t.setEnable(!1,e),t.$input?t.$input.attr("readonly",!0):null,t.$viewBox.off("click").addClass("readonly"),t.$container.find("[wui-toolBar-action]").attr("disabled","disabled")},readwrite:function(e){var t=this;t.setEnable(!0,e),t.$input?t.$input.removeAttr("readonly"):null,t.$viewBox.removeClass("readonly"),t.opt.isClickTriggerPopup&&t.$viewBox.off("click").on("click",function(){t.open()}),t.$container.find("[wui-toolBar-action]").removeAttr("disabled")},_refresh:function(r){var n=this,o=!1,a=!1,s=!1,l=!1;if(r.popPageUrl!=i&&this.opt.popPageUrl!=r.popPageUrl&&""!=r.popPageUrl&&(this.opt.popPageUrl=r.popPageUrl),r.otherParam!=i&&this.opt.otherParam!=r.otherParam&&(this.opt.otherParam=r.otherParam),r.treeTitle!=i&&this.opt.treeTitle!=r.treeTitle&&(this.opt.treeTitle=r.treeTitle),r.treeUrl!=i&&this.opt.treeUrl!=r.treeUrl&&(this.opt.treeUrl=r.treeUrl),r.lazyField!=i&&this.opt.lazyField!=r.lazyField&&(this.opt.lazyField=r.lazyField),r.isEnabledSearch!=i&&this.opt.isEnabledSearch!=r.isEnabledSearch&&(this.opt.isEnabledSearch=r.isEnabledSearch),r.tabTitle!=i&&this.opt.tabTitle!=r.tabTitle&&(this.opt.tabTitle=r.tabTitle),r.tabUrl!=i&&this.opt.tabUrl!=r.tabUrl&&(this.opt.tabUrl=r.tabUrl),r.gridTitle!=i&&this.opt.gridTitle!=r.gridTitle&&(this.opt.gridTitle=r.gridTitle),r.gridUrl!=i&&this.opt.gridUrl!=r.gridUrl&&(this.opt.gridUrl=r.gridUrl),r.pageHeight!=i&&this.opt.pageHeight!=r.pageHeight&&(this.opt.pageHeight=r.pageHeight),r.pageWidth!=i&&this.opt.pageWidth!=r.pageWidth&&(this.opt.pageWidth=r.pageWidth),r.pageTitle!=i&&this.opt.pageTitle!=r.pageTitle&&(this.opt.pageTitle=r.pageTitle),r.isVoluation!=i&&this.opt.isVoluation!=r.isVoluation&&(this.opt.isVoluation=r.isVoluation),r.isRewrite!=i&&this.opt.isRewrite!=r.isRewrite&&(this.opt.isRewrite=r.isRewrite),r.isAllowDuplicates!=i&&this.opt.isAllowDuplicates!=r.isAllowDuplicates&&(this.opt.isAllowDuplicates=r.isAllowDuplicates,r.isAllowDuplicates||(a=!0)),r.width!=i&&this.opt.width!=r.width&&(this.opt.width=r.width,this.width(this.opt.width)),r.initHeight!=i&&this.opt.initHeight!=r.initHeight&&(this.opt.initHeight=r.initHeight,o=!0),r.maxHeight!=i&&this.opt.maxHeight!=r.maxHeight&&(this.opt.maxHeight=r.maxHeight,o=!0),o&&this.height(this.opt.initHeight,this.opt.maxHeight),r.isAddRemoveLink!=i&&this.opt.isAddRemoveLink!=r.isAddRemoveLink&&(this.opt.isAddRemoveLink=r.isAddRemoveLink,this.setEnable(this.opt.isAddRemoveLink)),r.isShowAnimate!=i&&this.opt.isShowAnimate!=r.isShowAnimate&&(this.opt.isShowAnimate=r.isShowAnimate),r.text!=i&&this.opt.text!=r.text&&(a=!0,this.opt.text=r.text),r.name!=i&&this.opt.name!=r.name&&(a=!0,this.opt.name=r.name),a&&this.empty(),r.tagClass!=i&&this.opt.tagClass!=r.tagClass&&(""!=this.opt.tagClass&&t.each(n.nodes,function(e,t){t.node.removeClass(n.opt.tagClass).addClass(r.tagClass)}),this.opt.tagClass=r.tagClass),r.maxNumber!=i&&this.opt.maxNumber!==e.formatMaxNumber(r.maxNumber)){var d=e.formatMaxNumber(r.maxNumber);if(this.opt.maxNumber=d,d)for(;n.nodes.length>d;){var u=n.nodes[n.nodes.length-1];u.remove()}}if(r.ellipsis!=i&&this.opt.ellipsis!=r.ellipsis&&(this.opt.ellipsis=r.ellipsis,s=!0),r.maxChars!=i&&this.opt.maxChars!=e.formatMaxChars(r.maxChars)){var h=e.formatMaxChars(r.maxChars);this.opt.maxChars=h,s=!0}return!a&&s&&t.each(n.nodes,function(e,t){t.renderTitle()}),r.isFreeInput!=i&&this.opt.isFreeInput!=r.isFreeInput&&(this.opt.isFreeInput=r.isFreeInput,l=!0),r.isFilterable!=i&&this.opt.isFilterable!=r.isFilterable&&(this.opt.isFilterable=r.isFilterable,l=!0),l&&n.renderInputBox(),r.isShowInputBar!=i&&this.opt.isShowInputBar!=r.isShowInputBar&&(this.opt.isShowInputBar=r.isShowInputBar,r.isShowInputBar?this.$viewCon.show():this.$viewCon.hide()),r.isShowBtnGroup!=i&&this.opt.isShowBtnGroup!=r.isShowBtnGroup&&(this.opt.isShowBtnGroup=r.isShowBtnGroup,this.renderToolbar(this.opt.isShowBtnGroup)),r.isClickTriggerPopup!=i&&this.opt.isClickTriggerPopup!=r.isClickTriggerPopup&&(this.opt.isClickTriggerPopup=r.isClickTriggerPopup,this.$viewBox.off("click"),this.opt.isClickTriggerPopup&&this.$viewBox.on("click",function(){n.open()})),!0},option:function(e){var t=this;if(!e)return this.opt;if("object"==typeof e)this._refresh(e);else if("string"==typeof e)return"getDefOpt"===e?t.defaults:t.opt[e]},open:function(i){i=e.formatOtherParam(i);var r=this,n=this.opt,o=i.url||n.popPageUrl,s=i.width||n.pageWidth,l=i.height||n.pageHeight,d=i.title||n.pageTitle,u=function(e){var t=!0,r=i.onSuccessCallback||n.onSuccessCallback;r&&"function"==typeof r&&(t=r(e)),t!==!1&&a(e)},h=i.onCancelCallback||n.onCancelCallback,c=i.onClosedLayer||n.onClosedLayer,f={selectorId:this.id,treeTitle:n.treeTitle,treeUrl:n.treeUrl,lazyField:n.lazyField,isEnabledSearch:n.isEnabledSearch,tabUrl:n.tabUrl,tabTitle:n.tabTitle,gridUrl:n.gridUrl,gridTitle:n.gridTitle,text:n.text,name:n.name,maxNumber:n.maxNumber,isAllowDuplicates:n.isAllowDuplicates,isRewrite:n.isRewrite,isDisableRemove:n.isDisableRemove,otherParam:n.otherParam,treeExtSetting:n.treeExtSetting,tabsExtSetting:n.tabsExtSetting,gridExtSetting:n.gridExtSetting,tagsExtSetting:n.tagsExtSetting};if("string"==typeof o&&""!=o){n.isRewrite&&r.empty();var p=r.get("json");if(e.addChooseBoxNode(p),n.onBeforeOpenPopup&&"function"==typeof n.onBeforeOpenPopup){var m=n.onBeforeOpenPopup(f);if(m&&e.isJson(m))f=m;else if(m===!1)return!1}n.isOpenWithNodes?f.value=JSON.stringify(p):f.value="",n.beforeOpenPop&&"function"==typeof n.beforeOpenPop&&n.beforeOpenPop(o,f);var g=e.buildUrl(o,f,!0,!0),v={url:g,width:s,height:l,title:d,isFull:n.isFull,successCallback:u,cancelCallback:h,closedCallback:function(){e.removeChooseBoxNode();var t=r.get("json");c&&"function"==typeof c&&c(t)}};n.modalExtSetting&&t.extend(!0,v,n.modalExtSetting),e.openModalDialog(v)}else e.logWarn("打开页面的URL不能为空",FRAME_NAME+"."+T,!0);return this},empty:function(e){var t=this;if(e===i&&(e=!0),e)for(;t.nodes.length>0;){var r=t.nodes[0],n=r.data;r.remove(),t.trigger("itemRemoved",{type:"itemRemoved",item:n,items:t.get("json"),nodes:t.nodes})}else for(;t.nodes.length>0;){var r=t.nodes[0];r.remove()}t.updatedNodes(),t.trigger("empty",{type:"empty",component:t}),"btn"===e&&t.trigger("emptyBtn",{type:"emptyBtn",component:t})},destroy:function(){return this.$element.removeData(_),this.$element.removeAttr("ui-type"),this.$container.replaceWith(this.initDom),this.status="destroy",this},trigger:function(i,r){var n,o,a=Array.prototype.slice.call(arguments,1),s=i.substring(0,1).toUpperCase()+i.substring(1);if(this.opt[i]&&"function"==typeof this.opt[i]&&(n=this.opt[i].apply(this,a),!e.isUndefined(n)))return n;if(this.opt["on"+s]&&"function"==typeof this.opt["on"+s]&&(o=this.opt["on"+s].apply(this,a),!e.isUndefined(o)))return o;if(this.handlers[i]instanceof Array){var l={type:i,target:this,srcElement:this.element};t.extend(!0,l,r);for(var d=this.handlers[i],u=0,h=d.length;u<h;u++){var c=d[u](l);if(!e.isUndefined(c))return c}}},component:function(){return this},on:function(e,t){return"undefined"==typeof this.handlers[e]&&(this.handlers[e]=[]),this.handlers[e].push(t),this},off:function(e,t){if(e&&this.handlers[e]instanceof Array){var i=this.handlers[e];if(t&&i.indexOf(t)>-1){var r=i.indexOf(t);this.handlers[e].splice(r,1)}}return this}},t.fn[E]=function(e){return this.each(function(){t.data(document.getElementById(r),_)||t.data(document.getElementById(r),_,new s(this,e))})},C(n),{init:C,on:d,off:u,get:c,set:h,add:f,remove:p,enabled:v,disabled:g,readwrite:y,readonly:b,openPopup:m,destroy:S,component:N,option:x,empty:w}):(e.logError("【"+T+"】当前页面不存在 ID 为"+r+" 的DOM节点",FRAME_NAME+"."+T,!0),!1))},e}(wui||{},libs),function(e,t,i){return e.selectComboBox=function(r,n){function o(e,t){this.init()}function a(i,n){var o=t.data(document.getElementById(r),N);if(!o)return void e.logError("wui.selectComboBox 未初始化或已被销毁",FRAME_NAME+"."+C,!0);var a=Array.prototype.slice.call(arguments,1);return"function"==typeof o[i]?o[i].apply(o,a):void e.logWarn("wui.selectComboBox 中不存在 "+i+"() 方法",FRAME_NAME+"."+C,!0)}function s(e,i){var n=t.data(document.getElementById(r),N);return a("on",e,i),n}function l(e,i){var n=t.data(document.getElementById(r),N);return a("off",e,i),n}function d(e){return a("get",e)}function u(e,t){return a("select",e,t)}function h(e,t){return a("unselect",e,t)}function c(){return a("disabled")}function f(){return a("enabled")}function p(){return a("readonly")}function m(){return a("readwrite")}function g(e){return a("option",e)}function v(e){return a("empty",e)}function b(){return a("refresh")}function y(){return a("destroy")}function x(){return a("component")}function w(i){return t.data(document.getElementById(r),N)?i&&e.isJson(i)?a("option",i):void 0:void t("#"+r)[S](i)}var S="uiSelectComboBox",N="plugin_"+S,C="selectComboBox";if(e.logMethodCalled({className:FRAME_NAME,methodName:C,isDebug:!0,id:r}),!e.checkIsLoadPlugins(C))return!1;if(!t("#"+r).exist())return e.logError("【"+C+"】当前页面不存在 ID 为"+r+" 的DOM节点",FRAME_NAME+"."+C,!0),!1;var E=["iframeLoaded","beforeItemSelect","itemSelectError","itemSelected","beforeItemUnselect","itemUnselectError","itemUnselected"],_={direction:"auto",multipleSeparator:",",maxNumber:!1,value:"",name:"id",text:"name",pageUrl:e.commonPageBasePath+"wui.comboBox.dropdown.html",otherParam:{},maxHeight:0,width:"",isReload:!1,beforeIframeLoad:e.CONSTANTS.EMPTYFUNC,treeTitle:"",treeUrl:"",lazyField:"parentDeptId",isEnabledSearch:!0,tabTitle:"",tabUrl:"",treeExtSetting:null,tabsExtSetting:null,defaultText:{noneSelectedText:e.language.selectComboBox.noneSelected},updateSubpageItem:e.CONSTANTS.EMPTYFUNC},T={maxOptionsText:["超出限制 (最多选择{n}项)","组选择超出限制(最多选择{n}组)"]};return o.prototype={constructor:o,init:function(){this.pluginName=C,this.element=r,this.$element=t("#"+r),this.defaults=T,this.hasDom=!1,this.initDom=this.$element.prop("outerHTML");var i=e.getAttributeParams(this.$element,_);this._opt=t.extend(!0,{},_,n,i),this.itemsArray=[],this.itemsName=[],this.itemsText=[],this.iframeTmpl='<iframe id="" name="" allowtransparency="true" width="100%" height="98%" src="" scrolling="yes" frameborder="0"></iframe>',this.$element.attr("placeholder")?this.defaults.noneSelectedText=this.$element.attr("placeholder"):this.defaults.noneSelectedText=this._opt.defaultText.noneSelectedText,this.$Maxcontainer=null,this.$viewBox=null,this.$buttonBox=null,this.$resultBox=null,this.$dropdownBox=null,this.$selectContentBox=null,this.errorElement=null,this.iframe=null,this.listeners=[],this.handlers={},this._formatParams(),this.dom=this._buildContainer()},_buildContainer:function(){var e=this,i=this._opt,r=this.$element;if(r.attr("name")||r.attr("name",e.element),this.name=r.attr("name"),!r.parent().hasClass("wui-selectcombobox")){var n='<div class="wui-selectcombobox"></div>';r.wrap(n)}return this.$Maxcontainer=r.parent(),this.$viewBox=t('<div wui-combobox="dropdowm" class="btn-group wui-select-box show-tick input-layout" style="width: 100%;"></div>'),this.$buttonBox=t('<button type="button" class="wui-btn dropdown-toggle btn-default" data-toggle="dropdown" aria-expanded="true"></button>').appendTo(this.$viewBox),this.$resultBox=t('<span class="filter-option pull-left">'+this.defaults.noneSelectedText+"</span>").appendTo(this.$buttonBox),this.$caret=t('<span class="ws-caret"> <span class="caret"></span> <span class="sr-only">Toggle Dropdown</span> </span>').appendTo(this.$buttonBox),this.$dropdownBox=t('<div class="dropdown-menu open"></div>').appendTo(this.$viewBox),this.$selectContentBox=t('<div wui-data="menu" class="dropdown-menu inner" role="menu" style="overflow-y: auto; height: 100%;"></div>').appendTo(this.$dropdownBox),r.after(this.$viewBox),r.hide(),this._setDirection(),this._bindEvent(),i.width&&this.$Maxcontainer.width(i.width),this.select(i.value),this.hasDom=!0,this.$Maxcontainer.prop("outerHTML")},_initDropDownBox:function(){var t=this._initSelectContentBox();return t?void this._loadIframe(t):(this.$selectContentBox.height(40),e.logWarn("没有传入可初始化下拉框的数据",FRAME_NAME+"."+C,!0),!1)},_initSelectContentBox:function(){var i,r=this,n=this._opt;this.$element;if(r.$selectContentBox.attr("id")?i=r.$selectContentBox.attr("id"):(i=e.guid(),r.$selectContentBox.attr("id",i)),n.pageUrl&&""!=n.pageUrl&&(""!=n.treeUrl||0!=n.tabUrl.length)){var o=t(r.iframeTmpl);this.iframe=o[0];var a=i+"_iframe";o.attr({id:a,name:a}),r.$selectContentBox.html(o)}return this.iframe},_formatParams:function(){var t=this._opt;this._opt.maxNumber=e.formatMaxNumber(t.maxNumber);var i=t.value;e.parseToObj(i)&&(this._opt.value=e.parseToObj(i))},_bindEvent:function(){var i=this,r=this._opt;t(document).on("click",'[wui-data="menu"]',function(t){e.stopPropagation(t)}),this.$viewBox.on({"hide.bs.dropdown":function(e){i.$selectContentBox.attr("aria-expanded",!1)},"hidden.bs.dropdown":function(e){},"show.bs.dropdown":function(e){i.$selectContentBox.attr("aria-expanded",!0)},"shown.bs.dropdown":function(e){r.isReload?(i._setHeight(),i._initDropDownBox()):i.iframe||(i._setHeight(),i._initDropDownBox())}}),i.$element.attr("ui-type",i.pluginName),this.$element.on("change",function(r){var n=t(this).val();if(""!=n){var o=e.parseToObj(n);o?i.select(o):i.select(n)}})},_setDirection:function(){var e=this._opt;"auto"==e.direction?this._checkDropdownPosition():""!=e.direction&&this.$viewBox.addClass(e.direction)},_checkDropdownPosition:function(){var t=this,i=e.getViewSize(),r=t.$Maxcontainer.offset();i.height/2>r.top?(t.$viewBox.removeClass("dropup"),t.$viewBox.addClass("dropdown")):(t.$viewBox.addClass("dropup"),t.$viewBox.removeClass("dropdown"))},_loadIframe:function(i){var r=this,n=this._opt;this.$element;i=i||this.iframe,t(i).on("load",function(e){r.listeners.indexOf("iframeLoaded")>-1&&!r.emit({type:"iframeLoaded",target:e.target})});var o={selectorId:this.element,widgetName:r.pluginName,treeTitle:n.treeTitle,treeUrl:n.treeUrl,lazyField:n.lazyField,isEnabledSearch:n.isEnabledSearch,tabUrl:n.tabUrl,tabTitle:n.tabTitle,text:n.text,name:n.name,maxNumber:n.maxNumber,otherParam:n.otherParam,data:r.get("value"),treeExtSetting:n.treeExtSetting,tabsExtSetting:n.tabsExtSetting};if(n.beforeIframeLoad&&"function"==typeof n.beforeIframeLoad&&n.beforeIframeLoad!=t.noop){var a=n.beforeIframeLoad(i,o);if(!a)return;a.urlParams&&"object"==typeof a.urlParams&&(o=a.urlParams)}var s=e.buildUrl(n.pageUrl,o,!0,!0);t(i).attr("src",s)},_setHeight:function(){var i=this,r=e.getViewSize(),n=null,o=t(window).scrollTop(),a=0;if(0==i._opt.maxHeight||"0"==i._opt.maxHeight)if(i.$viewBox.hasClass("dropup")){n=i.$buttonBox.offset();var s=0;this.$dropdownBox.children().not('[wui-data="menu"]').each(function(e,t){s+=t.offsetHeight}),a=n.top-o-s-10}else n=i.$selectContentBox.offset(),a=r.height-(n.top-o)-10;else a=parseInt(i._opt.maxHeight);this.$selectContentBox.height(a)},_parseText:function(e){var t=this._opt.text,i=t;if(t){var r=/\{\{(.+?)\}\}/g,n=t.match(r);if(n)for(var o=n.length,a=0;a<o;a++){var s=/^\{\{(.+?)\}\}$/.exec(n[a]);s.length>1&&(i=i.replace(s[0],e[s[1]]))}else{var l=t.split(","),o=l.length;if(o<2)i=e[t];else{for(var d={},a=0;a<o;a++){var u=l[a];d[u]=e[u]}i=JSON.stringify(d)}}}else i=JSON.stringify(e);return i},_addItem:function(r,n){if(!(this.listeners.indexOf("beforeItemSelect")>-1)||this.emit({type:"beforeItemSelect",target:this.$viewBox,iframe:this.iframe})){var o=this,a=this._opt,s=this.$element;if(a.maxNumber!==!1&&o.itemsArray.length>=a.maxNumber)return void(this.listeners.indexOf("itemSelectError")>-1&&!this.emit({type:"itemSelectError",target:this.$viewBox,iframe:this.iframe,item:r,code:-1,message:"最多可添加"+a.maxNumber+"个标签"}));if(r==i)return void(this.listeners.indexOf("itemSelectError")>-1&&!this.emit({type:"itemSelectError",target:this.$viewBox,iframe:this.iframe,item:r,code:0,message:"添加的数据不能为空"}));var l,d,u={};if("object"!=typeof r||null==r)return void(this.listeners.indexOf("itemSelectError")>-1&&!this.emit({type:"itemSelectError",target:this.$viewBox,iframe:this.iframe,item:r,code:1,message:"只能添加类型为Object的数据"}));if(u=r,l=u[a.name],e.isUndefined(l))return void(this.listeners.indexOf("itemSelectError")>-1&&!this.emit({type:"itemSelectError",target:this.$viewBox,iframe:this.iframe,item:r,code:4,message:JSON.stringify(u)+" 对象中不存在value属性值"}));if(this.itemsName.indexOf(l)>-1)return void(this.listeners.indexOf("itemSelectError")>-1&&!this.emit({type:"itemSelectError",target:this.$viewBox,iframe:this.iframe,item:r,code:3,message:r+" 已经被选中"}));d=o._parseText(u),this.itemsName.push(l),this.itemsArray.push(u),this.itemsText.push(d),this.$resultBox.text(this.itemsText.join(a.multipleSeparator)),s.val(this.itemsName.join(","));var h=o.$element.get(0);if(h.form&&t.data(h.form,"validator")&&!e.isEmptyType(o.$element.rules())&&e.validElement(o.$element),n==i&&(n=!0),!(n&&this.listeners.indexOf("itemSelected")>-1)||this.emit({type:"itemSelected",target:this.$viewBox,iframe:this.iframe,item:u}))return this}},_removeItem:function(r,n,o){if(!(this.listeners.indexOf("beforeItemUnselect")>-1)||this.emit({type:"beforeItemUnselect",target:this.$viewBox,iframe:this.iframe})){var a=this,s=a._opt,l=a.$element;if(r===i)return void(this.listeners.indexOf("itemUnselectError")>-1&&!this.emit({type:"itemUnselectError",target:this.$viewBox,iframe:this.iframe,item:r,code:0,message:"移除的数据不能为空"}));if("object"==typeof r&&!s.name){if(this.listeners.indexOf("itemRemoveError")>-1&&!this.emit({type:"itemRemoveError",target:this.$viewBox,item:r,code:4,message:"name属性值没设置，无法删除object类型数据"}))return;return 1}n=n||!1;var d=0;if(n)d=parseInt(r);else if("object"!=typeof r||e.isArray(r)){if("string"!=typeof r)return void(this.listeners.indexOf("itemUnselectError")>-1&&!this.emit({type:"itemUnselectError",target:this.$viewBox,iframe:this.iframe,item:r,code:1,message:"取消数据类型不是string"}));d=this.itemsName.indexOf(r)}else{var u=r[s.name];d=this.itemsName.indexOf(u)}if(d<0)return void(this.listeners.indexOf("itemUnselectError")>-1&&!this.emit({type:"itemUnselectError",target:this.$viewBox,iframe:this.iframe,item:r,code:3,message:r+" 未被选中"}));var h=this.itemsArray[d];if(this.itemsName.splice(d,1),this.itemsArray.splice(d,1),this.itemsText.splice(d,1),0==this.itemsText.length){var c=this.defaults.noneSelectedText;this.$resultBox.text(c),l.val("")}else this.$resultBox.text(this.itemsText.join(s.multipleSeparator)),l.val(this.itemsName.join(","));var f=a.$element.get(0);if(f.form&&t.data(f.form,"validator")&&!e.isEmptyType(a.$element.rules())&&e.validElement(a.$element),o==i&&(o=!0),!(o&&this.listeners.indexOf("itemUnselected")>-1)||this.emit({type:"itemUnselected",target:this.$viewBox,iframe:this.iframe,item:h}))return this}},disabled:function(){
this.$buttonBox.attr("disabled","disabled")},enabled:function(){this.$buttonBox.removeAttr("disabled")},readonly:function(){this.$buttonBox.attr("disabled","disabled"),this.$buttonBox.addClass("wui-readonly")},readwrite:function(){this.$buttonBox.removeAttr("disabled"),this.$buttonBox.removeClass("wui-readonly")},get:function(e){e=e||"json";this.$element;return"value"==e?this.itemsName:"json"==e?this.itemsArray:"text"==e?this.itemsText:this.itemsArray},select:function(t,r){if(t!=i){if("string"==typeof t){if(""==t){if(this.listeners.indexOf("itemSelectError")>-1&&!this.emit({type:"itemSelectError",target:this.$viewBox,iframe:this.iframe,item:t,code:6,message:"添加的节点不能为空字符串"}))return;return!1}for(var n=t.split(","),o=0;o<n.length;o++)this._addItem(n[o],r)}else if(e.isArray(t)){if(!(t.length>0)){if(this.listeners.indexOf("itemSelectError")>-1&&!this.emit({type:"itemSelectError",target:this.$viewBox,iframe:this.iframe,item:t,code:6,message:"添加的节点不能为空数组"}))return;return!1}for(var o=0;o<t.length;o++)this._addItem(t[o],r)}else{if("object"!=typeof t){if(this.listeners.indexOf("itemSelectError")>-1&&!this.emit({type:"itemSelectError",target:this.$viewBox,iframe:this.iframe,item:t,code:6,message:"传入的参数值不支持赋值"}))return;return!1}if(null==t){if(this.listeners.indexOf("itemSelectError")>-1&&!this.emit({type:"itemSelectError",target:this.$viewBox,iframe:this.iframe,item:t,code:6,message:"添加的节点不能为空对象"}))return;return!1}this._addItem(t,r)}return this}if(!(this.listeners.indexOf("itemSelectError")>-1)||this.emit({type:"itemSelectError",target:this.$viewBox,iframe:this.iframe,item:t,code:6,message:"必须传入添加的节点"}))return this},unselect:function(t,r){var n=!1;if(t!=i){if("string"==typeof t){if(""==t){if(this.listeners.indexOf("itemUnselectError")>-1&&!this.emit({type:"itemUnselectError",target:this.$viewBox,iframe:this.iframe,item:t,code:6,message:"移除的节点不能为空字符串"}))return;return!1}for(var o=t.split(","),a=0;a<o.length;a++)this._removeItem(o[a],n,r)}else if(e.isArray(t)){if(t.length>0)for(var a=0;a<t.length;a++)this._removeItem(t[a],n,r);else if(this.listeners.indexOf("itemUnselectError")>-1&&!this.emit({type:"itemUnselectError",target:this.$viewBox,iframe:this.iframe,item:t,code:6,message:"移除的节点不能为空数组"}))return}else if("object"==typeof t&&null!=t){if(null!=t)this._removeItem(t,n,r);else if(this.listeners.indexOf("itemUnselectError")>-1&&!this.emit({type:"itemUnselectError",target:this.$viewBox,iframe:this.iframe,item:t,code:6,message:"移除的节点不能为空对象"}))return}else if(this.listeners.indexOf("itemUnselectError")>-1&&!this.emit({type:"itemUnselectError",target:this.$viewBox,iframe:this.iframe,item:t,code:6,message:"传入的参数类型不支持移除"}))return;return this}},option:function(t){var r=this._opt;if(!t)return r;if("object"==typeof t)this._resetOption(t);else if("string"==typeof t)return"getDefOpt"===t?_:r[t]==i?e.logWarn("查找的属性值不存在",FRAME_NAME+"."+C,!0):r[t]},_resetOption:function(t){var r=this._opt,n=!1,o=!1;if(t.direction!=i&&r.direction!=t.direction&&(this._opt.direction=t.direction,this._setDirection()),t.name!=i&&r.name!=t.name&&(n=!0,this._opt.name=t.name),t.text!=i&&r.text!=t.text&&(n=!0,this._opt.text=t.text),n&&this.empty(),t.multipleSeparator!=i&&r.multipleSeparator!=t.multipleSeparator){var a=this.itemsText;a.length>0&&this.$resultBox.text(a.join(t.multipleSeparator)),this._opt.multipleSeparator=t.multipleSeparator}if(t.maxNumber!=i&&r.maxNumber!=parseInt(t.maxNumber)){var s=e.formatMaxNumber(t.maxNumber);if(this._opt.maxNumber=s,0!=s)for(var l=this.itemsName.length;l>s;)this._removeItem(--l,!0)}if(t.otherParam!=i&&t.otherParam!=r.otherParam&&(o=!0,this._opt.otherParam=t.otherParam),t.treeTitle!=i&&t.treeTitle!=r.treeTitle&&(o=!0,this._opt.treeTitle=t.treeTitle),t.treeUrl!=i&&t.treeUrl!=r.treeUrl&&(o=!0,this._opt.treeUrl=t.treeUrl),t.lazyField!=i&&t.lazyField!=r.lazyField&&(o=!0,this._opt.lazyField=t.lazyField),t.isEnabledSearch!=i&&t.isEnabledSearch!=r.isEnabledSearch&&(o=!0,this._opt.isEnabledSearch=t.isEnabledSearch),t.tabTitle!=i&&t.tabTitle!=r.tabTitle&&(o=!0,this._opt.tabTitle=t.tabTitle),t.tabUrl!=i&&t.tabUrl!=r.tabUrl&&(o=!0,this._opt.tabUrl=t.tabUrl),t.pageUrl&&r.pageUrl!=t.pageUrl){if(""==t.pageUrl)return e.logError("必须传入下拉页面地址",FRAME_NAME+"."+C,!0),!1;o=!0,this._opt.pageUrl=t.pageUrl}t.isReload!=i&&r.isReload!=t.isReload&&(this._opt.isReload=!(!t.isReload&&"true"!=t.isReload)),o&&(this._opt.isReload||this._loadIframe())},empty:function(e){var t=this._opt,r=this.$element;if(e===i&&(e=!0),e)for(var n=this.itemsName.length;n>0;)this._removeItem(--n,!0);else{this.itemsName=[],this.itemsArray=[],this.itemsText=[];var o=this.defaults.noneSelectedText;this.$resultBox.text(o),r.val("")}return t.onEmpty&&"function"==typeof t.onEmpty&&t.onEmpty(),this},refresh:function(){this._loadIframe()},destroy:function(e){if(!(this.listeners.indexOf("destroy")>-1)||this.emit({type:"destroy",target:this.dom}))return this.$element.removeData(N),this.$element.removeAttr("ui-type"),this.$Maxcontainer.replaceWith(this.initDom),e&&"function"==typeof e&&e(),this},on:function(e,t){return E.indexOf(e)>-1&&("undefined"==typeof this.handlers[e]&&(this.handlers[e]=[],this.listeners.push(e)),this.handlers[e].push(t)),this},off:function(e,t){var r,n,o,a,s;if(E.indexOf(e)>-1&&this.handlers[e]instanceof Array){for(a=this.handlers[e],o=this.listeners,r=0,s=o.length;r<s&&o[r]!==e;r++);if(t===i)this.listeners.splice(r,1),delete this.handlers[e];else{for(n=0,s=a.length;n<s&&a[n]!==t;n++);n<s&&(this.handlers[e].splice(n,1),0==this.handlers[e].length&&this.listeners.splice(r,1))}}return this},emit:function(e){if(e.target||(this.$Maxcontainer?e.target=this.$Maxcontainer:e.target=this),this.handlers[e.type]instanceof Array){for(var t=this.handlers[e.type],i=0,r=t.length;i<r;i++)t[i](e);return!0}return!1},component:function(){return this}},t.fn[S]=function(e,i,n){return this.each(function(){t.data(document.getElementById(r),N)||t.data(document.getElementById(r),N,new o(this,e))})},w(n),{init:w,on:s,off:l,get:d,select:u,unselect:h,enabled:f,disabled:c,readwrite:m,readonly:p,option:g,empty:v,refresh:b,component:x,destroy:y}},e}(wui||{},libs),function(e,t,i){return e.file=function(r,n){function o(e){var t="";return t+=e?'<div class="dz-preview dz-file-preview">\n':'<div class="dz-preview dz-file-preview" style="display: none!important">\n',t+='\t<div class="img-btn-mask"></div>\n',t+='\t<div class="dz-image"><img data-dz-thumbnail /></div>\n',t+='\t<div class="dz-details">\n',t+='\t\t<div class="dz-size"><span data-dz-size></span></div>\n',t+='\t\t<div class="dz-filename"><span data-dz-name></span></div>\n',t+="\t</div>\n",t+='\t<div class="dz-progress"><span class="dz-upload" data-dz-uploadprogress></span></div>\n',t+='\t<div class="dz-error-message"><span data-dz-errormessage></span></div>\n',t+='\t<div class="dz-success-mark"><i class="fa fa-check"></i></div>\n',t+='\t<div class="dz-error-mark"><i class="fa fa-close"></i></div>\n',t+="</div>\n"}function a(e){var t=["zip","7z","rar"],i=["mp3","wav","wma"],r=["htm","html","js","css","java","asp","aspx","php","cs","json"],n=["xls","xlsx"],o=["png","jpg","jpeg","gif","bmp","ico"],a=["mp4","avi","wmv","mpeg"],s=["pdf"],l=["ppt","pptx"],d=["doc","docx"],u=["txt"],h=e.split("."),c=h[h.length-1],f="file-o";return c&&(c=c.toLowerCase(),t.indexOf(c)>-1?f="file-archive-o":i.indexOf(c)>-1?f="file-audio-o":r.indexOf(c)>-1?f="file-code-o":n.indexOf(c)>-1?f="file-excel-o":o.indexOf(c)>-1?f="file-image-o":a.indexOf(c)>-1?f="file-video-o":s.indexOf(c)>-1?f="file-pdf-o":l.indexOf(c)>-1?f="file-powerpoint-o":d.indexOf(c)>-1?f="file-word-o":u.indexOf(c)>-1&&(f="file-text-o")),f}function s(e,t){this.init()}function l(i,n){var o=t.data(document.getElementById(r),B);if(!o)return void e.logError("组件未初始化或已被销毁",FRAME_NAME+"."+$,!0);var a=Array.prototype.slice.call(arguments,1);return"function"==typeof o[i]?o[i].apply(o,a):void e.logWarn("组件中不存在 "+i+"() 方法",FRAME_NAME+"."+$,!0)}function d(e,i){var n=t.data(document.getElementById(r),B);return l("on",e,i),n}function u(e,i){var n=t.data(document.getElementById(r),B);return l("off",e,i),n}function h(e){return l("get",e)}function c(e){return l("getFilesWithStatus",e)}function f(){return l("selectFile")}function p(e){return l("addFilesPreview",e)}function m(){return l("upload")}function g(e,t){return l("cancel",e,t)}function v(e,t){return l("remove",e,t)}function b(){return l("disabled")}function y(){return l("enabled")}function x(){return l("readonly")}function w(){return l("readwrite")}function S(e){return l("option",e)}function N(){return l("empty")}function C(){return l("widget")}function E(){return l("destroy")}function _(){return l("component")}function T(i){return t.data(document.getElementById(r),B)?i&&e.isJson(i)?l("option",i):void 0:void t("#"+r)[A](i)}var A="uiFile",B="plugin_"+A,$="file";if(e.logMethodCalled({className:FRAME_NAME,methodName:$,isDebug:!0,id:r}),!e.checkIsLoadPlugins($))return!1;if(!t("#"+r).exist())return e.logError("【"+$+"】当前页面不存在 ID 为"+r+" 的DOM节点",FRAME_NAME+"."+$,!0),!1;var M=["addedfile","uploading","success","error","complete","canceled"],F={url:"",data:{},otherParam:{},method:"post",maxNumber:!1,name:"filePath",acceptedFiles:null,maxFilesize:256,isCreateImageThumbnails:!0,isAutoProcessQueue:!0,isAddRemoveLinks:!0,isAddUploadLinks:!0,TestTags:!1,conMinWidth:"auto",conMinHeight:"auto",thumbnailWidth:100,thumbnailHeight:100,flashUrl:e.uploadFlashUrl,buttonSetting:{imageUrl:e.FRAME_PATH+"/themes/images/add_button.png",falshImageSuffix:"_falsh",width:102,height:102},headers:{},jsonReader:{root:"rows",isSuccess:"success",message:"message",fileName:"fileName",filePath:"filePath",fileUrl:"fileUrl"},downloadUrl:"",downloadServiceParams:{},subPath:"",isRename:!0,onAddedFile:e.CONSTANTS.EMPTYFUNC,onMaxFilesReached:e.CONSTANTS.EMPTYFUNC,onRemovedFile:e.CONSTANTS.EMPTYFUNC,onCancelFile:e.CONSTANTS.EMPTYFUNC,onSuccess:e.CONSTANTS.EMPTYFUNC,onFail:e.CONSTANTS.EMPTYFUNC},I={containerTmp:'<div wui-widget="file" class="wui-file-container"></div>',parallelUploads:100,uploadMultiple:!1,maxThumbnailFilesize:10,previewTemplate:o(!0),paramName:"file",clickable:".file-add-icon",filesizeBase:1e3,minThumbnailHeight:40,minThumbnailWidth:40,postfix:"_file"};return t.extend(!0,I,e.language.file),s.prototype={constructor:s,init:function(){this.pluginName=$,this.element=r,this.$element=t("#"+r),this.defaults=I,this.inputSelectorId=null,this.fileSelectorId=null,this.hasDom=!1,this.initDom=this.$element.prop("outerHTML"),this.defaults.clickable="#"+this.element+" "+this.defaults.clickable;var i=e.getAttributeParams(this.$element,F);this._opt=t.extend(!0,{},F,n,i),this.isSupport=e.CONSTANTS.ISSUPPORTH5,this._file=null,this.files=[],this.filesFormMethod=[],this.queuedFiles=[],this.successFiles=[],this.errorFiles=[],this.uploadNext=!1,this.clickBoxTmp='<div class="dz-message">    <a javascript:void(0); class="file-add-icon perview-a">          <img src="'+this._opt.buttonSetting.imageUrl+'" />    </a></div>',this.$Maxcontainer=null,this.$viewBox=null,this.previewsContainer=null,this.$clickBoxView=null,this.listeners=[],this.handlers={},this._formatParams(),this.dom=this._buildContainer()},_initFileInfo:function(i){var r=this,n=this._opt,o={accepted:!0,isAddFormMethod:!0,fileName:"",filePath:"",fileUrl:"",height:0,id:"",lastModified:Date.parse(new Date),lastModifiedDate:new Date,name:"",previewElement:null,previewTemplate:null,processing:!0,size:0,status:"success",type:"",upload:{progress:100,total:0,bytesSent:0},webkitRelativePath:"",width:0};return i=t.extend(!0,{},o,i),!i.filePath&&i.src&&(i.filePath=i.src),i.id||(i.id=e.guid()),""!=i.name&&""==i.fileName?i.fileName=i.name:""!=i.fileName&&""==i.name&&(i.name=i.fileName),parseInt(i.size)>0&&(i.upload.total=parseInt(i.size),i.upload.bytesSent=parseInt(i.size)),i.previewElement||(i.previewElement=r._createElement(r.defaults.previewTemplate),i.previewTemplate=i.previewElement),n.isCreateImageThumbnails&&i.type.match(/image.*/)&&t(i.previewElement).addClass("dz-image-preview"),i},_formatParams:function(){var t=this._opt;this._opt.maxNumber=e.formatMaxNumber(t.maxNumber),t.TestTags&&(this.defaults.previewTemplate=o(!1),this.$viewBox.addClass("hide-prev"))},_buildContainer:function(){var i=this,r=(this._opt,this.$element);if(!r.parent().hasClass("wui-file")){var n='<div class="wui-file"></div>';r.wrap(n)}this.$Maxcontainer=r.parent(),this.$Maxcontainer.attr("_fileId",this.element),"INPUT"===r[0].tagName?(this.inputSelectorId=this.element,this.fileSelectorId=this.element+this.defaults.postfix,this.$element.hide(),this.$element.after('<div id="'+this.fileSelectorId+'"></div>')):"DIV"===r[0].tagName&&(this.inputSelectorId=this.element+this.defaults.postfix,this.fileSelectorId=this.element,this.$element.before('<input type="text" wui-widget-hidden="true" style="display:none" id="'+this.inputSelectorId+'" name="'+this.inputSelectorId+'" />')),r.attr(e.validateAttributeField)&&t("#"+this.inputSelectorId).attr(e.validateAttributeField,r.attr(e.validateAttributeField)),r.attr("required")&&t("#"+this.inputSelectorId).attr("required",!0),this.$viewBox=t("#"+this.fileSelectorId),this.previewsContainer=document.getElementById(this.fileSelectorId),this.$viewBox.hasClass("dropzone")||this.$viewBox.addClass("dropzone"),this.$viewBox.hasClass("wui-file-icon")||this.$viewBox.addClass("wui-file-icon"),this.$viewBox.find(".dz-message")&&this.$viewBox.find(".dz-message").length>0?this.$clickBoxView=this.$viewBox.find(".dz-message").eq(0):(this.$clickBoxView=t(i._createElement(i.clickBoxTmp)),this.$viewBox.append(this.$clickBoxView)),i._initSize();var o=e.guid();return this.$clickBoxView.attr("id",o),i._initWidget(),this.$element.attr("ui-type",i.pluginName),t("#"+this.inputSelectorId).attr("ui-type",i.pluginName),this.hasDom=!0,this.$viewBox.prop("outerHTML")},_initWidget:function(){var i=this,r=this._opt,n=(this.$element,r.url);if(""==n)return e.logError("url不能为空",FRAME_NAME+"."+$,!0),!1;var o,a=this.$clickBoxView.attr("id"),s={subPath:r.subPath,isRename:r.isRename};if(e.isEmptyType(r.data)||(o=t.extend(!0,{},r.data,r.jsonReader)),s=t.extend(!0,s,r.otherParam),n=e.buildUrl(n,s),this.isSupport){Dropzone.autoDiscover=!1;var l={url:n,method:r.method,maxFiles:r.maxNumber!==!1?r.maxNumber:null,acceptedFiles:r.acceptedFiles,maxFilesize:r.maxFilesize,createImageThumbnails:r.isCreateImageThumbnails,autoProcessQueue:r.isAutoProcessQueue,addRemoveLinks:r.isAddRemoveLinks,thumbnailWidth:r.thumbnailWidth,thumbnailHeight:r.thumbnailHeight,clickable:this.defaults.clickable,parallelUploads:this.defaults.parallelUploads,uploadMultiple:this.defaults.uploadMultiple,maxThumbnailFilesize:this.defaults.maxThumbnailFilesize,previewTemplate:this.defaults.previewTemplate,paramName:this.defaults.paramName,params:o,filesizeBase:this.defaults.filesizeBase,headers:r.headers,dictDefaultMessage:this.defaults.dictDefaultMessage,dictFallbackMessage:this.defaults.dictFallbackMessage,dictFallbackText:this.defaults.dictFallbackText,dictFileTooBig:this.defaults.dictFileTooBig,dictInvalidFileType:this.defaults.dictInvalidFileType,dictResponseError:this.defaults.dictResponseError,dictCancelUpload:this.defaults.dictCancelUpload,dictUploadCanceled:this.defaults.dictUploadCanceled,dictCancelUploadConfirmation:this.defaults.dictCancelUploadConfirmation,dictRemoveFile:this.defaults.dictRemoveFile,dictUploadFile:this.defaults.dictUploadFile,dictMaxFilesExceeded:this.defaults.dictMaxFilesExceeded};this._file=new Dropzone(this.previewsContainer,l),this._initDropzoneEvent()}else{null==r.acceptedFiles?(r.acceptedFiles="*.*",r.file_types_description="All Files"):(r.acceptedFiles=r.acceptedFiles.replace(/\./g,"*.").replace(/,/g,";"),r.file_types_description=r.acceptedFiles),"post"==r.method.toLowerCase()?r.use_query_string=!1:r.use_query_string=!0,0==parseInt(r.maxFilesize)?r.file_size_limit=0:r.file_size_limit=parseInt(r.maxFilesize)+"MB";var d=r.buttonSetting,u=d.imageUrl,h=u.lastIndexOf("."),c=u.insert(d.falshImageSuffix,h),f=parseInt(d.width)-2,p=parseInt(d.height)-2,l={upload_url:n,flash_url:r.flashUrl,file_post_name:this.defaults.paramName,use_query_string:r.use_query_string,post_params:o,prevent_swf_caching:!0,file_types:r.acceptedFiles,file_types_description:r.file_types_description,file_size_limit:r.file_size_limit,file_upload_limit:r.maxNumber===!1?100:r.maxNumber,file_queue_limit:100,button_placeholder_id:a,button_text:"",button_text_style:"color: #000000; font-size: 16pt;",button_text_left_padding:0,button_text_top_padding:0,button_image_url:c,button_width:f,button_height:p,button_action:SWFUpload.BUTTON_ACTION.SELECT_FILES,button_disabled:!1,button_cursor:SWFUpload.CURSOR.HAND,button_window_mode:SWFUpload.WINDOW_MODE.TRANSPARENT,swfupload_load_failed_handler:function(){},swfupload_loaded_handler:function(){},file_dialog_start_handler:function(e){},file_queued_handler:function(e){i._addedFileEvent(e)},file_queue_error_handler:function(e,t,i){var r={"-100":"用户入队过多，超过队列最大长度","-110":"超过了所限制的文件大小","-120":"选择的文件是0字节的","-130":"选择的文件扩展名与允许不符"};wui.errorNotice(r[t.toString()])},file_dialog_complete_handler:function(e,t,i){},upload_start_handler:function(e){},upload_progress_handler:function(e,t,r){i._progress(e,t,r)},upload_error_handler:function(e,t,r){i._error(e,r,t)},upload_success_handler:function(e,t,r){i._success(e,t,r)},upload_complete_handler:function(e){i._complete(e)},debug_handler:function(){},debug:!0,custom_settings:{}};this._file=new SWFUpload(l)}},_addedFileEvent:function(i){var r=this,n=this._opt;if(r.isSupport){var o,s,l,d,u,h=this._file;if(i.id||(i.id=e.guid()),i.previewElement){if(t(i.previewElement).attr("fileId",i.id),i.type.match(/image.*/)){if(!n.isCreateImageThumbnails){var c=a(i.name);for(d=i.previewElement.querySelectorAll("[data-dz-thumbnail]"),s=0,l=d.length;s<l;s++){o=d[s];var f=t('<i class="fa fa-'+c+' prev-icon"></i>');f.css("font-size",n.thumbnailHeight-30+"px"),t(o).after(f)}}}else{var c=a(i.name);for(d=i.previewElement.querySelectorAll("[data-dz-thumbnail]"),s=0,l=d.length;s<l;s++){o=d[s];var f=t('<i class="fa fa-'+c+' prev-icon"></i>');f.css("font-size",n.thumbnailHeight-30+"px"),t(o).after(f)}}for(n.isAddUploadLinks&&(i._uploadLink=Dropzone.createElement('<a class="dz-upload-link" href="javascript:void(0);" data-dz-upload>'+r.defaults.dictUploadFile+"</a>"),i.previewElement.appendChild(i._uploadLink),t(i._uploadLink).on("click",function(){h.processFile(i)})),n.isEnableDownload&&(i._downloadLink=Dropzone.createElement('<a class="dz-download-link" href="javascript:void(0);" data-dz-download>'+r.defaults.dictDownloadFile+"</a>"),i.previewElement.appendChild(i._downloadLink),t(i._downloadLink).on("click",function(){n.onDownloadFile&&"function"==typeof n.onDownloadFile&&n.onDownloadFile(i,"downloadFile"),r._downloadFile(i)})),u=i.previewElement.querySelectorAll(".dz-image"),s=0,l=u.length;s<l;s++)dzImageElement=u[s],dzImageElement.style.width=n.thumbnailWidth-2+"px",dzImageElement.style.height=n.thumbnailHeight-2+"px"}}else{if(n.maxNumber!==!1){if(r.files.length>=n.maxNumber)return r._maxFilesReached(i),!1;r.files.length+1==n.maxNumber&&r.$viewBox.addClass("dz-max-files-reached")}var s,l,d,u;if(r.$viewBox.hasClass("dz-started")||r.$viewBox.addClass("dz-started"),r.previewsContainer){i.previewElement=r._createElement(r.defaults.previewTemplate),i.previewTemplate=i.previewElement,t(i.previewElement).attr("fileId",i.id);var p=r.previewsContainer.children.length;r.previewsContainer.insertBefore(i.previewElement,r.previewsContainer.children[p-1]),t(i.previewElement).find("[data-dz-name]").each(function(e,n){t(n).html(r._renameFilename(i.name))}),t(i.previewElement).find("[data-dz-size]").each(function(e,n){t(n).html(r._filesize(i.size))}),t(i.previewElement).find(".dz-image").each(function(e,i){t(i).css({width:n.thumbnailWidth-2+"px",height:n.thumbnailHeight-2+"px"})}),r._addFileAction(i);var c=a(i.name);t(i.previewElement).find("[data-dz-thumbnail]").each(function(e,i){var r=t('<i class="fa fa-'+c+' prev-icon"></i>');r.css("font-size",n.thumbnailHeight-30+"px"),t(i).after(r)})}n.isAutoProcessQueue&&r._file.startUpload(i.id)}r.files.push(i),this._resize(),n.onAddedFile&&"function"==typeof n.onAddedFile&&n.onAddedFile(i,"addedFile"),r.listeners.indexOf("addedfile")>-1&&!r.emit({type:"addedfile",target:r.$element,file:i})},_maxFilesReached:function(e){var t=this,i=this._opt;t.$viewBox.addClass("dz-max-files-reached"),i.onMaxFilesReached&&"function"==typeof i.onMaxFilesReached&&i.onMaxFilesReached(e,"maxFilesReached"),t.listeners.indexOf("maxfilesreached")>-1&&!t.emit({type:"maxfilesreached",target:t.dom,file:e})},_error:function(e,i,r){var n=this,o=this._opt,a=null;if(n.isSupport){var s,l,d,u,h;if(e.previewElement)for(e.previewElement.classList.add("dz-error"),"String"!=typeof i&&i.error&&(i=i.error),u=e.previewElement.querySelectorAll("[data-dz-errormessage]"),h=[],l=0,d=u.length;l<d;l++)s=u[l],h.push(s.textContent=i);a=e}else{if(r==-240)return n._maxFilesReached(e),!1;for(var c=e.id,f=n.files,p=-1,m=0,d=f.length;m<d;m++){var g=f[m];if(c==g.id){g.filestatus=e.filestatus,a=g,p=m;break}}if(null!=a){var s,l,d,u,h;if(a.previewElement)for(t(a.previewElement).addClass("dz-error"),"String"!=typeof i&&i.error&&(i=i.error),u=a.previewElement.querySelectorAll("[data-dz-errormessage]"),l=0,d=u.length;l<d;l++)s=u[l],s.innerHTML=i}}o.onFail&&"function"==typeof o.onFail&&o.onFail(a,i),n.listeners.indexOf("error")>-1&&!n.emit({type:"error",target:n.$element,file:a,code:r,message:i})},_success:function(i,r,n){var o=this,a=this._opt,s=null,l=t.extend(!0,{},a.jsonReader),d=l.root,u=l.message,h=l.isSuccess;if(delete l.root,delete l.message,delete l.isSuccess,e.isEmptyType(r))return!1;var c,f=e.parseToObj(r);if(f||(f=r),e.isEmptyType(d))c=f;else if(c=f[d],!e.isEmptyType(h)&&!f[h])return this._error(i,f[u],-1),!1;if(e.isEmptyType(c))return!1;if(o.isSupport){if(i.previewElement&&i.previewElement.classList.add("dz-success"),s=i,e.isArray(c))for(var p=0;p<c.length;p++){var m=c[p];s.data=m;for(var g in l)s[l[g]]=m[l[g]]}else if(e.isJson(c)){s.data=c;for(var g in l)s[l[g]]=c[l[g]]}if(i._downloadLink){var v=a.jsonReader.fileUrl,b=(a.jsonReader.fileName,"javascript:void(0);");v&&i[v]&&(b=a.downloadHostAddress?a.downloadHostAddress+i[v]:i[v],i._downloadLink.setAttribute("_href",b))}}else{for(var y=i.id,x=o.files,w=-1,p=0,S=x.length;p<S;p++){var N=x[p];if(y==N.id){N.filestatus=i.filestatus,s=N,w=p;break}}if(null!=s){if(s.previewElement&&t(s.previewElement).addClass("dz-success"),e.isArray(c))for(var p=0;p<c.length;p++){var m=c[p];s.data=m;for(var g in l)s[l[g]]=m[l[g]]}else if(e.isJson(c)){s.data=c;for(var g in l)s[l[g]]=c[l[g]]}if(i._downloadLink){var v=a.jsonReader.fileUrl,b="javascript:void(0);";v&&i[v]&&(b=a.downloadHostAddress?a.downloadHostAddress+i[v]:i[v]),i._downloadLink.setAttribute("_href",b)}}t(s.previewElement).addClass("dz-processing-success-show"),e.setTimeout(function(){t(s.previewElement).removeClass("dz-processing-success-show")},800)}a.onSuccess&&"function"==typeof a.onSuccess&&a.onSuccess(s,f,c),o.listeners.indexOf("success")>-1&&!o.emit({type:"success",target:o.$element,file:s,data:f,response:n,results:c})},_downloadFile:function(t){var i=this._opt,r={filePath:t.filePath,fileName:t.fileName};e.getAjax({url:e.buildUrl(i.downloadUrl,r),data:i.downloadServiceParams,onSuccess:function(e){},onError:function(e){}})},_removeFile:function(i){var r=this,n=this._opt;if(this.files=r._without(r.files,i),this.filesFormMethod=r._without(r.filesFormMethod,i),i.isAddFormMethod)t(i.previewElement).remove(),n.maxNumber!==!1&&r.files.length<=n.maxNumber&&r.$viewBox.removeClass("dz-max-files-reached");else if(r.isSupport)n.maxNumber!==!1&&r.files.length<=n.maxNumber&&r.$viewBox.removeClass("dz-max-files-reached");else{if(i.filestatus==e.CONSTANTS.FILE_STATUS.QUEUED)r._file.cancelUpload(i.id,!1);else if(i.filestatus==e.CONSTANTS.FILE_STATUS.PROCESSING)r._file.stopUpload(i.id,!1),r._file.cancelUpload(i.id,!1);else if(i.filestatus==e.CONSTANTS.FILE_STATUS.SUCCESS){var o=r._file.getStats().successful_uploads;r._file.setStats({successful_uploads:o-1})}else if(i.filestatus==e.CONSTANTS.FILE_STATUS.ERROR){var a=r._file.getStats().upload_errors;r._file.setStats({upload_errors:a-1}),r._file.cancelUpload(i.id,!1)}else r._file.cancelUpload(i.id,!1);t(i.previewElement).remove(),"number"==typeof n.maxNumber&&r.files.length<=n.maxNumber&&r.$viewBox.removeClass("dz-max-files-reached")}if(r._resize(),n.onRemovedFile&&"function"==typeof n.onRemovedFile&&n.onRemovedFile(i,"remove"),!(r.listeners.indexOf("removedfile")>-1)||r.emit({type:"removedfile",target:r.dom,file:i}))return 0===r.files.length?r.reset():void 0},_initSize:function(){var e=this._opt,i=e.buttonSetting;return"auto"!=e.conMinWidth&&(this.$viewBox.width(e.conMinWidth),this.$viewBox.addClass("wui-dz-init")),"auto"!=e.conMinHeight&&(this.$viewBox.height(e.conMinHeight),this.$viewBox.css({"min-height":parseInt(e.conMinHeight)+"px"}),this.$viewBox.addClass("wui-dz-init")),this.$viewBox.find(".file-add-icon").each(function(e,r){t(r).width(i.width),t(r).height(i.height)}),!0;var i},_resize:function(){return!1},_progress:function(e,i,r){var n=this,o=(this._opt,null);if(n.isSupport)o=e;else{for(var a=e.id,s=n.files,l=-1,d=0,u=s.length;d<u;d++){var h=s[d];if(a==h.id){h.filestatus=e.filestatus,o=h,l=d;break}}if(null!=o){var u;if(o.previewElement){if(t(o.previewElement).hasClass("dz-processing")||t(o.previewElement).addClass("dz-processing"),e._removeLink)return o._removeLink.htmlContent=n.defaults.dictCancelUpload;var c=100*i/r;t(o.previewElement).find("[data-dz-uploadprogress]").eq(0).css("width",c+"%")}}}n.listeners.indexOf("uploading")>-1&&!n.emit({type:"uploading",target:n.$element,file:o,completeBytes:i,totalBytes:r})},_complete:function(i){var r=this,n=this._opt,o=null;if(r.isSupport)i._removeLink&&(i._removeLink.htmlContent=r.defaults.dictRemoveFile),i.previewElement&&i.previewElement.classList.add("dz-complete"),o=i;else{for(var a=i.id,s=r.files,l=-1,d=0,u=s.length;d<u;d++){var h=s[d];if(a==h.id){h.filestatus=i.filestatus,o=h,l=d;break}}null!=o&&(o._removeLink&&(o._removeLink.htmlContent=r.defaults.dictRemoveFile),o.previewElement&&t(o.previewElement).addClass("dz-complete"));var c=r._getFilesWithStatus(e.CONSTANTS.FILE_STATUS.QUEUED);0==c.length&&(r.uploadNext=!1),(n.isAutoProcessQueue||r.uploadNext)&&r._file.startUpload()}t(o._removeLink).on("click",function(){r._removeFile(o)});var f=t("#"+r.inputSelectorId).get(0);f.form&&t.data(f.form,"validator")&&!e.isEmptyType(t("#"+r.inputSelectorId).rules())&&e.validElement(t("#"+r.inputSelectorId)),r.listeners.indexOf("complete")>-1&&!r.emit({type:"complete",target:r.$element,file:o})},_initDropzoneEvent:function(){var e=this._file,t=this._opt,i=this;e.on("init",function(e){i.listeners.indexOf("init")>-1&&!i.emit({type:"init",target:i.dom,file:e})}),e.on("sending",function(e,t,r){i.listeners.indexOf("sending")>-1&&!i.emit({type:"sending",target:i.dom,file:e})}),e.on("addedfile",function(e){i._addedFileEvent(e)}),e.on("removedfile",function(e){return i._removeFile(e),this._updateMaxFilesReachedClass()}),e.on("maxfilesreached",function(e){i._maxFilesReached(e)}),e.on("maxfilesexceeded",function(e){i.listeners.indexOf("maxfilesexceeded")>-1&&!i.emit({type:"maxfilesexceeded",target:i.dom,file:e})}),e.on("uploadprogress",function(e,t,r){i._progress(e,t,r)}),e.on("canceled",function(e,i){t.onCancelFile&&"function"==typeof t.onCancelFile&&t.onCancelFile(e,i,"cancelFile")}),e.on("success",function(e,t,r){i._success(e,t,r)}),e.on("error",function(e,t){i._error(e,t)}),e.on("complete",function(e){i._complete(e)})},_createElement:function(e){var t;return t=document.createElement("div"),t.innerHTML=e,t.childNodes[0]},_without:function(e,t){var i,r,n,o;for(o=[],r=0,n=e.length;r<n;r++)i=e[r],i!==t&&o.push(i);return o},_renameFilename:function(e){return"function"!=typeof this._opt.renameFilename?e:this._opt.renameFilename(e)},_filesize:function(e){var t,i,r,n,o,a,s,l;if(r=0,n="b","string"==typeof e)return e=e.split(" "),e.length>1&&""!=e[1]&&(n=e[1]),"<strong>"+e[0]+"</strong> "+n;if("number"==typeof e){if(e>0){for(a=["TB","GB","MB","KB","b"],i=s=0,l=a.length;s<l;i=++s)if(o=a[i],t=Math.pow(this.defaults.filesizeBase,4-i)/10,e>=t){r=e/Math.pow(this.defaults.filesizeBase,4-i),n=o;break}r=Math.round(10*r)/10}return"<strong>"+r+"</strong> "+n}},_addFileAction:function(i){var r=this,n=this._opt;if(n.isAutoProcessQueue||n.isAddUploadLinks&&(i._uploadLink=r._createElement('<a class="dz-upload-link" href="javascript:void(0);" data-dz-upload>'+r.defaults.dictUploadFile+"</a>"),i.previewElement.appendChild(i._uploadLink),t(i._uploadLink).on("click",function(t){e.stopPropagation(t),r._file.startUpload(i.id)})),n.isAddRemoveLinks&&(i._removeLink=r._createElement('<a class="dz-remove" href="javascript:undefined;" data-dz-remove>'+r.defaults.dictCancelUpload+"</a>"),i.previewElement.appendChild(i._removeLink),t(i._removeLink).on("click",function(t){e.stopPropagation(t),r._removeFile(i)})),n.isEnableDownload){n.jsonReader.fileUrl;i._downloadLink=r._createElement('<a class="dz-download-link" href="javascript:void(0)" data-dz-download>'+r.defaults.dictDownloadFile+"</a>"),i.previewElement.appendChild(i._downloadLink),t(i._downloadLink).on("click",function(){n.onDownloadFile&&"function"==typeof n.onDownloadFile&&n.onDownloadFile(i,"downloadFile"),r._downloadFile(i)})}},addFilePreview:function(i,r){var n=this,o=this._opt;if(o.maxNumber!==!1&&n.files.length>=o.maxNumber)return n._maxFilesReached(n.files),!1;r=r||!1;var s,l,d,u,h,c,f,p;if(n.$viewBox.hasClass("dz-started")||n.$viewBox.addClass("dz-started"),n.$viewBox){for(r&&(i=n._initFileInfo(i),t(i.previewElement).addClass("dz-processing dz-success dz-complete"),t(i.previewElement).attr("fileId",i.id)),n.$clickBoxView.before(i.previewElement),c=i.previewElement.querySelectorAll("[data-dz-name]"),l=0,u=c.length;l<u;l++)s=c[l],s.textContent=n._renameFilename(i.name);for(f=i.previewElement.querySelectorAll("[data-dz-size]"),d=0,h=f.length;d<h;d++)s=f[d],s.innerHTML=n._filesize(i.size);for(p=i.previewElement.querySelectorAll(".dz-image"),l=0,u=p.length;l<u;l++)dzImageElement=p[l],dzImageElement.style.width=o.thumbnailWidth-2+"px",dzImageElement.style.height=o.thumbnailHeight-2+"px";if(r&&(o.isAutoProcessQueue||n._opt.isAddUploadLinks&&(i._uploadLink=n._createElement('<a class="dz-upload" href="javascript:void(0);" data-dz-upload>'+n.defaults.dictUploadFile+"</a>"),i.previewElement.appendChild(i._uploadLink),t(i._uploadLink).on("click",function(t){e.stopPropagation(t),n._file.startUpload(i.id)}))),n._opt.isAddRemoveLinks&&(i._removeLink=n._createElement('<a class="dz-remove" href="javascript:undefined;" data-dz-remove>'+n.defaults.dictRemoveFile+"</a>"),i.previewElement.appendChild(i._removeLink),t(i._removeLink).on("click",function(t){e.stopPropagation(t),n._removeFile(i)})),o.isCreateImageThumbnails&&i.type&&i.type.match(/image.*/)&&parseInt(i.size)<=1024*o.maxFilesize*1024)for(c=i.previewElement.querySelectorAll("[data-dz-thumbnail]"),l=0,u=c.length;l<u;l++)thumbnailElement=c[l],thumbnailElement.src=i.src;else{var m=a(i.name);for(c=i.previewElement.querySelectorAll("[data-dz-thumbnail]"),l=0,u=c.length;l<u;l++){thumbnailElement=c[l];var g=t('<i class="fa fa-'+m+' prev-icon"></i>');g.css("font-size",o.thumbnailHeight-30+"px"),t(thumbnailElement).after(g)}}}return this.files.push(i),o.maxNumber!==!1&&n.files.length>=o.maxNumber&&n.$viewBox.addClass("dz-max-files-reached"),i},addFilesPreview:function(t){var i=this,r=(this._opt,!0),n=[];if(i.$viewBox.hasClass("dz-started")||i.$viewBox.addClass("dz-started"),i.previewsContainer)if(e.isArray(t))for(var o=0;o<t.length;o++){var a=t[o],s=i.addFilePreview(a,r);s&&(this.filesFormMethod.push(s),n.push(s))}else if(e.isJson(t)){var s=i.addFilePreview(t,r);s&&(this.filesFormMethod.push(s),n.push(s))}return n},selectFile:function(){this.isSupport?this._file.hiddenFileInput.click():e.logMessage("SWF上传不兼容弹出选择框事件","wui.file",!0)},upload:function(){this.isSupport?this._file.processQueue():(this.uploadNext=!0,this._file.startUpload())},cancel:function(r,n){var o=[],a=[];
this._opt;if(o=this.isSupport?this._file.getAcceptedFiles():this.files,r){n==i&&(n="name");for(var s=0,l=o.length;s<l;s++){var d=o[s];if(r==d[n]){a.push(d);break}}}else e.logMessage("传入的文件名为空","wui.file",!0),a=o;if(0==a.length)return e.logMessage("无可取消的文件","wui.file",!0),!1;if(this.isSupport)for(var s=0,l=a.length;s<l;s++)this._file.cancelUpload(a[s]);else for(var s=0,l=a.length;s<l;s++){var u=a[s],h=u.filestatus;if(h==e.CONSTANTS.FILE_STATUS.QUEUED)this._file.cancelUpload(u.id,!1);else{if(h!=e.CONSTANTS.FILE_STATUS.PROCESSING)continue;this._file.stopUpload(),this._file.cancelUpload(u.id,!1)}null!=u&&(u._removeLink&&(u._removeLink.htmlContent=this.defaults.dictRemoveFile),u.previewElement&&t(u.previewElement).addClass("dz-complete"))}return o},remove:function(t,r){var n=[],o=[];this._opt;if(this.isSupport){n=this._file.getAcceptedFiles();for(var a=0;a<this.filesFormMethod.length;a++){var s=this.filesFormMethod[a];n.push(s)}}else n=this.files;if(t){r==i&&(r="name");for(var a=0,l=n.length;a<l;a++){var d=n[a];if(t==d[r]){o.push(d);break}}}else e.logMessage("传入的文件字段为空","wui.file",!0),o=n;if(0==o.length)return e.logMessage("remove:无可取消的文件","wui.file",!0),!1;if(this.isSupport)for(var a=0,l=o.length;a<l;a++)this._file.removeFile(o[a]);else for(var a=0,l=o.length;a<l;a++){var u=o[a];this._removeFile(u)}return n},disabled:function(){for(var e=0;e<this.files.length;e++){var i=this.files[e];i._removeLink&&(i._removeLink.disabled=!0),i._uploadLink&&(i._uploadLink.disabled=!0),i._editLink&&(i._editLink.disabled=!0)}this.isSupport?this._file.disable():(this._file.setButtonDisabled(!0),this._file.setButtonCursor(SWFUpload.CURSOR.ARROW)),this.$viewBox.find(".file-add-icon").each(function(){t(this).addClass("disabled")})},enabled:function(){for(var e=0;e<this.files.length;e++){var i=this.files[e];i._removeLink&&(i._removeLink.disabled=!0),i._uploadLink&&(i._uploadLink.disabled=!0),i._editLink&&(i._editLink.disabled=!0)}this.isSupport?this._file.enable():(this._file.setButtonDisabled(!1),this._file.setButtonCursor(SWFUpload.CURSOR.HAND)),this.$viewBox.find(".file-add-icon").each(function(){t(this).removeClass("disabled")})},readonly:function(){for(var e=0;e<this.files.length;e++){var i=this.files[e];i._removeLink&&(i._removeLink.disabled=!0),i._uploadLink&&(i._uploadLink.disabled=!0),i._editLink&&(i._editLink.disabled=!0)}this.isSupport?this._file.disable():(this._file.setButtonDisabled(!0),this._file.setButtonCursor(SWFUpload.CURSOR.ARROW)),this.$viewBox.find(".file-add-icon").each(function(){t(this).addClass("disabled")})},readwrite:function(){for(var e=0;e<this.files.length;e++){var i=this.files[e];i._removeLink&&(i._removeLink.disabled=!0),i._uploadLink&&(i._uploadLink.disabled=!0),i._editLink&&(i._editLink.disabled=!0)}this.isSupport?this._file.enable():(this._file.setButtonDisabled(!1),this._file.setButtonCursor(SWFUpload.CURSOR.HAND)),this.$viewBox.find(".file-add-icon").each(function(){t(this).removeClass("disabled")})},get:function(t){var i=this,r=this._opt,n=r.name,o=e.deepCopy(r.jsonReader);delete o.root,t=t||"";var a=i.getFilesWithStatus("success"),s=[];n||(t="json");for(var l=0;l<a.length;l++){var d=a[l];if(""==t)s.push(d);else if("json"==t){var u={};u.id=d.id;for(var h in o)u[o[h]]=d[o[h]];s.push(u)}else"value"==t&&d[n]&&s.push(d[n])}return s},getFilesWithStatus:function(t){t=t||"all";var i=[];return i=this.isSupport?"queue"==t.toLowerCase()?this._file.getQueuedFiles():"success"==t.toLowerCase()?this._file.getFilesWithStatus(e.CONSTANTS.FILE_STATUS.SUCCESS):"error"==t.toLowerCase()?this._file.getFilesWithStatus(e.CONSTANTS.FILE_STATUS.ERROR):"uploading"==t.toLowerCase()?this._file.getUploadingFiles():"canceled"==t.toLowerCase()?this._file.getFilesWithStatus(e.CONSTANTS.FILE_STATUS.CANCELED):this._file.getAcceptedFiles():"queue"==t.toLowerCase()?this._getFilesWithStatus(e.CONSTANTS.FILE_STATUS.QUEUED):"success"==t.toLowerCase()?this._getFilesWithStatus(e.CONSTANTS.FILE_STATUS.SUCCESS):"error"==t.toLowerCase()?this._getFilesWithStatus(e.CONSTANTS.FILE_STATUS.ERROR):"uploading"==t.toLowerCase()?this._getFilesWithStatus(e.CONSTANTS.FILE_STATUS.PROCESSING):"canceled"==t.toLowerCase()?this.getFilesWithStatus(e.CONSTANTS.FILE_STATUS.CANCELED):this.files},_getFilesWithStatus:function(e){var t,i,r,n,o;for(n=this.files,o=[],i=0,r=n.length;i<r;i++)t=n[i],t.filestatus===e&&o.push(t);return o},option:function(t){var r=this._opt;if(!t)return r;if("object"==typeof t)this._reoption(t);else if("string"==typeof t)return"getDefOpt"===t?F:r[t]==i?e.logWarn("查找的属性值不存在",FRAME_NAME+"."+$,!0):r[t]},setUploadUrl:function(t){t||(t=this._opt.url),e.isEmptyType(this._opt.otherParam)||(t=e.buildUrl(t,this._opt.otherParam)),this.isSupport?this._file.options.url=t:this._file.setUploadURL(t)},setPostParams:function(e){this.isSupport?this._file.options.params=e:this._file.setPostParams(e)},setFileTypes:function(e,i){this.isSupport?(this._file.options.acceptedFiles=e,this._file.options.file_types_description=i,null!=e?this._file.hiddenFileInput.setAttribute("accept",e):t(this._file.hiddenFileInput).removeAttr("accept")):(null==e?(e="*.*",i=i?i:"All Files"):(e=e.replace(/\./g,"*.").replace(/,/g,";"),i=i?i:e),this._file.setFileTypes(e,i))},setFileSizeLimit:function(e){this.isSupport?(e?"string"==typeof e&&(e.toLowerCase().endWith("mb")?e=parseFloat(e):e.toLowerCase().endWith("kb")?(e=parseFloat(e),e=Math.ceil(1e4*e/1024)/1e4):e.toLowerCase().endWith("gb")?(e=parseFloat(e),e=1024*e):e.toLowerCase().endWith("b")?(e=parseFloat(e),e=Math.ceil(1e4*e*1e4/1024/1024)/1e4/1e4):e=parseFloat(e)):e=0,this._file.options.maxFilesize=e):(e?"nummber"==typeof e&&(e+="MB"):e=0,this._file.setFileSizeLimit(e))},setFileUploadLimit:function(e){this.isSupport?this._file.options.maxFiles=e:this._file.setFileUploadLimit(e)},_reoption:function(e){var t=this._opt,r=!1;e.url!=i&&t.url!=e.url&&(this._opt.url=e.url,r=!0),e.otherParam!=i&&t.otherParam!=e.otherParam&&(this._opt.otherParam=e.otherParam,r=!0),r&&this.setUploadUrl(),e.data!=i&&t.data!=e.data&&(this._opt.data=e.data,this.setPostParams(e.data)),e.acceptedFiles!=i&&t.acceptedFiles!=e.acceptedFiles&&(this._opt.acceptedFiles=e.acceptedFiles,this.setFileTypes(e.acceptedFiles)),e.maxFilesize!=i&&t.maxFilesize!=e.maxFilesize&&(this._opt.maxFilesize=e.maxFilesize,this.setFileSizeLimit(e.maxFilesize)),e.maxNumber!=i&&t.maxNumber!=e.maxNumber&&(this._opt.maxNumber=e.maxNumber,this.setFileUploadLimit(e.maxNumber)),console.info(this)},reset:function(){return this.$viewBox.removeClass("dz-started")},empty:function(){var e=this;if(this.isSupport)this._file.removeAllFiles(!0);else for(var i=this.files.length;i>0;)this._removeFile(this.files[--i]);for(var r=0;r<this.filesFormMethod.length;r++){var n=this.filesFormMethod[r];t(n.previewElement).remove()}return e.$viewBox.removeClass("dz-started dz-max-files-reached"),e.filesFormMethod=[],e.files=[],this},destroy:function(){if(!(this.listeners.indexOf("destroy")>-1)||this.emit({type:"destroy",target:this.dom}))return this._file.destroy(),this.$element.removeAttr("ui-type"),this.$element.removeData(B),this.$viewBox.replaceWith(this.initDom),this},widget:function(){return this._file},on:function(e,t){return M.indexOf(e)>-1&&("undefined"==typeof this.handlers[e]&&(this.handlers[e]=[],this.listeners.push(e)),this.handlers[e].push(t)),this},off:function(e,t){var r,n,o,a,s;if(M.indexOf(e)>-1&&this.handlers[e]instanceof Array){for(a=this.handlers[e],o=this.listeners,r=0,s=o.length;r<s&&o[r]!==e;r++);if(t===i)this.listeners.splice(r,1),delete this.handlers[e];else{for(n=0,s=a.length;n<s&&a[n]!==t;n++);n<s&&(this.handlers[e].splice(n,1),0==this.handlers[e].length&&this.listeners.splice(r,1))}}return this},emit:function(e){if(e.target||(this.$viewBox?e.target=this.$viewBox:e.target=this),this.handlers[e.type]instanceof Array)for(var t=this.handlers[e.type],i=0,r=t.length;i<r;i++)return t[i](e),!0;return!1},component:function(){return this}},t.fn[A]=function(e){return this.each(function(){t.data(document.getElementById(r),B)||t.data(document.getElementById(r),B,new s(this,e))})},T(n),{init:T,on:d,off:u,get:h,getFilesWithStatus:c,addFilesPreview:p,selectFile:f,upload:m,cancel:g,removeFile:v,enabled:y,disabled:b,readwrite:w,readonly:x,option:S,widget:C,component:_,empty:N,destroy:E}},e}(wui||{},libs),function(e,t,i){return e.img=function(r,n){function o(e,t){this.init()}function a(i,n){var o=t.data(document.getElementById(r),S);if(!o)return void e.logError("wui.img 未初始化或已被销毁",FRAME_NAME+"."+N,!0);var a=Array.prototype.slice.call(arguments,1);return"function"==typeof o[i]?o[i].apply(o,a):void e.logWarn("wui.img 中不存在 "+i+"() 方法",FRAME_NAME+"."+N,!0)}function s(e,i){var n=t.data(document.getElementById(r),S);return a("on",e,i),n}function l(e,i){var n=t.data(document.getElementById(r),S);return a("off",e,i),n}function d(e){return a("get",e)}function u(e){return a("addImagesPreview",e)}function h(e){return a("setEdit",e)}function c(){return a("disabled")}function f(){return a("enabled")}function p(){return a("readonly")}function m(){return a("readwrite")}function g(e){return a("option",e)}function v(){return a("empty")}function b(){return a("destroy")}function y(){return a("component")}function x(i){return t.data(document.getElementById(r),S)?i&&e.isJson(i)?a("option",i):void 0:void t("#"+r)[w](i)}var w="uiImage",S="plugin_"+w,N="img";if(e.logMethodCalled({className:FRAME_NAME,methodName:N,isDebug:!0,id:r}),!e.checkIsLoadPlugins(N))return!1;if(!t("#"+r).exist())return e.logError("【"+N+"】当前页面不存在 ID 为"+r+" 的DOM节点",FRAME_NAME+"."+N,!0),!1;var C=["addedfile","uploading","success","error","complete","canceled"],E={url:"",data:{},otherParam:{},method:"post",maxFilesize:256,maxNumber:!1,key:"filePath",isAddRemoveLinks:!0,isAddEditLinks:!0,isEnablePreview:!0,acceptedFiles:"*",conMinWidth:"auto",conMinHeight:"auto",thumbnailWidth:100,thumbnailHeight:100,buttonSetting:{imageUrl:e.FRAME_PATH+"/themes/images/add_button.png",width:102,height:102},editPageUrl:e.commonPageBasePath+"wui.img.edit.html",jsonReader:{root:"rows",isSuccess:"success",message:"message",fileUrl:"fileUrl",fileName:"fileName",filePath:"filePath"},pageHeight:"540px",pageWidth:"600px",pageTitle:"图片编辑",resolutions:"1x1,16x9,25x25",subPath:"",isRename:!0},_={isCreateImageThumbnails:!0,isAddRemoveLinks:!1,isAddUploadLinks:!1,allAcceptedFiles:[".jpg",".gif",".bmp",".jpeg",".png",".ico"],filesizeBase:1e3,isAutoProcessQueue:!0,dictCancelUpload:e.language.img.dictCancelUpload,dictEditFile:e.language.img.dictEditFile,dictRemoveFile:e.language.img.dictRemoveFile,otherParam:{}};return o.prototype={constructor:o,init:function(){this.pluginName=N,this.element=r,this.$element=t("#"+r),this.defaults=_,this.hasDom=!1,this.initDom=this.$element.prop("outerHTML");var i=e.getAttributeParams(this.$element,E);this._opt=t.extend(!0,{},E,n,i),this.isSupport=e.CONSTANTS.ISSUPPORTH5,this.files=[],this._file=null,this.$Maxcontainer=this.$element,this.previewsContainer=document.getElementById(this.element),this.listeners=[],this.handlers={},this._formatParams(),this.dom=this._initDom()},_formatParams:function(){var t=this._opt;this.isSupport||(this._opt.isAddEditLinks=!1),this._opt.maxNumber=e.formatMaxNumber(t.maxNumber)},_addImgAction:function(i){var r=this,n=this._opt;this.$element;if(!i.previewElement)return e.logWarn("传入的img对象没有previewElement属性,所以无法添加操作按钮",FRAME_NAME+"."+N,!0),!1;n.isAddEditLinks&&(i._editLink=r._createElement('<a class="dz-edit" href="javascript:void(0);" data-dz-edit>'+r.defaults.dictEditFile+"</a>"),i.previewElement.appendChild(i._editLink),t(i._editLink).on("click",function(t){e.stopPropagation(t),r.editFile(i)})),r.defaults.isAddRemoveLinks||n.isAddRemoveLinks&&(i._removeLink=r._createElement('<a class="dz-remove" href="javascript:undefined;" data-dz-remove>'+r.defaults.dictRemoveFile+"</a>"),i.previewElement.appendChild(i._removeLink),t(i._removeLink).on("click",function(t){e.stopPropagation(t),r.removeFile(i)})),n.isEnablePreview&&t(i.previewElement).on("click",function(e){e=e||window.event;var t=e.target||e.srcElement,r=t.src?t.parentNode:t,n={index:r,event:e,container:"#blueimp-image-gallery"},o=[{title:i.name,href:i.src,type:i.type}];blueimp.Gallery(o,n)}),_ref1=i.previewElement.querySelectorAll("[data-dz-size]");for(var o=0,a=_ref1.length;o<a;o++){var s=_ref1[o];s.parentNode.removeChild(s)}return i},_initDom:function(){var i=this,r=this._opt,n=this.$element;n.addClass("wui-img-container");var o=t.extend(!0,{},r.jsonReader),a=o.fileUrl,s=o.fileName,l=o.filePath;delete o.fileUrl,delete o.root,delete o.message,delete o.isSuccess,delete o.fileName,delete o.filePath;var d=function(r,n,d){i.files.push(r);var u=function(r,n){var d,u=n[l];d=e.isEmptyType(a)?e.hostAddress+u:n[a],r._name=n[s],r.path=u,r.src=d;for(var h in o)r[o[h]]=n[o[h]];if(r.previewElement){var c=t(r.previewElement).find("[data-dz-thumbnail]");c.each(function(e,n){r.cropSrc=n.src,t(n).attr({alt:r._name,title:r._name}),t(n).next("i").hide(),i.isSupport?i._addImgAction(r):(t(n).attr("src",d),t(n).on("load",function(){alert("图片加载完成"),i._addImgAction(r)}))})}};if(e.isArray(d))for(var h=0;h<d.length;h++){var c=d[h];u(r,c)}else e.isJson(d)&&u(r,d)},u=function(n,o){n.previewElement&&(i.defaults.isAddRemoveLinks||r.isAddRemoveLinks&&(n._removeLink=i._createElement('<a class="dz-remove" href="javascript:undefined;" data-dz-remove>'+i.defaults.dictCancelUpload+"</a>"),n.previewElement.appendChild(n._removeLink),t(n._removeLink).on("click",function(t){e.stopPropagation(t),i.previewsContainer.removeChild(n.previewElement)})))},h=function(e){},c=function(e){},f=function(e,t){};if(r.isEnablePreview)if("undefined"==typeof window.blueimp)e.logWarn("没有加载 img 预览所需第三方插件:Gallery",FRAME_NAME+"."+N,!0),r.isEnablePreview=!1;else{var p=t('<div id="blueimp-image-gallery" class="blueimp-gallery"></div>');p.append('<div class="slides"></div>'),p.append('<h3 class="title"></h3>'),p.append('<a class="prev">‹</a>'),p.append('<a class="next">›</a>'),p.append('<a class="close">×</a>'),p.append('<a class="play-pause"></a>'),p.append('<ol class="indicator"></ol>'),t("body").append(p)}var m=t.extend(!0,{resolutions:r.resolutions},i.defaults.otherParam,r.otherParam),g={url:r.url,data:r.data,otherParam:m,method:r.method,maxNumber:r.maxNumber,acceptedFiles:i._getAcceptedFiles(),maxFilesize:r.maxFilesize,isCreateImageThumbnails:i.defaults.isCreateImageThumbnails,isAutoProcessQueue:i.defaults.isAutoProcessQueue,isAddRemoveLinks:i.defaults.isAddRemoveLinks,isAddUploadLinks:i.defaults.isAddUploadLinks,conMinWidth:r.conMinWidth,conMinHeight:r.conMinHeight,thumbnailWidth:r.thumbnailWidth,thumbnailHeight:r.thumbnailHeight,buttonSetting:r.buttonSetting,jsonReader:r.jsonReader,subPath:r.subPath,isRename:r.isRename,onRemovedFile:c,onCancelFile:f,onAddedFile:h,onSuccess:d,onFail:u};return this._file=e.file(i.element,g),this.$element.attr("ui-type",N),this.hasDom=!0,this.$element.prop("outerHTML")},_getAcceptedFiles:function(){var e=this._opt;return"*"!=e.acceptedFiles&&e.acceptedFiles?e.acceptedFiles:this.defaults.allAcceptedFiles.join(",")},_updateImgPreview:function(i){var r=this,n=this._opt;if(i._name=i.name,i.path=i.src,i.previewElement)for(_ref=i.previewElement.querySelectorAll("[data-dz-thumbnail]"),_i=0,_len=_ref.length;_i<_len;_i++)thumbnailElement=_ref[_i],thumbnailElement.alt=i._name,thumbnailElement.src=i.src,thumbnailElement.onload=function(){n.isAddEditLinks&&(i._editLink=r._createElement('<a class="dz-edit" href="javascript:void(0);" data-dz-edit>'+r.defaults.dictEditFile+"</a>"),i.previewElement.appendChild(i._editLink),t(i._editLink).on("click",function(t){e.stopPropagation(t),r.editFile(i)})),r.defaults.isAddRemoveLinks||n.isAddRemoveLinks&&(i._removeLink=r._createElement('<a class="dz-remove" href="javascript:undefined;" data-dz-remove>'+r.defaults.dictRemoveFile+"</a>"),i.previewElement.appendChild(i._removeLink),t(i._removeLink).on("click",function(t){e.stopPropagation(t),r.removeFile(i)})),n.isEnablePreview&&t(i.previewElement).on("click",function(e){e=e||window.event;var t=e.target||e.srcElement,r=t.src?t.parentNode:t,n={index:r,event:e,container:"#blueimp-image-gallery"},o=[{title:i.name,href:i.src,type:i.type}];blueimp.Gallery(o,n)}),_ref1=i.previewElement.querySelectorAll("[data-dz-size]");for(var o=0,a=_ref1.length;o<a;o++){var s=_ref1[o];s.parentNode.removeChild(s)}};r.files.push(i)},addImagesPreview:function(t){var i=this,r=(this._opt,i._file.addFilesPreview(t));if(e.isJson(r))i._updateImgPreview(r);else if(e.isArray(r))for(var n=0;n<r.length;n++){var o=r[n];i._updateImgPreview(o)}return r},_createElement:function(e){var t;return t=document.createElement("div"),t.innerHTML=e,t.childNodes[0]},_renameFilename:function(e){return"function"!=typeof this._opt.renameFilename?e:this._opt.renameFilename(e)},_filesize:function(e){var t,i,r,n,o,a,s,l;if(r=0,n="b",e>0){for(a=["TB","GB","MB","KB","b"],i=s=0,l=a.length;s<l;i=++s)if(o=a[i],t=Math.pow(this.defaults.filesizeBase,4-i)/10,e>=t){r=e/Math.pow(this.defaults.filesizeBase,4-i),n=o;break}r=Math.round(10*r)/10}return"<strong>"+r+"</strong> "+n},setEdit:function(i){var r=this,n=this.files,o=n.length;if(i=i||!1)for(var a=0;a<o;a++){var s=n[a];s._editLink||(s._editLink=r._createElement('<a class="dz-edit" href="javascript:void(0);" data-dz-edit>'+r.defaults.dictEditFile+"</a>"),s.previewElement.appendChild(s._editLink),t(s._editLink).on("click",function(t){e.stopPropagation(t),r.editFile(s)}))}else for(var a=0;a<o;a++){var s=n[a];s._editLink&&(s.previewElement.removeChild(s._editLink),s._editLink=null)}},removeFile:function(e){var t,i=this,r=this.files,n=null,o=-1;this._opt;if(e.id){for(var a=e.id,s=0,t=r.length;s<t;s++){var l=r[s];if(a==l.id){n=l,o=s;break}}o>-1&&i.files.splice(o,1),i._file.removeFile(e.id,"id")}},editFile:function(i){var r=this,n=this._opt,o=(this.$element,t.extend(!0,{},r.defaults.otherParam,n.otherParam)),a={handleUrl:n.url,otherParam:o,picSrc:i.src,imageName:i.name,imagePath:i.filePath,resolutions:n.resolutions,subPath:n.subPath,isRename:n.isRename,jsonReader:n.jsonReader},s=wui.buildUrl(n.editPageUrl,a,!0,!0),l={url:s,width:n.pageWidth,height:n.pageHeight,title:n.pageTitle,successCallback:function(o){e.logParamValue({paramName:"serviceResult",paramValue:o,methodName:"img.closeEdit",className:FRAME_NAME,isDebug:!0});var a=t.extend(!0,{},n.jsonReader),s=a.root,l=a.message,d=a.isSuccess;a.fileUrl,a.fileName,a.filePath;if(e.isEmptyType(o))return!1;var u,h=e.parseToObj(o);if(h||(h=o),e.isEmptyType(s))u=h;else if(u=h[s],!e.isEmptyType(d)&&!h[d])return wui.errorNotice(h[l]),!1;var c;c=e.isArray(u)?u[0]:u,r.refreshFile(c,i)}};e.openModalDialog(l)},refreshFile:function(i,r){e.logParamValue({paramName:"data",paramValue:i,methodName:"img.refreshFile",className:FRAME_NAME,isDebug:!0});var n=this,o=this._opt,a=t.extend(!0,{},o.jsonReader),s=a.fileUrl,l=a.fileName,d=a.filePath;delete a.fileUrl,delete a.root,delete a.message,delete a.isSuccess,delete a.fileName,delete a.filePath;var u,h=i[d],c=i[l];u=s?i[s]:e.hostAddress+h,r.path=h,r._name=c,r.src=u,r.size="";var f,p;f=r.previewElement.querySelectorAll("[data-dz-name]");for(var m=0,p=f.length;m<p;m++){var g=f[m];g.textContent=n._renameFilename(r.name)}var v=r.previewElement.querySelector("[data-dz-thumbnail]");v.src=u,v.onload=function(e){var t=new Image;t.src=u,t.onload=function(e){var i=t.width,n=t.height;r.width=i,r.height=n},n.listeners.indexOf("modalDialogClosed")>-1&&!n.emit({type:"modalDialogClosed",target:n.$element,file:r})}},disabled:function(){this._file.disabled()},enabled:function(){this._file.enabled()},readonly:function(){this._file.readonly()},readwrite:function(){this._file.readwrite()},get:function(t){var i=this._opt,r=this.files,n=i.key,o=e.deepCopy(i.jsonReader);delete o.root;var a,s=r.length,l=null,d=[];for(n||(t="json"),t=t||"",a=0;a<s;a++)if(l=r[a],""==t)d.push(l);else if("json"==t){var u={};u.id=l.id;for(var h in o)u[o[h]]=l[o[h]];d.push(u)}else"value"==t&&(l[n]&&d.push(l[n]),d=d.join(","));return d},option:function(t){var r=this._opt;if(!t)return r;if("object"==typeof t)this._file.option(t);else if("string"==typeof t)return"getDefOpt"===t?E:r[t]==i?e.logWarn("查找的属性值不存在",FRAME_NAME+"."+N,!0):r[t]},empty:function(){if(!(this.listeners.indexOf("empty")>-1)||this.emit({type:"empty",target:this.dom}))return this._file.empty(),this.files=[],this},destroy:function(){return this._file.destroy(),this.$element.removeAttr("ui-type"),this.$element.removeData(S),this.$element.prop("outerHTML",this.initDom),this},on:function(e,t){return C.indexOf(e)>-1&&("undefined"==typeof this.handlers[e]&&(this.handlers[e]=[],this.listeners.push(e)),this.handlers[e].push(t)),this},off:function(e,t){var r,n,o,a,s;if(C.indexOf(e)>-1&&this.handlers[e]instanceof Array){for(a=this.handlers[e],o=this.listeners,r=0,s=o.length;r<s&&o[r]!==e;r++);if(t===i)this.listeners.splice(r,1),delete this.handlers[e];else{for(n=0,s=a.length;n<s&&a[n]!==t;n++);n<s&&(this.handlers[e].splice(n,1),0==this.handlers[e].length&&this.listeners.splice(r,1))}}return this},emit:function(e){if(e.target||(this.$Maxcontainer?e.target=this.$Maxcontainer:e.target=this),this.handlers[e.type]instanceof Array)for(var t=this.handlers[e.type],i=0,r=t.length;i<r;i++)return t[i](e),!0;return!1},component:function(){return this}},t.fn[w]=function(e){return this.each(function(){var i=document.querySelectorAll("#"+r);t.data(i[0],S)||t.data(i[0],S,new o(this,e))})},x(n),{init:x,on:s,off:l,addImagesPreview:u,setEdit:h,get:d,enabled:f,disabled:c,readwrite:m,readonly:p,option:g,empty:v,component:y,destroy:b}},e}(wui||{},libs),function(e,t,i){return e.tagBox=function(r,n){function o(e,t){this.init()}function a(i,n){var o=t.data(document.getElementById(r),N);if(!o)return void e.logError("wui.tagBox 未初始化或已被销毁",FRAME_NAME+"."+C,!0);var a=Array.prototype.slice.call(arguments,1);return"function"==typeof o[i]?o[i].apply(o,a):void e.logWarn("wui.tagBox 中不存在 "+i+"() 方法",FRAME_NAME+"."+C,!0)}function s(e,i){var n=t.data(document.getElementById(r),N);return a("on",e,i),n}function l(e,i){var n=t.data(document.getElementById(r),N);return a("off",e,i),n}function d(e){return a("get",e)}function u(e){return a("set",e)}function h(e){return a("add",e)}function c(e){return a("remove",e)}function f(){return a("disabled")}function p(){return a("enabled")}function m(){return a("readonly")}function g(){return a("readwrite")}function v(e){return a("option",e)}function b(e){return a("empty",e)}function y(){return a("destroy")}function x(){return a("component")}function w(i){return t.data(document.getElementById(r),N)?i&&e.isJson(i)?a("option",i):void 0:void t("#"+r)[S](i)}var S="uiTagBox",N="plugin_"+S,C="tagBox";if(e.logMethodCalled({className:FRAME_NAME,methodName:C,isDebug:!0,id:r}),!e.checkIsLoadPlugins(C))return!1;if(!t("#"+r).exist())return e.logError("【"+C+"】当前页面不存在 ID 为"+r+" 的DOM节点",FRAME_NAME+"."+C,!0),!1;var E=["beforeItemAdd","itemAddError","itemAdded","beforeItemRemove","itemRemoveError","itemRemoved"],_={loadUrl:"",value:[],direction:"dropdown",maxNumber:!1,text:"name",name:"id",width:"",isShowDropdown:!1,tagClass:"label wui-bg-primary",maxChars:0,ellipsis:"...",isEnableInput:!0,isFreeInput:!0,jsonReader:{root:null},prmNames:{searchField:"searchKey"},onBeforeItemAdd:e.CONSTANTS.EMPTYFUNC,onItemAddError:e.CONSTANTS.EMPTYFUNC,onItemAdded:e.CONSTANTS.EMPTYFUNC,onBeforeItemRemove:e.CONSTANTS.EMPTYFUNC,onItemRemoveError:e.CONSTANTS.EMPTYFUNC,onItemRemoved:e.CONSTANTS.EMPTYFUNC},T={dynamicLoading:!0,dropdownMaxHeight:400,dropdownMinHeight:-1,noneResultsText:"匹配不到'{0}'",maxOptionsText:["超出限制 (最多选择{n}项)","组选择超出限制(最多选择{n}组)"],placeholderText:e.language.tagBox.placeholder,noneItemText:e.language.tagBox.noneItem};return o.prototype={constructor:o,init:function(){this.pluginName=C,this.element=r,this.$element=t("#"+r),this.defaults=T,this._option=n,this.hasDom=!1,this.initDom=this.$element.prop("outerHTML");var i=e.getAttributeParams(this.$element,_);this._opt=t.extend(!0,{},_,n,i),this._data=[],this.itemsArray=[],this.itemsName=[],this.itemsText=[],this.placeholderText=this.$element.attr("placeholder")?this.$element.attr("placeholder"):this.defaults.placeholderText,this.optionTmp='<li data-original-index=""><a tabindex=""><span class="text"></span></a></li>',this.tagTmp='<span class="tag"><em></em><span data-role="remove"></span></span>',this.tipTmp='<span class="no-item">'+this.defaults.noneItemText+"</span>",this.$Maxcontainer=null,this.$viewBox=null,this.$buttonBox=null,this.$input=null,this.$dropdownBox=null,this.$selectContentBox=null,this.$tip=null,this.activeItem=null,this.listeners=[],this.handlers={},this._formatParams(),this.dom=this._buildContainer()},_buildContainer:function(){var e=this,i=this._opt,r=this.$element;if(r.attr("name")||r.attr("name",e.element),this.name=r.attr("name"),!r.parent().hasClass("wui-tagsbox")){var n='<div class="wui-tagsbox"></div>';r.wrap(n)}this.$Maxcontainer=r.parent(),this.$viewBox=t('<div wui-combobox="dropdowm" class="btn-group wui-select-box show-tick input-layout" style="width: 100%;"></div>'),this.$buttonBox=t('<div class="tag-container wui-input" data-toggle="dropdown"></div>').appendTo(this.$viewBox),this.$input=t('<input type="text" wui-widget-hidden="true" placeholder="'+this.placeholderText+'">').appendTo(this.$buttonBox),this.$dropdownBox=t('<div class="dropdown-menu open"></div>').appendTo(this.$viewBox),this.$selectContentBox=t('<ul wui-data="menu" class="dropdown-menu focus inner" role="menu" style="overflow-y: auto;"></ul>'),r.after(this.$viewBox),r.hide(),this._setDirection(),this._initDropDownBox(),this._bindEvent(),i.width&&this.$Maxcontainer.width(i.width);var o=r.val();""!=o&&e.set(o);var a=i.value;return e.add(a),this.hasDom=!0,this.$Maxcontainer.prop("outerHTML")},_initDropDownBox:function(){var e=this;this._opt;return 0==this.$dropdownBox.children('[wui-data="menu"]').length&&this.$dropdownBox.append(this.$selectContentBox),e.$viewBox},_formatParams:function(){var t=this._opt;this._opt.maxNumber=e.formatMaxNumber(t.maxNumber);var i=t.value;e.parseToObj(i)&&(this._opt.value=e.parseToObj(i))},_bindEvent:function(){var i=this,r=this._opt;t(document).on("click",'[ui-combobox="dropdowm"] .tag-container',function(t){e.stopPropagation(t)}),i.inputAddEvent(),r.isEnableInput?(i.$input.focus(),i.$buttonBox.on("click",function(){i.$input.focus()})):(i.$input.addClass("noFreeInput"),i.$tip=t(i.tipTmp).appendTo(i.$buttonBox)),this.$viewBox.on({"hide.bs.dropdown":function(e){},"hidden.bs.dropdown":function(e){i.$selectContentBox.empty()},"show.bs.dropdown":function(e){},"shown.bs.dropdown":function(e){var n=i.$input.val();""!=n||r.isShowDropdown?i.render(n):t(this).dropdown("toggle")}}),i.$element.attr("ui-type",i.pluginName)},_setDirection:function(){var e=this._opt;"auto"==e.direction?this._checkDropdownPosition():""!=e.direction&&this.$viewBox.addClass(e.direction)},_checkDropdownPosition:function(){var t=this,i=e.getViewSize(),r=t.$Maxcontainer.offset();i.height/2>r.top?(t.$viewBox.removeClass("dropup"),t.$viewBox.addClass("dropdown")):(t.$viewBox.addClass("dropup"),t.$viewBox.removeClass("dropdown"))},_setHeight:function(){var i=this,r=this._data.length,n=null,o=null,a=t(window).scrollTop();if(r>0){var s=0;i.$optionBox.children("li:not(.hide)").each(function(e,i){s+=t(i).outerHeight(!0)}),n=e.getViewSize();var l=0;if(0==i._opt.maxHeight||"0"==i._opt.maxHeight)if(i.$container.hasClass("dropup")){o=i.$button.offset();var d=0;this.$dropdownBox.children().not('[wui-data="menu"]').each(function(e,t){d+=t.offsetHeight}),l=o.top-a-d-10}else o=i.$optionBox.offset(),l=n.height-(o.top-a)-10;else l=parseInt(i._opt.maxHeight);var u=s>l?l:s;i.$optionBox.height(u)}else i.$optionBox.height(0)},_textWidth:function(e){var i=t("<pre>"+e+"</pre>").css({display:"none"});t("body").append(i);var r=i.outerWidth();return i.remove(),r},_checkTextIsOverConWidth:function(e){var t=this,i=t.$container.width(),r=(t.$input,e.children("[data-role=remove]").outerWidth(!0)),n=i-2*r;e.children("em").css("max-width",n+"px")},inputAddEvent:function(){var i=this,r=this._opt;i.$input.on("click",function(n){e.stopPropagation(n),t(this).prev("span")&&t(this).prev("span").hasClass("selected")&&t(this).prev("span").removeClass("selected");var o=t(this).val();(""!=o||r.isShowDropdown)&&i.render(o)}).on("input propertychange",function(r){e.stopPropagation(r);var n=t(this).val();""!=n?(t(this).prev("span")&&t(this).prev("span").hasClass("selected")&&t(this).prev("span").removeClass("selected"),i.render(n)):i.blur()}).keydown(function(e){}).keypress(function(t){var i=window.event?t.keyCode:t.which;i!=e.CONSTANTS.KEYS.ENTER&&i!=e.CONSTANTS.KEYS.OTHER||(e.stopPropagation(t),e.preventDefault(t))}).keyup(function(n){var o=window.event?n.keyCode:n.which;if(o==e.CONSTANTS.KEYS.ENTER||o==e.CONSTANTS.KEYS.OTHER){var a=t(this).val();if(""!=a){if(i.activeItem){var s=i.activeItem.attr("data-original-index"),l=i._data[s];i.addItem(l)}else if(r.isFreeInput)i.addItem(a);else{var l=i._data[0];e.isUndefined(l)||i.addItem(l)}i.blur(),t(this).val("")}}else if(o==e.CONSTANTS.KEYS.DOWN)i.KeyDown();else if(o==e.CONSTANTS.KEYS.UP)i.KeyUp();else if(o==e.CONSTANTS.KEYS.END)i.KeyEnd();else if(o==e.CONSTANTS.KEYS.DELETE||o==e.CONSTANTS.KEYS.BACKSPACE||o==e.CONSTANTS.KEYS.CLEAR){var a=t(this).val();""==a&&t(this).prev()&&t(this).prev().length&&(t(this).prev().hasClass("selected")?t(this).prev().children('[data-role="remove"]').trigger("click"):t(this).prev().addClass("selected"))}})},set:function(e,t){this.empty(),this.add(e,t)},add:function(t){if(t!=i){if("string"==typeof t){if(""==t){if(this.listeners.indexOf("itemAddError")>-1&&!this.emit({type:"itemAddError",target:this.$Maxcontainer,item:t,code:6,message:"添加的节点不能为空字符串"}))return;return!1}for(var r=t.split(","),n=0;n<r.length;n++)this.addItem(r[n])}else if(e.isArray(t)){if(!(t.length>0)){if(this.listeners.indexOf("itemAddError")>-1&&!this.emit({type:"itemAddError",target:this.$Maxcontainer,item:t,code:6,message:"添加的节点不能为空数组"}))return;return!1}for(var n=0;n<t.length;n++)this.addItem(t[n])}else{if("object"!=typeof t||null==t){if(this.listeners.indexOf("itemAddError")>-1&&!this.emit({type:"itemAddError",target:this.$Maxcontainer,item:t,code:6,message:"传入的参数值不支持赋值"}))return;return!1}if(null==t){if(this.listeners.indexOf("itemAddError")>-1&&!this.emit({type:"itemAddError",target:this.$Maxcontainer,item:t,code:6,message:"添加的节点不能为空对象"}))return;return!1}this.addItem(t)}return this}return!1},remove:function(t){if(t!=i){if("string"==typeof t){if(""==t){if(this.listeners.indexOf("itemRemoveError")>-1&&!this.emit({type:"itemRemoveError",target:this.$Maxcontainer,item:t,code:6,message:"移除的节点不能为空字符串"}))return;return!1}for(var r=t.split(","),n=0;n<r.length;n++)this.removeItem(r[n])}else if(e.isArray(t)){if(!(t.length>0)){if(this.listeners.indexOf("itemRemoveError")>-1&&!this.emit({type:"itemRemoveError",target:this.$Maxcontainer,item:t,code:6,message:"移除的节点不能为空数组"}))return;return!1}for(var n=0;n<t.length;n++)this.removeItem(t[n])}else{if("object"!=typeof t||null==t){if(this.listeners.indexOf("itemRemoveError")>-1&&!this.emit({type:"itemRemoveError",target:this.$Maxcontainer,item:t,code:6,message:"传入的参数类型不支持移除"}))return;return!1}if(null==t){if(this.listeners.indexOf("itemRemoveError")>-1&&!this.emit({type:"itemRemoveError",target:this.$Maxcontainer,item:t,code:6,message:"移除的节点不能为空对象"}))return;return!1}this.removeItem(t)}return this}return!1},addItem:function(r){var n,o=this,a=this._opt,s=this.$element,l=a.name,d=a.text,u="";if(a.onBeforeItemAdd&&"function"==typeof a.onBeforeItemAdd&&!a.onBeforeItemAdd(o.$Maxcontainer,r))return!1;if(!(o.listeners.indexOf("beforeItemAdd")>-1)||o.emit({type:"beforeItemAdd",target:o.$Maxcontainer,item:f})){if(a.maxNumber!==!1&&o.itemsArray.length>=a.maxNumber){if(n=-1,u="最多可添加"+a.maxNumber+"个标签",a.onItemAddError&&"function"==typeof a.onItemAddError&&!a.onItemAddError(o.$Maxcontainer,r,n,u))return!1;if(o.listeners.indexOf("itemAddError")>-1&&!o.emit({type:"itemAddError",target:o.$Maxcontainer,item:r,code:n,message:u}))return;return!1}if(!r){if(n=0,u="添加的数据不能为空",a.onItemAddError&&"function"==typeof a.onItemAddError&&!a.onItemAddError(o.$Maxcontainer,r,n,u))return!1;
if(o.listeners.indexOf("itemAddError")>-1&&!o.emit({type:"itemAddError",target:o.$Maxcontainer,item:r,code:n,message:u}))return;return!1}if("string"==typeof r&&a.trimValue&&(r=t.trim(r)),!l){if(n=1,u="name属性值没设置，无法添加object类型数据",a.onItemAddError&&"function"==typeof a.onItemAddError&&!a.onItemAddError(o.$Maxcontainer,r,n,u))return!1;if(o.listeners.indexOf("itemAddError")>-1&&!o.emit({type:"itemAddError",target:o.$Maxcontainer,item:r,code:n,message:u}))return;return!1}var h,c,f={};if(e.isJson(r))f=r;else{if("string"!=typeof r){if(n=5,u="只能添加类型为object、string的数据",a.onItemAddError&&"function"==typeof a.onItemAddError&&!a.onItemAddError(o.$Maxcontainer,r,n,u))return!1;if(o.listeners.indexOf("itemAddError")>-1&&!o.emit({type:"itemAddError",target:o.$Maxcontainer,item:r,code:n,message:u}))return;return!1}f[l]=r,f[d]=r}if(f[l]==i){if(n=3,u="添加的节点没有对应的 "+l+" 字段值",a.onItemAddError&&"function"==typeof a.onItemAddError&&!a.onItemAddError(o.$Maxcontainer,r,n,u))return!1;if(o.listeners.indexOf("itemAddError")>-1&&!o.emit({type:"itemAddError",target:o.$Maxcontainer,item:r,code:n,message:u}))return;return!1}if(f[d]==i){if(n=4,u="添加的节点没有对应的 "+d+" 字段值",a.onItemAddError&&"function"==typeof a.onItemAddError&&!a.onItemAddError(o.$Maxcontainer,r,n,u))return!1;if(o.listeners.indexOf("itemAddError")>-1&&!o.emit({type:"itemAddError",target:o.$Maxcontainer,item:r,code:n,message:u}))return;return!1}if(h=f[l],c=f[d],!a.isAllowDuplicates&&o.itemsName.indexOf(h)>-1){var p=o.itemsName.indexOf(h);if(this.$buttonBox.children("span").eq(p).hide().fadeIn(),n=2,u="数据重复",a.onItemAddError&&"function"==typeof a.onItemAddError&&!a.onItemAddError(o.$Maxcontainer,r,n,u))return!1;if(o.listeners.indexOf("itemAddError")>-1&&!o.emit({type:"itemAddError",target:o.$Maxcontainer,item:r,code:n,message:u}))return;return!1}o.itemsName.push(h),o.itemsText.push(c),o.itemsArray.push(f);var m=t(o.tagTmp);""!=a.tagClass&&m.addClass(a.tagClass);var g=c;m.attr("title",c),a.maxChars>0&&a.maxChars<c.length&&(g=g.substr(0,a.maxChars)+a.ellipsis),m.children("em").text(g),o.$input.before(m),o.$tip&&!o.$tip.hasClass("hide")&&o.$tip.addClass("hide"),s.val(this.itemsName.join(",")),m.on("click",function(t){e.stopPropagation(t)}),m.children('[data-role="remove"]').on("click",function(i){e.stopPropagation(i);var r=t(this).parent().index();o.removeItem(r,!0)});var v=o.$element.get(0);if(v.form&&t.data(v.form,"validator")&&!e.isEmptyType(o.$element.rules())&&e.validElement(o.$element),a.onItemAdded&&"function"==typeof a.onItemAdded&&!a.onItemAdded(o.$Maxcontainer,f))return!1;if(!(o.listeners.indexOf("itemAdded")>-1)||o.emit({type:"itemAdded",target:o.$Maxcontainer,item:f}))return o.focus(),this}},removeItem:function(r,n){var o,a=this,s=this._opt,l=this.$element,d=s.name,u=(s.text,"");if(s.onBeforeItemRemove&&"function"==typeof s.onBeforeItemRemove&&!s.onBeforeItemRemove(a.$Maxcontainer,r))return!1;if(!(a.listeners.indexOf("beforeItemRemove")>-1)||a.emit({type:"beforeItemRemove",target:a.$Maxcontainer,item:r})){if(r===i){if(o=0,u="移除的数据不能为空",s.onItemRemoveError&&"function"==typeof s.onItemRemoveError&&!s.onItemRemoveError(a.$Maxcontainer,r,o,u))return!1;if(a.listeners.indexOf("itemRemoveError")>-1&&!a.emit({type:"itemRemoveError",target:a.$Maxcontainer,item:r,code:o,message:u}))return;return!1}if("object"==typeof r&&!s.name){if(o=1,u="name属性值没设置，无法删除object类型数据",s.onItemRemoveError&&"function"==typeof s.onItemRemoveError&&!s.onItemRemoveError(a.$Maxcontainer,r,o,u))return!1;if(a.listeners.indexOf("itemRemoveError")>-1&&!a.emit({type:"itemRemoveError",target:a.$Maxcontainer,item:r,code:o,message:u}))return;return!1}n=n||!1;var h=-1;if(n)h=r;else if(e.isJson(r)){var c=r[d];h=a.itemsName.indexOf(c)}else{if("string"!=typeof r){if(o=5,u="只能根据类型为object、string的数据来删除节点",s.onItemRemoveError&&"function"==typeof s.onItemRemoveError&&!s.onItemRemoveError(a.$Maxcontainer,r,o,u))return!1;if(a.listeners.indexOf("itemRemoveError")>-1&&!a.emit({type:"itemRemoveError",target:a.$Maxcontainer,item:r,code:o,message:u}))return;return!1}h=a.itemsName.indexOf(r)}if(h<0){if(o=2,u="传入数据不存在",s.onItemRemoveError&&"function"==typeof s.onItemRemoveError&&!s.onItemRemoveError(a.$Maxcontainer,r,o,u))return!1;if(a.listeners.indexOf("itemRemoveError")>-1&&!a.emit({type:"itemRemoveError",target:a.$Maxcontainer,item:r,code:o,message:u}))return;return!1}var f=a.itemsArray[h];a.itemsName.splice(h,1),a.itemsArray.splice(h,1),a.itemsText.splice(h,1),0==a.itemsText.length&&a.$tip&&a.$tip.hasClass("hide")&&a.$tip.removeClass("hide"),l.val(a.itemsName.join(",")),a.$buttonBox.children("span").eq(h).remove();var p=a.$element.get(0);if(p.form&&t.data(p.form,"validator")&&!e.isEmptyType(a.$element.rules())&&e.validElement(a.$element),s.onItemRemoved&&"function"==typeof s.onItemRemoved&&!s.onItemRemoved(a.$Maxcontainer,f))return!1;if(!(a.listeners.indexOf("itemRemoved")>-1)||a.emit({type:"itemRemoved",target:a.$Maxcontainer,item:f}))return a.$input.focus(),this}},loadData:function(i,r){var n,o=this,a=this._opt,s=a.text,l=(a.name,i.length),d=0;for(o._data=[],o.$selectContentBox.empty(),n=0;n<l;n++){var u=i[n],h=t(o.optionTmp),c=u[s];c.indexOf(r)!=-1&&(o._data.push(u),h.attr("data-original-index",d++).children("a").attr("tabindex",d).children(".text").text(c),o.$selectContentBox.append(h),h.on("click","a, span",function(t){e.stopPropagation(t),o.click(this)}).mouseenter(function(){t(this).siblings("li.active").each(function(){t(this).removeClass("active")}),t(this).addClass("active"),o.activeItem=t(this)}).mouseleave(function(){t(this).removeClass("active"),o.activeItem=null}),h.keyup(function(t){e.stopPropagation(t);var i=window.event?t.keyCode:t.which;i!=e.CONSTANTS.KEYS.ENTER&&i!=e.CONSTANTS.KEYS.OTHER||o.enter(this)}))}l>0&&o.focus()},render:function(t){var i=this,r=this._opt,n=(this.$element,r.jsonReader.root),o=r.prmNames.searchField;if(i.activeItem=null,i.defaults.dynamicLoading){var a={};a[o]=t;var s=function(r){if(n){var o=r[n];e.isArray(o)&&o.length>0?i.loadData(o,t):i.$viewBox.removeClass("open")}else{var o=r;e.isArray(o)&&o.length>0?i.loadData(o,t):i.$viewBox.removeClass("open")}},l=function(e){},d=e.buildUrl(r.loadUrl,a);e.getAjax({url:d,onSuccess:s,onError:l,async:!1,dataType:"json"})}else{var u=i.$element.attr("isInit");if(u)i.focus();else{var a={};a[o]=t;var s=function(r){if(""!=n){var o=r[n];e.isArray(o)&&o.length>0&&i.loadData(o,t)}else{var o=r;e.isArray(o)&&o.length>0&&i.loadData(o,t)}},l=function(e){},d=e.buildUrl(r.loadUrl,a);e.getAjax({url:d,onSuccess:s,onError:l,async:!1,dataType:"json"})}}},KeyDown:function(){var e=this,t=null;e.activeItem?(t=e.activeItem&&e.activeItem.nextAll().not(".hidden").length?e.activeItem.nextAll().not(".hidden").eq(0):e.activeItem,e.activeItem.removeClass("active")):t=e.$selectContentBox.children("li").not(".hidden").first(),t.addClass("active"),e.activeItem=t,e.activeItem.focus()},KeyUp:function(){var t=this,i=null;t.activeItem?(i=t.activeItem&&t.activeItem.prevAll().not(".hidden").length?t.activeItem.prevAll().not(".hidden").eq(0):t.activeItem,t.activeItem.removeClass("active"),i.addClass("active"),t.activeItem=i,t.activeItem.focus()):e.logMessage("当前没有选中项","wui.tagBox",!0)},KeyEnd:function(){var e=this,t=null;e.activeItem?(t=e.activeItem&&e.activeItem.nextAll().not(".hidden").length?e.activeItem.nextAll().not(".hidden").last():e.activeItem,e.activeItem.removeClass("active")):t=e.$selectContentBox.children("li").not(".hidden").last(),t.addClass("active"),e.activeItem=t,e.activeItem.focus()},focus:function(){var e=this,t=this._opt;e.$input.focus(),e.$selectContentBox.addClass("focus");var i=e.$input.val();(""!=i||t.isShowDropdown)&&e._data.length>0&&e.$viewBox.addClass("open"),e.setHeight()},blur:function(){var e=this;e.defaults.dropdownMinHeight;e.$selectContentBox.removeClass("focus"),e.$viewBox.removeClass("open"),e.activeItem&&(e.activeItem.removeClass("active"),e.activeItem.addClass("hidden")),e.activeItem=null,e.defaults.dynamicLoading&&(e.$selectContentBox.empty(),e._data=[]),e.setHeight()},click:function(e){var i=this,r=null;"LI"==e.tagName?r=t(e):"A"==e.tagName?r=t(e).parent():"SPAN"==e.tagName&&(r=t(e).parent().parent());var n=parseInt(r.attr("data-original-index")),o=i._data[n];i.addItem(o),i.blur(),i.$input.val("")},enter:function(e){var i=this,r=null;"LI"==e.tagName?r=t(e):"A"==e.tagName?r=t(e).parent():"SPAN"==e.tagName&&(r=t(e).parent().parent());var n=parseInt(r.attr("data-original-index")),o=i._data[n];i.addItem(o),i.blur(),i.$input.val("")},get:function(e){return e=e||"json","value"==e?this.itemsName:"json"==e?this.itemsArray:"text"==e?this.itemsText:this.itemsArray},setHeight:function(){var e=this,t=this._data.length,i=e.defaults.dropdownMinHeight;if(t>0){var r=e.$selectContentBox.children("li").not(".hidden").first().height(),n=r*t>e.defaults.dropdownMaxHeight?e.defaults.dropdownMaxHeight:r*t;e.$selectContentBox.height(n)}else e.$selectContentBox.height(i)},option:function(t){var r=this._opt;if(!t)return r;if("object"==typeof t)this._resetOption(t);else if("string"==typeof t)return"getDefOpt"===t?_:r[t]==i?e.logWarn("查找的属性值不存在",FRAME_NAME+"."+C,!0):r[t]},_resetOption:function(r){var n=this,o=this._opt,a=!1;if(r.direction!=i&&o.direction!=r.direction&&(""!=o.direction&&n.$viewBox.removeClass(o.direction),""!=r.direction&&n.$viewBox.addClass(r.direction),n._opt.direction=r.direction),r.text!=i&&o.text!=r.text&&(a=!0,n._opt.text=r.text),r.name!=i&&o.name!=r.name&&(a=!0,n._opt.name=r.name),r.loadUrl!=i&&o.loadUrl!=r.loadUrl&&(n._opt.loadUrl=r.loadUrl,a=!0),r.loadData&&o.loadData!=r.loadData&&(n._opt.loadData=r.loadData,a=!0),a&&n.empty(),r.maxNumber!=i&&o.maxNumber!=parseInt(r.maxNumber)){var s=e.formatMaxNumber(r.maxNumber);if(this._opt.maxNumber=s,s!==!1)for(var l=n.itemsName.length;l>s;)n.removeItem(--l,!0)}var d=!1;if(r.ellipsis!=i&&o.ellipsis!=r.ellipsis&&(n._opt.ellipsis=r.ellipsis,d=!0),r.maxChars!=i&&o.maxChars!=parseInt(r.maxChars)){var u=parseInt(r.maxChars);n._opt.maxChars=u,d=!0}if(d){var h=(n.itemsText,n.$buttonBox.children(".tag"));h.each(function(e,i){var r=t(i),o=r.attr("title");u>0&&o.length>u&&(o=o.substr(0,u)+n._opt.ellipsis),r.children("em").text(o)})}},disabled:function(){this.blur(),this.$input.attr("readonly",!0).attr("disabled","disabled"),this.$buttonBox.attr("disabled","disabled").removeAttr("data-toggle"),this.$buttonBox.find('[data-role="remove"]').hide(),this.$buttonBox.addClass("disabled")},enabled:function(){this.$input.removeAttr("readonly").removeAttr("disabled"),this.$buttonBox.removeAttr("disabled").attr("data-toggle","dropdown"),this.$buttonBox.find('[data-role="remove"]').show(),this.$buttonBox.removeClass("disabled")},readonly:function(){this.blur(),this.$input.attr("readonly",!0).attr("disabled","disabled").addClass("wui-readonly"),this.$buttonBox.attr("disabled","disabled").removeAttr("data-toggle"),this.$buttonBox.find('[data-role="remove"]').hide()},readwrite:function(){this.$input.removeAttr("readonly").removeAttr("disabled").removeClass("wui-readonly"),this.$buttonBox.removeAttr("disabled").attr("data-toggle","dropdown"),this.$buttonBox.find('[data-role="remove"]').show()},empty:function(e){var r=this,n=this._opt,o=this.$element;if(e===i&&(e=!0),e)for(var a=r.itemsName.length;a>0;)r.removeItem(--a,!0);else this.itemsName=[],this.itemsArray=[],this.itemsText=[],r.$tip&&r.$tip.hasClass("hide")&&r.$tip.removeClass("hide"),o.val(""),r.$buttonBox.children("span").each(function(){t(this).remove()});return n.onEmpty&&"function"==typeof n.onEmpty&&n.onEmpty(),this},destroy:function(){var e=this;if(!(e.listeners.indexOf("destroy")>-1)||e.emit({type:"destroy",target:e.dom}))return e.$element.removeData(N),this.$element.removeAttr("ui-type"),this.$Maxcontainer.replaceWith(this.initDom),this},on:function(e,t){return E.indexOf(e)>-1&&("undefined"==typeof this.handlers[e]&&(this.handlers[e]=[],this.listeners.push(e)),this.handlers[e].push(t)),this},off:function(e,t){var r,n,o,a,s;if(E.indexOf(e)>-1&&this.handlers[e]instanceof Array){for(a=this.handlers[e],o=this.listeners,r=0,s=o.length;r<s&&o[r]!==e;r++);if(t===i)this.listeners.splice(r,1),delete this.handlers[e];else{for(n=0,s=a.length;n<s&&a[n]!==t;n++);n<s&&(this.handlers[e].splice(n,1),0==this.handlers[e].length&&this.listeners.splice(r,1))}}return this},emit:function(e){if(e.target||(this.$Maxcontainer?e.target=this.$Maxcontainer:e.target=this),this.handlers[e.type]instanceof Array)for(var t=this.handlers[e.type],i=0,r=t.length;i<r;i++)return t[i](e),!0;return!1},component:function(){return this}},t.fn[S]=function(e){return this.each(function(){t.data(document.getElementById(r),N)||t.data(document.getElementById(r),N,new o(this,e))})},w(n),{init:w,on:s,off:l,get:d,set:u,add:h,remove:c,enabled:p,disabled:f,readwrite:g,readonly:m,option:v,empty:b,component:x,destroy:y}},e}(wui||{},libs),function(e,t,i){return e.tagComboBox=function(r,n){function o(e,t){this.init()}function a(i,n){var o=t.data(document.getElementById(r),N);if(!o)return void e.logError("wui.tagComboBox 未初始化或已被销毁",FRAME_NAME+"."+C,!0);var a=Array.prototype.slice.call(arguments,1);return"function"==typeof o[i]?o[i].apply(o,a):void e.logWarn("wui.tagComboBox 中不存在 "+i+"() 方法",FRAME_NAME+"."+C,!0)}function s(e,i){var n=t.data(document.getElementById(r),N);return a("on",e,i),n}function l(e,i){var n=t.data(document.getElementById(r),N);return a("off",e,i),n}function d(e){return a("get",e)}function u(e,t,i){return a("select",e,t,i)}function h(e,t,i){return a("unselect",e,t,i)}function c(){return a("disabled")}function f(){return a("enabled")}function p(){return a("readonly")}function m(){return a("readwrite")}function g(e){return a("option",e)}function v(e){return a("empty",e)}function b(){return a("refresh")}function y(){return a("destroy")}function x(){return a("component")}function w(i){return t.data(document.getElementById(r),N)?i&&e.isJson(i)?a("option",i):void 0:void t("#"+r)[S](i)}var S="uiTagComboBox",N="plugin_"+S,C="tagComboBox";if(e.logMethodCalled({className:FRAME_NAME,methodName:C,isDebug:!0,id:r}),!e.checkIsLoadPlugins(C))return!1;if(!t("#"+r).exist())return e.logError("【"+C+"】当前页面不存在 ID 为"+r+" 的DOM节点",FRAME_NAME+"."+C,!0),!1;var E=["iframeLoaded","beforeItemSelect","itemSelectError","itemSelected","beforeItemUnselect","itemUnselectError","itemUnselected"],_={direction:"auto",maxNumber:!1,value:"",text:"name",name:"id",maxChars:0,ellipsis:"...",width:"",tagClass:"label wui-bg-primary",pageUrl:e.commonPageBasePath+"wui.comboBox.dropdown.html",otherParam:{},maxHeight:0,isReload:!1,beforeIframeLoad:e.CONSTANTS.EMPTYFUNC,treeTitle:"",treeUrl:"",lazyField:"parentDeptId",isEnabledSearch:!0,tabTitle:"",tabUrl:"",treeExtSetting:null,tabsExtSetting:null,updateSubpageItem:e.CONSTANTS.EMPTYFUNC},T={isFreeInput:!1,dynamicLoading:!0,dropdownMaxHeight:400,noneSelectedText:"没有选中任何项",maxOptionsText:["超出限制 (最多选择{n}项)","组选择超出限制(最多选择{n}组)"],noneItemText:e.language.tagComboBox.noneItem};return o.prototype={constructor:o,init:function(){this.pluginName=C,this.element=r,this.$element=t("#"+r),this.defaults=T,this.hasDom=!1,this.initDom=this.$element.prop("outerHTML");var i=e.getAttributeParams(this.$element,_);this._opt=t.extend(!0,{},_,n,i),this.itemsArray=[],this.itemsName=[],this.itemsText=[],this.placeholderText=this.$element.attr("placeholder")?this.$element.attr("placeholder"):this.defaults.noneItemText,this.tagTmp='<span class="tag"><em></em><span data-role="remove"></span></span>',this.tipTmp='<span class="no-item">'+this.placeholderText+"</span>",this.iframeTmpl='<iframe id="" name="" allowtransparency="true" width="100%" height="98%" src="" scrolling="yes" frameborder="0"></iframe>',this.$Maxcontainer=null,this.$viewBox=null,this.$buttonBox=null,this.$input=null,this.$dropdownBox=null,this.$selectContentBox=null,this.errorElement=null,this.iframe=null,this.$tip=null,this.listeners=[],this.handlers={},this._formatParams(),this.dom=this._buildContainer()},_buildContainer:function(){var e=this,i=this._opt,r=this.$element;if(r.attr("name")||r.attr("name",e.element),this.name=r.attr("name"),!r.parent().hasClass("wui-tagcomboBox")){var n='<div class="wui-tagcomboBox"></div>';r.wrap(n)}return this.$Maxcontainer=r.parent(),this.$viewBox=t('<div wui-combobox="dropdowm" class="btn-group wui-select-box show-tick input-layout" style="width: 100%;"></div>'),this.$buttonBox=t('<div class="tag-container dropdown-toggle" data-toggle="dropdown"></div>').appendTo(this.$viewBox),this.$input=t('<input type="text" wui-widget-hidden="true" placeholder="'+this.placeholderText+'">').appendTo(this.$buttonBox),this.$caret=t('<span class="ws-caret" style="float:right"> <span class="caret"></span> <span class="sr-only">Toggle Dropdown</span> </span>').appendTo(this.$buttonBox),this.$dropdownBox=t('<div class="dropdown-menu open"></div>').appendTo(this.$viewBox),this.$selectContentBox=t('<div wui-data="menu" class="dropdown-menu inner" role="menu" style="overflow-y: auto; height: 100%;"></div>').appendTo(this.$dropdownBox),r.after(this.$viewBox),r.hide(),this._setDirection(),this._setIsFreeInput(),this._bindEvent(),i.width&&this.$Maxcontainer.width(i.width),this.select(i.value),this.hasDom=!0,this.$Maxcontainer.prop("outerHTML")},_initDropDownBox:function(){var t=this._initSelectContentBox();return t?void this._loadIframe(t):(this.$selectContentBox.height(40),e.logError("没有传入可初始化下拉框的数据",FRAME_NAME+"."+C,!0),!1)},_setIsFreeInput:function(){this.defaults.isFreeInput?this.$input.focus():(this.$input.addClass("noFreeInput"),this.$tip=t(this.tipTmp).appendTo(this.$buttonBox))},_initSelectContentBox:function(){var i,r=this,n=this._opt;this.$element;if(r.$selectContentBox.attr("id")?i=r.$selectContentBox.attr("id"):(i=e.guid(),r.$selectContentBox.attr("id",i)),n.pageUrl&&""!=n.pageUrl&&(""!=n.treeUrl||0!=n.tabUrl.length)){var o=t(r.iframeTmpl);this.iframe=o[0];var a=i+"_iframe";o.attr({id:a,name:a}),r.$selectContentBox.html(o)}return this.iframe},_formatParams:function(){var t=this._opt;this._opt.maxNumber=e.formatMaxNumber(t.maxNumber);var i=t.value;e.parseToObj(i)&&(this._opt.value=e.parseToObj(i))},_bindEvent:function(){var i=this,r=this._opt;t(document).on("click",'[wui-data="menu"]',function(t){e.stopPropagation(t)}),this.$viewBox.on({"hide.bs.dropdown":function(e){i.$selectContentBox.attr("aria-expanded",!1)},"hidden.bs.dropdown":function(e){},"show.bs.dropdown":function(e){"auto"==r.direction&&i._checkDropdownPosition(),i.$selectContentBox.attr("aria-expanded",!0)},"shown.bs.dropdown":function(e){i._setHeight(),r.isReload?i._initDropDownBox():i.iframe||i._initDropDownBox()}}),i.$element.attr("ui-type",i.pluginName),this.$element.on("change",function(r){var n=t(this).val();if(""!=n){var o=e.parseToObj(n);o?i.select(o):i.select(n)}})},_setDirection:function(){var e=this._opt;"auto"==e.direction?this._checkDropdownPosition():""!=e.direction&&this.$viewBox.addClass(e.direction)},_checkDropdownPosition:function(){var t=this,i=e.getViewSize(),r=t.$Maxcontainer.offset();i.height/2>r.top?(t.$viewBox.removeClass("dropup"),t.$viewBox.addClass("dropdown")):(t.$viewBox.addClass("dropup"),t.$viewBox.removeClass("dropdown"))},_loadIframe:function(i){var r=this,n=this._opt;this.$element;i=i||this.iframe,t(i).on("load",function(e){r.listeners.indexOf("iframeLoaded")>-1&&!r.emit({type:"iframeLoaded",target:e.target})});var o={selectorId:this.element,widgetName:r.pluginName,treeTitle:n.treeTitle,treeUrl:n.treeUrl,lazyField:n.lazyField,isEnabledSearch:n.isEnabledSearch,tabUrl:n.tabUrl,tabTitle:n.tabTitle,text:n.text,name:n.name,maxNumber:n.maxNumber,otherParam:n.otherParam,data:r.get("value"),treeExtSetting:n.treeExtSetting,tabsExtSetting:n.tabsExtSetting};if(n.beforeIframeLoad&&"function"==typeof n.beforeIframeLoad){var a=n.beforeIframeLoad(r.iframe,o);if(!a)return;a.urlParams&&"object"==typeof a.urlParams&&(o=a.urlParams)}var s=e.buildUrl(n.pageUrl,o,!0,!0);t(i).attr("src",s)},_setHeight:function(){var i=this,r=e.getViewSize(),n=null,o=t(window).scrollTop(),a=0;if(0==i._opt.maxHeight||"0"==i._opt.maxHeight)if(i.$viewBox.hasClass("dropup")){n=i.$buttonBox.offset();var s=0;this.$dropdownBox.children().not('[wui-data="menu"]').each(function(e,t){s+=t.offsetHeight}),a=n.top-o-s-10}else n=i.$selectContentBox.offset(),a=r.height-(n.top-o)-10;else a=parseInt(i._opt.maxHeight);this.$selectContentBox.height(a)},_getTextJson:function(e){var t=this._opt.text,i={};if(!t)return null;var r=/\{\{(.+?)\}\}/g,n=t.match(r);if(n)for(var o=n.length,a=0;a<o;a++){var s=/^\{\{(.+?)\}\}$/.exec(n[a]);s.length>1&&(i[s[1]]=e)}else for(var l=t.split(","),o=l.length,a=0;a<o;a++)i[l[a]]=e;return i},_parseText:function(e){var t=this._opt.text,i=t;if(t){var r=/\{\{(.+?)\}\}/g,n=t.match(r);if(n)for(var o=n.length,a=0;a<o;a++){var s=/^\{\{(.+?)\}\}$/.exec(n[a]);s.length>1&&(i=i.replace(s[0],e[s[1]]))}else{var l=t.split(","),o=l.length;if(o<2)i=e[t];else{for(var d={},a=0;a<o;a++){var u=l[a];d[u]=e[u]}i=JSON.stringify(d)}}}else i=JSON.stringify(e);return i},_addItem:function(r,n,o){var a=this,s=this._opt,l=this.$element,d=s.name,u=(s.text,this.$buttonBox),h=a.iframe;if(!(this.listeners.indexOf("beforeItemSelect")>-1)||this.emit({type:"beforeItemSelect",target:u,iframe:h})){if(s.maxNumber!==!1&&a.itemsArray.length>=s.maxNumber)return void(this.listeners.indexOf("itemSelectError")>-1&&!this.emit({type:"itemSelectError",target:u,iframe:h,item:r,code:-1,message:"最多可添加"+s.maxNumber+"个标签"}));if(r==i)return void(this.listeners.indexOf("itemSelectError")>-1&&!this.emit({type:"itemSelectError",target:u,iframe:h,item:r,code:0,message:"添加的数据不能为空"}));if("string"==typeof r&&s.trimValue&&(r=t.trim(r)),!d){if(a.listeners.indexOf("itemSelectError")>-1&&!a.emit({type:"itemSelectError",target:u,iframe:h,item:r,code:1,message:"name属性值没设置，无法添加object类型数据"}))return;return!1}var c,f,p={};if(e.isJson(r))p=r;else{if("string"!=typeof r){if(a.listeners.indexOf("itemSelectError")>-1&&!a.emit({type:"itemSelectError",target:u,iframe:h,item:r,code:5,message:"只能添加类型为object、string的数据"}))return;return!1}p[d]=r,p=t.extend(!1,{},p,a._getTextJson(r))}if(c=p[d],e.isUndefined(c)){if(a.listeners.indexOf("itemSelectError")>-1&&!a.emit({type:"itemSelectError",target:u,iframe:h,item:r,code:3,message:"添加的节点没有对应的 "+d+" 字段值"}))return;return!1}if(this.itemsName.indexOf(c)>-1){if(this.listeners.indexOf("itemSelectError")>-1&&!this.emit({type:"itemSelectError",target:u,iframe:h,item:r,code:3,message:r+" 已经被选中"}))return;return!1}f=a._parseText(p),a.itemsName.push(c),a.itemsText.push(f),a.itemsArray.push(p);var m=t(a.tagTmp);""!=s.tagClass&&m.addClass(s.tagClass);var g=f;m.attr("title",f),s.maxChars>0&&s.maxChars<f.length&&(g=g.substr(0,s.maxChars)+s.ellipsis),m.children("em").text(g),a.$input.before(m),a.$tip&&!a.$tip.hasClass("hide")&&a.$tip.addClass("hide"),l.val(this.itemsName.join(",")),m.on("click",function(t){e.stopPropagation(t)}),m.children('[data-role="remove"]').on("click",function(i){e.stopPropagation(i);var r=t(this).parent().index();a._removeItem(r,!0)});var v=a.$element.get(0);if(v.form&&t.data(v.form,"validator")&&!e.isEmptyType(a.$element.rules())&&e.validElement(a.$element),e.isUndefined(o)&&(o=!0),o){var b={item:p,iframe:h,isChecked:!0};s.updateSubpageItem&&"function"==typeof s.updateSubpageItem?s.updateSubpageItem(b):h&&h.contentWindow?h.contentWindow.gridPopupCommonService&&"object"==typeof h.contentWindow.gridPopupCommonService&&"function"==typeof h.contentWindow.gridPopupCommonService.updateResultNode?h.contentWindow.gridPopupCommonService.updateResultNode(p,!0,!0):h.contentWindow.updateSelectedNode&&"function"==typeof h.contentWindow.updateSelectedNode?h.contentWindow.updateSelectedNode(p,!0):e.logMessage("没有传入updateSubpageItem参数且下拉页面没有 updateSelectedNode() 方法","wui.tagComboBox",!0):e.logMessage("没有iframe","wui.tagComboBox",!0)}if(e.isUndefined(n)&&(n=!0),!(n&&a.listeners.indexOf("itemSelected")>-1)||a.emit({type:"itemSelected",target:u,iframe:h,item:p}))return this}},_removeItem:function(r,n,o,a){var s=this,l=this._opt,d=this.$element,u=l.name,h=(l.text,this.$buttonBox),c=this.iframe;if(!(s.listeners.indexOf("beforeItemUnselect")>-1)||s.emit({type:"beforeItemUnselect",target:h,iframe:c})){if(r===i){if(s.listeners.indexOf("itemUnselectError")>-1&&!s.emit({type:"itemUnselectError",target:h,iframe:c,item:r,code:0,message:"添加的数据不能为空"}))return;return!1}if("object"==typeof r&&!l.name){if(s.listeners.indexOf("itemUnselectError")>-1&&!s.emit({type:"itemUnselectError",target:h,iframe:c,item:r,code:1,message:"name属性值没设置，无法删除object类型数据"}))return;return!1}n=n||!1;var f=-1;if(n)f=r;else if(e.isJson(r)){var p=r[u];f=s.itemsName.indexOf(p)}else{if("string"!=typeof r){if(s.listeners.indexOf("itemUnselectError")>-1&&!s.emit({type:"itemUnselectError",target:h,iframe:c,item:r,code:5,message:"只能根据类型为object、string的数据来删除节点"}))return;return!1}f=s.itemsName.indexOf(r)}if(f<0){if(s.listeners.indexOf("itemUnselectError")>-1&&!s.emit({type:"itemUnselectError",target:h,iframe:c,item:r,code:2,message:"传入数据不存在"}))return;return!1}var m=s.itemsArray[f];s.itemsName.splice(f,1),s.itemsArray.splice(f,1),s.itemsText.splice(f,1),0==s.itemsText.length&&s.$tip&&s.$tip.hasClass("hide")&&s.$tip.removeClass("hide"),d.val(s.itemsName.join(",")),s.$buttonBox.children("span").eq(f).remove();var g=s.$element.get(0);if(g.form&&t.data(g.form,"validator")&&!e.isEmptyType(s.$element.rules())&&e.validElement(s.$element),e.isUndefined(a)&&(a=!0),a){var v={item:m,iframe:c,isChecked:!1};l.updateSubpageItem&&"function"==typeof l.updateSubpageItem?l.updateSubpageItem(v):c&&c.contentWindow?c.contentWindow.gridPopupCommonService&&"object"==typeof c.contentWindow.gridPopupCommonService&&"function"==typeof c.contentWindow.gridPopupCommonService.updateResultNode?c.contentWindow.gridPopupCommonService.updateResultNode(m,!1,!0):c.contentWindow.updateSelectedNode&&"function"==typeof c.contentWindow.updateSelectedNode?c.contentWindow.updateSelectedNode(m,!1):e.logMessage("没有传入updateSubpageItem参数且下拉页面没有 updateSelectedNode() 方法","wui.tagComboBox",!0):e.logMessage("没有iframe","wui.tagComboBox",!0)}if(e.isUndefined(o)&&(o=!0),!(o&&s.listeners.indexOf("itemUnselected")>-1)||s.emit({type:"itemUnselected",target:h,iframe:c,item:m}))return this}},get:function(e){e=e||"json";this.$element;return"value"==e?this.itemsName:"json"==e?this.itemsArray:"text"==e?this.itemsText:this.itemsArray},select:function(t,r,n){if(t!=i){if("string"==typeof t){if(""==t){if(this.listeners.indexOf("itemSelectError")>-1&&!this.emit({type:"itemSelectError",target:this.$container,iframe:this.iframe,item:t,code:6,message:"添加的节点不能为空字符串"}))return;return!1}for(var o=t.split(","),a=0;a<o.length;a++)this._addItem(o[a],r,n)}else if(e.isArray(t)){if(!(t.length>0)){if(this.listeners.indexOf("itemSelectError")>-1&&!this.emit({type:"itemSelectError",target:this.$container,iframe:this.iframe,item:t,code:6,message:"添加的节点不能为空数组"}))return;return!1}for(var a=0;a<t.length;a++)this._addItem(t[a],r,n)}else{if("object"!=typeof t){if(this.listeners.indexOf("itemSelectError")>-1&&!this.emit({type:"itemSelectError",target:this.$container,iframe:this.iframe,item:t,code:6,message:"传入的参数值不支持赋值"}))return;return!1}if(null==t){if(this.listeners.indexOf("itemSelectError")>-1&&!this.emit({type:"itemSelectError",target:this.$container,iframe:this.iframe,item:t,code:6,message:"添加的节点不能为空对象"}))return;return!1}this._addItem(t,r,n)}return this}if(!(this.listeners.indexOf("itemSelectError")>-1)||this.emit({type:"itemSelectError",target:this.$container,iframe:this.iframe,item:t,code:6,message:"必须传入添加的节点"}))return this},unselect:function(t,r,n){var o=!1;if(t!=i){if("string"==typeof t){if(""==t){if(this.listeners.indexOf("itemUnselectError")>-1&&!this.emit({type:"itemUnselectError",target:this.$container,iframe:this.iframe,item:t,code:6,message:"移除的节点不能为空字符串"}))return;return!1}for(var a=t.split(","),s=0;s<a.length;s++)this._removeItem(a[s],o,r,n)}else if(e.isArray(t)){if(t.length>0)for(var s=0;s<t.length;s++)this._removeItem(t[s],o,r,n);else if(this.listeners.indexOf("itemUnselectError")>-1&&!this.emit({type:"itemUnselectError",target:this.$container,iframe:this.iframe,item:t,code:6,message:"移除的节点不能为空数组"}))return}else if("object"==typeof t&&null!=t){if(null!=t)this._removeItem(t,o,r,n);else if(this.listeners.indexOf("itemUnselectError")>-1&&!this.emit({type:"itemUnselectError",target:this.$container,iframe:this.iframe,item:t,code:6,message:"移除的节点不能为空对象"}))return}else if(this.listeners.indexOf("itemUnselectError")>-1&&!this.emit({type:"itemUnselectError",target:this.$container,iframe:this.iframe,item:t,code:6,message:"传入的参数类型不支持移除"}))return;return this}},option:function(t){var r=this._opt;if(!t)return r;if("object"==typeof t)this._resetOption(t);else if("string"==typeof t)return"getDefOpt"===t?_:r[t]==i?e.logWarn("查找的属性值不存在",FRAME_NAME+"."+C,!0):r[t]},_resetOption:function(t){var r=this._opt,n=!1,o=!1;if(""==t.treeUrl&&0==t.tabUrl.length)return e.logError("下拉页面的数据源不能为空",FRAME_NAME+"."+C,!0),!1;if(t.direction!=i&&r.direction!=t.direction&&(this._opt.direction=t.direction,this._setDirection()),t.name&&r.name!=t.name&&(n=!0,this._opt.name=t.name),t.text&&r.text!=t.text&&(n=!0,this._opt.text=t.text),n&&this.empty(),t.maxNumber&&r.maxNumber!=t.maxNumber){var a=e.formatMaxNumber(t.maxNumber);if(this._opt.maxNumber=a,a!==!1)for(var s=this.itemsName.length;s>a;)this._removeItem(--s,!0)}if(t.lazyField!=i&&t.lazyField!=r.lazyField&&(o=!0,this._opt.lazyField=t.lazyField),t.isEnabledSearch!=i&&t.isEnabledSearch!=r.isEnabledSearch&&(o=!0,this._opt.isEnabledSearch=t.isEnabledSearch),t.otherParam!=i&&t.otherParam!=r.otherParam&&(o=!0,this._opt.otherParam=t.otherParam),t.treeTitle!=i&&t.treeTitle!=r.treeTitle&&(o=!0,this._opt.treeTitle=t.treeTitle),t.treeUrl!=i&&t.treeUrl!=r.treeUrl&&(o=!0,this._opt.treeUrl=t.treeUrl),t.tabTitle!=i&&t.tabTitle!=r.tabTitle&&(o=!0,this._opt.tabTitle=t.tabTitle),t.tabUrl!=i&&t.tabUrl!=r.tabUrl&&(o=!0,this._opt.tabUrl=t.tabUrl),t.pageUrl&&r.pageUrl!=t.pageUrl){if(""==t.pageUrl)return e.logError("必须传入下拉页面地址",FRAME_NAME+"."+C,!0),!1;o=!0,this._opt.pageUrl=t.pageUrl}t.isReload!=i&&r.isReload!=t.isReload&&(this._opt.isReload=!(!t.isReload&&"true"!=t.isReload)),o&&(this._opt.isReload||this._loadIframe())},disabled:function(){this.$input.attr("readonly",!0).attr("disabled","disabled"),this.$buttonBox.attr("disabled","disabled").removeAttr("data-toggle"),this.$buttonBox.find('[data-role="remove"]').attr("disabled","disabled"),this.$buttonBox.addClass("disabled")},enabled:function(){this.$input.removeAttr("readonly").removeAttr("disabled"),this.$buttonBox.removeAttr("disabled").attr("data-toggle","dropdown"),this.$buttonBox.find('[data-role="remove"]').removeAttr("disabled"),this.$buttonBox.removeClass("disabled")},readonly:function(){this.$input.attr("readonly",!0).attr("disabled","disabled").addClass("wui-readonly"),this.$buttonBox.attr("disabled","disabled").removeAttr("data-toggle"),this.$buttonBox.find('[data-role="remove"]').attr("disabled","disabled")},readwrite:function(){this.$input.removeAttr("readonly").removeAttr("disabled").removeClass("wui-readonly"),this.$buttonBox.removeAttr("disabled").attr("data-toggle","dropdown"),this.$buttonBox.find('[data-role="remove"]').removeAttr("disabled")},empty:function(e){var r=this,n=this._opt,o=this.$element;if(e===i&&(e=!0),e)for(var a=this.itemsName.length;a>0;)this._removeItem(--a,!0);else this.itemsName=[],this.itemsArray=[],this.itemsText=[],r.$tip&&r.$tip.hasClass("hide")&&r.$tip.removeClass("hide"),o.val(""),r.$buttonBox.children("span").each(function(){t(this).remove()});return n.onEmpty&&"function"==typeof n.onEmpty&&n.onEmpty(),this},refresh:function(){this._loadIframe()},destroy:function(){if(!(this.listeners.indexOf("destroy")>-1)||this.emit({type:"destroy",target:this.dom}))return this.$element.removeData(N),this.$element.removeAttr("ui-type"),this.$Maxcontainer.replaceWith(this.initDom),this},on:function(e,t){return E.indexOf(e)>-1&&("undefined"==typeof this.handlers[e]&&(this.handlers[e]=[],this.listeners.push(e)),this.handlers[e].push(t)),this},off:function(e,t){var r,n,o,a,s;if(E.indexOf(e)>-1&&this.handlers[e]instanceof Array){for(a=this.handlers[e],o=this.listeners,
r=0,s=o.length;r<s&&o[r]!==e;r++);if(t===i)this.listeners.splice(r,1),delete this.handlers[e];else{for(n=0,s=a.length;n<s&&a[n]!==t;n++);n<s&&(this.handlers[e].splice(n,1),0==this.handlers[e].length&&this.listeners.splice(r,1))}}return this},emit:function(e){if(e.target||(this.$Maxcontainer?e.target=this.$Maxcontainer:e.target=this),this.handlers[e.type]instanceof Array)for(var t=this.handlers[e.type],i=0,r=t.length;i<r;i++)return t[i](e),!0;return!1},component:function(){return this}},t.fn[S]=function(e){return this.each(function(){t.data(document.getElementById(r),N)||t.data(document.getElementById(r),N,new o(this,e))})},w(n),{init:w,on:s,off:l,get:d,select:u,unselect:h,enabled:f,disabled:c,readwrite:m,readonly:p,option:g,refresh:b,empty:v,component:x,destroy:y}},e}(wui||{},libs),function(e,t,i){return e.tree=function(r,n){function o(e,t){this.init()}function a(i,n){var o=t.data(document.getElementById(r),"plugin_uiTree");if(!o)return void e.logError("wui.tree 未初始化或已被销毁",FRAME_NAME+"."+F,!0);var a=Array.prototype.slice.call(arguments,1);return"function"==typeof o[i]?o[i].apply(o,a):void e.logWarn("wui.tree 中不存在 "+i+"() 方法",FRAME_NAME+"."+F,!0)}function s(e,i){var n=t.data(document.getElementById(r),M);return a("on",e,i),n}function l(e,i){var n=t.data(document.getElementById(r),M);return a("off",e,i),n}function d(e){return a("set",e)}function u(e,t){return a("get",e,t)}function h(e,t){return a("getNodeStatus",e,t)}function c(e){return a("select",e)}function f(e){return a("unselect",e)}function p(){return a("selectAll")}function m(){return a("unselectAll")}function g(e){return a("visitTree",e)}function v(e){return a("filter",e)}function b(e){return a("getTree",e)}function y(){return a("getActiveNode")}function x(e,t){return a("activateKey",e,t)}function w(){return a("disabled")}function S(e){return a("enabled",e)}function N(e){var t=Array.prototype.slice.call(arguments,0);return a("method",t)}function C(e){return a("option",e)}function E(e,t){return a("refresh",e,t)}function _(){return a("empty")}function T(){return a("destroy")}function A(){return a("component")}function B(i){return t.data(document.getElementById(r),M)?i&&e.isJson(i)?a("option",i):void 0:void t("#"+r)[$](i)}var $="uiTree",M="plugin_"+$,F="tree";if(e.logMethodCalled({className:FRAME_NAME,methodName:F,isDebug:!0,id:r}),!e.checkIsLoadPlugins(F))return!1;if(!t("#"+r).exist())return e.logError("【"+F+"】当前页面不存在 ID 为"+r+" 的DOM节点",FRAME_NAME+"."+F,!0),!1;var I=["beforeItemSelect","itemSelectError","itemSelected","beforeItemUnselect","itemUnselectError","itemUnselected"],k={loadDataUrl:"",dataType:"json",value:"",minExpandLevel:1,maxNumber:!1,name:"id",text:"name",height:"auto",width:"100%",isFullScreen:!0,offset:{top:0,bottom:0,left:0,right:0},icon:e.CONSTANTS.EMPTYFUNC,glyph:{preset:"awesome4",map:{_addClass:"fa ",checkbox:"fa-square-o",checkboxSelected:"fa-check-square-o",checkboxUnknown:"fa-square",dragHelper:"fa-arrow-right",dropMarker:"fa-long-arrow-right",error:"fa-warning",expanderClosed:"fa-caret-right",expanderLazy:"fa-angle-right",expanderOpen:"fa-caret-down",loading:"fa-spinner fa-pulse",nodata:"fa-meh-o",noExpander:"",radio:"fa-circle-thin",radioSelected:"fa-circle",doc:"fa-file-o",docOpen:"fa-file-o",folder:"fa-folder-o",folderOpen:"fa-folder-open-o"}},isAddRoot:!1,rootSetting:{key:"",title:e.language.tree.virtualRootTitle,folder:!0,lazy:!1,expand:!0},isShowCheckBox:!1,isChangeAllChildren:!1,isEnabledSearch:!1,isStrictFilter:!0,isClickFirstNode:!0,activeNode:"",searchBarSetting:{searchText:'<i class="fa fa-search"></i>',clearText:!1,searchField:"key",width:"auto",isLocalData:!0,searchUrl:null,searchBtnClass:"wui-btn-info",clearBtnClass:"wui-btn-info"},lazyField:"parentId",expandLevel:1,contextMenu:null,filter:{autoApply:!0,autoExpand:!0,counter:!1,fuzzy:!1,hideExpandedCounter:!0,hideExpanders:!1,highlight:!0,leavesOnly:!1,nodata:"过滤不到数据",mode:"hide"},jsonReader:{root:"",branchId:"key",branchName:"title",leaveId:"key",leaveName:"title",children:"children",folder:"folder",enable:"enable",synch:"synch"},onActivate:e.CONSTANTS.EMPTYFUNC,onLazyLoad:e.CONSTANTS.EMPTYFUNC,onAfterLoad:e.CONSTANTS.EMPTYFUNC,onSelectedNode:e.CONSTANTS.EMPTYFUNC,onBeforeSelect:e.CONSTANTS.EMPTYFUNC,onCreateNode:e.CONSTANTS.EMPTYFUNC,onRenderNode:e.CONSTANTS.EMPTYFUNC,onRenderTitle:e.CONSTANTS.EMPTYFUNC,onClick:e.CONSTANTS.EMPTYFUNC,onInput:!1,onEnter:!0,onCreated:e.CONSTANTS.EMPTYFUNC,onInit:e.CONSTANTS.EMPTYFUNC,onLoadError:e.CONSTANTS.EMPTYFUNC,formatParams:null},D={extensions:["filter"],name:"key",text:"title",folder:"folder",children:"children",selectMode:2};return o.prototype={constructor:o,init:function(){this.pluginName=F,this.hasDom=!1,this.element=r,this.$element=t("#"+r),this.defaults=D,this._option=n,this.initDom=t("#"+r).prop("outerHTML");var i=e.getAttributeParams(this.$element,k);this._opt=t.extend(!0,{},k,n,i),this._tree=null,this.container=null,this.searchInput=null,this.searchBtn=null,this.itemsName=[],this.itemsText=[],this.itemsArray=[],this.listeners=[],this.handlers={},this.status="init",this._formatParams(),this.dom=this._initDom()},_formatParams:function(){var t=this._opt;return this._opt.maxNumber=e.formatMaxNumber(t.maxNumber),1==this._opt.maxNumber?(this.defaults.selectMode=1,this.$element.addClass("fancytree-radio"),this._opt.isChangeAllChildren=!1):(this.defaults.selectMode=2,this.$element.removeClass("fancytree-radio")),this._opt},_prependSearchGroup:function(){var e=this,t=this._opt,i=(this.$element,"");i+='<div class="input-group" data-tree-searchbar>',i+='    <input type="text" wui-widget-hidden="true" class="wui-input" />',i+='    <span class="input-group-btn">',i+='        <button class="wui-btn '+t.searchBarSetting.searchBtnClass+'" data-tree-search type="button">'+t.searchBarSetting.searchText+"</button>",t.searchBarSetting.clearText&&(i+='        <button class="wui-btn '+t.searchBarSetting.clearBtnClass+'" data-tree-clear type="button">'+t.searchBarSetting.clearText+"</button>"),i+="    </span>",i+="</div>",e.container.prepend(i),e.container.children("[data-tree-searchbar]").css({width:t.searchBarSetting.width}),e.searchBtn=e.container.find("[data-tree-search]"),e.clearBtn=e.container.find("[data-tree-clear]"),e.searchInput=e.container.find("input").eq(0)},_bindSearchEvent:function(){var t=this,i=this._opt,r=this._opt.searchBarSetting,n=t.searchInput.val();if(r.isLocalData)t.filter({filter:function(e){return e.title.indexOf(n)>-1}});else{var o,a={};a[i.searchBarSetting.searchField]=n,o=r.searchUrl?e.buildUrl(r.searchUrl,a):e.buildUrl(i.loadDataUrl,a),t._initTree(o)}},_bindResetEvent:function(){var t=this,i=this._opt,r=this._opt.searchBarSetting,n="";if(t.searchInput.val(""),r.isLocalData)t.filter({filter:function(e){return!0}});else{var o,a={};a[i.searchBarSetting.searchField]=n,a.isReset=!0,o=e.buildUrl(i.loadDataUrl,a),t._initTree(o)}},_setTreeSize:function(){var i=this,r=this._opt,n=this.$element,o=(i.container.parent().height(),0),a=0;"auto"==r.height?i.container.css({height:"auto"}):(i.container.height(r.height),o=i.container.height(),n.siblings().each(function(e,i){a+=t(i).outerHeight(!0)}),n.height(o-a)),e.scroll(n.children())},_setTreeFullScreen:function(){var i=this,r=(this._opt,this.$element),n=this._opt.offset,o=e.getFullScreenSize(i.container),a=o.height>10?o.height:i.container.parent().height();if(o){var s=a-parseFloat(n.top)-parseFloat(n.bottom);i.container.height(s);var l=0;r.siblings().each(function(e,i){var r=t(i).outerHeight(!0);l+=r});var d=s-l;r.height(d),e.scroll(r.children())}},_initDom:function(){var r=this,n=this._opt,o=this.$element;if(!o.parent().hasClass("wui-tree")){var a='<div class="wui-tree"></div>';o.wrap(a)}if(r.container=r.$element.parent(),n.isEnabledSearch?0==r.container.children(".input-group").length?r._prependSearchGroup():(r.searchInput=r.container.find("input").eq(0),r.searchBtn=r.container.find("[data-tree-search]"),r.clearBtn=r.container.find("[data-tree-clear]")):(r.searchInput=null,r.searchBtn=null,r.clearBtn=null,r.container.children(".input-group").length>0&&r.container.children(".input-group").remove()),"string"==typeof n.value)n.value=n.value.split(",");else if(e.isArray(n.value)){var s=[];t.each(n.value,function(t,i){e.isJson(i)?s.push(i[n.name]):s.push(i)}),n.value=s}if(n.contextMenu)try{t.ui.fancytree._extensions.contextMenu?r.defaults.extensions.push("contextMenu"):e.logWarn("没有加载 tree右键功能 所需第三方插件:contextMenu",FRAME_NAME+"."+F,!0)}catch(l){e.logWarn("没有加载 tree右键功能 所需第三方插件:contextMenu",FRAME_NAME+"."+F,!0)}return t.ui.fancytree._FancytreeNodeClass.prototype.setEnable=function(i,r){i=i!==!1,this.enable=i,this.enable?this.removeClass("fancytree-disabled"):this.addClass("fancytree-disabled"),e.isUndefined(r)?r=this.isSynchChildrensEnable():this.setSynchChildrensEnable(r,!1),r&&this.hasChildren()&&t.each(this.getChildren(),function(e,t){t.isEnable()!==i&&t.setEnable(i,!0)})},t.ui.fancytree._FancytreeNodeClass.prototype.setSynchChildrensEnable=function(e,i){if(e=e||!1,i!==!1&&(i=!0),this.synchChildrensEnable=e,e&&i&&this.hasChildren()){var r=this.isEnable();t.each(this.getChildren(),function(t,i){i.isEnable()!==r&&i.setEnable(r,e)})}},t.ui.fancytree._FancytreeNodeClass.prototype.isEnable=function(){return this.enable},t.ui.fancytree._FancytreeNodeClass.prototype.isSynchChildrensEnable=function(){return this.synchChildrensEnable},t.ui.fancytree._FancytreeNodeClass.prototype.getSelectedChildrenNodes=function(r){if(r===i&&(r=!0),this.isFolder){var n=this.getChildren();if(n){var o=[];return t.each(n,function(e,t){t.isSelected()&&(t.isEnable()?o.push(t):r&&o.push(t))}),o.length>0?o:null}e.logMessage("该节点没有加载下一级子节点","wui.tree",!0)}else e.logMessage("该节点没有下一级子节点","wui.tree",!0);return null},t.ui.fancytree._FancytreeNodeClass.prototype.getUnselectedChildrenNodes=function(r){if(r===i&&(r=!0),this.isFolder){var n=this.getChildren();if(n){var o=[];return t.each(n,function(e,t){t.isSelected()||(t.isEnable()?o.push(t):r&&o.push(t))}),o.length>0?o:null}e.logMessage("该节点没有加载下一级子节点","wui.tree",!0)}else e.logMessage("该节点没有下一级子节点","wui.tree",!0);return null},t.ui.fancytree._FancytreeNodeClass.prototype.getChildrenNodes=function(r){if(r===i&&(r=!0),this.isFolder){var n=this.getChildren();if(n){if(r)return n;var o=[];return t.each(n,function(e,t){t.isEnable()&&o.push(t)}),o}e.logMessage("该节点没有加载下一级子节点","wui.tree",!0)}else e.logMessage("该节点没有下一级子节点","wui.tree",!0);return null},t.ui.fancytree._FancytreeNodeClass.prototype.setPartSelect=function(e){e===i&&(e=!0),this.isRoot()||(this.getSelectedChildrenNodes(!1)&&this.getUnselectedChildrenNodes(!1)?(this.isSelected()&&this.setSelected(!1),this.addClass("fancytree-partsel"),this.partSelect=!0):(this.removeClass("fancytree-partsel"),this.partSelect=!1,this.getSelectedChildrenNodes(!1)?this.setSelected(!0):this.setSelected(!1)))},t.ui.fancytree._FancytreeNodeClass.prototype.isPartSelect=function(){var e=!1;return this.getSelectedChildrenNodes(!1)&&this.getUnselectedChildrenNodes(!1)&&(e=!0),e},r._initTree(n.loadDataUrl),this.hasDom=!0,o.prop("outerHTML")},_postProcessSource:function(i,r){"loading"==this.status&&(r=!1),(this.status="init")&&(this.status="loading");var n=this,o=this._opt,a=(this.$element,o.jsonReader),s=a.branchId,l=a.branchName,d=a.leaveId,u=a.leaveName,h=a.children,c=a.folder,f=o.name,p=o.text,m=this.defaults,g=[];if(t.each(i,function(t,i){i[h]&&i[h].length>0?(i[s]&&!i[m.name]&&(i[m.name]=i[s]),i[l]&&!i[m.text]&&(i[m.text]=i[l]),i[c]&&!i[m.folder]?i[m.folder]=i[c]:i[m.folder]=!0,i[m.children]=n._postProcessSource(i[h],!1)):(i[d]&&!i[m.name]&&(i[m.name]=i[d]),i[u]&&!i[m.text]&&(i[m.text]=i[u])),e.isUndefined(i[f])&&(i[f]=i[m.name]),e.isUndefined(i[p])&&(i[p]=i[m.text]),g.push(i)}),r&&!e.isEmptyType(i)){var v=e.deepCopy(o.rootSetting);v.children=g;var b=[v];return b}return g},_formatSource:function(t){var i=this,r=this._opt,n=(this.$element,r.jsonReader),o=(n.branchId,n.branchName,n.leaveId,n.leaveName,n.children,n.folder,this.defaults,[]);return e.isArray(t)?(r.searchBarSetting.isLocalData=!0,o=i._postProcessSource(t,r.isAddRoot)):"string"==typeof t&&(o={url:t,dataType:r.dataType}),o},_getOptions:function(i){var r=this,n=this._opt,o=this.$element;this.isFirstLoad=!0,this.itemsName=[],this.itemsText=[],this.itemsArray=[],this.nodesArray=[];var a=r._formatSource(i),s={source:a,minExpandLevel:n.minExpandLevel,checkbox:n.isShowCheckBox,selectMode:r.defaults.selectMode,extensions:r.defaults.extensions,contextMenu:n.contextMenu,filter:n.filter,icon:n.icon,glyph:n.glyph,create:function(e,t){n.onCreated&&"function"==typeof n.onCreated&&n.onCreated(this,e,t)},postProcess:function(e,t){var i,o=n.jsonReader.root,a=t.response;return i=o?a[o]:a,t.result=r._postProcessSource(i,n.isAddRoot),t},init:function(i,o,a){var s=r.$element.fancytree("getTree");s.getActiveNode();this.status="loaded";var l=function(e,i){if(e.setExpanded(!0),i>0){var r=e.getChildren();if(!r)return!1;t.each(r,function(e,t){l(t,i-1)})}return!1};"boolean"==typeof n.expandLevel&&1==n.expandLevel?s.visit(function(e){e.setExpanded(!0)}):n.expandLevel&&parseInt(n.expandLevel)>0&&l(s.getRootNode(),n.expandLevel),n.activeNode?"string"==typeof n.activeNode?s.visit(function(e){if(e.key===n.activeNode)return e.setActive(!0),!1}):n.activeNode.setActive(!0):n.isClickFirstNode&&r.$element.find("span").eq(0).click(),n.isEnabledSearch&&(n.onInput&&r.searchInput.off("input propertychange").on("input propertychange",function(i){e.stopPropagation(i);t(this).val();n.onInput===!0?r._bindSearchEvent():"function"==typeof n.onInput&&n.onInput(this,i),t(this).focus()}),n.onEnter&&r.searchInput.off("keyup").on("keyup",function(t){var i=window.event?t.keyCode:t.which;i!=e.CONSTANTS.KEYS.ENTER&&i!=e.CONSTANTS.KEYS.OTHER||(n.onEnter===!0?r._bindSearchEvent():n.onEnter&&"function"==typeof n.onEnter&&n.onEnter(this,t))}),r.searchBtn&&r.searchBtn.off("click").on("click",function(e){r._bindSearchEvent()}),r.clearBtn&&r.clearBtn.off("click").on("click",function(e){r._bindResetEvent()})),n.isFullScreen?(e.onresize(function(e,t){r._setTreeFullScreen()}),r._setTreeFullScreen()):(e.onresize(function(e,t){r._setTreeSize()}),r._setTreeSize()),r.isFirstLoad=!1,n.onInit&&"function"==typeof n.onInit&&n.onInit.call(this,i,o,a)},activate:function(e,t){var i=t.node;return!(n.isStrictFilter&&!i.isMatched())&&(i.enable!==!1&&(n.activeNode=i.key,void(n.onActivate&&"function"==typeof n.onActivate?n.onActivate(e,t):n.activate&&"function"==typeof n.activate&&n.activate(e,t))))},beforeSelect:function(t,i){var o=i.node,a=o.isSelected();if(e.logParamValue({paramName:"node",paramValue:o,methodName:"beforeSelect",className:"wui.tree",isDebug:!0}),o.enable===!1)return!1;var s=!0;if(n.onBeforeSelect&&"function"==typeof n.onBeforeSelect?s=n.onBeforeSelect(t,i):n.beforeSelect&&"function"==typeof n.beforeSelect&&(s=n.beforeSelect(t,i)),a){if(r.listeners.indexOf("beforeItemUnselect")>-1&&!r.emit({type:"beforeItemUnselect",target:t.target,node:o}))return}else{if(r.listeners.indexOf("beforeItemSelect")>-1&&!r.emit({type:"beforeItemSelect",target:t.target,node:o}))return;var l=n.maxNumber;if("number"==typeof l&&l>1&&r.itemsName.length>=l){if(r.listeners.indexOf("itemSelectError")>-1&&!r.emit({type:"itemSelectError",target:t.target,node:o,code:-1,message:"最多可添加"+l+"个标签"}))return;return!1}}return s},loadChildren:function(e,t){n.onAfterLoad&&"function"==typeof n.onAfterLoad?n.onAfterLoad(e,t):n.afterLoad&&"function"==typeof n.afterLoad&&n.afterLoad(e,t)},loadError:function(e,t){if(n.onLoadError&&"function"==typeof n.onLoadError)return n.onLoadError(e,t)},select:function(e,i){var o=i.node,a=e.target,s=o[r.defaults.name],l=o[r.defaults.text],d={selected:o.isSelected()};if(!o.isRoot()){if(d[n.name]=s,d[n.text]=l,o.isSelected())r.itemsName.push(s),r.itemsText.push(l),r.itemsArray.push(d),r.nodesArray.push(o);else{var u=r.itemsName.indexOf(s);u>-1&&(r.itemsName.splice(u,1),r.itemsText.splice(u,1),r.itemsArray.splice(u,1),r.nodesArray.splice(u,1))}if(n.isChangeAllChildren){var h=o.getParent();if(h&&!h.isRoot()&&(h.isSelected()==o.isSelected()&&(o.isSelected()||h.isPartSelect())||h.setPartSelect(!0)),o.isFolder()){var c=o.getUnselectedChildrenNodes(!1),f=o.getSelectedChildrenNodes(!1),p=o.getChildrenNodes(!1);p&&(o.isSelected()?(!f||f.length<p.length)&&t.each(c,function(e,t){t.setSelected(o.isSelected())}):f&&f.length==p.length&&t.each(f,function(e,t){t.setSelected(o.isSelected())}))}else if(n.onSelectedNode&&"function"==typeof n.onSelectedNode?n.onSelectedNode(d,o):n.selectFun&&"function"==typeof n.selectFun&&n.selectFun(d,o),o.isSelected()){if(r.listeners.indexOf("itemSelected")>-1&&!r.emit({type:"itemSelected",target:a,item:d,node:o}))return}else if(r.listeners.indexOf("itemUnselected")>-1&&!r.emit({type:"itemUnselected",target:a,item:d,node:o}))return}else if(n.onSelectedNode&&"function"==typeof n.onSelectedNode?n.onSelectedNode(d,o):n.selectFun&&"function"==typeof n.selectFun&&n.selectFun(d,o),o.isSelected()){if(r.listeners.indexOf("itemSelected")>-1&&!r.emit({type:"itemSelected",target:a,item:d,node:o}))return}else if(r.listeners.indexOf("itemUnselected")>-1&&!r.emit({type:"itemUnselected",target:a,item:d,node:o}))return}},createNode:function(t,i){var o={methodName:"createNode",className:"wui.tree",id:r.element,isDebug:!0};e.logMethodCalled(o);var a=i.node,s=n.jsonReader.enable,l=n.jsonReader.synch,d=a[r.defaults.name];if(a.data[l]===!0?a.setSynchChildrensEnable(!0,!1):a.parent&&a.parent.isSynchChildrensEnable()?a.setSynchChildrensEnable(!0,!1):a.setSynchChildrensEnable(!1,!1),a.data[s]===!1?a.setEnable(!1):a.parent&&a.parent.isSynchChildrensEnable()?a.setEnable(a.parent.isEnable()):a.setEnable(!0),d){var u=n.value.indexOf(d),h=r.itemsName.indexOf(d);u>-1?(a.setSelected(!0),n.value.splice(u,1)):h>-1?a.setSelected(!0):n.isChangeAllChildren&&a.getParent().isSelected()&&a.setSelected(!0)}if(n.onCreateNode&&"function"==typeof n.onCreateNode)return n.onCreateNode.call(this,t,i)},renderNode:function(e,t){if(n.onRenderNode&&"function"==typeof n.onRenderNode)return n.onRenderNode.call(this,e,t)},renderTitle:function(e,t){if(n.onRenderTitle&&"function"==typeof n.onRenderTitle)return n.onRenderTitle.call(this,e,t)},beforeExpand:function(e,t){if(n.onBeforeExpand&&"function"==typeof n.onBeforeExpand)return n.onBeforeExpand.call(this,e,t)},click:function(e,t){if(n.onClick&&"function"==typeof n.onClick)return n.onClick.call(this,e,t)},collapse:function(t,i){if(e.scroll(o.children()),n.onCollapse&&"function"==typeof n.onCollapse)return n.onCollapse.call(this,t,i)},expand:function(i,r){var a=r.node,s=(n.jsonReader.enable,a.getChildren());if(s&&t.each(s,function(e,t){t.setEnable(t.enable)}),e.scroll(o.children()),n.onExpand&&"function"==typeof n.onExpand)return n.onExpand.call(this,i,r)},lazyLoad:function(e,t){n.onLazyLoad&&"function"==typeof n.onLazyLoad?n.onLazyLoad(e,t):n.lazyLoad&&"function"==typeof n.lazyLoad?n.lazyLoad(e,t):r._onLazyLoad(e,t)}};return s},_initTree:function(i){var r=this,n=this._opt,o=this.$element;this._tree&&(this.$element.fancytree("destroy"),this._tree=null),this.status="init";var a=r._getOptions(i);if(n.formatParams)if("object"==typeof n.formatParams)t.extend(!0,a,n.formatParams);else if("function"==typeof n.formatParams){var s=n.formatParams(a);"object"==typeof s&&t.extend(!0,a,s)}e.logParamValue({paramName:"options",paramValue:a,methodName:"_initTree",className:"wui.tree",isDebug:!0}),o.fancytree(a),this._tree=this.$element.fancytree("getTree")},_onLazyLoad:function(t,i){var r=this._opt,n=i.node,o=n.data;o?(o.key=n.key,o.title=n.title):o={key:n.key,title:n.title},o[r.lazyField]=n.key;var a=e.buildUrl(r.loadDataUrl,o);i.result={url:a,debugDelay:200}},option:function(t){var r=this._opt;if(!t)return r;if("object"==typeof t)this._resetOption(t);else if("string"==typeof t)return"getDefOpt"===t?k:r[t]==i?e.logWarn("查找的属性值不存在",FRAME_NAME+"."+F,!0):r[t]},_resetOption:function(i){var r=this,n=e.deepCopy(this._opt);i.loadDataUrl&&(n.loadDataUrl=null),this._option=i,this._opt=t.extend(!0,{},n,i),this._opt.value="";var o=this._formatParams();e.logParamValue({paramName:"newParams",paramValue:o,methodName:"_resetOption",className:"wui.tree",isDebug:!0}),r.searchInput&&r.searchInput.val(""),this.dom=this._initTree(o.loadDataUrl)},refresh:function(e,t){var i=this,r=this._opt,e=e||r.loadDataUrl;t&&(this._opt.activeNode=""),i._initTree(e)},empty:function(){var e=this;e._tree.visit(function(e){e.setSelected(!1)})},destroy:function(){return this.$element.fancytree()&&(this.$element.fancytree("destroy"),this._tree=null),this.$element.removeData(M),this.$element.removeAttr("ui-type"),this.container.replaceWith(this.initDom),this},on:function(e,t){return I.indexOf(e)>-1&&("undefined"==typeof this.handlers[e]&&(this.handlers[e]=[],this.listeners.push(e)),this.handlers[e].push(t)),this},off:function(e,t){var r,n,o,a,s;if(I.indexOf(e)>-1&&this.handlers[e]instanceof Array){for(a=this.handlers[e],o=this.listeners,r=0,s=o.length;r<s&&o[r]!==e;r++);if(t===i)this.listeners.splice(r,1),delete this.handlers[e];else{for(n=0,s=a.length;n<s&&a[n]!==t;n++);n<s&&(this.handlers[e].splice(n,1),0==this.handlers[e].length&&this.listeners.splice(r,1))}}return this},emit:function(e){if(e.target||(this.$Maxcontainer?e.target=this.$Maxcontainer:e.target=this),this.handlers[e.type]instanceof Array)for(var t=this.handlers[e.type],i=0,r=t.length;i<r;i++)return t[i](e),!0;return!1},component:function(){return this},getActiveNode:function(){return this._tree.getActiveNode()},activateKey:function(e,i){if(!e)return null;var r=e.split(","),n=null;if(1==r.length)n=this.$element.fancytree("getTree").activateKey(e);else{var o=this._tree.rootNode,a=function(e){var i=e.children;return!!i&&void t.each(i,function(){if(this.key==r[0])return this.isExpanded()||this.setExpanded(!0),r.splice(0,1),0==r.length?n=this:this.hasChildren()&&a(this),!1})};a(o)}return i&&n&&n.setSelected(!0),n},method:function(e,t){var i=Array.prototype.slice.call(arguments,1);return this._tree[e].call(this._tree,i)},_setUnselected:function(e){var t=this,r=this._opt.name,n=this.defaults.name,o="",a=!1,s=!1;if("string"==typeof e?o=e:"object"==typeof e&&(o=e[r]),o==i){if(t.listeners.indexOf("itemUnselectError")>-1&&!t.emit({type:"itemUnselectError",target:t.$element[0],item:e,code:2,message:"传入的对象中不存在"+r+"属性值"}))return;return!1}if(this._tree.visit(function(e){var t=e[n];if(t===o)return e.setSelected(s),a=!0,!1}),!a){if(t.listeners.indexOf("itemUnselectError")>-1&&!t.emit({type:"itemUnselectError",target:t.$element[0],item:e,code:0,message:"查无此节点"}))return;return!1}},_setSelected:function(e){var t=this,r=this._opt.name,n=this.defaults.name,o="",a=!1,s=!0;if("string"==typeof e?o=e:"object"==typeof e&&(o=e[r]),o==i){if(t.listeners.indexOf("itemSelectError")>-1&&!t.emit({type:"itemSelectError",target:t.$element[0],item:e,code:2,message:"传入的对象中不存在"+r+"属性值"}))return;return!1}if(this._tree.visit(function(e){var t=e[n];if(t===o)return e.setSelected(s),a=!0,!1}),!a){if(t.listeners.indexOf("itemSelectError")>-1&&!t.emit({type:"itemSelectError",target:t.$element[0],item:e,code:0,message:"查无此节点"}))return;return!1}},set:function(t){var r=this.$element[0];if(t!=i){if(this.empty(),"string"==typeof t){if(""==t){if(this.listeners.indexOf("itemSelectError")>-1&&!this.emit({type:"itemSelectError",target:r,item:t,code:6,message:"添加的节点不能为空字符串"}))return;return!1}for(var n=t.split(","),o=0;o<n.length;o++)this._setSelected(n[o])}else if(e.isArray(t)){if(!(t.length>0)){if(this.listeners.indexOf("itemSelectError")>-1&&!this.emit({type:"itemSelectError",target:r,item:t,code:6,message:"添加的节点不能为空数组"}))return;return!1}for(var o=0;o<t.length;o++)this._setSelected(t[o])}else{if("object"!=typeof t){if(this.listeners.indexOf("itemSelectError")>-1&&!this.emit({type:"itemSelectError",target:r,item:t,code:6,message:"传入的参数值不支持赋值"}))return;return!1}if(null==t){if(this.listeners.indexOf("itemSelectError")>-1&&!this.emit({type:"itemSelectError",target:r,item:t,code:6,message:"添加的节点不能为空对象"}))return;return!1}this.empty(),this._setSelected(t)}return this}if(!(this.listeners.indexOf("itemSelectError")>-1)||this.emit({type:"itemSelectError",target:r,item:t,code:6,message:"必须传入添加的节点"}))return this},get:function(e,i){this._opt.name,this._opt.text;if(e=e||"json",i=i||!1){var r=[],n=[],o=[],a=[];return t.each(this.nodesArray,function(e,t){t.isFolder()||(r.push(t),n.push(this.itemsName[e]),o.push(this.itemsText[e]),a.push(this.itemsArray[e]))}),"value"==e?n:"json"==e?a:"text"==e?o:r}return"value"==e?this.itemsName:"json"==e?this.itemsArray:"text"==e?this.itemsText:this.nodesArray},getNodeStatus:function(e,t){var i=(this._opt.name,this.defaults.name),r=!1,n=null;return this._tree.visit(function(t){var o=t[i];if(o===e)return n=t,r=t.selected,!1}),t&&"function"==typeof t&&t(r,n),r},visitTree:function(e){var t=this,i=(this._opt.name,this.defaults.name),r=t._tree;this._tree.visit(function(t){var n=t[i];if(e&&"function"==typeof e){var o=e.call(r,t,i,n);if(o===!1)return!1}})},filter:function(i){var r=this._opt;i=i||{};var n={filterMode:"branches",filter:"",options:{},isResetCheckbox:!0};i=t.extend(!0,{},n,i);try{if(t.ui.fancytree._extensions.filter){var o=0;if("nodes"==i.filterMode)o=this._tree.filterNodes(i.filter,i.options);else{if("branches"!=i.filterMode)return!1;o=this._tree.filterBranches(i.filter,i.options)}return this._tree.visit(function(e){if(e.isSelected()&&i.isResetCheckbox&&e.setSelected(!1),r.isStrictFilter){var n=!e.isMatched();e.unselectable=n,n?t(e.span).addClass("fancytree-unselectable"):t(e.span).removeClass("fancytree-unselectable")}}),o}e.logWarn("没有加载 tree filter模块",FRAME_NAME+"."+F,!0)}catch(a){e.logWarn(a,FRAME_NAME+"."+F,!0)}},select:function(t){var r=this.$element[0];if(t!=i)if("string"==typeof t){if(""==t){if(this.listeners.indexOf("itemSelectError")>-1&&!this.emit({type:"itemSelectError",target:r,item:t,code:6,message:"添加的节点不能为空字符串"}))return;return!1}for(var n=t.split(","),o=0;o<n.length;o++)this._setSelected(n[o])}else if(e.isArray(t)){if(!(t.length>0)){if(this.listeners.indexOf("itemSelectError")>-1&&!this.emit({type:"itemSelectError",target:r,item:t,code:6,message:"添加的节点不能为空数组"}))return;return!1}for(var o=0;o<t.length;o++)this._setSelected(t[o])}else{if("object"!=typeof t){if(this.listeners.indexOf("itemSelectError")>-1&&!this.emit({type:"itemSelectError",target:r,item:t,code:6,message:"传入的参数值不支持赋值"}))return;return!1}if(null==t){if(this.listeners.indexOf("itemSelectError")>-1&&!this.emit({type:"itemSelectError",target:r,item:t,code:6,message:"添加的节点不能为空对象"}))return;return!1}this._setSelected(t)}else if(this.listeners.indexOf("itemSelectError")>-1&&!this.emit({type:"itemSelectError",target:r,item:t,code:6,message:"必须传入添加的节点"}))return;return!0},unselect:function(t){var r=this.$element[0];if(t!=i){if("string"==typeof t){if(""==t){if(this.listeners.indexOf("itemUnselectError")>-1&&!this.emit({type:"itemUnselectError",target:r,item:t,code:6,message:"移除的节点不能为空字符串"}))return;return!1}for(var n=t.split(","),o=0;o<n.length;o++)this._setUnselected(n[o])}else if(e.isArray(t)){if(!(t.length>0)){if(this.listeners.indexOf("itemUnselectError")>-1&&!this.emit({type:"itemUnselectError",target:r,item:t,code:6,message:"移除的节点不能为空数组"}))return;return!1}for(var o=0;o<t.length;o++)this._setUnselected(t[o])}else{if("object"!=typeof t||null==t){if(this.listeners.indexOf("itemUnselectError")>-1&&!this.emit({type:"itemUnselectError",target:r,item:t,code:6,message:"传入的参数类型不支持移除"}))return;return!1}if(null==t){if(this.listeners.indexOf("itemUnselectError")>-1&&!this.emit({type:"itemUnselectError",target:r,item:t,code:6,message:"移除的节点不能为空对象"}))return;return!1}this._setUnselected(t)}return!0}},selectAll:function(){var e=this;e._tree.visit(function(e){e.setSelected(!0)})},unselectAll:function(){var e=this;e._tree.visit(function(e){e.setSelected(!1)})},getTree:function(){return this._tree},disabled:function(){var e=this._tree;e.visit(function(e){e.setEnable(!1,!0)})},enabled:function(e){var t=this._tree,i=this._opt.jsonReader.enable;t.visit(function(t){e?t.setEnable(!0,!0):t.data[i]!==!1&&t.setEnable(!0,!0)})}},t.fn[$]=function(e){return this.each(function(){t.data(document.getElementById(r),M)||t.data(document.getElementById(r),M,new o(this,e))})},B(n),{init:B,on:s,off:l,get:u,set:d,getNodeStatus:h,getActiveNode:y,select:c,unselect:f,selectAll:p,unselectAll:m,filter:v,activateKey:x,visitTree:g,option:C,refresh:E,empty:_,destroy:T,method:N,disabled:w,enabled:S,component:A,getTree:b}},e}(wui||{},libs),function(e,t,i){return e.grid=function(r,n){function o(e,t){this.init(t)}function a(i,n){var o=t.data(document.getElementById(r),_pluginDataName);if(!o)return void e.logError("wui.grid 未初始化或已被销毁",FRAME_NAME+"."+_widgetName,!0);var a=Array.prototype.slice.call(arguments,1);return"function"==typeof o[i]?o[i].apply(o,a):void e.logWarn("wui.grid 中不存在 "+i+"() 方法",FRAME_NAME+"."+_widgetName,!0)}function s(e,i){var n=t.data(document.getElementById(r),_pluginDataName);return a("on",e,i),n}function l(e,i){var n=t.data(document.getElementById(r),_pluginDataName);return a("off",e,i),n}function d(e,t){return a("selectRows",e,t)}function u(e,t){return a("selectAllRows",e,t)}function h(e,t){return a("select",e,t)}function c(e,t){return a("unselect",e,t)}function f(e,t){return a("deleteSelectedRows",e,t)}function m(e,t){return a("getSelectedRows",e,t)}function g(e,t){return a("getRowsDataById",e,t)}function v(e){return a("addRowsData",e)}function b(e,t){return a("customSearchBar",e,t)}function y(e,t,i){return a("searchGrid",e,t,i)}function x(){return a("scroll")}function w(){return a("getSearchFiltersData")}function S(e,t){return a("searchGridFromSearchBar",e,t)}function N(){return a("showSearchBarRow")}function C(){return a("hideSearchBarRow")}function E(){return a("resetGrid")}function _(){return a("refreshGrid")}function T(){return a("refreshData")}function A(e){return a("disableRows",e)}function B(e){return a("enableRows",e)}function $(e){return a("mergerRows",e)}function M(){return a("exportGrid")}function F(){return a("showSearchGrid")}function I(){return a("showFilterSearch")}function k(e){return a("setGroupHeaders",e)}function D(e){return a("option",e)}function U(){return a("destroy")}function R(){return a("component")}function L(i){return t.data(document.getElementById(r),_pluginDataName)?i&&e.isJson(i)?a("option",i):void 0:void t("#"+r)[O](i)}var O="uiGrid";if(_pluginDataName="plugin_"+O,_widgetName="grid",e.logMethodCalled({className:FRAME_NAME,methodName:_widgetName,isDebug:!0,id:r}),!e.checkIsLoadPlugins(_widgetName))return!1;if(!t("#"+r).exist())return e.logError("【"+_widgetName+"】当前页面不存在 ID 为"+r+" 的DOM节点",FRAME_NAME+"."+_widgetName,!0),!1;var P={url:"",localData:[],isShowPageBar:!0,gridPageId:"",gridToolbar:"",isShowCheckBox:!0,maxNumber:!1,isEnableSelectAll:!1,mtype:"GET",otherParam:{},dataType:"json",colModel:[],sortname:"",sortorder:"asc",rowNum:10,rowList:[5,10,50,100],rowNumbersTitle:"序号",isShowRowNumbers:!1,mergerRowsField:"",altclass:"ui-widget-altclass",colMenu:!0,altRows:!0,pagerpos:"right",recordpos:"left",multiSort:!1,shrinkToFit:!1,height:"auto",width:"100%",autowidth:!1,direction:"left",scroll:!1,isFullScreen:!0,offset:{top:0,bottom:20,left:0,right:0},searchColNum:3,searchBarSetting:{searchText:e.language.grid.searchBar.searchBtn,resetText:e.language.grid.searchBar.resetBtn,showMoreText:e.language.grid.searchBar.showMoreBtn,hideMoreText:e.language.grid.searchBar.hideMoreBtn,fieldIdPrefix:"wui_"+r+"_searchbar_",labelClass:"",contentClass:"",btnCellClass:"",isSetWidth:!0,titleColWidthRec:1,contentColWidthRec:2,btnColWidth:"15%"},actions:["search","reset","showHide"],isSortable:!1,caption:"",exportUrl:"",toolBarSetting:{btnResetText:e.language.grid.toolBar.resetBtn,btnShowFilterText:e.language.grid.toolBar.showFilterBtn,btnShowSearchText:e.language.grid.toolBar.highSearchBtn,btnExportText:e.language.grid.toolBar.exportBtn,btnImportText:e.language.grid.toolBar.importBtn,btnScreenText:e.language.grid.toolBar.screenBtn,btnFilterShowText:e.language.grid.toolBar.filterShowString,btnFilterHideText:e.language.grid.toolBar.filterHideString,maxShowNumber:6},modalWindow:"self",
pageBarSetting:{leftCellWidth:"150px",centerCellWidth:"10px",rightCellWidth:""},btnReset:!1,btnShowSearch:!1,btnShowFilter:!1,btnScreen:!1,btnExport:!1,btnImport:!1,importSetting:{pageUrl:e.commonPageBasePath+"wui.grid.import.html",pageHeight:"700px",pageWidth:"400px",pageTitle:e.language.grid.importPageTitle,fileUploadUrl:e.serviceInterface.gridFileUploadServiceAPI,importUrl:e.serviceInterface.gridImportServiceAPI,otherParam:{},maxNumber:1,maxFilesize:40,acceptedFiles:".xlsx,.xls",jsonReader:{},onSuccess:e.CONSTANTS.EMPTYFUNC},exportSetting:{defaultMode:""},isShowSearchBar:!0,isHideSearchRows:!0,isShowSearchOperator:!1,isShowRecords:!0,isLoadonce:!1,isEnableCellEdit:!1,isClickRow:!0,groupOp:"AND",prmNames:{page:"page",rows:"rows",sort:"sidx",order:"sord",search:"_search",nd:"nd",id:"id",oper:"oper",editoper:"edit",addoper:"add",deloper:"del",subgridid:"id",npage:null,totalrows:"totalrows"},jsonReader:{root:"rows",page:"page",total:"total",records:"records",repeatitems:!0,cell:"cell",id:"id",userdata:"userdata",subgrid:{root:"rows",repeatitems:!0,cell:"cell"}},isTreeGrid:!1,treeGridModel:"adjacency",treeExpandColumn:"",isClickNodeExpandCol:!0,treeIconsSetting:{plus:e.language.grid.treeIcon.plus,minus:e.language.grid.treeIcon.minus,leaf:e.language.grid.treeIcon.leaf},treeReader:{level_field:"level",parent_id_field:"parent",leaf_field:"isLeaf",expanded_field:"expanded",lazy_field:"isLazy"},lazySetting:{lazyField:"id",otherParam:{},dataType:"json",contentType:"application/json"},grouping:!1,groupingView:{groupField:[],groupColumnShow:[!0],groupText:["<b>{0} - {1} 条记录{Amount}</b>"],groupCollapse:!1,groupDataSorted:!0,groupOrder:["asc"],groupSummary:[!0],summaryType:"max",summaryTpl:"<b>Max: {0}</b>",groupSummaryPos:["footer"],showSummaryOnHide:!1},defaultText:e.language.grid.defaultText,singleColSetting:{label:e.language.grid.singleColHead,name:"jqg_"+r+"_radio",width:50,align:"center",fixed:!0,resizable:!1},onBeforePage:e.CONSTANTS.EMPTYFUNC,onBeforeExport:e.CONSTANTS.EMPTYFUNC,onGridComplete:e.CONSTANTS.EMPTYFUNC,onLoadComplete:e.CONSTANTS.EMPTYFUNC,onSelectedAll:e.CONSTANTS.EMPTYFUNC,onBeforeSelectedRow:e.CONSTANTS.EMPTYFUNC,onSelectedRow:e.CONSTANTS.EMPTYFUNC,onBeforeExpandTreeGridNode:e.CONSTANTS.EMPTYFUNC,onAfterExpandTreeGridNode:e.CONSTANTS.EMPTYFUNC,onBeforeCollapseTreeGridNode:e.CONSTANTS.EMPTYFUNC,onAfterCollapseTreeGridNode:e.CONSTANTS.EMPTYFUNC,onBeforeSearchGrid:e.CONSTANTS.EMPTYFUNC,onOverMaxNumber:e.CONSTANTS.EMPTYFUNC,onClickGroup:e.CONSTANTS.EMPTYFUNC,onResizeStart:e.CONSTANTS.EMPTYFUNC,onResizeStop:e.CONSTANTS.EMPTYFUNC,formatParams:null},j={responsive:!0,operandTitle:"点击选择搜索符号",groupOp:"AND",defaultSearch:"cn",operands:{eq:"==",ne:"!",lt:"<",le:"<=",gt:">",ge:">=",bw:"^",bn:"!^","in":"=",ni:"!=",ew:"|",en:"!@",cn:"~",nc:"!~",nu:"#",nn:"!#",bt:"..."},defaultColConfig:e.gridSetting.defaultColConfig,searchFormAttr:r+"-searchBar-form",cellValueEmpty:"",colModels:[],styleUI:"wuiUI",mergerRowsField:"",keyField:null,windowModal:window};return o.prototype={constructor:o,init:function(i){this.pluginName=_widgetName,this.hasDom=!1,this.element=r,this.$element=t("#"+r),this.defaults=j,this._option=i;var n=e.getAttributeParams(this.$element,P);this._opt=t.extend(!0,{},P,i,n),this.colModel=[],this.container=null,this._grid=null,this.btnTemplate="<a id='{0}' href='javascript:void(0)' class='wui-btn wui-btn-default'>{1}</a>",this.btnDdTemplate="<li><a id='{0}' href='javascript:void(0)'>{1}</a></li>",this.loadData=null,this.listeners=[],this.handlers={},this.oNiceScroll=null,this.status="init",this._formatParams(),this.dom=this._initDom()},_formatParams:function(){var i=this,r=this._opt,n=(this.element,this.$element),o=r.singleColSetting,a=e.formatMaxNumber(r.maxNumber);if(this._opt.maxNumber=a,i._extendGrid(),t.jgrid.regional.cn.defaults=r.defaultText,this.defaults.colModels=[],1==a&&r.isShowCheckBox){var s=function(e,t,i){var r=n.jqGrid("getGridParam","keyName"),a='<input type="radio" name="'+o.name+'" data-mutex-check="false" value="'+i[r]+'" class="cbox" _id="'+i[r]+'">';return a};this.defaults.colModels.unshift({label:o.label,name:o.name,width:o.width,formatter:s,resizable:o.resizable,align:o.align,fixed:o.fixed,frozen:r.colModel[0].frozen})}for(var l=null,d=!1,u=0;u<r.colModel.length;u++){var h=r.colModel[u];"boolean"==typeof h.key&&h.key===!0&&(l=h.name),h.frozen&&(d=h.frozen),this.defaults.colModels.push(r.colModel[u])}this.defaults.isFrozen=d,l?this.defaults.keyField=l:e.logWarn("没有设置行数据的key字段","wui.grid",!0),e.isEmptyType(r.mergerRowsField)?this.defaults.mergerRowsField="":"string"==typeof r.mergerRowsField&&""!=r.mergerRowsField?this.defaults.mergerRowsField=r.mergerRowsField.split(","):this.defaults.mergerRowsField=r.mergerRowsField;var c=e.CONSTANTS.OMODALWINDOW.indexOf(r.modalWindow);c>-1?this.defaults.windowModal=window[r.modalWindow]:"function"==typeof e.modalWindow&&(this.defaults.windowModal=e.modalWindow.call(this,window)),r.actions.indexOf("showHide")==-1&&(r.isHideSearchRows=!1)},_initDom:function(){var i=this,r=this._opt,n=this.$element;if(!n.parent().hasClass("wui-grid")){var o='<div class="wui-grid grid-table"></div>';n.wrap(o)}if(i.container=i.$element.parent(),r.gridToolbar){if(!t(r.gridToolbar).exist()){var a=r.gridToolbar.substr(1);i.$element.before('<div class="toolbar w-grid-toolbar" id="'+a+'"></div>')}}else{var s=r.btnReset||r.btnShowSearch||r.btnShowFilter||r.btnScreen||r.btnExport||r.btnImport;if(s){var a="grid_"+e.guid();i.$element.before('<div class="toolbar w-grid-toolbar" id="'+a+'"></div>'),r.gridToolbar="#"+a}}return r.isShowPageBar?(r.gridPageId||0==i.$element.siblings(".w-grid-page").length&&(r.gridPageId=e.guid(),i.$element.after('<div class="w-grid-page" id="'+r.gridPageId+'"></div>')),r.gridPage="#"+r.gridPageId):r.gridPage=null,i.initDom=i.container.html(),i._initGrid(),this.hasDom=!0,n.prop("outerHTML")},_extendGrid:function(){t.jgrid.hasOwnProperty("regional")||(t.jgrid.regional=[]),t.jgrid.regional.cn={defaults:{recordtext:"{0} - {1}　共 {2} 条",emptyrecords:"无数据显示",loadtext:"读取中...",savetext:"保存中...",pgtext:" {0} 共 {1} 页",pgfirst:"首页",pglast:"末页",pgnext:"下一页",pgprev:"上一页",pgrecs:"Records per Page",showhide:"Toggle Expand Collapse Grid",pagerCaption:"Grid::Page Settings",pageText:"Page:",recordPage:"Records per Page",nomorerecs:"没有更多记录...",scrollPullup:"上拉加载更多...",scrollPulldown:"下拉刷新...",scrollRefresh:"释放刷新..."},search:{caption:"搜索...",Find:"查找",Reset:"重置",odata:[{oper:"eq",text:"等于　　"},{oper:"ne",text:"不等于　"},{oper:"lt",text:"小于　　"},{oper:"le",text:"小于等于"},{oper:"gt",text:"大于　　"},{oper:"ge",text:"大于等于"},{oper:"bw",text:"开始于　"},{oper:"bn",text:"不开始于"},{oper:"in",text:"属于　　"},{oper:"ni",text:"不属于　"},{oper:"ew",text:"结束于　"},{oper:"en",text:"不结束于"},{oper:"cn",text:"包含　　"},{oper:"nc",text:"不包含　"},{oper:"nu",text:"不存在　"},{oper:"nn",text:"存在　　"},{oper:"bt",text:"两者之间"}],groupOps:[{op:"AND",text:"所有"},{op:"OR",text:"任一"}],operandTitle:"点击选择搜索符号",resetTitle:"重置搜索值"},edit:{addCaption:"添加记录",editCaption:"编辑记录",bSubmit:"提交",bCancel:"取消",bClose:"关闭",saveData:"数据已改变,是否保存？",bYes:"是",bNo:"否",bExit:"取消",msg:{required:"此字段必需",number:"请输入有效数字",minValue:"输值必须大于等于 ",maxValue:"输值必须小于等于 ",email:"这不是有效的e-mail地址",integer:"请输入有效整数",date:"请输入有效时间",url:"无效网址。前缀必须为 ('http://' 或 'https://')",nodefined:" 未定义！",novalue:" 需要返回值！",customarray:"自定义函数需要返回数组！",customfcheck:"必须有自定义函数!"}},view:{caption:"查看记录",bClose:"关闭"},del:{caption:"删除",msg:"删除所选记录？",bSubmit:"删除",bCancel:"取消"},nav:{edittext:"",edittitle:"编辑所选记录",addtext:"",addtitle:"添加新记录",deltext:"",deltitle:"删除所选记录",searchtext:"",searchtitle:"查找",refreshtext:"",refreshtitle:"刷新表格",alertcap:"注意",alerttext:"请选择记录",viewtext:"",viewtitle:"查看所选记录",savetext:"",savetitle:"保存行",canceltext:"",canceltitle:"取消行编辑",selectcaption:"Actions..."},col:{caption:"选择列",bSubmit:"确定",bCancel:"取消"},errors:{errcap:"错误",nourl:"没有设置url",norecords:"没有要处理的记录",model:"colNames 和 colModel 长度不等！"},formatter:{integer:{thousandsSeparator:",",defaultValue:"0"},number:{decimalSeparator:".",thousandsSeparator:",",decimalPlaces:2,defaultValue:"0.00"},currency:{decimalSeparator:".",thousandsSeparator:",",decimalPlaces:2,prefix:"",suffix:"",defaultValue:"0.00"},date:{dayNames:["日","一","二","三","四","五","六","星期日","星期一","星期二","星期三","星期四","星期五","星期六"],monthNames:["一","二","三","四","五","六","七","八","九","十","十一","十二","一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],AmPm:["am","pm","上午","下午"],S:function(e){return e<11||e>13?["st","nd","rd","th"][Math.min((e-1)%10,3)]:"th"},srcformat:"Y-m-d",newformat:"Y-m-d",parseRe:/[#%\\\/:_;.,\t\s-]/,masks:{ISO8601Long:"Y-m-d H:i:s",ISO8601Short:"Y-m-d",ShortDate:"n/j/Y",LongDate:"l, F d, Y",FullDateTime:"l, F d, Y g:i:s A",MonthDay:"F d",ShortTime:"g:i A",LongTime:"g:i:s A",SortableDateTime:"Y-m-d\\TH:i:s",UniversalSortableDateTime:"Y-m-d H:i:sO",YearMonth:"F, Y"},reformatAfterEdit:!1,userLocalTime:!1},baseLinkUrl:"",showAction:"",target:"",checkbox:{disabled:!0},idName:"id"},colmenu:{sortasc:"Sort Ascending",sortdesc:"Sort Descending",columns:"Columns",filter:"Filter",grouping:"Group By",ungrouping:"Ungroup",searchTitle:"Get items with value that:",freeze:"Freeze",unfreeze:"Unfreeze",reorder:"Move to reorder"}};var e={common:{cornerall:"ui-corner-all",icon_base:"fa",error:"wui-bg-danger",button:"wui-btn wui-btn-info",content:""},base:{pgInput:"wui-input",pgSelectBox:"wui-select",icon_asc:"fa-sort-asc",icon_desc:"fa-sort-desc",icon_caption_open:"fa-arrow-circle-up",icon_caption_close:"fa-arrow-circle-down"},modal:{icon_close:"fa-times-close",icon_resizable:"ui-icon-gripsmall-diagonal-se"},celledit:{inputClass:"wui-input"},inlinedit:{inputClass:"wui-input",icon_edit_nav:"fa-edit",icon_add_nav:"fa-plus",icon_save_nav:"fa-save",icon_cancel_nav:"fa-times-circle-o"},formedit:{inputClass:"wui-input",icon_save:"fa-save",icon_close:"fa-times-circle-o",icon_del:"fa-trash-o",icon_cancel:"fa-times-circle-o"},navigator:{icon_edit_nav:"fa-edit",icon_add_nav:"fa-plus",icon_del_nav:"fa-trash-o",icon_search_nav:"fa-search",icon_refresh_nav:"fa-refresh",icon_view_nav:"fa-info-circle",icon_newbutton_nav:"fa-external-link"},grouping:{icon_plus:"fa-plus-circle",icon_minus:"fa-minus-circle"},filter:{srSelect:"wui-select",srInput:"wui-input",icon_search:"fa-search",icon_reset:"fa-refresh",icon_query:"fa-comment"},subgrid:{icon_plus:"fa-caret-right",icon_minus:"fa-caret-down",icon_open:"fa-indent"},treegrid:{icon_plus:"fa-caret-right",icon_minus:"fa-caret-down",icon_leaf:"fa-circle-o"},fmatter:{icon_edit:"fa-edit",icon_add:"fa-plus",icon_save:"fa-save",icon_cancel:"fa-times-circle-o",icon_del:"fa-trash-o"},colmenu:{filter_select:"form-control",filter_input:"form-control",icon_sort_asc:"fa-sort-alpha-asc",icon_sort_desc:"fa-sort-alpha-desc",icon_columns:"fa-list-alt",icon_filter:"fa-filter",icon_group:"fa-align-left",icon_freeze:"fa-align-center",icon_move:"fa-arrows-alt"}};t.jgrid.styleUI.wuiUI=t.extend(!0,{},t.jgrid.styleUI.jQueryUI,e)},_initFormatter:function(n){var o=this,a=n.formatter;switch(n.formatter||(a=n.wstype),a){case"text":case"string":n.stype="text",n.wstype="string",n.searchoptions.sopt=o._getSopt(n.wstype),n.sopt=n.sopt||n.searchoptions.sopt[0],n.searchoptions.value||(n.searchoptions.value=":全部;1:是;0:否"),n.formatter="text",n.align||(n.align="left");break;case"boolean":n.stype="select",n.wstype="boolean",n.searchoptions.sopt=o._getSopt(n.wstype),n.sopt=n.sopt||n.searchoptions.sopt[0],n.searchoptions.value||(n.searchoptions.value=":全部;true:是;false:否"),n.formatter="checkbox",n.align||(n.align="center");break;case"date":n.stype="text",n.wstype="date",n.searchoptions.sopt=o._getSopt(n.wstype),n.sopt=n.sopt||n.searchoptions.sopt[0],n.searchoptions.dataInit=function(i){function r(){t("#"+o).exist()&&(wui.clearInterval(a),e.date(o,{isShowBtnGroup:!1,format:n.formatDate?n.formatDate:"yyyy-mm-dd"}))}var o;t(i).attr("id")?o=t(i).attr("id"):(o=e.guid(),t(i).attr("id",o));var a=wui.setInterval(r,1e3)},n.formatter=function(t,r,n){if(null===t||t==i||""==t)return o.defaults.cellValueEmpty;var a=e.formatDate(t,r.colModel.formatDate);return a?a:t},n.align||(n.align="center");break;case"dateRange":n.stype="text",n.wstype="dateRange",n.searchoptions.sopt=o._getSopt("date"),n.sopt=n.sopt||o._getSopt(n.wstype),n.searchoptions.dataInit=function(i){function r(){t("#"+o).exist()&&(wui.clearInterval(a),e.date(o,{isShowBtnGroup:!1,format:n.formatDate?n.formatDate:"yyyy-mm-dd"}))}var o;t(i).attr("id")?o=t(i).attr("id"):(o=e.guid(),t(i).attr("id",o));var a=wui.setInterval(r,1e3)},n.formatter=function(t,r,n){if(null===t||t==i||""==t)return o.defaults.cellValueEmpty;var a=e.formatDate(t,r.colModel.formatDate);return a?a:t},n.align||(n.align="center");break;case"num":case"number":n.stype="text",n.wstype="number",n.searchoptions.sopt=o._getSopt(n.wstype),n.sopt=n.sopt||n.searchoptions.sopt[0],n.searchoptions.dataInit=function(e){t(e).keyup(function(){var i=t(r).val();t(e).val(i.replace(/[^\d]/g,""))})},n.formatter="number",n.align||(n.align="right");break;case"numRange":n.stype="text",n.wstype="numRange",n.searchoptions.sopt=o._getSopt("number"),n.sopt=n.sopt||o._getSopt(n.wstype),n.searchoptions.dataInit=function(e){t(e).keyup(function(){var i=t(e).val();t(e).val(i.replace(/[^\d]/g,""))})},n.formatter="number",n.align||(n.align="right");break;case"int":case"integer":n.stype="text",n.wstype="integer",n.searchoptions.sopt=o._getSopt(n.wstype),n.sopt=n.sopt||n.searchoptions.sopt[0],n.searchoptions.dataInit=function(e){t(e).keyup(function(){var i=t(e).val();t(e).val(i.replace(/^((\-?[0-9]*)|(\+?[0-9]*))$/g,""))})},n.formatter="integer",n.align||(n.align="right");break;case"intRange":n.stype="text",n.wstype="intRange",n.searchoptions.sopt=o._getSopt("integer"),n.sopt=n.sopt||o._getSopt(n.wstype),n.searchoptions.dataInit=function(e){t(e).keyup(function(){var i=t(e).val();t(e).val(i.replace(/^((\-?[0-9]*)|(\+?[0-9]*))$/g,""))})},n.formatter="integer",n.align||(n.align="right");break;case"double":n.stype="text",n.wstype="double",n.searchoptions.sopt=o._getSopt(n.wstype),n.sopt=n.sopt||n.searchoptions.sopt[0],n.searchoptions.dataInit=function(e){t(e).keyup(function(){var i=t(e).val();t(e).val(i.replace(/^((\-?[0-9]*)|(\+?[0-9]*))$/g,""))})},n.formatter="number",n.align||(n.align="right");break;case"doubleRange":n.stype="text",n.wstype="doubleRange",n.searchoptions.sopt=o._getSopt("double"),n.sopt=n.sopt||o._getSopt(n.wstype),n.searchoptions.dataInit=function(e){t(e).keyup(function(){var i=t(e).val();t(e).val(i.replace(/^((\-?[0-9]*)|(\+?[0-9]*))$/g,""))})},n.formatter="number",n.align||(n.align="right");break;case"checkbox":n.stype="select",n.wstype="checkbox",n.searchoptions.sopt=o._getSopt(n.wstype),n.sopt=n.sopt||n.searchoptions.sopt[0],n.searchoptions.value||(n.searchoptions.value=":全部;1:是;0:否"),n.formatter="checkbox",n.align||(n.align="center");break;case"select":n.stype="select",n.wstype="select",n.searchoptions.sopt=o._getSopt(n.wstype),n.sopt=n.sopt||n.searchoptions.sopt[0],n.formatter=function(e,t,r){return null===e||e==i||""==e?o.defaults.cellValueEmpty:e},n.align||(n.align="left");break;case"selectbox":case"selectBox":n.stype="text",n.wstype="selectBox",n.searchoptions.sopt=o._getSopt(n.wstype),n.sopt=n.sopt||n.searchoptions.sopt[0],n.formatter=function(e,t,r){return null===e||e==i||""==e?o.defaults.cellValueEmpty:e},n.align||(n.align="left");break;case"choosebox":case"chooseBox":n.stype="text",n.wstype="chooseBox",n.searchoptions.sopt=o._getSopt(n.wstype),n.sopt=n.sopt||n.searchoptions.sopt[0],n.formatter=function(e,t,r){return null===e||e==i||""==e?o.defaults.cellValueEmpty:e},n.align||(n.align="left");break;case"dictCode":n.stype="text",n.wstype="dictCode",n.searchoptions.sopt=o._getSopt(n.wstype),n.sopt=n.sopt||n.searchoptions.sopt[0];var s=n.searchoptions;n.formatter=function(r,n,a){var l,d,u=s.name?s.name:e.dictCodeSetting.name,h=s.text?s.text:e.dictCodeSetting.text;return s.code?s.data?l=s.data[s.code]:e.dictCodeSetting&&e.dictCodeSetting.items&&(l=e.dictCodeSetting.items[s.code]):e.logError("【code】参数不能为空",FRAME_NAME+"."+_widgetName,!0),l&&t.each(l,function(){if(this[u]==r)return d=this[h],!1}),d==i?o.defaults.cellValueEmpty:d},n.align||(n.align="left");break;default:n.wstype||(n.stype="text",n.wstype="string"),n.searchoptions.sopt=o._getSopt(n.wstype),n.sopt=n.sopt||n.searchoptions.sopt[0],n.align||(n.align="center")}if("text"==n.stype&&""==n.formatter&&(n.formatter=function(e,t,r){return null===e||e==i||""==e?o.defaults.cellValueEmpty:e}),n.formatterOption){var l="";"string"==typeof n.formatterOption?l=n.formatterOption:"object"==typeof n.formatterOption?l=n.formatterOption.value:"function"==typeof n.formatterOption&&(l=n.formatterOption(n)),e.logParamValue({paramName:"optionValue",paramValue:l,methodName:"grid",className:FRAME_NAME,isDebug:!0}),n.formatter=function(e,t,r){var n=new RegExp("(?<=;"+e+":).*?(?=;)","gim");if(l.indexOf(";"+e+":")>-1||0==l.indexOf(e+":")){var a=l.match(n);return a}return null===e||e==i||""==e?o.defaults.cellValueEmpty:e}}return n},_createColModel:function(i){var r=this,n=e.deepCopy(r.defaults.defaultColConfig),o=t.extend(!0,{},n,i);return o.hidedlg&&(o.hidden=!0),e.isEmptyType(r.defaults.mergerRowsField)||r.defaults.mergerRowsField.indexOf(o.name)>-1&&(o.cellattr=function(e,t,i,r,n){return"id='"+r.name+e+"'"}),o=this._initFormatter(o),o.search||(o.searchoptions={}),o},_initColModel:function(){for(var e=this,t=this.defaults.colModels,i=0;i<t.length;i++){var r=t[i],n=this._createColModel(r);e.colModel.push(n)}return e.colModel},_initGrid:function(){var i=this,r=this._opt,n=this.$element,o=this.element,a=i.container,s=i._initColModel();i.buildSearchBar(),i.buildToolbar();var l=(r.defaultText,{mtype:r.mtype,datatype:r.dataType,url:r.url,postData:r.otherParam,data:r.localData,colModel:s,sortname:r.sortname,direction:"right"===r.direction?"rtl":"ltl",sortorder:r.sortorder,defaultColWidth:r.defaultColWidth,rowNum:r.rowNum,rowList:r.rowList,rownumbers:r.isShowRowNumbers,multiselect:r.isShowCheckBox,multiSort:r.multiSort,height:r.height,width:r.width,scrollOffset:"5px",autowidth:r.autowidth,shrinkToFit:r.shrinkToFit,sortable:r.isSortable,scroll:r.scroll,viewrecords:r.isShowRecords,loadonce:r.isLoadonce,cellEdit:r.isEnableCellEdit,altRows:r.altRows,altclass:r.altclass,pager:r.gridPage,pagerpos:r.pagerpos,recordpos:r.recordpos,colMenu:r.colMenu,prmNames:r.prmNames,jsonReader:r.jsonReader,localReader:r.localReader,treeGrid:r.isTreeGrid,treeGridModel:r.treeGridModel,ExpandColumn:r.treeExpandColumn,ExpandColClick:r.isClickNodeExpandCol,treeIcons:r.treeIconsSetting,treeReader:r.treeReader,grouping:r.grouping,groupingView:r.groupingView,onClickGroup:function(e,t){r.isFullScreen?i._setGridFullScreen():i._setGridSize(),r.onClickGroup&&"function"==typeof r.onClickGroup&&r.onClickGroup.call(this,e,t)},styleUI:i.defaults.styleUI,onPaging:function(n,o){if("user"==n){var s=e.parseInt(t(o).val().replace(/[^0-9]/gi,""),1),l=this.p.lastpage;s>l&&(e.notice(r.defaultText.overPageNumberText.replace("{0}",l)),t(o).val(l))}var d=!0;return r.onBeforePage&&"function"==typeof r.onBeforePage&&(d=r.onBeforePage.call(this,n,o)),i.listeners.indexOf("beforePage")>-1&&i.emit({type:"beforePage",target:a,_this:o,pgButton:n})===!1?"stop":d===!1?"stop":void 0},loadComplete:function(e){if(i.loadData=e[r.jsonReader.root],!i.isLocalData())if(e[r.jsonReader.records])n.find(".jqgird-no-text").remove();else{var t=n.jqGrid("getGridParam","colModel").length,o="<tr class='jqgird-no-text'><td colspan ='"+t+" '>"+r.defaultText.emptyrowstext+"</td></tr>";n.children("tbody")&&n.children("tbody").length>1?n.children("tbody").append(o):n.append(o)}if(r.onLoadComplete&&"function"==typeof r.onLoadComplete)return r.onLoadComplete.call(this,e)},gridComplete:function(){if(t("#"+r.gridPageId+"_left").width(r.pageBarSetting.leftCellWidth),t("#"+r.gridPageId+"_center").width(r.pageBarSetting.centerCellWidth),t("#"+r.gridPageId+"_right").width(r.pageBarSetting.rightCellWidth),i.isLocalData())if(i.isNoneData()){var s=n.jqGrid("getGridParam","colModel").length,l="<tr class='jqgird-no-text'><td colspan ='"+s+" '>"+r.defaultText.emptyrowstext+"</td></tr>";n.children("tbody")&&n.children("tbody").length>1?n.children("tbody").append(l):n.append(l)}else n.find(".jqgird-no-text").remove();if(1==r.maxNumber){n.jqGrid("hideCol","cb");var d=i.container.find('[name="'+i._opt.singleColSetting.name+'"]');d.each(function(e,o){t(o).off("click").on("click",function(e){e.stopPropagation();var o=t(this).val(),s=n.getGridParam("selarrrow"),l=t(this).attr("data-mutex-check");if("true"==l){if(r.onBeforeSelectedRow&&"function"==typeof r.onBeforeSelectedRow&&r.onBeforeSelectedRow.call(this,o,e),i.listeners.indexOf("beforeSelectedRow")>-1&&!i.emit({type:"beforeSelectedRow",target:a,rowid:o}))return!1;t.each(s,function(e,t){n.jqGrid("setSelection",t,!0)}),t(this).prop("checked",!1).change(),t(this).attr("data-mutex-check","false")}else{if(t.each(s,function(e,t){n.jqGrid("setSelection",t,!0)}),d.each(function(){"true"==t(this).attr("data-mutex-check")&&t(this).attr("data-mutex-check","false").change()}),r.onBeforeSelectedRow&&"function"==typeof r.onBeforeSelectedRow&&r.onBeforeSelectedRow.call(this,o,e),i.listeners.indexOf("beforeSelectedRow")>-1&&!i.emit({type:"beforeSelectedRow",target:a,rowid:o}))return!1;n.jqGrid("setSelection",o),t(this).attr("data-mutex-check","true")}})})}if(r.maxNumber!==!1&&r.isShowCheckBox&&!r.isEnableSelectAll){var u="cb_"+o;t("#"+u).attr("disabled",!0)}r.isShowRowNumbers&&n.jqGrid("setLabel","rn",r.rowNumbersTitle,{"text-align":"center"},""),e.isEmptyType(i.defaults.mergerRowsField)||i.mergerRows(i.defaults.mergerRowsField),r.isFullScreen?(i._setGridFullScreen(),e.onresize(function(e,t){i._setGridFullScreen()})):(i._setGridSize(),e.onresize(function(e,t){i._setGridSize()})),i._gridplueFrozen(),n.find(".grid-opt").each(function(e,i){t(this).parent().css("overflow","visible"),t(this).parent().attr("title","操作列")}),i.status="complete",r.onGridComplete&&"function"==typeof r.onGridComplete?r.onGridComplete.call(this):r.gridComplete&&"function"==typeof r.gridComplete&&r.gridComplete.call(this),i.listeners.indexOf("gridComplete")>-1&&!i.emit({type:"gridComplete",target:a})},onSelectAll:function(e,t){for(var n=[],o=0;o<e.length;o++){var s=i.getRowDataById(e[o],!0);n.push(s)}if(r.onSelectedAll&&"function"==typeof r.onSelectedAll&&r.onSelectedAll.call(this,e,n,t),i.listeners.indexOf("selectedAll")>-1){if(!i.emit({type:"selectedAll",target:a,aRowids:e,rows:n,status:t}))return}else if(i.listeners.indexOf("onSelectedAll")>-1&&!i.emit({type:"onSelectedAll",target:a,aRowids:e,rows:n,status:t}))return},beforeSelectRow:function(e,t){var r=i.onBeforeSelectedRow(e,t,this);return r},onSelectRow:function(e,t){i.onSelectedRow(e,t)},afterInsertRow:function(e,t){},beforeRequest:function(r){if("init"==i.status){var o=i.getSearchFiltersData(),a=i._buildFilters(o),s=n.jqGrid("getGridParam","postData");if(!e.isEmptyType(a)){if(s){if(s.hasOwnProperty("filters")&&"string"==typeof s.filters){var l=e.parseToObj(s.filters),d=e.parseToObj(a);l&&(a=JSON.stringify(t.extend(!0,{},d,l)))}}else s={};s.filters=a,n.jqGrid("setGridParam",{postData:s})}}},beforeExpandTreeGridNode:function(e,t){var n=r.treeReader.lazy_field;r.lazySetting.lazyField;"boolean"==typeof t[n]&&1==t[n],r.onBeforeExpandTreeGridNode&&"function"==typeof r.onBeforeExpandTreeGridNode&&r.onBeforeExpandTreeGridNode.call(this,e,t),i.listeners.indexOf("beforeExpandTreeGridNode")>-1&&!i.emit({type:"beforeExpandTreeGridNode",target:a,rowid:e,row:t})},afterExpandTreeGridNode:function(e,t){r.isFullScreen?i._setGridFullScreen():i._setGridSize(),r.onAfterExpandTreeGridNode&&"function"==typeof r.onAfterExpandTreeGridNode&&r.onAfterExpandTreeGridNode.call(this,e,t),i.listeners.indexOf("afterExpandTreeGridNode")>-1&&!i.emit({type:"afterExpandTreeGridNode",target:a,rowid:e,row:t})},beforeCollapseTreeGridNode:function(e,t){r.onBeforeCollapseTreeGridNode&&"function"==typeof r.onBeforeCollapseTreeGridNode&&r.onBeforeCollapseTreeGridNode.call(this,e,t),i.listeners.indexOf("beforeCollapseTreeGridNode")>-1&&!i.emit({type:"beforeCollapseTreeGridNode",target:a,rowid:e,row:t})},afterCollapseTreeGridNode:function(e,t){r.isFullScreen?i._setGridFullScreen():i._setGridSize(),r.onAfterCollapseTreeGridNode&&"function"==typeof r.onAfterCollapseTreeGridNode&&r.onAfterCollapseTreeGridNode.call(this,e,t),i.listeners.indexOf("afterCollapseTreeGridNode")>-1&&!i.emit({type:"afterCollapseTreeGridNode",target:a,rowid:e,row:t})},resizeStart:function(e,t){r.onResizeStart&&"function"==typeof r.onResizeStart&&r.onResizeStart.call(this,e,t)},resizeStop:function(){r.isFullScreen?i._setGridFullScreen():i._setGridSize(),r.onResizeStop&&"function"==typeof r.onResizeStop&&r.onResizeStop.call(this,newwidth,index)}});if(r.formatParams)if("object"==typeof r.formatParams)t.extend(!0,l,r.formatParams);else if("function"==typeof r.formatParams){var d=r.formatParams(l);"object"==typeof d&&t.extend(!0,l,d)}e.logParamValue({paramName:"options",paramValue:l,methodName:"_initGrid",className:"wui.grid",isDebug:!0}),i._grid=n.jqGrid(l),r.isShowPageBar&&n.navGrid("#"+r.gridPageId,{search:!0,add:!1,edit:!1,del:!1,refresh:!0},{},{},{},{multipleSearch:!0}),r.caption&&i.container.prepend('<div class="grid-caption"><h4 id="gridTitle">'+r.caption+"</h4></div>"),t("#gbox_"+i.element).find(".navtable").hide()},isLocalData:function(){var e=(this._opt,this.$element);return"local"==e.jqGrid("getGridParam","datatype")||"local"==e.jqGrid("getGridParam","treedatatype")},isNoneData:function(){var e=this.getRowData();return!((e&&e.length)>0)},onBeforeSelectedRow:function(e,i,r){var n=this,o=this._opt,a=this.$element,s=n.container,l=a.getGridParam("selarrrow"),d=l.length;if("number"==typeof o.maxNumber&&t(i.toElement).prop("checked")&&d>=o.maxNumber)return t(i.toElement).removeAttr("checked"),o.onOverMaxNumber&&"function"==typeof o.onOverMaxNumber&&o.onOverMaxNumber.call(r,l,o.maxNumber),n.listeners.indexOf("overMaxNumber")>-1&&!n.emit({type:"overMaxNumber",target:s,selectedRowIds:l,maxNumber:o.maxNumber}),!1;if(o.onBeforeSelectedRow&&"function"==typeof o.onBeforeSelectedRow){var u=o.onBeforeSelectedRow.call(r,e,i);if(u===!1)return!1}if(n.listeners.indexOf("beforeSelectedRow")>-1&&!n.emit({type:"beforeSelectedRow",target:s,rowid:e}))return!1;if(!e||o.maxNumber!==!1||!o.isClickRow){var h=t(r),c=t.jgrid.getCellIndex(t(i.target).closest("td")[0]),f=h.jqGrid("getGridParam","colModel");return"cb"===f[c].name}return!0},onSelectedRow:function(e,t){var i=this,r=this._opt,n=(this.$element,i.container),o=i.getRowDataById(e,!0);if(t){if(i.listeners.indexOf("selected")>-1&&!i.emit({type:"selected",target:n,rowid:e,row:o,status:t}))return}else if(i.listeners.indexOf("unselected")>-1&&!i.emit({type:"unselected",target:n,rowid:e,row:o,status:t}))return;if(r.onSelectedRow&&"function"==typeof r.onSelectedRow&&r.onSelectedRow.call(this,e,o,t),i.listeners.indexOf("selectedRow")>-1){if(!i.emit({type:"selectedRow",target:n,rowid:e,row:o,status:t}))return}else if(i.listeners.indexOf("onSelectedRow")>-1&&!i.emit({type:"onSelectedRow",target:n,rowid:e,row:o,status:t}))return},_onLazyLoad:function(t,i){var r=this._opt,n=this.$element,o=r.lazySetting,a=o.url?o.url:r.url,s=o.mtype?o.mtype:r.mtype,l=o.dataType?o.dataType:r.dataType,d=o.otherParam;d?d[r.lazySetting.lazyField]=t:(d={},d[r.lazySetting.lazyField]=t),e.ajax({url:a,data:d,async:!0,dataType:l,method:s,contentType:o.contentType,onSuccess:function(i){e.logMessage(i,"wui.grid._onLazyLoad",!0);var r=jsonReader.root,o=[];e.isArray(i)?o=i:e.isJson(i)&&("undefined"==typeof i[r]?o.push(i):o=i[r]);for(var a=0;a<o.length;a++)n.jqGrid("addChildNode",nodeid,t,data,expandData)},onError:function(t){e.logError(t)}})},mergerRows:function(i){var r,n=this,o=n.$element.getDataIDs(),a=o.length;if(e.isEmptyType(i))return!1;r="string"==typeof i?i.split(","):i;for(var s={},l={},d=0;d<r.length;d++)s[r[d]]=1,l[r[d]]=0;for(var d=0;d<a;d++)for(var u=n.$element.jqGrid("getRowData",o[d]),h=n.$element.jqGrid("getRowData",o[d+1]),c=0;c<r.length;c++){var f=r[c];u[f]==h[f]?(s[f]++,n.$element.setCell(o[d+1],f,"",{display:"none"}),t("#"+f+o[l[f]]).attr("rowspan",s[f])):(s[f]=1,l[f]=d+1)}},scroll:function(){var i=this.element;this.oNiceScroll||(this.oNiceScroll=e.scroll(t("#gview_"+i).children(".ui-jqgrid-bdiv").eq(0)))},_setGridSize:function(){var e=this,i=this.element,r=this.$element,n=40,o=10,a=0,s=0,l=0;if("auto"==this._opt.height){if(e._opt.grouping)return void e.scroll();var d=r.children("tbody").children(".jqgrow");d.each(function(e,t){a+=t.offsetHeight}),d.length>0&&0==a&&(o=r.jqGrid("getGridParam","rowNum"),a=parseInt(o)*n),0==a&&(a=n);var u=t("#gview_"+i).children(".ui-jqgrid-bdiv").get(0);if(u){var h=(u.scrollHeight,u.clientHeight),c=u.offsetHeight,f=c-h;s=a+f+2}else s=a+2}else s=this._opt.height;l="auto"==this._opt.width?r.parent().width():this._opt.width,r.width(l),t("#gbox_"+i).find("table.ui-jqgrid-htable").eq(0).width(l),e.$element.width(l),this.$element.jqGrid("setGridWidth",l).jqGrid("setGridHeight",s),e.scroll()},_setGridFullScreen:function(){var i=this,r=this.element,n=this._opt.offset,o=t("#gview_"+r).children(".ui-jqgrid-bdiv");if(o.length>0){var a=e.getFullScreenSize(o.eq(0));if(a){var s=0;i.container.find(".ui-jqgrid-pager").each(function(e,i){s+=t(i).outerHeight(!0)});var l=0;l=e.isJson(n)?parseFloat(n.top)+parseFloat(n.bottom):parseFloat(n);var d=a.height-s-l,u=a.width-parseInt(n.left)-parseInt(n.right);this.$element.jqGrid("setGridWidth",u).jqGrid("setGridHeight",d),i.scroll()}}t("#gview_"+r).find(".ui-jqgrid-htable").eq(0).width("100%"),i.$element.width("100%")},buildToolbar:function(){var i=this,r=this._opt,n=this.$element,o=i.element,a=i.btnTemplate,s=r.toolBarSetting,l=s.maxShowNumber,d=0;if(!t(r.gridToolbar).exist())return!1;if(t(r.gridToolbar).addClass("clearfix"),1==r.btnScreen){var u=o+"-btnScreen",h=s.btnScreenText,c="<div id='{0}' class='btn-group'><button class='wui-btn wui-btn-default dropdown-toggle' data-toggle='dropdown'>{1}</button></div>",f=c.replace("{0}",u).replace("{1}",h);t(r.gridToolbar).append(f),d++,t("#"+u).click(function(){i._screenGrid(t(this))})}var p=t('<ul class="dropdown-menu"></ul>'),m=t('<div class="btn-group"><button type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">更多操作 <span class="caret"></span></button></div>').append(p);if(1==r.btnReset){var u=o+"-btnReset",h=s.btnResetText;if(d==l&&t(r.gridToolbar).append(m),d>=l){a=i.btnDdTemplate;var f=a.replace("{0}",u).replace("{1}",h);p.append(f)}else{a=i.btnTemplate;var f=a.replace("{0}",u).replace("{1}",h);t(r.gridToolbar).append(f)}d++,t("#"+u).click(function(){i.resetGrid()})}if(r.btnShowFilter){var u=o+"-btnShowFilter",h=s.btnShowFilterText;if(d==l&&t(r.gridToolbar).append(m),d>=l){a=i.btnDdTemplate;var f=a.replace("{0}",u).replace("{1}",h);p.append(f)}else{a=i.btnTemplate;var f=a.replace("{0}",u).replace("{1}",h);t(r.gridToolbar).append(f)}d++,t("#"+u).click(function(){g(this),i.showFilterSearch(o)})}if(1==r.btnShowSearch){var u=o+"-btnShowSearch",h=s.btnShowSearchText;if(d==l&&t(r.gridToolbar).append(m),d>=l){a=i.btnDdTemplate;var f=a.replace("{0}",u).replace("{1}",h);p.append(f)}else{a=i.btnTemplate;var f=a.replace("{0}",u).replace("{1}",h);t(r.gridToolbar).append(f)}d++,t("#"+u).click(function(){i.showSearchGrid(o)})}if(1==r.btnImport){var u=o+"-btnImport",h=s.btnImportText;if(d==l&&t(r.gridToolbar).append(m),d>=l){a=i.btnDdTemplate;var f=a.replace("{0}",u).replace("{1}",h);p.append(f)}else{a=i.btnTemplate;var f=a.replace("{0}",u).replace("{1}",h);t(r.gridToolbar).append(f)}d++,t("#"+u).click(function(){var t=r.importSetting,n={url:t.fileUploadUrl,importUrl:t.importUrl,otherParam:JSON.stringify(t.otherParam),maxNumber:t.maxNumber,maxFilesize:t.maxFilesize,acceptedFiles:t.acceptedFiles,jsonReader:JSON.stringify(t.jsonReader)},o=e.buildUrl(t.pageUrl,n);e.openModalDialog(o,function(e){t.onSuccess&&"function"==typeof t.onSuccess?t.onSuccess(e):i.resetGrid()},t.pageHeight,t.pageWidth,t.pageTitle)})}if(1==r.btnExport){var u=o+"-btnExport",h=s.btnExportText;
if(d==l&&t(r.gridToolbar).append(m),d>=l){a=i.btnDdTemplate;var f=a.replace("{0}",u).replace("{1}",h);p.append(f)}else{a=i.btnTemplate;var f=a.replace("{0}",u).replace("{1}",h);t(r.gridToolbar).append(f)}d++,t("#"+u).click(function(){var t=function(t,n){var o={};o.exportType=t||"page",n&&(o.SelectedIds=n);var a=e.buildUrl(r.exportUrl,o);i.exportGrid({url:a})},o=n.getGridParam("selarrrow");switch(r.exportSetting.defaultMode){case"all":t("all");break;case"page":t("page");break;case"select":0==o.length?i.defaults.windowModal.wui.warnNotice("请至少选择一条数据"):t("select",o);break;default:0==o.length?i.defaults.windowModal.wui.confirm("请您确定导出方式？",{title:"导出确认",btn:["当前页","全部","取消"]},function(){t("page"),e.closeAll("dialog")},function(){t("all")},function(){e.closeAll("dialog")}):i.defaults.windowModal.wui.confirm("请您确定导出方式？",{title:"导出确认",btn:["所选数据","当前页","全部","取消"]},function(){t("select",o),e.closeAll("dialog")},function(){t("page")},function(){t("all")},function(){e.closeAll("dialog")})}})}var g=function(e){var i=t(e).text();i=i.indexOf(s.btnFilterShowText)>=0?i.replace(s.btnFilterShowText,s.btnFilterHideText):i.replace(s.btnFilterHideText,s.btnFilterShowText),t(e).text(i)}},reloadGridByFilters:function(i,r){var n=this,o=this._opt,a=this.$element,s=n._buildFilters(i,r),l=a.jqGrid("getGridParam","postData");t.each(l,function(e,t){delete l[e]});var d={filters:s};if(o.onBeforeSearchGrid&&"function"==typeof o.onBeforeSearchGrid){var u=o.onBeforeSearchGrid.call(this.$element.get(0),d);u&&e.isJson(u)&&(d=u)}a.jqGrid("setGridParam",{postData:d,page:1}).trigger("reloadGrid")},_buildFilters:function(e,i){var r=this;this.$element;i=i||r._opt.groupOp;var n,o,a,s,l='{"groupOp":"'+i+'","rules":[',d=0;return t.each(e,function(e,t){"string"==typeof t?(d>0&&(l+=","),l+=t,d++):(n=this.name||this.field||this.index,o=this.searchoptions||{},s=this.sopt||this.op?this.sopt||this.op:o.sopt?o.sopt[0]:r.defaults.defaultSearch,a=this.type||"text",this.data&&(d>0&&(l+=","),l+='{"field":"'+n+'",',l+='"op":"'+s+'",',l+='"type":"'+a+'",',l+='"data":"'+this.data.replace(/\\/g,"\\\\").replace(/\"/g,'\\"')+'"}',d++))}),l+="]}"},buildRuleMenu:function(e,i,r,n){t("#sopt_menu").remove(),r=parseInt(r,10),n=parseInt(n,10)+18;var o,a,s=t(".ui-jqgrid-view").css("font-size")||"11px",l='<ul id="sopt_menu" class="ui-search-menu modal-content" role="menu" tabindex="0" style="font-size:'+s+";left:"+r+"px;top:"+n+'px;">',d=t(e).attr("soper"),u=[],h=0,c=(t(e).attr("colname"),i.searchoptions);for(c.sopt||(c.sopt=[],c.sopt[0]="select"===cm.stype?"eq":p.defaultSearch),h=0;h<i.sopt.length;h++)a=t.inArray(i.sopt[h],u),a!==-1&&(o=d===p.odata[a].oper?common.highlight:"",l+='<li class="ui-menu-item '+o+'" role="presentation"><a class="'+common.cornerall+' g-menu-item" tabindex="0" role="menuitem" value="'+p.odata[a].oper+'" oper="'+p.operands[p.odata[a].oper]+'"><table class="ui-common-table"><tr><td width="25px">'+p.operands[p.odata[a].oper]+"</td><td>"+p.odata[a].text+"</td></tr></table></a></li>");l+="</ul>",t("body").append(l),t("#sopt_menu").addClass("ui-menu "+classes.menu_widget),t("#sopt_menu > li > a").hover(function(){t(this).addClass(common.hover)},function(){t(this).removeClass(common.hover)}).click(function(){var i=t(this).attr("value"),r=t(this).attr("oper");if(t($t).triggerHandler("jqGridToolbarSelectOper",[i,r,e]),t("#sopt_menu").hide(),t(e).text(r).attr("soper",i),p.autosearch===!0){var n=t(e).parent().next().children()[0];(t(n).val()||"nu"===i||"nn"===i)&&triggerToolbar()}})},_createSearchElement:function(i,r){var n=this,o=this._opt.searchBarSetting.fieldIdPrefix;r.fieldId=o+r.name;var a=r.wstype,s=e.validate("[wui-attr='"+this.defaults.searchFormAttr+"']"),l=r.name;switch(s||(s={rules:function(){}}),r.searchoptions&&r.searchoptions.customSearchName&&(l=r.searchoptions.customSearchName),a){case"text":case"string":var d=t('<input type="text" data-searchrule=\'{"field":"'+l+'","op":"'+r.sopt+'","type":"string"}\' id="'+r.fieldId+'" class="wui-input" />').appendTo(i);d.off("keyup").on("keyup",function(t){var i=window.event?t.keyCode:t.which;i!=e.CONSTANTS.KEYS.ENTER&&i!=e.CONSTANTS.KEYS.OTHER||n.searchGridFromSearchBar()}),e.isEmptyType(r.searchDefVal)||d.val(r.searchDefVal);break;case"boolean":for(var u=t('<select data-searchrule=\'{"field":"'+l+'","op":"'+r.sopt+'","type":"'+a+'"}\' class="wui-select" id="'+r.fieldId+'"></select>').appendTo(i),h=r.searchoptions.name?r.searchoptions.name:"id",c=r.searchoptions.text?r.searchoptions.text:"name",f=r.searchoptions.value.split(";"),p=[],m=0;m<f.length;m++){var g=f[m].split(":"),v={};v[h]=g[0],v[c]=g[1],p.push(v)}var b={loadData:p,isEnabledLiveSearch:!1,maxNumber:1};b=t.extend(!0,{},b,r.searchoptions),e.logParamValue({paramName:"selectBoxSetting",paramValue:b,methodName:"grid",className:FRAME_NAME,isDebug:!0});var y=e.selectBox(r.fieldId,b);e.isEmptyType(r.searchDefVal)||y.set(r.searchDefVal.toString());break;case"date":var d=t('<input type="text" data-searchrule=\'{"field":"'+l+'","op":"'+r.sopt+'","type":"'+a+'"}\' id="'+r.fieldId+'" class="wui-input" />').appendTo(i),x={format:r.formatDate,value:r.searchDefVal};r.searchoptions.customConfig&&(x=t.extend(!0,{},x,r.searchoptions.customConfig)),delete r.searchoptions.customConfig,x=t.extend(!0,{},x,r.searchoptions),e.date(r.fieldId,x);break;case"dateRange":var w=r.startFieldName?r.startFieldName:l,S=r.endFieldName?r.endFieldName:l,N=r.fieldId+"_start",C=r.fieldId+"_end",E="";E+='<div class="input-group date-range">',E+='    <input type="text" class="date-range-input" id="'+N+'" data-init-wui="date" data-searchrule=\'{"field":"'+w+'","op":"'+r.sopt[0]+'","type":"date"}\' />',E+='    <span class="input-group-addon date-range-addon" title="清空日期">-</span>',E+='    <input type="text" class="date-range-input" id="'+C+'" data-init-wui="date" data-searchrule=\'{"field":"'+S+'","op":"'+r.sopt[1]+'","type":"date"}\' />',E+="</div>";var d=t(E).appendTo(i),_={isShowBtnGroup:!1,format:r.formatDate};r.searchoptions.customConfig&&(_=t.extend(!0,{},_,r.searchoptions.customConfig)),delete r.searchoptions.customConfig,_=t.extend(!0,{},_,r.searchoptions);var T=e.date(N,_).on("changeDate",function(){e.date(C).option({startDate:e.date(N).get()})}),A=e.date(C,_).on("changeDate",function(){e.date(N).option({endDate:e.date(C).get()})});d.find(".date-range-addon").on("click",function(){e.date(C).empty(),e.date(N).empty()}),e.isEmptyType(r.searchDefVal)||(e.isArray(r.searchDefVal)?(T.set(r.searchDefVal[0]),A.set(r.searchDefVal[1])):T.set(r.searchDefVal));break;case"num":case"number":var d=t('<input type="number" data-searchrule=\'{"field":"'+l+'","op":"'+r.sopt+'","type":"number"}\' id="'+r.fieldId+'" class="wui-input" />').appendTo(i);s.rules("#"+r.fieldId,"add",{number:!0}),d.off("keyup").on("keyup",function(t){var i=window.event?t.keyCode:t.which;i!=e.CONSTANTS.KEYS.ENTER&&i!=e.CONSTANTS.KEYS.OTHER||n.searchGridFromSearchBar()}),e.isEmptyType(r.searchDefVal)||d.val(r.searchDefVal);break;case"numRange":var w=r.startFieldName?r.startFieldName:l,S=r.endFieldName?r.endFieldName:l,N=r.fieldId+"_start",C=r.fieldId+"_end",E="";E+='<div class="input-group date-range">',E+='    <input type="text" class="date-range-input" id="'+N+'" data-init-wui="date" data-searchrule=\'{"field":"'+w+'","op":"'+r.sopt[0]+'","type":"number"}\' />',E+='    <span class="input-group-addon date-range-addon" title="清空日期">-</span>',E+='    <input type="text" class="date-range-input" id="'+C+'" data-init-wui="date" data-searchrule=\'{"field":"'+S+'","op":"'+r.sopt[1]+'","type":"number"}\' />',E+="</div>";var B=t(E).appendTo(i);s.rules("#"+N,"add",{number:!0}),s.rules("#"+C,"add",{number:!0}),B.find("input").each(function(){t(this).off("keyup").on("keyup",function(t){var i=window.event?t.keyCode:t.which;i!=e.CONSTANTS.KEYS.ENTER&&i!=e.CONSTANTS.KEYS.OTHER||n.searchGridFromSearchBar()})}),e.isEmptyType(r.searchDefVal)||(e.isArray(r.searchDefVal)?(t("#"+N).val(r.searchDefVal[0]),t("#"+C).val(r.searchDefVal[1])):t("#"+N).val(r.searchDefVal));break;case"int":case"integer":var d=t('<input type="number" data-searchrule=\'{"field":"'+l+'","op":"'+r.sopt+'","type":"integer"}\' id="'+r.fieldId+'" class="wui-input" />').appendTo(i);s.rules("#"+r.fieldId,"add",{integer:!0}),d.off("keyup").on("keyup",function(t){var i=window.event?t.keyCode:t.which;i!=e.CONSTANTS.KEYS.ENTER&&i!=e.CONSTANTS.KEYS.OTHER||n.searchGridFromSearchBar()}),e.isEmptyType(r.searchDefVal)||d.val(r.searchDefVal);break;case"intRange":var w=r.startFieldName?r.startFieldName:l,S=r.endFieldName?r.endFieldName:l,N=r.fieldId+"_start",C=r.fieldId+"_end",E="";E+='<div class="input-group date-range">',E+='    <input type="text" class="date-range-input" id="'+N+'" data-init-wui="date" data-searchrule=\'{"field":"'+w+'","op":"'+r.sopt[0]+'","type":"integer"}\' />',E+='    <span class="input-group-addon date-range-addon" title="清空日期">-</span>',E+='    <input type="text" class="date-range-input" id="'+C+'" data-init-wui="date" data-searchrule=\'{"field":"'+S+'","op":"'+r.sopt[1]+'","type":"integer"}\' />',E+="</div>";var B=t(E).appendTo(i);s.rules("#"+N,"add",{integer:!0}),s.rules("#"+C,"add",{integer:!0}),B.find("input").each(function(){t(this).off("keyup").on("keyup",function(t){var i=window.event?t.keyCode:t.which;i!=e.CONSTANTS.KEYS.ENTER&&i!=e.CONSTANTS.KEYS.OTHER||n.searchGridFromSearchBar()})}),e.isEmptyType(r.searchDefVal)||(e.isArray(r.searchDefVal)?(t("#"+N).val(r.searchDefVal[0]),t("#"+C).val(r.searchDefVal[1])):t("#"+N).val(r.searchDefVal));break;case"double":var d=t('<input type="text" data-searchrule=\'{"field":"'+l+'","op":"'+r.sopt+'","type":"'+a+'"}\' id="'+r.fieldId+'" class="wui-input" />').appendTo(i);s.rules("#"+r.fieldId,"add",{number:!0}),d.off("keyup").on("keyup",function(t){var i=window.event?t.keyCode:t.which;i!=e.CONSTANTS.KEYS.ENTER&&i!=e.CONSTANTS.KEYS.OTHER||n.searchGridFromSearchBar()}),e.isEmptyType(r.searchDefVal)||d.val(r.searchDefVal);break;case"doubleRange":var w=r.startFieldName?r.startFieldName:l,S=r.endFieldName?r.endFieldName:l,N=r.fieldId+"_start",C=r.fieldId+"_end",E="";E+='<div class="input-group date-range">',E+='    <input type="text" class="date-range-input" id="'+N+'" data-init-wui="date" data-searchrule=\'{"field":"'+w+'","op":"'+r.sopt[0]+'","type":"double"}\' />',E+='    <span class="input-group-addon date-range-addon" title="清空日期">-</span>',E+='    <input type="text" class="date-range-input" id="'+C+'" data-init-wui="date" data-searchrule=\'{"field":"'+S+'","op":"'+r.sopt[1]+'","type":"double"}\' />',E+="</div>";var B=t(E).appendTo(i);s.rules("#"+N,"add",{number:!0}),s.rules("#"+C,"add",{number:!0}),B.find("input").each(function(){t(this).off("keyup").on("keyup",function(t){var i=window.event?t.keyCode:t.which;i!=e.CONSTANTS.KEYS.ENTER&&i!=e.CONSTANTS.KEYS.OTHER||n.searchGridFromSearchBar()})}),e.isEmptyType(r.searchDefVal)||(e.isArray(r.searchDefVal)?(t("#"+N).val(r.searchDefVal[0]),t("#"+C).val(r.searchDefVal[1])):t("#"+N).val(r.searchDefVal));break;case"checkbox":var E="";E+='<div class="wui-form-check">',E+='    <input type="checkbox" data-searchrule=\'{"field":"'+l+'", "op":"'+r.sopt+'", "type":"boolean"}\' value="1" id="'+r.fieldId+'" name="'+r.fieldId+'" />',E+='    <label for="'+r.fieldId+'">',E+="    </label>",E+="    <span>"+r.label+"</span>",E+="</div>",i.append(E);break;case"select":var u=t('<select data-searchrule=\'{"field":"'+l+'","op":"'+r.sopt+'","type":"string"}\' class="wui-select" id="'+r.fieldId+'"></select>').appendTo(i),h=r.searchoptions.name?r.searchoptions.name:"id",c=r.searchoptions.text?r.searchoptions.text:"name";if(r.searchoptions.value){var $=r.searchoptions.value,p=[];if("function"==typeof $){var M=$(r.fieldId,h,c);if(M)if(e.isJson(M))for(var F in M){var v={};v[h]=F,v[c]=M[F],p.push(v)}else if("string"==typeof M)for(var f=M.split(";"),m=0;m<f.length;m++){var g=f[m].split(":"),v={};v[h]=g[0],v[c]=g[1],p.push(v)}else e.isArray(M)&&(p=M);else console.info("您自己渲染,我不参与")}else if(e.isJson($))for(var F in $){var v={};v[h]=F,v[c]=$[F],p.push(v)}else if("string"==typeof $)for(var f=$.split(";"),m=0;m<f.length;m++){var g=f[m].split(":"),v={};v[h]=g[0],v[c]=g[1],p.push(v)}else e.isArray($)&&(p=$);t.each(p,function(e,t){u.append('<option value="'+t[h]+'">'+t[c]+"</option>")})}if(r.searchoptions.dataSource){var I=r.searchoptions.dataSource;"string"==typeof I&&""!=I&&e.getAjax({url:I,onSuccess:function(e){t.each(e,function(e,t){u.append('<option value="'+t[h]+'">'+t[c]+"</option>")})},onError:function(e){},async:!1,dataType:"json"})}e.isEmptyType(r.searchDefVal)||u.val(r.searchDefVal);break;case"selectbox":case"selectBox":var u=t('<select data-searchrule=\'{"field":"'+l+'","op":"'+r.sopt+'","type":"string"}\' class="wui-select" id="'+r.fieldId+'"></select>').appendTo(i),h=r.searchoptions.name?r.searchoptions.name:"id",c=r.searchoptions.text?r.searchoptions.text:"name",k="",p=[];if(r.searchoptions.value){var $=r.searchoptions.value;if("function"==typeof $){var M=$(r.fieldId,h,c);if(M)if(e.isJson(M))for(var F in M){var v={};v[h]=F,v[c]=M[F],p.push(v)}else if("string"==typeof M)for(var f=M.split(";"),m=0;m<f.length;m++){var g=f[m].split(":"),v={};v[h]=g[0],v[c]=g[1],p.push(v)}else e.isArray(M)&&(p=M);else e.logMessage("您自己渲染,我不参与","wui.grid._addSearchCondition",!0)}else if(e.isJson($))for(var F in $){var v={};v[h]=F,v[c]=$[F],p.push(v)}else if("string"==typeof $)for(var f=$.split(";"),m=0;m<f.length;m++){var g=f[m].split(":"),v={};v[h]=g[0],v[c]=g[1],p.push(v)}}r.searchoptions.dataSource&&(k=r.searchoptions.dataSource);var b={loadUrl:k,loadData:p,maxNumber:1};r.searchoptions.customConfig&&(b=t.extend(!0,{},b,r.searchoptions.customConfig)),delete r.searchoptions.customConfig,b=t.extend(!0,{},b,r.searchoptions),e.logParamValue({paramName:"selectBoxSetting",paramValue:b,methodName:"grid",className:FRAME_NAME,isDebug:!0});var y=e.selectBox(r.fieldId,b);e.isEmptyType(r.searchDefVal)||y.set(r.searchDefVal);break;case"choosebox":case"chooseBox":var d=t('<input type="text" data-searchrule=\'{"field":"'+l+'","op":"'+r.sopt+'","type":"string"}\' id="'+r.fieldId+'" class="wui-input" />').appendTo(i),D={maxNumber:1};r.searchoptions.customConfig&&(D=t.extend(!0,{},D,r.searchoptions.customConfig)),delete r.searchoptions.customConfig,D=t.extend(!0,{},D,r.searchoptions),e.logParamValue({paramName:"chooseBoxSetting",paramValue:D,methodName:"grid",className:FRAME_NAME,isDebug:!0});var y=e.chooseBox(r.fieldId,D);e.isEmptyType(r.searchDefVal)||y.set(r.searchDefVal);break;case"dictCode":var d=t('<input type="text" data-searchrule=\'{"field":"'+l+'","op":"'+r.sopt+'","type":"string"}\' id="'+r.fieldId+'" class="wui-input" />').appendTo(i),U={};r.searchoptions.customConfig&&t.extend(!0,U,r.searchoptions.customConfig),delete r.searchoptions.customConfig,U=t.extend(!0,{},U,r.searchoptions),e.logParamValue({paramName:"dictCodeSetting",paramValue:U,methodName:"grid",className:FRAME_NAME,isDebug:!0});var y=e.dictionaryCode(r.fieldId,U);e.isEmptyType(r.searchDefVal)||y.set(r.searchDefVal);break;case"userChooseBox":case"orgChooseBox":var d=t('<input type="text" data-searchrule=\'{"field":"'+l+'","op":"'+r.sopt+'","type":"string"}\' id="'+r.fieldId+'" class="wui-input" />').appendTo(i),D={maxNumber:1};r.searchoptions.customConfig&&t.extend(!0,D,r.searchoptions.customConfig),delete r.searchoptions.customConfig,D=t.extend(!0,{},D,r.searchoptions),e.logParamValue({paramName:"chooseBoxSetting",paramValue:D,methodName:"grid",className:FRAME_NAME,isDebug:!0});var y=e[a](r.fieldId,D);e.isEmptyType(r.searchDefVal)||y.set(r.searchDefVal);break;default:var d=t('<input type="text" data-searchrule=\'{"field":"'+l+'","op":"'+r.sopt+'","type":"string"}\' id="'+r.fieldId+'" class="wui-input" />').appendTo(i);if(e._hasOwnProperty(e,a))try{var R={maxNumber:1};r.searchoptions.customConfig&&(R=t.extend(!0,{},R,r.searchoptions.customConfig)),delete r.searchoptions.customConfig,R=t.extend(!0,{},R,r.searchoptions),e.logParamValue({paramName:"widgetSetting",paramValue:R,methodName:"grid",className:FRAME_NAME,isDebug:!0});var y=e[a](r.fieldId,R);e.isEmptyType(r.searchDefVal)||y.set(r.searchDefVal)}catch(L){e.logError("该类型无法进行初始化控件和set赋值","wui.grid",!0),d.val(r.searchDefVal)}}},_addSearchCondition:function(e,i){var r,n,o=this,a=this._opt,s=(this.$element,{});if(e.append('<td class="search-title '+a.searchBarSetting.labelClass+'">'+i.label+"：</td>\n"),a.isShowSearchOperator){var l=t('<td class="td-search-oper" headers=""></td>').appendTo(e);if(i.sopt||i.searchoptions){s=i.searchoptions||{},r=i.sopt?i.sopt:s.sopt?s.sopt[0]:"select"===i.stype?"eq":o.defaults.defaultSearch,n=null!=s.searchtitle?s.searchtitle:o.defaults.operandTitle;t('<a title="'+n+'" style="padding-right: 0.5em;" soper="'+r+'" class="soptclass" colname="'+i.label+'">'+o.defaults.operands[r]+"</a>").appendTo(l)}}var d=t('<td class="search-content '+a.searchBarSetting.contentClass+'"></td>\n').appendTo(e);this._createSearchElement(d,i)},showSearchBarRow:function(t){var i=this,r=this._opt;this.$element;if(!t){if(!(i.container.children(".wui-grid-searchBar").length>0))return e.logWarn("搜索栏无法检测到,可能是因为没有添加 .wui-grid-searchBar 样式类",FRAME_NAME+"."+_widgetName,!0),!1;t=i.container.children(".wui-grid-searchBar")}var n=t.find("tbody").eq(0).eq(0);n.find("tr").show(),r.isFullScreen?i._setGridFullScreen():i._setGridSize()},hideSearchBarRow:function(t){var i=this,r=this._opt;this.$element;if(!t){if(!(i.container.children(".wui-grid-searchBar").length>0))return e.logWarn("搜索栏无法检测到,可能是因为没有添加 .wui-grid-searchBar 样式类",FRAME_NAME+"."+_widgetName,!0),!1;t=i.container.children(".wui-grid-searchBar")}var n=t.find("tbody").eq(0).eq(0);n.find("tr:not(:first)").hide(),r.isFullScreen?i._setGridFullScreen():i._setGridSize()},buildSearchBarLayout:function(e){var i=this._opt,r=(this.$element,null),n=i.searchColNum,o=i.searchBarSetting,a=Math.ceil((100-parseInt(o.btnColWidth))/n)-1,s=a*o.titleColWidthRec/(o.titleColWidthRec+o.contentColWidthRec)+"%",l=a*o.contentColWidthRec/(o.titleColWidthRec+o.contentColWidthRec)+"%";if(o.isSetWidth){var d=e.children("thead");if(d&&d.length>0);else{d=t('<thead style="visibility: hidden"><tr></tr></thead>').prependTo(e);var u="";u+='<th style="width: '+s+'!important"></th>',u+='<th style="width: '+l+'!important"></th>';for(var h=0;h<n;h++)d.children("tr").append(u);d.children("tr").append('<th style="width: '+o.btnColWidth+'"></th>')}}return e.children("tbody")&&e.children("tbody").length>0?r=e.children("tbody"):(r=t("<tbody></tbody>"),e.append(r)),r},buildSearchBarDOMByData:function(i,r){var n=this,o=this._opt,a=(this.$element,o.searchColNum),s=(o.searchBarSetting,null),l=null,d=i.length,u=0;if(0==n.container.children(".wui-grid-searchBar").length?(s=t('<div class="wui-grid-searchBar"></div>'),n.container.prepend(s)):s=n.container.children(".wui-grid-searchBar").eq(0),0==s.find("table").length?(s.html('<table class="table table-responsive wui-grid-table"></table>'),l=s.children("table")):l=s.children("table").eq(0),0==s.find("form").length){var h='<form wui-attr="'+this.defaults.searchFormAttr+'" role="form"></form>';l.wrap(h)}else s.find("form").first().attr("wui-attr",this.defaults.searchFormAttr);e.validate("[wui-attr='"+this.defaults.searchFormAttr+"']");var c=n.buildSearchBarLayout(l),f=0;if(c.find("tr").length>0){var p=c.find("tr").last(),m=0;if(p.children("td").each(function(e,i){t(i).attr("colspan")?m+=parseInt(t(i).attr("colspan")):m++}),Math.ceil(m/2)<a){f=a-Math.ceil(m/2),u=d-f,u<0&&(f=d);for(var g=0;g<f;g++){var v=i[g];n._addSearchCondition(p,v)}}}else u=d;if(u>0)for(var b=Math.ceil(u/a),g=0;g<b;g++){var y=t("<tr></tr>");c.append(y);for(var x=g==b-1?u-g*a:a,w=0;w<x;w++){var S=g*a+w+f,v=i[S];n._addSearchCondition(y,v)}}0==l.find(".search-button").length&&n._setSearchBarButtons(s,c),o.isHideSearchRows&&n.hideSearchBarRow(s)},buildSearchBar:function(t){var i=this,r=this._opt,n=(this.$element,[]),o=(r.searchColNum,r.searchBarSetting,0);if(r.isShowSearchBar){t=t||r.groupOp;for(var a=i.colModel,s=0;s<a.length;s++){var l=a[s];l.searchoptions.searchhidden&&l.search&&n.push(l)}for(var d=n.length,s=0;s<d-1;s++)for(var u=0;u<d-1-s;u++)if(n[u].searchSort>n[u+1].searchSort){var h=n[u+1];n[u+1]=n[u],n[u]=h}return o=n.length,0==o?void e.logMessage("没有传入可搜索列","wui.grid",!0):void i.buildSearchBarDOMByData(n)}},getSearchFiltersData:function(){var i=this;if(i.container.children(".wui-grid-searchBar").length>0){var r=i.container.children(".wui-grid-searchBar"),n=e.getForm(r.children().get(0),"","value"),o=[];for(var a in n)if(!e.isEmptyType(n[a])&&t("#"+a).attr("data-searchrule")){var s=t("#"+a).attr("data-searchrule"),l=n[a];e.isArray(l)?l=l.join(","):e.isJson(l)&&(l=JSON.stringify(l));var d="";d=e.isString(l)?s.insert(',"data":"'+l.replace(/\\/g,"\\\\").replace(/\"/g,'\\"')+'"',s.length-1):s.insert(',"data":"'+l+'"',s.length-1),o.push(d)}return o}return!1},getRowData:function(e,t){var i=this.$element.jqGrid("getRowData",e,t);if(null==e){var r=this.$element.jqGrid("getDataIDs");r&&r.length>0&&i.push(this.$element.jqGrid("getRowData",r[r.length-1],t))}return i},searchGridFromSearchBar:function(i,r){var n=this,o=(this._opt,e.validate("[wui-attr='"+this.defaults.searchFormAttr+"']"));if(o||(o={valid:function(){return!0}}),o.valid()){var a=n.getSearchFiltersData();if(n.isLocalData()){var s=n._buildFilters(a),l=this.$element[0];l.p.search=!0,sdata={filters:s,searchField:"",searchOper:"",searchString:""},t.extend(l.p.postData,sdata),t(l).trigger("reloadGrid",[{page:1}])}else{var d=this.$element.jqGrid("getGridParam","url");r&&this.$element.jqGrid("setGridParam",{url:r}),a&&n.reloadGridByFilters(a,i),this.$element.jqGrid("setGridParam",{url:d})}}},_setSearchBarButtons:function(e,i){var r=this,n=this._opt,o=(this.$element,n.searchBarSetting),a="";if(a+='<td class="search-button '+n.searchBarSetting.btnCellClass+'">',a+='    <a wui-grid-action="search" href="javascript:void(0)" title="查询" class="wui-btn wui-btn-primary">',a+=o.searchText,a+="    </a>",a+='    <a wui-grid-action="reset" href="javascript:void(0)" title="刷新" class="wui-btn wui-btn-default">',a+=o.resetText,a+="    </a>",n.isHideSearchRows){var s=i.find("tr").length;s>1&&(a+='    <a wui-grid-action="show" href="javascript:void(0)" title="展开" class="wui-btn wui-btn-warning">',a+=o.showMoreText,a+="    </a>")}a+="</td>",i.find("tr").eq(0).append(a),i.find("[wui-grid-action]").each(function(i,n){t(n).on("click",function(){var i=t(this).attr("wui-grid-action");"search"==i?r.searchGridFromSearchBar():"reset"==i?r.resetGrid():"refresh"==i?r.refreshGrid():"show"==i?(t(this).attr("wui-grid-action","hide"),t(this).html(o.hideMoreText),r.showSearchBarRow(e)):"hide"==i&&(t(this).attr("wui-grid-action","show"),t(this).html(o.showMoreText),r.hideSearchBarRow(e))})})},customSearchBar:function(t,i){return 0==t.length?void e.logMessage("没有传入可搜索列","wui.grid",!0):void this.buildSearchBarDOMByData(t,i)},_hackHeight:function(){var i=this.element;t("#"+i+"_frozen tr").slice(1).each(function(){var r=(t(this).attr("id"),parseFloat(t("td:first",this).height())),n=parseFloat(t("#"+i+" #"+t(this).attr("id")).find("td:first").height());r<n&&t("td",this).each(function(){var i=0;e.CONSTANTS.isChrome()?i=.6:e.CONSTANTS.isIE()?i=-.2:e.CONSTANTS.isMozila()&&(i=.5),t(this).attr("style")&&t(this).attr("style").indexOf("height:")!=-1||t(this).attr("style",t(this).attr("style")+";height:"+(n+i)+"px !important")})})},_gridplueFrozen:function(){var i=this,r=(this._opt,this.element),n=this.$element;if(i.defaults.isFrozen){n.jqGrid("setFrozenColumns");var o=-1,a=-1,s=t("#gview_"+r+" .frozen-bdiv"),l=t("#gview_"+r+" .frozen-div"),d=t("#gview_"+r+" .ui-jqgrid-bdiv").eq(0);e.CONSTANTS.isOpera()&&(o=0,a=0),l&&l.each(function(e,i){t(i).css({})}),s&&s.each(function(e,i){t(i).css({height:d.height()})}),i._hackHeight()}},_screenGrid:function(e){var i=(this._opt,this.$element),r="<ul class='dropdown-menu checkbox-menu'></ul>",n=i.jqGrid("getGridParam","colModel"),o="";if(0==e.children(".dropdown-menu").length){e.append(r);for(var a=0;a<n.length;a++){var s=n[a],l=s.colmenu&&!s.key&&!s.frozen&&(s.hidden&&s.hidedlg||!s.hidden);if(l){var d="";d=s.hidedlg?"<input type='checkbox' value='"+s.name+"' />":"<input type='checkbox' checked value='"+s.name+"' />",o+="<li data-stopPropagation='true'><label class='checkbox'>"+d+" "+s.label+"</label></li>"}}e.find(".checkbox-menu").append(o)}t("ul.dropdown-menu").bind("click","[data-stopPropagation]",function(e){e.stopPropagation()}),t(".checkbox-menu li input:checkbox").bind("change",function(e){var r=t(this).val();1==t(this).prop("checked")?i.jqGrid().showCol(r).trigger("reloadGrid"):i.jqGrid().hideCol(r).trigger("reloadGrid");var n=i.parent().parent().width();i.width(n),i.parent().parent().prev().find(".ui-jqgrid-hbox").width(n),i.parent().parent().prev().find(".ui-jqgrid-htable").width(n)})},resetGrid:function(){var i=this,r=this.$element;if(i.container.children(".wui-grid-searchBar").length>0){var n=i.container.children(".wui-grid-searchBar").eq(0);e.emptyForm(n.children().get(0))}if(i.isLocalData()){wui.notice("本地重置");var o=this.$element[0];o.p.search=!0,sdata={filters:"",searchField:"",searchOper:"",searchString:""},t.extend(o.p.postData,sdata),t(o).trigger("reloadGrid",[{page:1}])}else{var a=r.jqGrid("getGridParam","postData");t.each(a,function(e,t){delete a[e]}),r.jqGrid("setGridParam",{page:1}).trigger("reloadGrid")}},refreshGrid:function(){var e=this._opt,t=this.$element,i=t.jqGrid("getGridParam","page");t.jqGrid("setGridParam",{url:e.url,datatype:e.dataType,page:i}).trigger("reloadGrid")},refreshData:function(){var e=this._opt,t=this.$element,i=t.jqGrid("getGridParam","page");t.jqGrid("setGridParam",{url:e.url,datatype:e.dataType,page:i}).trigger("reloadGrid")},getSelectedRows:function(t,r){var n=this,o=(this._opt,this.$element);r===i&&(r=!1);var a=o.jqGrid("getGridParam","keyName"),s=[],l=o.getGridParam("selarrrow"),d=l.length;if(r)if(t)for(var u=0;u<d;u++){var h=l[u],c=n.getRowDataById(h,!0);if(e.isArray(t)){for(var f={},p=0;p<t.length;p++){var m=t[p];f[m]=c[m]}s.push(f)}else{var f=c[t];s.push(f)}}else for(var u=0;u<d;u++){var h=l[u],f=n.getRowDataById(h,!0);s.push(f)}else if(t)for(var d=l.length,u=0;u<d;u++){var h=l[u];if(e.isArray(t)){for(var f={},p=0;p<t.length;p++){var m=t[p];m==a?f[m]=h:f[m]=o.jqGrid("getCell",h,m)}s.push(f)}else{var f=o.jqGrid("getCell",l[u],t);s.push(f)}}else for(var u=0;u<d;u++){var f=n.getRowDataById(l[u],!1);s.push(f)}return s},getRowDataById:function(e,r){var n=null,o=this.loadData,a=this.$element;if(r===i&&(r=!1),r){var s=a.jqGrid("getGridParam","keyName");t.each(o,function(t,i){if(i[s]==e)return n=i,!1})}else n=a.jqGrid("getRowData",e);return n},getRowsDataById:function(e,t){var r=this,n=(this._opt,this.$element,this.loadData);if(t===i&&(t=!1),e){"string"==typeof e&&(e=e.split(","));for(var o=e.length,a=[],s=0;s<o;s++){var l=r.getRowDataById(e[s],t);a.push(l)}return a}if(t)return n;var d=this.getRowData();return d},selectRows:function(e,i){var r=this,n=this._opt,o=this.$element,a=(this.element,e),s=n.maxNumber;if(i=i||!1,"string"==typeof e&&(a=e.split(",")),1==s)for(var l=0;l<a.length;l++){var d=a[l],u=r.container.find('[name="'+r._opt.singleColSetting.name+'"][value="'+d+'"]');if(u&&u.length>0){var h=u.last(),c=h.prop("checked");if(c)h.prop("checked",!1),h.removeAttr("checked");else{h.prop("checked",!0);var f=o.getGridParam("selarrrow");t.each(f,function(e,t){o.jqGrid("setSelection",t,!1)})}o.jqGrid("setSelection",d,i);break}}else for(var l=0;l<a.length;l++)o.jqGrid("setSelection",a[l],i);return!0},select:function(e,i){var r=this,n=this._opt,o=this.$element,a=(this.element,e),s=n.maxNumber;i=i||!1;var l=o.getGridParam("selarrrow"),d=[];if(e&&"string"==typeof e){a=e.split(",");for(var u=0;u<a.length;u++)l.indexOf(a[u])==-1&&d.push(a[u])}else if("object"==typeof a)for(var u=0;u<a.length;u++)l.indexOf(a[u])==-1&&d.push(a[u]);if(1==s)for(var u=0;u<d.length;u++){var h=d[u],c=r.container.find('[name="'+r._opt.singleColSetting.name+'"][value="'+h+'"]');if(c&&c.length>0){var f=c.last(),p=f.prop("checked");if(!p){f.prop("checked",!0);var m=o.getGridParam("selarrrow");t.each(m,function(e,t){o.jqGrid("setSelection",t,!1)}),o.jqGrid("setSelection",h,i)}break}}else for(var u=0;u<d.length;u++){var h=d[u];o.jqGrid("setSelection",h,i)}},unselect:function(e,t){var i=this,r=this._opt,n=this.$element,o=(this.element,e),a=r.maxNumber;t=t||!1;var s=n.getGridParam("selarrrow"),l=[];if(e&&"string"==typeof e){o=e.split(",");for(var d=0;d<o.length;d++)s.indexOf(o[d])>-1&&l.push(o[d])}else if("object"==typeof o)for(var d=0;d<o.length;d++)s.indexOf(o[d])>-1&&l.push(o[d]);if(1==a)for(var d=0;d<l.length;d++){var u=l[d],h=i.container.find('[name="'+i._opt.singleColSetting.name+'"][value="'+u+'"]');if(h&&h.length>0){var c=h.last(),f=c.prop("checked");f&&(c.removeAttr("checked"),n.jqGrid("setSelection",u,t))}}else for(var d=0;d<l.length;d++){var u=l[d];n.jqGrid("setSelection",u,t)}},selectAllRows:function(e,i){var r=(this._opt,this.$element),n=this.element;if(e=e||!1,i=i||!1,e){var o="cb_"+n;t("#"+o).prop("checked")||t("#"+o).trigger("change")}else r.jqGrid("resetSelection")},disableRows:function(e){var t=(this._opt,this.$element);e?"string"==typeof e&&(e=e.split(",")):e=t.jqGrid("getDataIDs");for(var i=0;i<e.length;i++)t.jqGrid("setSelection",e[i],!1)},enableRows:function(e){var t=(this._opt,this.$element);e?"string"==typeof e&&(e=e.split(",")):e=t.jqGrid("getDataIDs");for(var i=0;i<e.length;i++)t.jqGrid("setSelection",e[i],!0)},deleteSelectedRows:function(t,i){var r=this,n=(this._opt,this.$element),o=n.getGridParam("selarrrow");if(o&&o.length>0)if(i){var a=o.length,s="您当前选择了"+a+"条数据,您确定要删除选择数据吗？";r.defaults.windowModal.wui.confirm(s,{title:"删除确认"},function(){for(var t=0;t<a;t++)n.jqGrid("delRowData",o[0]);e.deleteDialog("dialog")})}else{var l=t.onSuccess||t.successCallback,d=t.onError||t.errorCallback;if(!t.url)return e.errorNotice("url不能为空"),!1;var u=function(t){l&&"function"==typeof l?l(t):r.refreshData(),e.deleteDialog("dialog")},h=function(t){d&&"function"==typeof d&&d(t),e.deleteDialog("dialog")},a=o.length,s="您当前选择了"+a+"条数据,您确定要删除选择数据吗？";r.defaults.windowModal.wui.confirm(s,{title:"删除确认"},function(){var i={rowids:o.join(",")},r=e.buildUrl(t.url,i);e.ajax({method:t.method,url:r,data:t.data,dataType:t.dataType,contentType:t.contentType,onSuccess:u,onError:h})})}else e.warnNotice("请至少选择一条数据")},showFilterSearch:function(){var e=this,i=(this._opt,this.element),r="#gview_"+i,n=null,o=t(r+" .ui-jqgrid-bdiv"),a=null,s=null;if(0==t(r+" .ui-search-toolbar").length&&(this.$element.jqGrid("filterToolbar",{searchOnEnter:!0,searchOperators:!0}),t(r+" .ui-search-toolbar").hide()),n=t(r+" .ui-search-toolbar"),o=t(r+" .ui-jqgrid-bdiv"),a=n.outerHeight(),s=o.outerHeight(),n.is(":hidden")){n.show();var s=s-a;o.height(s)}else{n.hide();var s=s+a;o.height(s)}e._gridplueFrozen()},showSearchGrid:function(){t("#search_"+this.element).click()},exportGrid:function(e){var t=this._opt,i=this.$element;e=e||{},onBeforeExport=e.onBeforeExport||t.onBeforeExport;var r=e.url||t.exportUrl;i.jqGrid("excelExport",{url:r,beforeExport:onBeforeExport})},_getSopt:function(e){e=e||"text";var t;switch(e){case"text":case"string":t=["cn","eq","ne","bw","bn","ew","en","nc","nu","nn","in","ni"];break;case"boolean":t=["eq","ne"];break;case"date":t=["eq","ne","lt","le","gt","ge"];break;case"dateRange":t=["ge","le"];break;case"num":case"number":t=["eq","ne","lt","le","gt","ge","nu","nn","in","ni"];break;case"numRange":t=["ge","le"];break;case"int":case"integer":t=["eq","ne","lt","le","gt","ge","nu","nn","in","ni"];break;case"intRange":t=["ge","le"];break;case"double":t=["eq","ne","lt","le","gt","ge","nu","nn","in","ni"];break;case"doubleRange":t=["ge","le"];break;case"checkbox":t=["eq"];break;case"select":case"dictCode":t=["eq"];break;case"selectbox":case"selectBox":t=["eq","cn","nc"];break;case"choosebox":case"chooseBox":t=["eq","cn","nc"];break;default:t=["cn"]}return t},searchGrid:function(i,r,n,o){e.logParamValue({paramName:"colFilters",paramValue:i,methodName:"grid.searchGrid",className:FRAME_NAME,isDebug:!0}),e.logParamValue({paramName:"postSearchJson",paramValue:r,
methodName:"grid.searchGrid",className:FRAME_NAME,isDebug:!0});var a=this,s=this._opt,l=this.$element,d={};i=i||null,r=r||null,o=o||null;var u=l.jqGrid("getGridParam","url");if(n&&l.jqGrid("setGridParam",{url:n}),r&&e.isJson(r)&&(d=r),i&&e.isArray(i)){var h=a._buildFilters(i,o);d.filters=h}var c=l.jqGrid("getGridParam","postData");if(t.each(c,function(e,t){delete c[e]}),s.onBeforeSearchGrid&&"function"==typeof s.onBeforeSearchGrid){var f=s.onBeforeSearchGrid.call(this.$element.get(0),d);f&&e.isJson(f)&&(d=f)}l.jqGrid("setGridParam",{postData:d,page:1}).trigger("reloadGrid"),l.jqGrid("setGridParam",{url:u})},option:function(t){var r=this._opt;if(!t)return r;if("object"==typeof t)this._resetOption(t);else if("string"==typeof t)return"getDefOpt"===t?P:r[t]==i?e.logWarn("查找的属性值不存在",FRAME_NAME+"."+_widgetName,!0):r[t]},_resetOption:function(e){var i=this,r=this._opt;t(i._opt.gridToolbar)&&t(i._opt.gridToolbar).length>0&&t(i._opt.gridToolbar).remove(),t(i._grid[0].p.pager).remove();try{t.jgrid.clearBeforeUnload(i.element),t("#gbox_"+i.element).remove()}catch(n){}i.container.html(i.initDom),t.data(document.getElementById(i.element),_pluginDataName,this);var o=t.extend(!0,{},r,e);this.init(o)},addRowsData:function(t){var i=this,r=(this._opt,this.$element),n=i.defaults.keyField;if(r.find(".jqgird-no-text").remove(),!n)return e.logError("没有设置行数据的key字段,无法添加行数据","wui.grid",!0),!1;for(var o=0;o<t.length;o++){var a=t[o];r.jqGrid("addRowData",a[n],t[o])}},setGroupHeaders:function(e){e=t.extend({useColSpanStyle:!1,groupHeaders:[]},e||{}),this.$element.jqGrid("setGroupHeaders",e)},destroy:function(){var e=this;this.$element.removeAttr("ui-type"),e.$element.removeData(_pluginDataName),t.jgrid.gridDestroy(e.element),t(e._opt.gridToolbar)&&t(e._opt.gridToolbar).length>0&&t(e._opt.gridToolbar).remove(),e.container.html(e.initDom)},on:function(e,t){return"undefined"==typeof this.handlers[e]&&(this.handlers[e]=[],this.listeners.push(e)),this.handlers[e].push(t),this},off:function(e,t){var r,n,o,a,s;if(this.handlers[e]instanceof Array){for(a=this.handlers[e],o=this.listeners,r=0,s=o.length;r<s&&o[r]!==e;r++);if(t===i)this.listeners.splice(r,1),delete this.handlers[e];else{for(n=0,s=a.length;n<s&&a[n]!==t;n++);n<s&&(this.handlers[e].splice(n,1),0==this.handlers[e].length&&this.listeners.splice(r,1))}}return this},emit:function(e){if(e.target||(this.$Maxcontainer?e.target=this.$Maxcontainer:e.target=this),!(this.handlers[e.type]instanceof Array))return!1;for(var t=this.handlers[e.type],i=0,r=t.length;i<r;i++)return t[i](e)},component:function(){return this}},t.fn[O]=function(e){return this.each(function(){t.data(document.getElementById(r),_pluginDataName)||t.data(document.getElementById(r),_pluginDataName,new o(this,e))})},L(n),{init:L,on:s,off:l,select:h,unselect:c,selectRows:d,selectAllRows:u,getSelectedRows:m,getRowsDataById:g,getSearchFiltersData:w,deleteSelectedRows:f,searchGridFromSearchBar:S,showSearchBarRow:N,hideSearchBarRow:C,searchGrid:y,customSearchBar:b,resetGrid:E,refreshData:T,refreshGrid:_,exportGrid:M,showSearchGrid:F,showFilterSearch:I,option:D,disableRows:A,enableRows:B,addRowsData:v,setGroupHeaders:k,scroll:x,component:R,mergerRows:$,destroy:U}},e}(wui||{},libs),function(e,t,i){return e.ueditor=function(r,n){function o(e,t){this.init()}function a(i,n){var o=t.data(document.getElementById(r),S);if(!o)return void e.logError("wui.ueditor 未初始化或已被销毁",FRAME_NAME+"."+N,!0);var a=Array.prototype.slice.call(arguments,1);return"function"==typeof o[i]?o[i].apply(o,a):void e.logWarn("wui.ueditor 中不存在 "+i+"() 方法",FRAME_NAME+"."+N,!0)}function s(e,i){var n=t.data(document.getElementById(r),S);return a("on",e,i),n}function l(e,i){var n=t.data(document.getElementById(r),S);return a("off",e,i),n}function d(e,t){return a("set",e,t)}function u(e){return a("get",e)}function h(e){return a("disabled",e)}function c(){return a("enabled")}function f(){return a("readonly")}function p(){return a("readwrite")}function m(e){return a("option",e)}function g(){return a("empty")}function v(){return a("reset")}function b(){return a("destroy")}function y(){return a("component")}function x(i){return t.data(document.getElementById(r),S)?i&&e.isJson(i)?a("option",i):void 0:void t("#"+r)[w](i)}var w="uiUeditor",S="plugin_"+w,N="ueditor";if(e.logMethodCalled({className:FRAME_NAME,methodName:N,isDebug:!0,id:r}),!e.checkIsLoadPlugins(N))return!1;if(!t("#"+r).exist())return e.logError("【"+N+"】当前页面不存在 ID 为"+r+" 的DOM节点",FRAME_NAME+"."+N,!0),!1;var C=["overMaxWords"],E={toolbars:[["undo","redo","|","bold","italic","underline","strikethrough","superscript","subscript","insertorderedlist","insertunorderedlist","rowspacingtop","rowspacingbottom","lineheight","|","fontfamily","fontsize","|","insertimage","pagebreak","|","date","time","spechars","|","inserttable","deletetable","insertparagraphbeforetable","insertrow","deleterow","insertcol","deletecol","mergecells","mergeright","mergedown","splittocells","splittorows","splittocols","|","preview","searchreplace"]],elementPathEnabled:!1,wordCount:!0,maximumWords:500,initialFrameWidth:"100%",initialFrameHeight:320,allHtmlEnabled:!1,autoSyncData:!0,initialContent:e.language.ueditor.initialContent,wordOverFlowMsg:e.language.ueditor.wordOverFlowMsg},_={postfix:"_ueditor"};return o.prototype={constructor:o,init:function(){this.pluginName=N,this.element=r,this.$element=t("#"+r),this.defaults=_,this.hasDom=!1,this.initDom=this.$element.prop("outerHTML");var o=e.getAttributeParams(this.$element,E);n=t.extend(!0,{},n,o),this._opt=t.extend(!0,{},E,n),n.toolbars!==i&&(this._opt.toolbars=n.toolbars),this.ueElement=t("<textarea></textarea>"),this.$Maxcontainer=null,this.$viewBox=null,this.ueditor=null,this.listeners=[],this.handlers={},this._formatParams(),this.dom=this._buildContainer()},_initUeditor:function(){var e=this._opt,t=this.element;this.ueditor=UE.getEditor(t,e),this._bindEvent()},_buildContainer:function(){var e=this,t=(this._opt,this.$element);if(!t.parent().hasClass("wui-ueditor")){var i='<div class="wui-ueditor"></div>';t.wrap(i)}this.$Maxcontainer=t.parent();var r=t.get(0).tagName.toLowerCase();if("script"==r)this.ueElement=t;else if("textarea"==r)this.ueElement=t;else if("input"==r){t.hide(),t.after(this.ueElement),this.element=e.element+e.defaults.postfix,this.ueElement.attr("id",this.element);var n=t.val();this.ueElement.val(n)}else if("div"==r){t.hide(),t.after(this.ueElement),this.element=e.element+e.defaults.postfix,this.ueElement.attr("id",this.element);var n=t.val();this.ueElement.val(n)}return this.ueElement.attr("name")||this.ueElement.attr("name",this.ueElement.attr("id")),this.name=this.ueElement.attr("name"),this._initUeditor(),t.attr("ui-type",N),this.hasDom=!0,this.$Maxcontainer.prop("outerHTML")},_formatParams:function(){var t=this._opt;this._opt.maximumWords=e.formatMaxNumber(t.maximumWords);var i=t.value;e.parseToObj(i)&&(this._opt.value=e.parseToObj(i))},_bindEvent:function(){var i=this,r=this._opt,n=this.ueditor,o="",a="",s="";n.ready(function(){n.addListener("contentchange",function(){a=n.getContent();var l=n.getContentLength(!0);if(l<=r.maximumWords){o=a,s=n.getContentTxt();var d=i.$element.get(0);d.form&&t.data(d.form,"validator")&&!e.isEmptyType(i.$element.rules())&&e.validElement(i.$element)}else if(r.onOverMaxWords&&"function"==typeof r.onOverMaxWords)r.onOverMaxWords(r.maximumWords,l);else if(i.listeners.indexOf("overMaxWords")>-1&&!i.emit({type:"overMaxWords",maxWords:r.maximumWords,contentLength:l}))return})})},option:function(t){var r=this._opt;if(!t)return r;if("object"==typeof t);else if("string"==typeof t)return"getDefOpt"===t?E:r[t]==i?e.logWarn("查找的属性值不存在",FRAME_NAME+"."+N,!0):r[t]},_resetOption:function(e){var t=this._opt;e.popPageUrl!=i&&e.popPageUrl!=t.popPageUrl&&""!=e.popPageUrl&&(this._opt.popPageUrl=e.popPageUrl)},get:function(e){var t=this.ueditor;e=e||"html";var i="";return i="all"==e?t.getAllHtml():"text"==e?t.getContentTxt():"plain"==e?t.getPlainTxt():"html"==e?t.getContent():t.getContent()},set:function(e,t){var i=this.ueditor;e=e||"",t=t||!1,i.ready(function(){i.setContent(e,t)})},disabled:function(e){var i=this.ueditor;return e=e||"",i.ready(function(){i.setDisabled(e),t(i.iframe).parent().addClass("disabled")}),this},enabled:function(){var e=this.ueditor;return e.ready(function(){e.setEnabled(),t(e.iframe).parent().removeClass("disabled")}),this},readonly:function(e){var t=this.ueditor;return e=e||"",t.ready(function(){t.setDisabled(e)}),this},readwrite:function(){var e=this.ueditor;return e.ready(function(){e.setEnabled()}),this},reset:function(){var e=this.ueditor;return e.ready(function(){e.reset()}),this},empty:function(){var e=this.ueditor;e.ready(function(){e.setContent("")})},render:function(e){var t=this.ueditor;t.ready(function(){t.render(e)})},destroy:function(){var e=this,t=this.ueditor;return t.ready(function(){t.destroy(),e.$element.removeData(S),this.$element.removeAttr("ui-type"),e.$Maxcontainer.replaceWith(e.initDom)}),this},on:function(e,t){var i=this.ueditor;return C.indexOf(e)>-1?("undefined"==typeof this.handlers[e]&&(this.handlers[e]=[],this.listeners.push(e)),this.handlers[e].push(t)):i.addListener(e,t),this},off:function(e,t){var r,n,o,a,s,l=this.ueditor;if(C.indexOf(e)>-1){if(this.handlers[e]instanceof Array){for(a=this.handlers[e],o=this.listeners,r=0,s=o.length;r<s&&o[r]!==e;r++);if(t===i)this.listeners.splice(r,1),delete this.handlers[e];else{for(n=0,s=a.length;n<s&&a[n]!==t;n++);n<s&&(this.handlers[e].splice(n,1),0==this.handlers[e].length&&this.listeners.splice(r,1))}}}else l.removeListener(e,t);return this},emit:function(e){var t=this.ueditor;if(e.target||(this.$Maxcontainer?e.target=this.$Maxcontainer:e.target=this),!(this.handlers[e.type]instanceof Array))return t.fireEvent(e.type);for(var i=this.handlers[e.type],r=0,n=i.length;r<n;r++)return i[r](e),!0;return!1},component:function(){return this}},t.fn[w]=function(e,i,n){return this.each(function(){t.data(document.getElementById(r),S)||t.data(document.getElementById(r),S,new o(this,e))})},x(n),{init:x,on:s,off:l,get:u,set:d,enabled:c,disabled:h,readwrite:p,readonly:f,destroy:b,option:m,reset:v,component:y,empty:g}},e}(wui||{},libs);
//# sourceMappingURL=wui.min.js.map
